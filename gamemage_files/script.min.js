!function(e){!function t(e,s,i){function o(a,r){if(!s[a]){if(!e[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=s[a]={exports:{}};e[a][0].call(c.exports,function(t){var s=e[a][1][t];return o(s?s:t)},c,c.exports,t,e,s,i)}return s[a].exports}for(var n="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,s,i){var o=o||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,s=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,n=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),r=e.webkitRequestFileSystem,l=e.requestFileSystem||r||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",h=0,f=4e4,u=function(e){var t=function(){"string"==typeof e?s().revokeObjectURL(e):e.remove()};setTimeout(t,f)},_=function(e,t,s){t=[].concat(t);for(var i=t.length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,s||e)}catch(n){c(n)}}},m=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},g=function(t,c,f){f||(t=m(t));var g,p,v,b=this,y=t.type,w=!1,z=function(){_(b,"writestart progress write writeend".split(" "))},k=function(){if(p&&a&&"undefined"!=typeof FileReader){var i=new FileReader;return i.onloadend=function(){var e=i.result;p.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),b.readyState=b.DONE,z()},i.readAsDataURL(t),void(b.readyState=b.INIT)}if((w||!g)&&(g=s().createObjectURL(t)),p)p.location.href=g;else{var o=e.open(g,"_blank");void 0===o&&a&&(e.location.href=g)}b.readyState=b.DONE,z(),u(g)},C=function(e){return function(){return b.readyState!==b.DONE?e.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};return b.readyState=b.INIT,c||(c="download"),o?(g=s().createObjectURL(t),void setTimeout(function(){i.href=g,i.download=c,n(i),z(),u(g),b.readyState=b.DONE})):(e.chrome&&y&&y!==d&&(v=t.slice||t.webkitSlice,t=v.call(t,0,t.size,d),w=!0),r&&"download"!==c&&(c+=".download"),(y===d||r)&&(p=e),l?(h+=t.size,void l(e.TEMPORARY,h,C(function(e){e.root.getDirectory("saved",x,C(function(e){var s=function(){e.getFile(c,x,C(function(e){e.createWriter(C(function(s){s.onwriteend=function(t){p.location.href=e.toURL(),b.readyState=b.DONE,_(b,"writeend",t),u(e)},s.onerror=function(){var e=s.error;e.code!==e.ABORT_ERR&&k()},"writestart progress write abort".split(" ").forEach(function(e){s["on"+e]=b["on"+e]}),s.write(t),b.abort=function(){s.abort(),b.readyState=b.DONE},b.readyState=b.WRITING}),k)}),k)};e.getFile(c,{create:!1},C(function(e){e.remove(),s()}),C(function(e){e.code===e.NOT_FOUND_ERR?s():k()}))}),k)}),k)):void k())},p=g.prototype,v=function(e,t,s){return new g(e,t,s)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,s){return s||(e=m(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(p.abort=function(){var e=this;e.readyState=e.DONE,_(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,v)}}("undefined"!=typeof self&&self||"undefined"!=typeof e&&e||this.content);"undefined"!=typeof s&&s.exports?s.exports.saveAs=o:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return o})},{}],2:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./constants"),a=t("./utils"),r=["staff","admin","global_mod"],l=["turbo","warcraft","bits"],c=["subscriber","ffz-badge-1"],d=["bits"],h=["subscriber"],f={"global-moderator":"global_mod"},u={broadcaster:0,staff:0,admin:0,global_mod:0,mod:1,moderator:1,subscriber:10},m={global_mod:"Global Moderator"},g={global_mod:"global-moderator"};o.settings_info.show_badges={type:"boolean",value:!0,category:"Chat Appearance",name:"Additional Badges",help:"Show additional badges for bots, FrankerFaceZ donors, and other special users."},o.settings_info.hidden_badges={type:"button",value:[],category:"Chat Appearance",name:"Hidden Badges",help:"Any badges added to this list will not be displayed in chat.",on_update:function(e){if(!this.has_bttv){var t=a.ember_lookup("controller:chat"),s=t&&t.get("currentRoom.messages");if(s)for(var i=0;i<s.length;i++)s[i]._line&&s[i]._line.ffzUpdateBadges()}},method:function(){var t=this,s=a.ember_lookup("service:badges"),i=s&&s.badgeCollection,o=t.settings.hidden_badges.join(", "),n=[];if(i){if(i.global)for(var r in i.global)i.global.hasOwnProperty(r)&&"broadcasterName"!==r&&n.push("<code>"+r+"</code>");if(i.channel)for(var r in i.channel)i.channel.hasOwnProperty(r)&&"broadcasterName"!==r&&n.push("<code>"+r+"</code>")}for(var l in t.badges)if(t.badges.hasOwnProperty(l)){var r=t.badges[l],c=(r.source_ext?t._apis[r.source_ext].name_key:"ffz")+"-"+(r.name||r.id);n.push("<code>"+c+"</code>")}if(this.has_bttv&&e.BetterTTV)try{for(var l in BetterTTV.chat.store.__badgeTypes)n.push("<code>bttv-"+l+"</code>");n.push("<code>bot</code>")}catch(d){this.error("Unable to load known BetterTTV badges.",d)}a.prompt("Hidden Badges","Please enter a comma-separated list of badges that you would like to be hidden in chat.</p><p><b>Possible Values:</b> "+_.unique(n).join(", "),o,function(e){null!==e&&void 0!==e&&t.settings.set("hidden_badges",_.unique(e.trim().toLowerCase().split(/\s*,\s*/)))},600)}},o.settings_info.sub_notice_badges={type:"boolean",value:!1,category:"Chat Appearance",name:"Old-Style Subscriber Notice Badges",no_bttv:!0,help:"Display a subscriber badge on old-style chat messages about new subscribers.",on_update:function(e){this.toggle_style("badges-sub-notice",!this.has_bttv&&!e),this.toggle_style("badges-sub-notice-on",!this.has_bttv&&e)}},o.settings_info.legacy_badges={type:"select",options:{0:"Default",1:"Moderator Only",2:"Mod + Turbo",3:"All Legacy Badges"},value:0,category:"Chat Appearance",name:"Legacy Badges",help:"Use the old, pre-vector chat badges from Twitch in place of the new.",process_value:function(e){return e===!1?0:e===!0?3:"string"==typeof e?parseInt(e||"0"):e},on_update:function(e){this.toggle_style("badges-legacy",3===e),this.toggle_style("badges-legacy-mod",0!==e),this.toggle_style("badges-legacy-turbo",e>1)}},o.settings_info.transparent_badges={type:"select",options:{0:"Default",1:"Rounded",2:"Circular",3:"Circular (Color Only)",4:"Circular (Color Only, Small)",5:"Transparent"},value:0,category:"Chat Appearance",no_bttv:!0,name:"Badge Style",help:"Make badges appear rounded, completely circular, or transparent with no background at all.",process_value:function(e){return e===!1?0:e===!0?5:"string"==typeof e?parseInt(e||"0"):e},on_update:function(e){this.has_bttv||(this.toggle_style("badges-rounded",1===e),this.toggle_style("badges-circular",2===e||3===e||4===e),this.toggle_style("badges-blank",3===e||4===e),this.toggle_style("badges-circular-small",4===e),this.toggle_style("badges-transparent",5===e),document.body.classList.toggle("ffz-transparent-badges",5===e))}},o.prototype.setup_badges=function(){if(!this.has_bttv){var e=this.settings.transparent_badges;this.toggle_style("badges-rounded",1===e),this.toggle_style("badges-circular",2===e||3===e||4===e),this.toggle_style("badges-blank",3===e||4===e),this.toggle_style("badges-circular-small",4===e),this.toggle_style("badges-transparent",5===e),document.body.classList.toggle("ffz-transparent-badges",5===e),this.toggle_style("badges-sub-notice",!this.settings.sub_notice_badges),this.toggle_style("badges-sub-notice-on",this.settings.sub_notice_badges)}this.toggle_style("badges-legacy",3===this.settings.legacy_badges),this.toggle_style("badges-legacy-mod",0!==this.settings.legacy_badges),this.toggle_style("badges-legacy-turbo",this.settings.legacy_badges>1),this.log("Preparing badge system."),this.badges={},this.log("Creating badge style element.");var t=this._badge_style=document.createElement("style");t.id="ffz-badge-css",document.head.appendChild(t),this.log("Loading badges."),this.load_badges()},o.ws_commands.reload_badges=function(){this.load_badges()},o.ws_commands.set_badge=function(e){var t=e[0],s=e[1],i=e[2],o=this.users[t]=this.users[t]||{},n=o.badges=o.badges||{};n[s]=void 0===i||null===i?null:i},o.prototype.get_badges=function(e,t,s,i){var o=this.users[e],n=this.settings.hidden_badges;if(!o||!o.badges||!this.settings.show_badges)return s;for(var a in o.badges){var r=o.badges[a];if(o.badges.hasOwnProperty(a)&&r){var l=this.badges[r.id]||{},c=s[a],d=(l.source_ext?this._apis[l.source_ext].name_key:"ffz")+"-"+(l.name||l.id);if(-1===n.indexOf(d)){if(void 0!==l.visible){var h=l.visible;if("function"==typeof h&&(h=h.call(this,t,e,i,s)),!h)continue}if(c){var f=r.hasOwnProperty("replaces")?r.replaces:l.replaces;if(!f)continue;c.image=r.image||l.image,c.klass+=" ffz-badge-replacement",c.title+=", "+(r.title||l.title)}else s[a]={klass:"ffz-badge-"+r.id,title:r.title||l.title||"Unknown FFZ Badge\nID: "+r.id,image:r.image,full_image:l.image,color:r.color,no_invert:r.no_invert||l.no_invert,invert_invert:r.invert_invert||l.invert_invert,transparent:r.transparent||l.transparent||"transparent"===(r.color||l.color),extra_css:r.extra_css}}}}return s},o.prototype.get_line_badges=function(e){var t={},s=this.settings.hidden_badges,i=-1,o=!1,n=e.get&&e.get("room")||e.room,r=e.get&&e.get("from")||e.from,f=e.get&&e.get("tags")||e.tags||{},_=f.badges||{},p=a.ember_lookup("service:badges"),v=p&&p.badgeCollection,b=v&&v.global||{},y=v&&v.channel||{};if(Array.isArray(_)){var w=_;_={};for(var z=0;z<w.length;z++)_[w[z].id]=w[z].version}else if("string"==typeof _){var w=_.split(",");_={};for(var z=0;z<w.length;z++){var k=w[z].split("/");2===k.length&&(_[k[0]]=k[1])}}for(var C in _){var x=_[C];if(_.hasOwnProperty(C)&&x){var T=y[C]||b[C],S=T&&T.versions&&T.versions[x];if(-1===s.indexOf(C)){u.hasOwnProperty(C)?i=u[C]:(i=o?i+1:15,o=!0);var E=u.hasOwnProperty(C)||-1!==l.indexOf(C);t[i]={klass:(g[C]||C)+(E?"":" unknown-badge")+" version-"+x,title:S&&S.title||m[C]||C.capitalize(),click_url:S&&"visit_url"===S.click_action&&S.click_url,no_invert:-1!==c.indexOf(C),invert_invert:-1!==d.indexOf(C),transparent:-1!==h.indexOf(C)},!E&&S&&(t[i].image=S.image_url_1x,t[i].srcSet='url("'+S.image_url_1x+'") 1x, url("'+S.image_url_2x+'") 2x, url("'+S.image_url_4x+'") 4x')}}}return this.get_badges(r,n,t,e)},o.prototype.get_other_badges=function(e,t,s,i,o){var n={};if(t&&e===t)n[0]={klass:"broadcaster",title:"Broadcaster"};else for(var a=0,l=r.length;l>a;a++){var c=r[a];if(s===c){n[0]={klass:g[c]||c,title:m[c]||c.capitalize()};break}}return i&&(n[10]={klass:"subscriber",title:"Subscriber",no_invert:!0,transparent:!0}),o&&(n[15]={klass:"turbo",title:"Turbo"}),this.get_badges(e,t,n,null)},o.prototype.render_badges=function(e){var t=[];for(var s in e){var i=e[s],o=i.klass,n=i.image?'background-image:url("'+a.quote_attr(i.image)+'");':"";i.srcSet&&(n+="background-image:-webkit-image-set("+i.srcSet+");background-image:image-set("+i.srcSet+");"),i.color&&(n+="background-color:"+i.color+";"),i.extra_css&&(n+=i.extra_css),i.click_url&&(o+=" click_url"),i.no_invert&&(o+=" no-invert"),i.invert_invert&&(o+=" invert-invert"),i.transparent&&(o+=" transparent"),t.push('<div class="badge html-tooltip '+a.quote_attr(o)+'"'+(i.click_url?' data-url="'+a.quote_attr(i.click_url)+'"':"")+(n?' style="'+a.quote_attr(n)+'"':"")+' title="'+a.quote_attr(i.title)+'"></div>')}return t.join("")},o.prototype.bttv_badges=function(e){if(this.settings.show_badges){var t=e.sender,s=this.users[t],i=[],o=-1,n=this.settings.hidden_badges,r=BetterTTV.settings.get("alphaTags");e.badges||(e.badges=[]);for(var l=0;l<e.badges.length;l++){var c=e.badges[l],d=c.type.indexOf(" "),h=-1!==d?c.type.substr(0,d):c.type;if(0===h.indexOf("twitch-")&&(h=h.substr(7)),f.hasOwnProperty(h))h=f[h];else{var u=h.indexOf("-");-1!==u&&(h=h.substr(0,u))}-1===n.indexOf(h)?-1!==o||"subscriber"!==c.type&&"turbo"!==c.type&&"twitch-"!==c.type.substr(0,7)||(o=l):(e.badges.splice(l,1),l--)}if(s&&s.badges){for(var _ in s.badges){var c=s.badges[_];if(s.badges.hasOwnProperty(_)&&c){var m=this.badges[c.id]||{},g=c.title||m.title,p="",v=(m.source_ext?this._apis[m.source_ext].name_key:"ffz")+"-"+(m.name||m.id);if(-1===n.indexOf(v)){if(void 0!==m.visible){var b=m.visible;if("function"==typeof b&&(b=b.call(this,null,t)),!b)continue}if(m.replaces){for(var y=!1,l=0;l<e.badges.length;l++){var w=e.badges[l];if(w.type===m.replaces_type){w.type="ffz-badge-replacement "+w.type,w.description+=", "+(c.title||m.title)+'" style="background-image: url('+a.quote_attr('"'+(c.image||m.image)+'"')+")",y=!0;break}}if(y)continue}r&&c.transparent_image?p+='background-image: url("'+c.transparent_image+'");':c.image&&(p+='background-image: url("'+c.image+'");'),c.color&&!r&&(p+="background-color: "+c.color+"; "),c.extra_css&&(p+=c.extra_css),p&&(g+='" style="'+a.quote_attr(p)),i.push([(-1==o?1:-1)*_,{type:"ffz-badge-"+c.id+(r?" alpha":""),name:"",description:g}])}}}if(i.sort(function(e,t){return e[0]-t[0]}),-1==o)for(;i.length;)e.badges.push(i.shift()[1]);else for(;i.length;)e.badges.insertAt(o,i.shift()[1])}}},o.bttv_known_bots=["nightbot","moobot","sourbot","xanbot","manabot","mtgbot","ackbot","baconrobot","tardisbot","deejbot","valuebot","stahpbot"],o.prototype.load_badges=function(e,t){var s=this;jQuery.getJSON(n.API_SERVER+"v1/badges").done(function(t){for(var i=0,o=0,n={},r=0;r<t.badges.length;r++){var l=t.badges[r];l&&l.name&&(s._load_badge_json(l.id,l),i++)}if(t.users)for(var c in t.users)if(t.users.hasOwnProperty(c)&&s.badges[c]){var l=s.badges[c],d=t.users[c];n[l.name]=d.length;for(var r=0;r<d.length;r++){var h=d[r],f=s.users[h]=s.users[h]||{},u=f.badges=f.badges||{};o++,u[l.slot]={id:l.id}}s.log('Added "'+l.name+'" badge to '+a.number_commas(d.length)+" users.")}var _=s.users.zenwan=s.users.zenwan||{},u=_.badges=_.badges||{};u[1]||o++,u[1]={id:2,image:"//cdn.frankerfacez.com/script/momiglee_badge.png",title:"WAN"},s.log("Loaded "+a.number_commas(o)+" total badges across "+i+" types."),"function"==typeof e&&e(!0,o,i,n)}).fail(function(i){return 404===i.status?"function"==typeof e&&e(!1):(t=(t||0)+1,10>t?setTimeout(s.load_badges.bind(s,e,t),500+500*t):(s.error("Unable to load badge data. [HTTP Status "+i.status+"]",i),void("function"==typeof e&&e(!1))))})},o.prototype._load_badge_json=function(e,t){this.badges[e]=t,t.replaces&&(t.replaces_type=t.replaces,t.replaces=!0),"developer"===t.name&&(t.no_invert=!0),"bot"===t.name&&(t.visible=function(e,t){return!(this.has_bttv&&-1!==o.bttv_known_bots.indexOf(t))}),a.update_css(this._badge_style,e,a.badge_css(t))}},{"./constants":6,"./utils":53}],3:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./utils"),a=function(e,t,s){return 0>s&&(s+=1),s>1&&(s-=1),1/6>s?e+6*(t-e)*s:.5>s?t:2/3>s?e+(t-e)*(2/3-s)*6:e},r=function(e){return.04045>=e?e/12.92:Math.pow((e+.055)/1.055,2.4)},l=function(e){return.0031308>=e?12.92*e:Math.pow(1.055*e,1/2.4)-.055};o.settings_info.fix_color={type:"select",options:{"-1":"Disabled",0:["Default (Unprocessed)",1],6:["HSL Luma (New Default)",2],1:["Luv Luma (Old Default)",3],5:["HSL Loop (BTTV-Like)",4],2:["HSL Adjustment (Deprecated)",5],3:["HSV Adjustment (Deprecated)",6],4:["RGB Adjustment (Deprecated)",7]},value:6,category:"Chat Appearance",no_bttv:!0,name:"Username Colors",help:"Ensure that username colors contrast with the background enough to be readable.",process_value:function(e){return e===!1?0:e===!0?1:("string"==typeof e&&(e=parseInt(e),(Number.isNaN(e)||!Number.isFinite(e))&&(e=6)),e)},on_update:function(e){this.toggle_style("chat-colors-gray",!this.has_bttv&&-1===e),this.has_bttv||-1===e||this._rebuild_colors()}},o.settings_info.luv_contrast={type:"button",value:4.5,category:"Chat Appearance",no_bttv:!0,name:"Username Colors - Luv Minimum Contrast",help:"Set the minimum contrast ratio used by Luv Adjustment to ensure colors are readable.",method:function(){var e=this,t=this.settings.luv_contrast;n.prompt("Luv Adjustment Minimum Contrast Ratio","Please enter a new value for the minimum contrast ratio required between username colors and the background.</p><p><b>Default:</b> 4.5",t,function(t){if(null!==t&&void 0!==t){var s=parseFloat(t);(Number.isNaN(s)||!Number.isFinite(s))&&(s=4.5),e.settings.set("luv_contrast",s)}})},on_update:function(e){this._rebuild_contrast(),this._rebuild_filter_styles(),this.has_bttv||1!==this.settings.fix_color||this._rebuild_colors()}},o.settings_info.color_blind={type:"select",options:{0:"Disabled",protanope:"Protanope",deuteranope:"Deuteranope",tritanope:"Tritanope"},value:"0",category:"Chat Appearance",no_bttv:!0,name:"Username Colors - Color Blindness",help:"Adjust username colors in an attempt to make them more distinct for people with color blindness.",on_update:function(e){this.has_bttv||-1===this.settings.fix_color||this._rebuild_colors()}},o.prototype.setup_colors=function(){this.toggle_style("chat-colors-gray",!this.has_bttv&&-1===this.settings.fix_color),this._hex_colors={},this._rebuild_contrast(),this._update_colors();var e=n.ember_lookup("service:layout"),t=n.ember_lookup("controller:settings");e&&e.addObserver("isTheatreMode",this._update_colors.bind(this,!0)),t&&t.addObserver("settings.darkMode",this._update_colors.bind(this,!0)),this._color_old_darkness=e&&e.get("isTheatreMode")||t&&t.get("settings.darkMode")},o.Color={},o.Color._canvas=null,o.Color._context=null,o.Color.CVDMatrix={protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]};var c=o.Color.RGBA=function(e,t,s,i){this.r=e||0,this.g=t||0,this.b=s||0,this.a=i||0},d=o.Color.HSVA=function(e,t,s,i){this.h=e||0,this.s=t||0,this.v=s||0,this.a=i||0},h=o.Color.HSLA=function(e,t,s,i){this.h=e||0,this.s=t||0,this.l=s||0,this.a=i||0},f=o.Color.XYZA=function(e,t,s,i){this.x=e||0,this.y=t||0,this.z=s||0,this.a=i||0},u=o.Color.LUVA=function(e,t,s,i){this.l=e||0,this.u=t||0,this.v=s||0,this.a=i||0};c.prototype.eq=function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a},c.fromName=function(e){var t=o.Color._context;if(!t){var s=o.Color._canvas=document.createElement("canvas");t=o.Color._context=s.getContext("2d")}t.clearRect(0,0,1,1),t.fillStyle=e,t.fillRect(0,0,1,1);var i=t.getImageData(0,0,1,1);return i&&i.data&&4===i.data.length?new c(i.data[0],i.data[1],i.data[2],i.data[3]/255):null},c.fromCSS=function(e){if(!e)return null;if(e=e.trim(),"#"===e.charAt(0))return c.fromHex(e);var t=/rgba?\( *(\d+%?) *, *(\d+%?) *, *(\d+%?) *(?:, *([\d\.]+))?\)/i.exec(e);if(t){var s=t[1],i=t[2],o=t[3],n=t[4];return s="%"===s.charAt(s.length-1)?255*(parseInt(s)/100):parseInt(s),i="%"===i.charAt(i.length-1)?255*(parseInt(i)/100):parseInt(i),o="%"===o.charAt(o.length-1)?255*(parseInt(o)/100):parseInt(o),n=n?"%"===n.charAt(n.length-1)?parseInt(n)/100:parseFloat(n):1,new c(Math.min(Math.max(0,s),255),Math.min(Math.max(0,i),255),Math.min(Math.max(0,o),255),Math.min(Math.max(0,n),1))}return c.fromName(e)},c.fromHex=function(e){var t=parseInt("#"===e.charAt(0)?e.substr(1):e,16);return new c(t>>16,t>>8&255,255&t,1)},c.fromHSVA=function(e,t,s,i){var o,n,a,r=Math.floor(6*e),l=6*e-r,d=s*(1-t),h=s*(1-l*t),f=s*(1-(1-l)*t);switch(r%6){case 0:o=s,n=f,a=d;break;case 1:o=h,n=s,a=d;break;case 2:o=d,n=s,a=f;break;case 3:o=d,n=h,a=s;break;case 4:o=f,n=d,a=s;break;case 5:o=s,n=d,a=h}return new c(Math.round(Math.min(Math.max(0,255*o),255)),Math.round(Math.min(Math.max(0,255*n),255)),Math.round(Math.min(Math.max(0,255*a),255)),void 0===i?1:i)},c.fromXYZA=function(e,t,s,i){var o=3.240479*e-1.53715*t-.498535*s,n=-.969256*e+1.875992*t+.041556*s,a=.055648*e-.204043*t+1.057311*s;return new c(Math.max(0,Math.min(255,255*l(o))),Math.max(0,Math.min(255,255*l(n))),Math.max(0,Math.min(255,255*l(a))),void 0===i?1:i)},c.fromHSLA=function(e,t,s,i){if(0===t){var o=Math.round(Math.min(Math.max(0,255*s),255));return new c(o,o,o,void 0===i?1:i)}var n=.5>s?s*(1+t):s+t-s*t,r=2*s-n;return new c(Math.round(Math.min(Math.max(0,255*a(r,n,e+1/3)),255)),Math.round(Math.min(Math.max(0,255*a(r,n,e)),255)),Math.round(Math.min(Math.max(0,255*a(r,n,e-1/3)),255)),void 0===i?1:i)},c.prototype.toHSVA=function(){return d.fromRGBA(this.r,this.g,this.b,this.a)},c.prototype.toHSLA=function(){return h.fromRGBA(this.r,this.g,this.b,this.a)},c.prototype.toCSS=function(){return"rgb"+(1!==this.a?"a":"")+"("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+(1!==this.a?","+this.a:"")+")"},c.prototype.toXYZA=function(){return f.fromRGBA(this.r,this.g,this.b,this.a)},c.prototype.toLUVA=function(){return this.toXYZA().toLUVA()},c.prototype.toHex=function(){var e=this.b|this.g<<8|this.r<<16;return"#"+(16777216+e).toString(16).slice(1)},c.prototype.get_Y=function(){return(.299*this.r+.587*this.g+.114*this.b)/255},c.prototype.luminance=function(){var e=r(this.r/255),t=r(this.g/255),s=r(this.b/255);return.2126*e+.7152*t+.0722*s},c.prototype.brighten=function(e){return e="number"==typeof e?e:1,e=Math.round(255*(e/100)),new c(Math.max(0,Math.min(255,this.r+e)),Math.max(0,Math.min(255,this.g+e)),Math.max(0,Math.min(255,this.b+e)),this.a)},c.prototype.daltonize=function(e,t){t="number"==typeof t?t:1;var s;if("string"==typeof e){if(!o.Color.CVDMatrix.hasOwnProperty(e))throw"Invalid CVD matrix.";s=o.Color.CVDMatrix[e]}else s=e;var i,n,a,r,l,d,h,f,u,_,m,g,p=s[0],v=s[1],b=s[2],y=s[3],w=s[4],z=s[5],k=s[6],C=s[7],x=s[8];return i=17.8824*this.r+43.5161*this.g+4.11935*this.b,n=3.45565*this.r+27.1554*this.g+3.86714*this.b,a=.0299566*this.r+.184309*this.g+1.46709*this.b,r=p*i+v*n+b*a,l=y*i+w*n+z*a,d=k*i+C*n+x*a,h=.0809444479*r+-.130504409*l+.116721066*d,f=-.0102485335*r+.0540193266*l+-.113614708*d,u=-.000365296938*r+-.00412161469*l+.693511405*d,h=this.r-h,f=this.g-f,u=this.b-u,_=0*h+0*f+0*u,m=.7*h+1*f+0*u,g=.7*h+0*f+1*u,h=Math.min(Math.max(0,_+this.r),255),f=Math.min(Math.max(0,m+this.g),255),u=Math.min(Math.max(0,g+this.b),255),new c(h,f,u,this.a)},c.prototype._r=function(e){return new c(e,this.g,this.b,this.a)},c.prototype._g=function(e){return new c(this.r,e,this.b,this.a)},c.prototype._b=function(e){return new c(this.r,this.g,e,this.a)},c.prototype._a=function(e){return new c(this.r,this.g,this.b,e)},h.prototype.eq=function(e){return e.h===this.h&&e.s===this.s&&e.l===this.l&&e.a===this.a},h.fromRGBA=function(e,t,s,i){e/=255,t/=255,s/=255;var o,n,a=Math.max(e,t,s),r=Math.min(e,t,s),l=Math.min(Math.max(0,(a+r)/2),1),c=Math.min(Math.max(0,a-r),1);if(0===c)o=n=0;else{switch(n=l>.5?c/(2-a-r):c/(a+r),a){case e:o=(t-s)/c+(s>t?6:0);break;case t:o=(s-e)/c+2;break;case s:o=(e-t)/c+4}o/=6}return new h(o,n,l,void 0===i?1:i)},h.prototype.targetLuminance=function(e){var t=this.s;t*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;for(var s=0,i=1,o=(i-s)/2,n=s+o;o>1/65536;o/=2,n=s+o){var a=c.fromHSLA(this.h,t,n,1).luminance();a>e?i=n:s=n}return new h(this.h,t,n,this.a)},h.prototype.toRGBA=function(){return c.fromHSLA(this.h,this.s,this.l,this.a)},h.prototype.toCSS=function(){return"hsl"+(1!==this.a?"a":"")+"("+Math.round(360*this.h)+","+Math.round(100*this.s)+"%,"+Math.round(100*this.l)+"%"+(1!==this.a?","+this.a:"")+")"},h.prototype.toHSVA=function(){return this.toRGBA().toHSVA()},h.prototype.toXYZA=function(){return this.toRGBA().toXYZA()},h.prototype.toLUVA=function(){return this.toRGBA().toLUVA()},h.prototype._h=function(e){return new h(e,this.s,this.l,this.a)},h.prototype._s=function(e){return new h(this.h,e,this.l,this.a)},h.prototype._l=function(e){return new h(this.h,this.s,e,this.a)},h.prototype._a=function(e){return new h(this.h,this.s,this.l,e)},d.prototype.eq=function(e){return e.h===this.h&&e.s===this.s&&e.v===this.v&&e.a===this.a},d.fromRGBA=function(e,t,s,i){e/=255,t/=255,s/=255;var o,n=Math.max(e,t,s),a=Math.min(e,t,s),r=Math.min(Math.max(0,n-a),1),l=0===n?0:r/n,c=n;if(0===r)o=0;else{switch(n){case e:o=(t-s)/r+(s>t?6:0);break;case t:o=(s-e)/r+2;break;case s:o=(e-t)/r+4}o/=6}return new d(o,l,c,void 0===i?1:i)},d.prototype.toRGBA=function(){return c.fromHSVA(this.h,this.s,this.v,this.a)},d.prototype.toHSLA=function(){return this.toRGBA().toHSLA()},d.prototype.toXYZA=function(){return this.toRGBA().toXYZA()},d.prototype.toLUVA=function(){return this.toRGBA().toLUVA()},d.prototype._h=function(e){return new d(e,this.s,this.v,this.a)},d.prototype._s=function(e){return new d(this.h,e,this.v,this.a)},d.prototype._v=function(e){return new d(this.h,this.s,e,this.a)},d.prototype._a=function(e){return new d(this.h,this.s,this.v,e)},f.prototype.eq=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},f.fromRGBA=function(e,t,s,i){var o=r(e/255),n=r(t/255),a=r(s/255);return new f(.412453*o+.35758*n+.180423*a,.212671*o+.71516*n+.072169*a,.019334*o+.119193*n+.950227*a,void 0===i?1:i)},f.fromLUVA=function(e,t,s,i){var o=1/(f.WHITE.x+15*f.WHITE.y+3*f.WHITE.z),n=4*f.WHITE.x*o,a=9*f.WHITE.y*o,r=e>8?Math.pow((e+16)/116,3):e/f.KAPPA,l=1/3*(52*e/(t+13*e*n)-1),c=-5*r,d=-1/3,h=r*(39*e/(s+13*e*a)-5),u=(h-c)/(l-d),_=u*l+c;return new f(u,r,_,void 0===i?1:i)},f.prototype.toRGBA=function(){return c.fromXYZA(this.x,this.y,this.z,this.a)},f.prototype.toLUVA=function(){return u.fromXYZA(this.x,this.y,this.z,this.a)},f.prototype.toHSLA=function(){return this.toRGBA().toHSLA()},f.prototype.toHSVA=function(){return this.toRGBA().toHSVA()},f.prototype._x=function(e){return new f(e,this.y,this.z,this.a)},f.prototype._y=function(e){return new f(this.x,e,this.z,this.a)},f.prototype._z=function(e){return new f(this.x,this.y,e,this.a)},f.prototype._a=function(e){return new f(this.x,this.y,this.z,e)},f.EPSILON=Math.pow(6/29,3),f.KAPPA=Math.pow(29/3,3),f.WHITE=new c(255,255,255,1).toXYZA(),u.prototype.eq=function(e){return e.l===this.l&&e.u===this.u&&e.v===this.v},u.fromXYZA=function(e,t,s,i){var o=1/(f.WHITE.x+15*f.WHITE.y+3*f.WHITE.z),n=4*f.WHITE.x*o,a=9*f.WHITE.y*o,r=t/f.WHITE.y,l=e+15*t+3*s;0===l&&(l=1);var c=1/l,d=4*e*c,h=9*t*c,_=r>f.EPSILON?116*Math.pow(r,1/3)-16:f.KAPPA*r,m=13*_*(d-n),g=13*_*(h-a);return new u(_,m,g,void 0===i?1:i)},u.prototype.toXYZA=function(){return f.fromLUVA(this.l,this.u,this.v,this.a)},u.prototype.toRGBA=function(){return this.toXYZA().toRGBA()},u.prototype.toHSLA=function(){return this.toXYZA().toHSLA()},u.prototype.toHSVA=function(){return this.toXYZA().toHSVA()},u.prototype._l=function(e){return new u(e,this.u,this.v,this.a)},u.prototype._u=function(e){return new u(this.l,e,this.v,this.a)},u.prototype._v=function(e){return new u(this.l,this.u,e,this.a)},u.prototype._a=function(e){return new u(this.l,this.u,this.v,e)},o.prototype._rebuild_contrast=function(){this._luv_required_bright=new f(0,this.settings.luv_contrast*(new c(35,35,35,1).toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luv_required_dark=new f(0,(new c(217,217,217,1).toXYZA().y+.05)/this.settings.luv_contrast-.05,0,1).toLUVA().l,this._luv_background_bright=new f(0,this.settings.luv_contrast*(c.fromCSS("#3c3a41").toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luv_background_dark=new f(0,(c.fromCSS("#acacbf").toXYZA().y+.05)/this.settings.luv_contrast-.05,0,1).toLUVA().l,this._hslluma_required_bright=this.settings.luv_contrast*(c.fromCSS("#17141f").luminance()+.05)-.05,this._hslluma_required_dark=(c.fromCSS("#efeef1").luminance()+.05)/this.settings.luv_contrast-.05},o.prototype._rebuild_colors=function(){this.has_bttv||(this._hex_colors={},this._update_colors())},o.prototype._update_colors=function(e){var t=n.ember_lookup("service:layout"),s=n.ember_lookup("controller:settings"),i=t&&t.get("isTheatreMode")||s&&s.get("settings.darkMode"),o=this.settings.dark_twitch||t&&t.get("isTheatreMode");if(!e||this._color_old_darkness!==i){this._color_old_darkness=i;for(var a=document.querySelectorAll(".has-color"),r=0,l=a.length;l>r;r++){var c=a[r],d=c.getAttribute("data-color"),h=d&&this._handle_color(d);h&&(c.style.color=(c.classList.contains("replay-color")?o:i)?h[1]:h[0])}}},o.prototype._handle_filter_color=function(e){e instanceof c||(e=c.fromCSS(e));var t=e,s=e,i=e.toLUVA();return i.l<this._luv_background_bright&&(t=i._l(this._luv_background_bright).toRGBA()),i.l>this._luv_background_dark&&(s=i._l(this._luv_background_dark).toRGBA()),[t,s]},o.prototype._handle_color=function(e){if(e instanceof c&&(e=e.toCSS()),!e)return null;if(this._hex_colors.hasOwnProperty(e))return this._hex_colors[e];var t=c.fromCSS(e),s=t,i=t;if("0"!==this.settings.color_blind){var o=t.daltonize(this.settings.color_blind);t.eq(o)||(t=o,s=i=t)}if(1===this.settings.fix_color){var n=t.toLUVA();n.l>this._luv_required_dark&&(s=n._l(this._luv_required_dark).toRGBA()),n.l<this._luv_required_bright&&(i=n._l(this._luv_required_bright).toRGBA())}if(2===this.settings.fix_color){var a=t.toHSLA();s=a._l(Math.min(Math.max(0,.7*a.l),1)).toRGBA(),i=a._l(Math.min(Math.max(0,.3+.7*a.l),1)).toRGBA()}if(3===this.settings.fix_color){var r=t.toHSVA();0===r.s?(s=r._v(Math.min(Math.max(.5,.5*r.v),1)).toRGBA(),i=r._v(Math.min(Math.max(.5,.5+.5*r.v),1)).toRGBA()):(s=c.fromHSVA(r.h,Math.min(Math.max(.7,.7+.3*r.s),1),Math.min(.7,r.v),r.a),i=c.fromHSVA(r.h,Math.min(.7,r.s),Math.min(Math.max(.7,.7+.3*r.v),1),r.a))}if(4===this.settings.fix_color){var l=t.luminance();if(l>.3){for(var d=127,h=t;d--&&(h=h.brighten(-1),!(h.luminance()<=.3)););s=h}if(.15>l){for(var d=127,h=t;d--&&(h=h.brighten(),!(h.luminance()>=.15)););i=h}}if(5===this.settings.fix_color){for(;s.get_Y()>=.5;){var a=s.toHSLA();s=a._l(Math.min(Math.max(0,.9*a.l),1)).toRGBA()}for(;i.get_Y()<.5;){var a=i.toHSLA();i=a._l(Math.min(Math.max(0,.1+.9*a.l),1)).toRGBA()}}if(6===this.settings.fix_color){var l=t.luminance();l>this._hslluma_required_dark&&(s=t.toHSLA().targetLuminance(this._hslluma_required_dark).toRGBA()),l<this._hslluma_required_bright&&(i=t.toHSLA().targetLuminance(this._hslluma_required_bright).toRGBA())}var f=this._hex_colors[e]=[s.toHex(),i.toHex()];return f}},{"./utils":53}],4:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./utils");o.ffz_commands.log=function(e,t){this._pastebin(this._log_data.join("\n"),function(t){return t?void this.room_message(e,"Your FrankerFaceZ log has been pasted to: "+t):this.room_message(e,"There was an error uploading the FrankerFaceZ log.")})},o.ffz_commands.reload=function(e,t){var s=this,i=[];i.push(new Promise(function(e,t){s.load_badges(function(t,s,i,o){e(t?[s,i,o]:[0,0,{}])})}));for(var o in this.emote_sets){var a=this.emote_sets[o];a&&!a.hasOwnProperty("source_ext")&&i.push(new Promise(function(e,t){s.load_set(o,e)}))}Promise.all(i).then(function(t){try{var i=0,o=t[0][0],a=t[0][1],r=t[0][2],l=t.length-1,c=[];if(t.length>1)for(var d=1;d<t.length;d++)t[d]&&i++;for(var h in r)r.hasOwnProperty(h)&&c.push(h+": "+r[h]);s.room_message(e,"Loaded "+n.number_commas(o)+" badge"+n.pluralize(o)+" across "+n.number_commas(a)+" badge type"+n.pluralize(a)+(c.length?" ("+c.join(", ")+")":"")+". Successfully reloaded "+n.number_commas(i)+" of "+n.number_commas(l)+" emoticon set"+n.pluralize(l)+".")}catch(f){s.room_message(e,"An error occured running the command."),s.error("Error Running FFZ Reload",f)}})},o.chat_commands.card=function(e,t){if(!t||!t.length||t.length>1)return"Usage: /card <username>";if(!this._roomv)return"An error occured. (We don't have the Room View.)";var s,i,o=this._roomv.get("element"),n=o&&o.querySelector("textarea"),a=n&&n.getBoundingClientRect(),r=0,l=0;a||(a=o&&o.getBoundingClientRect()||document.body.getBoundingClientRect()),a&&(a.left>400?(i=a.left-40,s=a.top+a.height):(r=a.left-20,s=a.top-20)),this._roomv.get("controller").send("showModOverlay",{top:l,left:r,bottom:s,right:i,sender:t[0]})},o.ffz_commands.massunmod=function(e,t){if(t=t.join(" ").trim(),!t.length)return"You must provide a list of users to unmod.";t=t.split(/\W*,\W*/);var s=this.get_user();if(!s||!s.login==e.id)return"You must be the broadcaster to use massunmod.";if(t.length>50)return"Each user you unmod counts as a single message. To avoid being globally banned, please limit yourself to 50 at a time and wait between uses.";for(var i=t.length;t.length;){var o=t.shift();

e.room.tmiRoom.sendMessage("/unmod "+o)}return"Sent unmod command for "+i+" users."},o.ffz_commands.massunmod.help="Usage: /ffz massunmod <list, of, users>\nBroadcaster only. Unmod all the users in the provided list.",o.ffz_commands.massmod=function(e,t){if(t=t.join(" ").trim(),!t.length)return"You must provide a list of users to mod.";t=t.split(/\W*,\W*/);var s=this.get_user();if(!s||!s.login==e.id)return"You must be the broadcaster to use massmod.";if(t.length>50)return"Each user you mod counts as a single message. To avoid being globally banned, please limit yourself to 50 at a time and wait between uses.";for(var i=t.length;t.length;){var o=t.shift();e.room.tmiRoom.sendMessage("/mod "+o)}return"Sent mod command for "+i+" users."},o.ffz_commands.massmod.help="Usage: /ffz massmod <list, of, users>\nBroadcaster only. Mod all the users in the provided list."},{"./utils":53}],5:[function(e,t,s){s["badges-blank"]=".badges .badge:not(.subscriber):not(.unknown-badge){background-size:0!important}",s["badges-circular-small"]=".badges .badge:not(.subscriber):not(.unknown-badge){height:10px;min-width:10px;margin:5px 3px 5px 0}",s["badges-circular"]=".badges .badge:not(.unknown-badge):not(.transparent){border-radius:9px;background-size:16px;background-repeat:no-repeat;background-position:center}",s["badges-legacy-mod"]=".badges .moderator{background-color:#068c10;background-image:url(//cdn.frankerfacez.com/script/legacy-mod.png)}",s["badges-legacy-turbo"]=".badges .turbo{background-color:#6441a3;background-image:url(//cdn.frankerfacez.com/script/legacy-turbo.png)}",s["badges-legacy"]=".badges .staff{background-color:#6441a5;background-image:url(//cdn.frankerfacez.com/script/legacy-staff.png)}.badges .broadcaster{background-color:#000;background-image:url(//cdn.frankerfacez.com/script/legacy-broadcaster.png)}.badges .admin{background-color:#ff0303;background-image:url(//cdn.frankerfacez.com/script/legacy-admin.png)}",s["badges-rounded"]=".badges .badge:not(.subscriber):not(.unknown-badge){border-radius:2px}",s["badges-sub-notice-on"]=".chat-line.notification .indicator{display:none!important}",s["badges-sub-notice"]=".chat-line.notification .badge.subscriber{display:none}",s["badges-transparent"]=".badges .badge{background-color:transparent!important}.badge:not(.no-invert):not(.invert-invert),.dark .badge.invert-invert,.ffz-dark .badge.invert-invert,.force-dark .badge.invert-invert,.theatre .badge.invert-invert{filter:invert(75%);-webkit-filter:invert(75%)}.dark .badge:not(.invert-invert),.ffz-dark .badge:not(.invert-invert),.force-dark .badge:not(.invert-invert),.theatre .badge:not(.invert-invert){filter:none!important;-webkit-filter:none!important}",s["chat-background"]=".conversation-window .new-message-divider:after,.conversation-window .timestamp-line:after,.mentioned:empty,.mentioning:empty{display:none}.chat-line:nth-child(2n+0):before,.conversation-chat-lines>div:nth-child(2n+0):before{background-color:rgba(0,0,0,.1)}.dark .chat-line:nth-child(2n+0):before,.ffz-dark .chat-history .chat-line:nth-child(2n+0):before,.ffz-dark .conversation-chat-lines>div:nth-child(2n+0):before,.force-dark .chat-line:nth-child(2n+0):before,.theatre .chat-line:nth-child(2n+0):before,.theatre .conversation-chat-lines>div:nth-child(2n+0):before{background-color:rgba(255,255,255,.05)}.chat-line.whisper:before{background-color:rgba(185,163,227,.2)}.chat-line.whisper:nth-child(2n+0):before{background-color:rgba(185,163,227,.4)}.dark .chat-line.whisper:before,.force-dark .chat-line.whisper:before,.theatre .chat-line.whisper:before{background-color:rgba(100,65,165,.2)}.dark .chat-line.whisper:nth-child(2n+0):before,.force-dark .chat-line.whisper:nth-child(2n+0):before,.theatre .chat-line.whisper:nth-child(2n+0):before{background-color:rgba(100,65,165,.4)}.chat-history .chat-line.original-sender:before{background-color:rgba(0,127,255,.2)}.chat-history .chat-line.original-sender:nth-child(2n+0):before{background-color:rgba(0,127,255,.4)}.dark .chat-history .chat-line.original-sender:before,.force-dark .chat-history .chat-line.original-sender:before,.theatre .chat-history .chat-line.original-sender:before{background-color:rgba(0,63,127,.2)}.dark .chat-history .chat-line.original-sender:nth-child(2n+0):before,.force-dark .chat-history .chat-line.original-sender:nth-child(2n+0):before,.theatre .chat-history .chat-line.original-sender:nth-child(2n+0):before{background-color:rgba(0,63,127,.4)}.chat-history .chat-line.original-msg:before{background-color:rgba(0,255,127,.4)}.chat-history .chat-line.original-msg:nth-child(2n+0):before{background-color:rgba(0,255,127,.8)}.dark .chat-history .chat-line.original-msg:before,.force-dark .chat-history .chat-line.original-msg:before,.theatre .chat-history .chat-line.original-msg:before{background-color:rgba(0,127,63,.4)}.dark .chat-history .chat-line.original-msg:nth-child(2n+0):before,.force-dark .chat-history .chat-line.original-msg:nth-child(2n+0):before,.theatre .chat-history .chat-line.original-msg:nth-child(2n+0):before{background-color:rgba(0,127,63,.8)}.chat-history .chat-line.original-msg span.has-color{color:#000!important}.dark .chat-history .chat-line.original-msg span.has-color,.force-dark .chat-history .chat-line.original-msg span.has-color,.theatre .chat-history .chat-line.original-msg span.has-color{color:#fff!important}.chat-line.ffz-mentioned:before{background-color:rgba(255,127,127,.2)}.chat-line.ffz-mentioned:nth-child(2n+0):before,.chat-lines>div:nth-child(2n+0)>.chat-line.ffz-mentioned:before{background-color:rgba(255,127,127,.4)}.dark .chat-line.ffz-mentioned:before,.ffz-dark .chat-history .chat-line.ffz-mentioned:before,.force-dark .chat-line.ffz-mentioned:before,.theatre .chat-line.ffz-mentioned:before{background-color:rgba(255,0,0,.2)!important}.dark .chat-line.ffz-mentioned:nth-child(2n+0):before,.dark .chat-lines>div:nth-child(2n+0)>.chat-line.ffz-mentioned:before,.ffz-dark .chat-history .chat-line.ffz-mentioned:nth-child(2n+0):before,.force-dark .chat-line.ffz-mentioned:nth-child(2n+0):before,.force-dark .chat-lines>div:nth-child(2n+0)>.chat-line.ffz-mentioned:before,.theatre .chat-line.ffz-mentioned:nth-child(2n+0):before,.theatre .chat-lines>div:nth-child(2n+0)>.chat-line.ffz-mentioned:before{background-color:rgba(255,0,0,.3)!important}.chat-line .mentioned,.chat-line .mentioning{border-radius:10px;padding:3px 7px;font-weight:700;color:#323232;background-color:rgba(255,255,255,.75)}.app-main.theatre .chat-container .chat-line .mentioned,.app-main.theatre .chat-container .chat-line .mentioning,.chat-container.dark .chat-line .mentioned,.chat-container.dark .chat-line .mentioning,.chat-container.force-dark .chat-line .mentioned,.chat-container.force-dark .chat-line .mentioning,.ember-chat-container.dark .chat-line .mentioned,.ember-chat-container.dark .chat-line .mentioning,.ember-chat-container.force-dark .chat-line .mentioned,.ember-chat-container.force-dark .chat-line .mentioning,.ffz-dark .chat-history .mentioned,.ffz-dark .chat-history .mentioning{color:#8c8c8c;background-color:rgba(16,16,16,.75)}.conversation-window .new-message-divider span,.conversation-window .timestamp-line span{background-color:transparent}",s["chat-colors-gray"]=".chat-line:not(.admin):not(.notification) span.from,.chat-line:not(.admin):not(.notification) span.message{color:inherit!important}",s["chat-hc-background"]=".chat-container,.ember-chat-container,body.ffz-bttv .chat-container,body.ffz-bttv .chat-messages,body.ffz-bttv .ember-chat.roomMode{background-color:#fff!important}.chat-container.dark,.chat-container.force-dark,.ember-chat-container.dark,.ember-chat-container.force-dark,.theatre .chat-container,.theatre .ember-chat-container,body.ffz-bttv-dark .chat-header,body.ffz-bttv-dark .chat-interface,body.ffz-bttv-dark .chat-messages{background-color:#000!important}",s["chat-hc-bold"]=".chat-line .colon,.chat-line .from,.chat-line .message{font-weight:700}",s["chat-hc-text"]=".chat-container,.ember-chat-container,body.ffz-bttv .chat-line .message,body.ffz-bttv .chat-line .timestamp{color:#000!important}.chat-container.dark,.chat-container.force-dark,.ember-chat-container.dark,.ember-chat-container.force-dark,.ffz-dark .chat-container.dark .chat-line,.ffz-dark .ember-chat-container.dark .chat-line,.theatre .chat-container,.theatre .ember-chat-container,body.ffz-bttv-dark .chat-container,body.ffz-bttv-dark .chat-line .message,body.ffz-bttv-dark .chat-line .timestamp{color:#fff!important}",s["chat-padding"]=".conversation-window .conversation-chat-line,.conversation-window .conversation-system-messages,.conversation-window .timestamp-line,.ember-chat .chat-messages .chat-line,.ember-chat .chat-messages .chat-line.admin{padding:5px}.ember-chat .chat-messages .chat-line.brick--marked{padding-left:8px}.conversation-window .conversation-chat-lines{padding-top:0}",s["chat-separator-3d-inset"]=".chat-line:before,.conversation-chat-lines>div:before{border-top:1px solid #aaa;border-bottom-color:rgba(255,255,255,.5)}.dark .chat-line:before,.ffz-dark .conversation-chat-lines>div:before,.force-dark .chat-line:before,.theatre .chat-line:before,.theatre .conversation-chat-lines>div:before{border-top-color:#000;border-bottom-color:rgba(255,255,255,.1)}",s["chat-separator-3d"]=".chat-line:before,.conversation-chat-lines>div:before{border-top:1px solid rgba(255,255,255,.5)}.dark .chat-line:before,.ffz-dark .conversation-chat-lines>div:before,.force-dark .chat-line:before,.theatre .chat-line:before,.theatre .conversation-chat-lines>div:before{border-top-color:rgba(255,255,255,.1)}",s["chat-separator-wide"]=".chat-line:before,.conversation-chat-lines>div:before{border-top:1px solid #aaa}.dark .chat-line:before,.ffz-dark .conversation-chat-lines>div:before,.force-dark .chat-line:before,.theatre .chat-line:before,.theatre .conversation-chat-lines>div:before{border-top-color:#000}",s["chat-separator"]=".chat-line:before,.conversation-chat-lines>div:before{border-bottom:1px solid #aaa}.dark .chat-line:before,.ffz-dark .conversation-chat-lines>div:before,.force-dark .chat-line:before,.theatre .chat-line:before,.theatre .conversation-chat-lines>div:before{border-bottom-color:#000}.chat-line:first-of-type:before,.conversation-chat-lines>div:first-child:before{border-top-color:transparent!important}.chat-line:last-of-type:nth-child(odd):before,.conversation-chat-lines>div:last-child:nth-child(odd):before{border-bottom-color:transparent!important}",s["chat-setup"]='.chat-line,.conversation-chat-lines>div{position:relative;z-index:1}.chat-line:before,.conversation-chat-lines>div:before{content:"";position:absolute;z-index:-1;left:0;right:0;top:2px;bottom:1px}.chat-history .chat-line:before{top:0;bottom:0}.chat-line.brick--marked{box-shadow:none}.chat-line.brick--marked:before{box-shadow:3px 0 0 #6441a4 inset}',s["chat-user-bg"]='.chat-lines .chat-line[data-sender="{user_id}"]:before{background-color:rgba(0,127,255,.2)}.chat-lines .chat-line[data-sender="{user_id}"]:nth-child(2n+0):before{background-color:rgba(0,127,255,.4)}.dark .chat-lines .chat-line[data-sender="{user_id}"]:before,.force-dark .chat-lines .chat-line[data-sender="{user_id}"]:before,.theatre .chat-lines .chat-line[data-sender="{user_id}"]:before{background-color:rgba(0,63,127,.2)}.dark .chat-lines .chat-line[data-sender="{user_id}"]:nth-child(2n+0):before,.force-dark .chat-lines .chat-line[data-sender="{user_id}"]:nth-child(2n+0):before,.theatre .chat-lines .chat-line[data-sender="{user_id}"]:nth-child(2n+0):before{background-color:rgba(0,63,127,.4)}'},{}],6:[function(e,t,s){var i="m120.95 1.74c4.08-0.09 8.33-0.84 12.21 0.82 3.61 1.8 7 4.16 11.01 5.05 2.08 3.61 6.12 5.46 8.19 9.07 3.6 5.67 7.09 11.66 8.28 18.36 1.61 9.51 7.07 17.72 12.69 25.35 3.43 7.74 1.97 16.49 3.6 24.62 2.23 5.11 4.09 10.39 6.76 15.31 1.16 2 4.38 0.63 4.77-1.32 1.2-7.1-2.39-13.94-1.97-21.03 0.38-3.64-0.91-7.48 0.25-10.99 2.74-3.74 4.57-8.05 7.47-11.67 3.55-5.47 10.31-8.34 16.73-7.64 2.26 2.89 5.13 5.21 7.58 7.92 2.88 4.3 6.52 8.01 9.83 11.97 1.89 2.61 3.06 5.64 4.48 8.52 2.81 4.9 4 10.5 6.63 15.49 2.16 6.04 5.56 11.92 5.37 18.5 0.65 1.95 0.78 4 0.98 6.03 1.01 3.95 2.84 8.55 0.63 12.42-2.4 5.23-7.03 8.97-11.55 12.33-6.06 4.66-11.62 10.05-18.37 13.75-4.06 2.65-8.24 5.17-12.71 7.08-3.59 1.57-6.06 4.94-9.85 6.09-2.29 1.71-3.98 4.51-6.97 5.02-4.56 1.35-8.98-3.72-13.5-1.25-2.99 1.83-6.19 3.21-9.39 4.6-8.5 5.61-18.13 9.48-28.06 11.62-8.36-0.2-16.69 0.62-25.05 0.47-3.5-1.87-7.67-1.08-11.22-2.83-6.19-1.52-10.93-6.01-16.62-8.61-2.87-1.39-5.53-3.16-8.11-4.99-2.58-1.88-4.17-4.85-6.98-6.44-3.83-0.11-6.54 3.42-10.24 3.92-2.31 0.28-4.64 0.32-6.96 0.31-3.5-3.65-5.69-8.74-10.59-10.77-5.01-3.68-10.57-6.67-14.84-11.25-2.52-2.55-5.22-4.87-8.24-6.8-4.73-4.07-7.93-9.51-11.41-14.62-3.08-4.41-5.22-9.73-4.6-15.19 0.65-8.01 0.62-16.18 2.55-24.02 4.06-10.46 11.15-19.34 18.05-28.06 3.71-5.31 9.91-10.21 16.8-8.39 3.25 1.61 5.74 4.56 7.14 7.89 1.19 2.7 3.49 4.93 3.87 7.96 0.97 5.85 1.6 11.86 0.74 17.77-1.7 6.12-2.98 12.53-2.32 18.9 0.01 2.92 2.9 5.36 5.78 4.57 3.06-0.68 3.99-4.07 5.32-6.48 1.67-4.06 4.18-7.66 6.69-11.23 3.61-5.28 5.09-11.57 7.63-17.37 2.07-4.56 1.7-9.64 2.56-14.46 0.78-7.65-0.62-15.44 0.7-23.04 1.32-3.78 1.79-7.89 3.8-11.4 3.01-3.66 6.78-6.63 9.85-10.26 1.72-2.12 4.21-3.32 6.55-4.6 7.89-2.71 15.56-6.75 24.06-7z",o="true"==localStorage.ffzDebugMode&&document.body.classList.contains("ffz-dev"),n=o?"//localhost:8000/":"https://cdn.frankerfacez.com/",a=navigator.platform?-1!==navigator.platform.indexOf("Mac"):/OS X/.test(navigator.userAgent),r=navigator.platform?-1!==navigator.platform.indexOf("Win"):/Windows/.test(navigator.userAgent),l="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]",c=new RegExp(l+"*,"+l+"*"),d=function(e,t,s,i,o){return'<svg version="1.1" class="ffz-svg svg-'+e+'" height="'+s+'px" width="'+t+'px" x="0px" y="0px" viewbox="'+(o||"0 0 16 16")+'"><path clip-rule="evenodd" fill-rule="evenodd" d="'+i+'"></path></svg>'};t.exports=FrankerFaceZ.constants={DEBUG:o,SERVER:n,IS_OSX:a,IS_WIN:r,META_NAME:a?"⌘":r?"Win":"Meta",CLIENT_ID:"a3bc9znoz6vi8ozsoca0inlcr4fcvkl",API_SERVER:"https://api.frankerfacez.com/",WS_SERVER_POOLS:{1:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",1],["wss://tuturu.frankerfacez.com/",1]],2:[["wss://localhost:8001/",1]]},CHAT_COLORS:["#FF0000","#0000FF","#008000","#B22222","#FF7F50","#9ACD32","#FF4500","#2E8B57","#DAA520","#D2691E","#5F9EA0","#1E90FF","#FF69B4","#8A2BE2","#00FF7F"],TOOLTIP_DISTANCE:50,SEPARATORS:l,SPLITTER:c,UUID_TEST:/(?:^| +)([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}) *$/i,KNOWN_CODES:{"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},TWITCH_BASE:"//static-cdn.jtvnw.net/emoticons/v1/",EMOTE_MIRROR_BASE:n+"twitch-emote-mirror/",EMOTE_REPLACEMENT_BASE:n+"script/replacements/",EMOTE_REPLACEMENTS:{15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",19:"19-PazPazowitz.png",20:"20-EagleEye.png",21:"21-CougarHunt.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",27:"27-PicoMause.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},EMOJI_REGEX:/(\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc41\u200d\ud83d\udde8|(?:[\u0023\u002a\u0030-\u0039])\ufe0f?\u20e3|(?:(?:[\u261d\u270c])(?:\ufe0f|(?!\ufe0e))|\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca\udfcb]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd75\udd90\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0]|\ud83e\udd18|[\u26f9\u270a\u270b\u270d])(?:\ud83c[\udffb-\udfff]|)|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf21\udf24-\udf84\udf86-\udf93\udf96\udf97\udf99-\udf9b\udf9e-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcc-\udff0\udff3-\udff5\udff7-\udfff]|\ud83d[\udc00-\udc41\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfd\udcff-\udd3d\udd49-\udd4e\udd50-\udd67\udd6f\udd70\udd73\udd74\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\udecb-\uded0\udee0-\udee5\udee9\udeeb\udeec\udef0\udef3]|\ud83e[\udd10-\udd17\udd80-\udd84\uddc0]|[\u2328\u23cf\u23e9-\u23f3\u23f8-\u23fa\u2602-\u2604\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638\u2692\u2694\u2696\u2697\u2699\u269b\u269c\u26b0\u26b1\u26c8\u26ce\u26cf\u26d1\u26d3\u26e9\u26f0\u26f1\u26f4\u26f7\u26f8\u2705\u271d\u2721\u2728\u274c\u274e\u2753-\u2755\u2763\u2795-\u2797\u27b0\u27bf\ue50a]|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37]|[\u00a9\u00ae\u203c\u2049\u2122\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600\u2601\u260e\u2611\u2614\u2615\u2639\u263a\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2693\u26a0\u26a1\u26aa\u26ab\u26bd\u26be\u26c4\u26c5\u26d4\u26ea\u26f2\u26f3\u26f5\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u2733\u2734\u2744\u2747\u2757\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e)))/g,EMOJI_CATEGORIES:{people:"People & Smileys",nature:"Animals & Nature",food:"Food & Drink",activity:"Activity",travel:"Travel & Places",objects:"Objects",symbols:"Symbols",flags:"Flags"},EMOJI_LOGOS:{activity:"26bd",food:"1f34e",flags:"1f1fa-1f1f8",nature:"1f436",objects:"1f4a1",people:"1f632",symbols:"2049",travel:"1f697"},ZREKNARF:d("glyph_views svg-zreknarf",16,12.5,i,"0 0 249 195"),CHAT_BUTTON:d("emoticons",24,18,i,"0 0 249 195"),ROOMS:d("glyph_views svg-roomlist",16,16,"M1,13v-2h14v2H1z M1,5h13v2H1V5z M1,2h10v2H1V2z M12,10H1V8h11V10z"),CAMERA:d("camera",16,16,"M24,20v6H4V10h20v6l8-6v16L24,20z","0 0 36 36"),INVITE:d("plus",16,16,"M15,9h-3v3h-2V9H7V7h3V4h2v3h3V9z M9,6H6v4h2h1v3h4l0,0l0,0v1h-3H4H1v-1l3-3h2L4,8V2h6v1H9V6z"),LIVE:d("glyph_live_small",13,16,"M11,14H5H2v-1l3-3h2L5,8V2h6v6l-2,2h2l3,3v1H11z"),EYE:d("glyph_views svg-eye",16,16,"M11,13H5L1,9V8V7l4-4h6l4,4v1v1L11,13z M8,5C6.344,5,5,6.343,5,8c0,1.656,1.344,3,3,3c1.657,0,3-1.344,3-3C11,6.343,9.657,5,8,5z M8,9C7.447,9,7,8.552,7,8s0.447-1,1-1s1,0.448,1,1S8.553,9,8,9z"),CLOCK:d("glyph_views svg-clock",16,16,"M8,15c-3.866,0-7-3.134-7-7s3.134-7,7-7s7,3.134,7,7 S11.866,15,8,15z M8,3C5.238,3,3,5.238,3,8s2.238,5,5,5s5-2.238,5-5S10.762,3,8,3z M7.293,8.707L7,8l1-4l0.902,3.607L11,11 L7.293,8.707z"),GEAR:d("gear",16,16,"M15,7v2h-2.115c-0.125,0.615-0.354,1.215-0.713,1.758l1.484,1.484l-1.414,1.414l-1.484-1.484C10.215,12.531,9.615,12.76,9,12.885V15H7v-2.12c-0.614-0.126-1.21-0.356-1.751-0.714l-1.491,1.49l-1.414-1.414l1.491-1.49C3.477,10.211,3.247,9.613,3.12,9H1V7h2.116C3.24,6.384,3.469,5.785,3.829,5.242L2.343,3.757l1.414-1.414l1.485,1.485C5.785,3.469,6.384,3.24,7,3.115V1h2v2.12c0.613,0.126,1.211,0.356,1.752,0.714l1.49-1.491l1.414,1.414l-1.49,1.492C12.523,5.79,12.754,6.387,12.88,7H15z M8,6C6.896,6,6,6.896,6,8s0.896,2,2,2s2-0.896,2-2S9.104,6,8,6z"),HEART:d("heart",16,16,"M8,13.5L1.5,7V4l2-2h3L8,3.5L9.5,2h3l2,2v3L8,13.5z"),UNHEART:d("unheart",16,16,"M1,9V7h14v2H1z M1,4l2-2h3l2,2l2-2h3l2,2v2H1V4z M8,14l-4.667-4h9.333L8,14z"),EMOTE:d("emote",16,16,"M9,18c-4.971,0-9-4.029-9-9s4.029-9,9-9s9,4.029,9,9S13.971,18,9,18z M14,4.111V4h-0.111C12.627,2.766,10.904,2,9,2C7.095,2,5.373,2.766,4.111,4H4v0.111C2.766,5.373,2,7.096,2,9s0.766,3.627,2,4.889V14l0.05-0.051C5.317,15.217,7.067,16,9,16c1.934,0,3.684-0.783,4.949-2.051L14,14v-0.111c1.234-1.262,2-2.984,2-4.889S15.234,5.373,14,4.111zM11,6h2v4h-2V6z M12.535,12.535C11.631,13.44,10.381,14,9,14s-2.631-0.56-3.536-1.465l0.707-0.707C6.896,12.553,7.896,13,9,13s2.104-0.447,2.828-1.172L12.535,12.535z M5,6h2v4H5V6z","0 0 18 18"),STAR:d("star",16,16,"M15,6l-4.041,2.694L13,14l-5-3.333L3,14l2.041-5.306L1,6h5.077L8,1l1.924,5H15z"),CLOSE:d("close_small",16,16,"M12.657,4.757L9.414,8l3.243,3.242l-1.415,1.415L8,9.414l-3.243,3.243l-1.414-1.415L6.586,8L3.343,4.757l1.414-1.414L8,6.586l3.242-3.243L12.657,4.757z"),EDIT:d("edit",16,16,"M6.414,12.414L3.586,9.586l8-8l2.828,2.828L6.414,12.414z M4.829,14H2l0,0v-2.828l0.586-0.586l2.828,2.828L4.829,14z"),GRAPH:d("glyph_views graph",16,16,"M1,16V2h16v14H1z M5,4H3v1h2V4z M5,7H3v1h2V7z M5,10H3v1h2V10zM5,13H3v1h2V13z M9,7H7v7h2V7z M12,10h-2v4h2V10z M15,4h-2v10h2V4z","0 0 18 18")}},{}],7:[function(t,s,i){var o=e.FrankerFaceZ;o.settings_info.developer_mode={type:"boolean",value:!1,storage_key:"ffzDebugMode",visible:function(){return this.settings.developer_mode||Date.now()-parseInt(localStorage.ffzLastDevMode||"0")<6048e5},category:"Debugging",name:"Developer Mode",help:"Load FrankerFaceZ from the local development server instead of the CDN. Please refresh after changing this setting.",on_update:function(){localStorage.ffzLastDevMode=Date.now()}},o.ffz_commands.developer_mode=function(e,t){var s,t=t&&t.length?t[0].toLowerCase():null;return"y"==t||"yes"==t||"true"==t||"on"==t?s=!0:("n"==t||"no"==t||"false"==t||"off"==t)&&(s=!1),void 0===s?"Developer Mode is currently "+(this.settings.developer_mode?"enabled.":"disabled."):(this.settings.set("developer_mode",s),"Developer Mode is now "+(s?"enabled":"disabled")+". Please refresh your browser.")},o.ffz_commands.developer_mode.help="Usage: /ffz developer_mode <on|off>\nEnable or disable Developer Mode. When Developer Mode is enabled, the script will be reloaded from //localhost:8000/script.js instead of from the CDN."},{}],8:[function(t,s,i){{var o=e.FrankerFaceZ,n=t("../utils");t("../constants")}o.settings_info.bits_animated={type:"boolean",value:!0,category:"Chat Appearance",no_bttv:!0,name:"Bits Animation",help:"Display bits with animation.",on_update:n.toggle_cls("ffz-animate-bits")},o.settings_info.bits_tags_container={type:"boolean",value:!0,category:"Chat Appearance",no_bttv:!0,name:"Bits Tag Display",help:"Display competitive bits tags at the top of chats that have it enabled.",on_update:n.toggle_cls("ffz-show-bits-tags")},o.prototype.setup_bits=function(){n.toggle_cls("ffz-animate-bits")(this.settings.bits_animated),n.toggle_cls("ffz-show-bits-tags")(this.settings.bits_tags_container);var e=this,t=n.ember_lookup("service:bits-rendering-config");return t?(t.reopen({ffz_get_tier:function(e){for(var t=this.get("config"),s=t.tiers||[],i=null,o=null,n=0,a=s.length;a>n;n++){var r=s[n];if(e<r.min_bits)break;i=r,o=n}return[o,i]},ffz_get_preview:function(t){return this._templateUrlConstructor(t.image,"dark",e.settings.bits_animated?"animated":"static",4)},_ffz_tier_css:function(t,s){var i,o=".ffz-bit.bit-tier-"+t,n=e._handle_color(s.color),a='url("'+this.get("config.templateUrl").replace("{background}","light").replace("{image}",s.image)+'")',r=a.replace("{scale}",1)+" 1x, "+a.replace("{scale}",2)+" 2x, "+a.replace("{scale}",4)+" 4x";return i=o+"{color: "+n[0]+";background-image: "+a.replace("{scale}",1).replace(/{state}/g,"static")+";background-image: -webkit-image-set("+r.replace(/{state}/g,"static")+");}.ffz-animate-bits "+o+"{background-image: "+a.replace("{scale}",1).replace(/{state}/g,"animated")+";background-image: -webkit-image-set("+r.replace(/{state}/g,"animated")+");}",a=a.replace("/light/","/dark/"),r=r.replace(/\/light\//g,"/dark/"),i+".tipsy "+o+",.dark "+o+",.force-dark "+o+",.theatre "+o+"{color: "+n[1]+";background-image: "+a.replace("{scale}",1).replace(/{state}/g,"static")+";background-image: -webkit-image-set("+r.replace(/{state}/g,"static")+");}.ffz-animate-bits .tipsy "+o+",.ffz-animate-bits .dark "+o+",.ffz-animate-bits .force-dark "+o+",.ffz-animate-bits .theatre "+o+"{background-image: "+a.replace("{scale}",1).replace(/{state}/g,"animated")+";background-image: -webkit-image-set("+r.replace(/{state}/g,"animated")+");}"},ffz_update_css:function(){for(var t=this.get("config.tiers")||[],s=[],i=0,o=t.length;o>i;i++)s.push(this._ffz_tier_css(i,t[i]));n.update_css(e._chat_style,"bit-styles",s.join(""))}.observes("config")}),void(t.get("isLoaded")?t.ffz_update_css():t.loadRenderConfig())):this.error("Unable to locate the Ember service:bits-rendering-config")}},{"../constants":6,"../utils":53}],9:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");o.prototype.setup_channel=function(){this.log("Creating channel style element.");var e=this._channel_style=document.createElement("style");if(e.id="ffz-channel-css",document.head.appendChild(e),document.body.classList.toggle("ffz-hide-view-count",!this.settings.channel_views),document.body.classList.toggle("ffz-theater-stats",this.settings.theater_stats),this.log("Hooking the Ember Channel Index view."),this.update_views("view:channel/index",this.modify_channel_index)){this.log("Hooking the Ember Channel model.");var t=this,s=n.ember_resolve("model:deprecated-channel");if(!s)return this.log("Unable to find the Ember model:deprecated-channel");this._modify_cmodel(s);var i=n.ember_lookup("service:store"),a=i&&i.typeMapFor(s);if(a&&a.records)for(var r=0;r<a.records.length;r++)this._modify_cmodel(a.records[r]);this.log("Hooking the Ember Channel controller."),s=n.ember_lookup("controller:channel"),s&&(s.reopen({ffzUpdateUptime:function(){t._cindex&&t._cindex.ffzUpdateUptime()}.observes("isLive","content.id"),ffzUpdateInfo:function(){this._ffz_update_timer&&clearTimeout(this._ffz_update_timer),this.get("content.id")&&(this._ffz_update_timer=setTimeout(this.ffzCheckUpdate.bind(this),55e3+1e4*Math.random()))}.observes("content.id"),ffzCheckUpdate:function(){var e=this,t=e.get("content.id");t&&n.api.get("streams/"+t,{},{version:3}).done(function(t){if(!t||!t.stream)return e.set("content.stream.created_at",null),void e.set("content.stream.viewers",0);e.set("content.stream.created_at",t.stream.created_at||null),e.set("content.stream.viewers",t.stream.viewers||0);var s=t.stream.game||t.stream.channel&&t.stream.channel.game;s&&e.set("content.game",s),t.stream.channel&&(t.stream.channel.status&&e.set("content.status",t.stream.channel.status),t.stream.channel.views&&e.set("content.views",t.stream.channel.views),t.stream.channel.followers&&e.get("content.followers.isLoaded")&&e.set("content.followers.total",t.stream.channel.followers))}).always(function(t){e.ffzUpdateInfo()})},ffzUpdateTitle:function(){var e=this.get("content.name"),s=this.get("content.display_name");s&&(o.capitalization[e]=[s,Date.now()]),t._cindex&&t._cindex.ffzFixTitle()}.observes("content.status","content.game","content.id","hostModeTarget.status","hostModeTarget.id","hostModeTarget.game"),ffzHostTarget:function(){var e=this.get("content.hostModeTarget"),s=e&&e.get("name"),i=e&&e.get("id"),n=e&&e.get("display_name");i!==t.__old_host_target&&(t.__old_host_target&&t.ws_send("unsub","channel."+t.__old_host_target),i?(t.ws_send("sub","channel."+i),t.__old_host_target=i):delete t.__old_host_target),n&&(o.capitalization[s]=[n,Date.now()]),t._chatv&&t._chatv.ffzUpdateHost(e),t.settings.follow_buttons&&t.rebuild_following_ui(),t.settings.srl_races&&t.rebuild_race_ui()}.observes("content.hostModeTarget")}),Ember.propertyDidChange(s,"isEditable"),s.ffzUpdateInfo())}},o.prototype._modify_cmodel=function(e){var t=this;e.reopen({ffz_host_target:void 0,setHostMode:function(e){return t.settings.hosted_channels?(this.set("ffz_host_target",e.target),this._super(e)):(this.set("ffz_host_target",void 0),this._super({target:void 0,delay:0}))}})},o.prototype.modify_channel_index=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){var e=this.get("controller.content.id")||this.get("controller.id"),s=this.get("element");t._cindex=this,t.ws_send("sub","channel."+e),s.setAttribute("data-channel",e),s.classList.add("ffz-channel"),this.ffzFixTitle(),this.ffzUpdateUptime(),this.ffzUpdateChatters(),this.ffzUpdateHostButton(),this.ffzUpdatePlayerStats(),this._ffz_scroller=this.ffzOnScroll.bind(this),jQuery(s).parents(".tse-scroll-content").on("scroll",this._ffz_scroller);var i=this.get("element").querySelector(".svg-glyph_views:not(.ffz-svg)");

if(i&&i.parentNode.classList.add("twitch-channel-views"),t.settings.follow_buttons&&t.rebuild_following_ui(),t.settings.srl_races&&t.rebuild_race_ui(),t.settings.auto_theater){var o=t.players&&t.players[e]&&t.players[e].get("player");o&&o.setTheatre(!0)}this.$().on("click",".ffz-creative-tag-link",function(e){return 0!==e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey?void 0:(n.ember_lookup("router:main").transitionTo("creative.hashtag.index",this.getAttribute("data-tag")),e.preventDefault(),!1)})},ffz_destroy:function(){var e=this.get("controller.content.id")||this.get("controller.id");e&&t.ws_send("unsub","channel."+e),this.get("element").setAttribute("data-channel",""),t._cindex=void 0,this._ffz_update_uptime&&clearTimeout(this._ffz_update_uptime),this._ffz_update_stats&&clearTimeout(this._ffz_update_stats),this._ffz_scroller&&(jQuery(this.get("element")).parents(".tse-scroll-content").off("scroll",this._ffz_scroller),this._ffz_scroller=null),document.body.classList.remove("ffz-small-player"),n.update_css(t._channel_style,e,null)},ffzOnScroll:function(e){var s=e&&e.target&&e.target.scrollTop,i=this.get("layout.playerSize.1");s||(s=jQuery(this.get("element")).parents(".tse-scroll-content").scrollTop()),document.body.classList.toggle("ffz-small-player",t.settings.small_player&&s>=i)},ffzFixTitle:function(){if(!t.has_bttv&&t.settings.stream_title){var e=this.get("controller.content.status"),s=this.get("controller.content.id"),i=this.get("controller.content.game"),o=t.tokenize_line(s,s,e,!0);"Creative"===i&&(o=t.tokenize_ctags(o)),this.$("#broadcast-meta .title").html(t.render_tokens(o)),e=this.get("controller.hostModeTarget.status"),s=this.get("controller.hostModeTarget.id"),i=this.get("controller.hostModeTarget.game"),s&&(o=t.tokenize_line(s,s,e,!0),"Creative"===i&&(o=t.tokenize_ctags(o)),this.$(".target-meta .target-title").html(t.render_tokens(o)))}},ffzUpdateHostButton:function(){var e=this.get("controller.content.id")||this.get("controller.id"),s=this.get("controller.hostModeTarget.id"),i=t.get_user(),r=i&&t.rooms&&t.rooms[i.login]&&t.rooms[i.login].room,l=r&&r.ffz_host_target,c=r&&r.ffz_hosts_left,d=this.get("element");if(this.set("ffz_host_updating",!1),e){var h=d&&d.querySelector(".stats-and-actions .channel-actions"),f=h&&h.querySelector("#ffz-ui-host-button");if(h&&t.settings.stream_host_button&&i&&i.login!==e){if(!f){f=document.createElement("span"),f.id="ffz-ui-host-button",f.className="button button--text",f.addEventListener("click",this.ffzClickHost.bind(this,!1));var u;try{u=h.querySelector(":scope > .theatre-button")}catch(_){u=void 0}u?h.insertBefore(f,u):h.appendChild(f),jQuery(f).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}f.classList.remove("disabled"),f.innerHTML=e===l?"Unhost":"Host",f.title=l?"You are now hosting "+n.sanitize(o.get_capitalization(l))+".":"You are not hosting any channel.","number"==typeof c&&(f.title+=" You have "+c+" host command"+n.pluralize(c)+" remaining this half hour.")}else f&&f.parentElement.removeChild(f)}if(s){var h=d&&d.querySelector("#hostmode .channel-actions"),f=h&&h.querySelector("#ffz-ui-host-button");if(h&&t.settings.stream_host_button&&i&&i.login!==s){if(!f){f=document.createElement("span"),f.id="ffz-ui-host-button",f.className="button button--text",f.addEventListener("click",this.ffzClickHost.bind(this,!0));var u;try{u=h.querySelector(":scope > .theatre-button")}catch(_){u=void 0}u?h.insertBefore(f,u):h.appendChild(f),jQuery(f).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}f.classList.remove("disabled"),f.innerHTML=s===l?"Unhost":"Host",f.title=l?"You are currently hosting "+n.sanitize(o.get_capitalization(l))+". Click to "+(s===l?"unhost":"host")+" this channel.":"You are not currently hosting any channel. Click to host this channel.","number"==typeof c&&(f.title+=" You have "+c+" host command"+n.pluralize(c)+" remaining this half hour.")}else f&&f.parentElement.removeChild(f)}},ffzClickHost:function(e,s){var i=s.target,o=e?this.get("controller.hostModeTarget.id"):this.get("controller.content.id")||this.get("controller.id"),n=t.get_user(),a=n&&t.rooms&&t.rooms[n.login]&&t.rooms[n.login].room,r=a&&a.ffz_host_target;a&&!this.get("ffz_host_updating")&&(i.classList.add("disabled"),i.title="Updating...",this.set("ffz_host_updating",!0),r===o?a.send("/unhost",!0):a.send("/host "+o,!0))},ffzUpdateChatters:function(){var e=this.get("controller.content.id")||this.get("controller.id"),s=t.rooms&&t.rooms[e];if(!s||!t.settings.chatter_count){var i=this.get("element").querySelector("#ffz-chatter-display");return i&&i.parentElement.removeChild(i),i=this.get("element").querySelector("#ffz-ffzchatter-display"),void(i&&i.parentElement.removeChild(i))}var o=Object.keys(s.room.get("ffz_chatters")||{}).length,r=s.ffz_chatters||0,l=s.ffz_viewers||0,i=this.get("element").querySelector("#ffz-chatter-display span");if(!i){var c=this.get("element").querySelector(".stats-and-actions .channel-stats");if(!c)return;var d=document.createElement("span");d.className="ffz stat",d.id="ffz-chatter-display",d.title="Currently in Chat",d.innerHTML=a.ROOMS+" ",i=document.createElement("span"),d.appendChild(i);var h=c.querySelector("#ffz-ffzchatter-display");h?c.insertBefore(d,h):c.appendChild(d),jQuery(d).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}if(i.innerHTML=n.number_commas(o),!r&&!l)return i=this.get("element").querySelector("#ffz-ffzchatter-display"),void(i&&i.parentNode.removeChild(i));if(i=this.get("element").querySelector("#ffz-ffzchatter-display span"),!i){var c=this.get("element").querySelector(".stats-and-actions .channel-stats");if(!c)return;var d=document.createElement("span");d.className="ffz stat",d.id="ffz-ffzchatter-display",d.title="Viewers (In Chat) with FrankerFaceZ",d.innerHTML=a.ZREKNARF+" ",i=document.createElement("span"),d.appendChild(i);var h=c.querySelector("#ffz-chatter-display");h?c.insertBefore(d,h.nextSibling):c.appendChild(d),jQuery(d).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}i.innerHTML=n.number_commas(l)+" ("+n.number_commas(r)+")"},ffzUpdatePlayerStats:function(){this._ffz_update_stats&&(clearTimeout(this._ffz_update_stats),this._ffz_update_stats=null),t.settings.player_stats&&(this._ffz_update_stats=setTimeout(this.ffzUpdatePlayerStats.bind(this),1e3));var e=this.get("controller.content.id")||this.get("controller.id"),s=this.get("controller.hostModeTarget.id"),i=this.get("element");if(e){var o,r=i&&i.querySelector(".stats-and-actions .channel-stats"),l=r&&r.querySelector("#ffz-ui-player-stats"),i=l&&l.querySelector("span"),c=t.players&&t.players[e],d=void 0,h=void 0;try{d=c&&c.get&&c.get("player"),h=d&&d.getVideoInfo()}catch(f){t.error("Channel ffzUpdatePlayerStats: player.getVideoInfo: "+f)}if(r&&t.settings.player_stats&&h&&h.hls_latency_broadcaster&&!Number.isNaN(h.hls_latency_broadcaster)){if(l)o=jQuery(l);else{l=document.createElement("span"),l.id="ffz-ui-player-stats",l.className="ffz stat",l.innerHTML=a.GRAPH+" ",i=document.createElement("span"),l.appendChild(i);var u=r.querySelector("#ffz-uptime-display");u?r.insertBefore(l,u.nextSibling):r.appendChild(l),o=jQuery(l),o.hover(function(){o.data("hover",!0).tipsy("show")},function(){o.data("hover",!1).tipsy("hide")}).data("hover",!1).tipsy({trigger:"manual",html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}var _,m=Math.round(h.hls_latency_broadcaster/10)/100,g=n.number_commas(h.dropped_frames||0);if(_=h.playback_bytes_per_second?Math.round(8*h.playback_bytes_per_second/10.24)/100:Math.round(100*h.current_bitrate)/100,m>180)m=Math.floor(m),l.setAttribute("original-title","Video Information<br>Broadcast "+n.time_to_string(m,!0)+" Ago<br><br>Video: "+h.vid_width+"x"+h.vid_height+"p @ "+h.current_fps+"<br>Playback Rate: "+_+" Kbps<br>Dropped Frames: "+g),i.textContent=n.time_to_string(Math.floor(m),!0,m>172800)+" old";else{l.setAttribute("original-title","Stream Latency<br>Video: "+h.vid_width+"x"+h.vid_height+"p @ "+h.current_fps+"<br>Playback Rate: "+_+" Kbps<br>Dropped Frames: "+g),m=m.toString();var p=m.indexOf(".");-1===p?m+=".00":p>=m.length-2&&(m+="0"),i.textContent=m+"s"}o.data("hover")&&o.tipsy("hide").tipsy("show")}else l&&l.parentElement.removeChild(l)}if(s){var o,r=i&&i.querySelector("#hostmode .channel-stats"),l=r&&r.querySelector("#ffz-ui-player-stats"),i=l&&l.querySelector("span"),c=t.players&&t.players[s],d=void 0,h=void 0;try{d=c&&c.ffz_player,h=d&&d.getVideoInfo()}catch(f){t.error("Channel ffzUpdatePlayerStats: player.getVideoInfo: "+f)}if(r&&t.settings.player_stats&&h&&h.hls_latency_broadcaster&&!Number.isNaN(h.hls_latency_broadcaster)){if(l)o=jQuery(l);else{l=document.createElement("span"),l.id="ffz-ui-player-stats",l.className="ffz stat",l.innerHTML=a.GRAPH+" ",i=document.createElement("span"),l.appendChild(i);var u=r.querySelector("#ffz-uptime-display");u?r.insertBefore(l,u.nextSibling):r.appendChild(l),o=jQuery(l),o.hover(function(){o.data("hover",!0).tipsy("show")},function(){o.data("hover",!1).tipsy("hide")}).data("hover",!1).tipsy({trigger:"manual",html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}var _,m=Math.round(h.hls_latency_broadcaster/10)/100,g=n.number_commas(h.dropped_frames||0);if(_=h.playback_bytes_per_second?Math.round(8*h.playback_bytes_per_second/10.24)/100:Math.round(100*h.current_bitrate)/100,m>180)m=Math.floor(m),l.setAttribute("original-title","Video Information<br>Broadcast "+n.time_to_string(m,!0)+" Ago<br><br>Video: "+h.vid_width+"x"+h.vid_height+"p @ "+h.current_fps+"<br>Playback Rate: "+_+" Kbps<br>Dropped Frames: "+g),i.textContent=n.time_to_string(Math.floor(m),!0,m>172800)+" old";else{l.setAttribute("original-title","Stream Latency<br>Video: "+h.vid_width+"x"+h.vid_height+"p @ "+h.current_fps+"<br>Playback Rate: "+_+" Kbps<br>Dropped Frames: "+g),m=m.toString();var p=m.indexOf(".");-1===p?m+=".00":p>=m.length-2&&(m+="0"),i.textContent=m+"s"}o.data("hover")&&o.tipsy("hide").tipsy("show")}else l&&l.parentElement.removeChild(l)}},ffzUpdateUptime:function(){if(this._ffz_update_uptime&&(clearTimeout(this._ffz_update_uptime),delete this._ffz_update_uptime),!t.settings.stream_uptime||!this.get("controller.isLiveAccordingToKraken")){var e=this.get("element").querySelector("#ffz-uptime-display");return void(e&&e.parentElement.removeChild(e))}this._ffz_update_uptime=setTimeout(this.ffzUpdateUptime.bind(this),1e3);var s=this.get("controller.content.stream.created_at"),i=Date.now()-(t._ws_server_offset||0);s=s&&n.parse_date(s);var o=s&&Math.floor((i-s.getTime())/1e3)||-1;if(0>o){var e=this.get("element").querySelector("#ffz-uptime-display");return void(e&&e.parentElement.removeChild(e))}var e=this.get("element").querySelector("#ffz-uptime-display span");if(!e){var r=this.get("element").querySelector(".stats-and-actions .channel-stats");if(!r)return;var l=document.createElement("span");l.className="ffz stat",l.id="ffz-uptime-display",l.title="Stream Uptime <nobr>(since "+s.toLocaleString()+")</nobr>",l.innerHTML=a.CLOCK+" ",e=document.createElement("span"),l.appendChild(e);var c=r.querySelector(".live-count");if(c)r.insertBefore(l,c.nextSibling);else try{c=r.querySelector("script:nth-child(0n+2)"),r.insertBefore(l,c.nextSibling)}catch(d){r.insertBefore(l,r.childNodes[0])}jQuery(l).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}e.innerHTML=n.time_to_string(o,!1,!1,!1,1===t.settings.stream_uptime||3===t.settings.stream_uptime)}})},o.settings_info.auto_theater={type:"boolean",value:!1,category:"Appearance",no_mobile:!0,no_bttv:!0,name:"Automatic Theater Mode",help:"Automatically enter theater mode when opening a channel."},o.settings_info.small_player={type:"boolean",value:!1,no_mobile:!0,no_bttv:!0,category:"Appearance",name:"Mini-Player on Scroll",help:"When you scroll down on the page, shrink the player and put it in the upper right corner so you can still watch.",on_update:function(e){return e?void(this._vodc?this._vodc.ffzOnScroll():this._cindex&&this._cindex.ffzOnScroll()):document.body.classList.remove("ffz-small-player")}},o.settings_info.chatter_count={type:"boolean",value:!1,no_mobile:!0,category:"Channel Metadata",name:"Chatter Count",help:"Display the current number of users connected to chat beneath the channel.",on_update:function(e){if(this._cindex&&this._cindex.ffzUpdateChatters(),e&&this.rooms)for(var t in this.rooms)this.rooms.hasOwnProperty(t)&&this.rooms[t].room&&this.rooms[t].room.ffzInitChatterCount()}},o.settings_info.channel_views={type:"boolean",value:!0,no_mobile:!0,category:"Channel Metadata",name:"Channel Views",help:"Display the number of times the channel has been viewed beneath the stream.",on_update:function(e){document.body.classList.toggle("ffz-hide-view-count",!e)}},o.settings_info.hosted_channels={type:"boolean",value:!0,no_mobile:!0,category:"Channel Metadata",name:"Channel Hosting",help:"Display other channels that have been featured by the current channel.",on_update:function(e){var t=document.querySelector("input.ffz-setting-hosted-channels");if(t&&(t.checked=e),this._cindex){var s=this._cindex.get("controller.model"),i=s&&this.rooms&&this.rooms[s.get("id")],o=i&&i.room&&i.room.get("ffz_host_target");s&&i&&s.setHostMode({target:o,delay:0})}}},o.settings_info.stream_host_button={type:"boolean",value:!0,no_mobile:!0,category:"Channel Metadata",name:"Host This Channel Button",help:"Display a button underneath streams that make it easy to host them with your own channel.",on_update:function(e){this._cindex&&this._cindex.ffzUpdateHostButton()}},o.settings_info.stream_uptime={type:"select",options:{0:"Disabled",1:"Enabled",2:"Enabled (with Seconds)",3:"Enabled (Channel Only)",4:"Enabled (Channel Only with Seconds)"},value:1,process_value:function(e){return e===!1?0:e===!0?2:"string"==typeof e?parseInt(e||"0")||0:e},no_mobile:!0,category:"Channel Metadata",name:"Stream Uptime",help:"Display the stream uptime under a channel by the viewer count.",on_update:function(e){this._cindex&&this._cindex.ffzUpdateUptime()}},o.settings_info.stream_title={type:"boolean",value:!0,no_bttv:!0,no_mobile:!0,category:"Channel Metadata",name:"Title Links",help:"Make links in stream titles clickable.",on_update:function(e){this._cindex&&this._cindex.ffzFixTitle()}},o.settings_info.theater_stats={type:"boolean",value:!0,no_mobile:!0,category:"Channel Metadata",name:"Display on Theater Mode Hover",help:"Show the channel metadata and actions over the video player in theater mode when you hover it with your mouse.",on_update:function(e){document.body.classList.toggle("ffz-theater-stats",e)}},o.basic_settings.channel_info={type:"select",options:{0:"Disabled",1:"Enabled",2:"Enabled (with Seconds)",3:"Enabled (Channel Only)",4:"Enabled (Channel Only with Seconds)"},category:"General",name:"Stream Uptime",help:"Display the current stream's uptime under the player.",get:function(){return this.settings.stream_uptime},set:function(e){"string"==typeof e&&(e=parseInt(e||"0")),this.settings.set("stream_uptime",e)}}},{"../constants":6,"../utils":53}],10:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants"),r=-1!==navigator.userAgent.indexOf("Android"),l={AT_SIGN:64,COLON:58},c={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,TWO:50,COLON:59,FAKE_COLON:186},d=function(e){if("number"==typeof e.selectionStart)return e.selectionStart;if(!e.createTextRange)return-1;var t=document.selection.createRange(),s=e.createTextRange();return s.moveToBookmark(t.getBookmark()),s.moveStart("character",-e.value.length),s.text.length},h=function(e,t){if(e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){var s=e.createTextRange();s.move("character",-e.value.length),s.move("character",t),s.select()}},f=function(e,t,s){return"emoticon"===e.type?"2|"+(e.favorite?1:2)+"|"+e.sort+"|"+e.label:"emoji"===e.type?"3|"+(e.favorite?1:2)+"|"+e.label:"4|"+e.label};o.settings_info.input_quick_reply={type:"boolean",value:!0,category:"Chat Input",no_bttv:!0,name:"Reply to Whispers with /r",help:"Automatically replace /r at the start of the line with the command to whisper to the person you've whispered with most recently."},o.settings_info.input_mru={type:"boolean",value:!0,category:"Chat Input",no_bttv:!0,name:"Chat Input History",help:"Use the Up and Down arrows in chat to select previously sent chat messages."},o.settings_info.input_complete_emotes={type:"select",options:{0:"Disabled",1:"Channel and Sub Only",2:"All Emoticons"},value:0,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},category:"Chat Input",no_bttv:!0,name:"Tab-Complete Emoticons <span>Beta</span>",help:"Use tab completion to complete emoticon names in chat.",on_update:function(e){this._inputv&&Ember.propertyDidChange(this._inputv,"ffz_emoticons")}},o.settings_info.input_complete_aliases={type:"select",options:{0:"Disabled",1:"By Name or Alias",2:"Aliases Only"},value:1,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},category:"Chat Input",no_bttv:!0,name:"Tab-Complete User Aliases",help:"Use tab completion to complete aliases you've given to users rather than their username.",on_update:function(e){this._inputv&&Ember.propertyDidChange(this._inputv,"ffz_name_suggestions")}},o.settings_info.input_complete_name_at={type:"boolean",value:!0,category:"Chat Input",no_bttv:!0,name:"Tab-Complete Usernames with At Sign",help:"When enabled, tab-completed usernames will have an @ sign before them if you typed one. This is default Twitch behavior, but unnecessary."},o.settings_info.input_emoticons_case_sensitive={type:"boolean",value:!0,category:"Chat Input",no_bttv:!0,name:"Tab-Complete Emoticons Case Sensitive",help:"When enabled, tab-completion for emoticons is case sensitive."},o.settings_info.input_complete_without_prefix={type:"boolean",value:!0,category:"Chat Input",no_bttv:!0,name:"Tab-Complete Sub Emotes without Prefix",help:"Allow you to tab complete a sub emote without including its prefix. Example: Battery into chrisBattery",on_update:function(e){this._inputv&&Ember.propertyDidChange(this._inputv,"ffz_emoticons")}},o.settings_info.input_emoji={type:"boolean",value:!1,category:"Chat Input",no_bttv:!0,name:"Enter Emoji By Name",help:"Replace emoji that you type by name with the character. :+1: becomes 👍."},o.prototype.setup_chat_input=function(){this.log("Hooking the Ember Chat Input component."),this.update_views("component:chat/twitch-chat-input",this.modify_chat_input)},o.prototype.modify_chat_input=function(t){var s=this;n.ember_reopen_view(t,{ffz_mru_index:-1,ffz_current_suggestion:0,ffz_partial_word:"",ffz_partial_word_start:-1,ffz_suggestions_visible:!1,ffz_freeze_suggestions:-1,ffz_suggestions_el:null,ffz_name_suggestions:[],ffz_chatters:[],ffz_init:function(){s._inputv=this;var e=this._ffz_minimal_style=document.createElement("style");e.id="ffz-minimal-chat-textarea-height",document.head.appendChild(e),this.set("ffz_name_suggestions",this.get("suggestions"));var t=this.$("textarea");t&&t.length||s.error("Cannot find textarea in Twitch Chat Input."),t.off("keydown"),t.off("keyup"),t.on("keypress",this._ffzKeyPress.bind(this)),t.on("keydown",this._ffzKeyDown.bind(this)),t.on("paste",this._ffzPaste.bind(this)),t.attr("rows",1),this.ffzResizeInput(),setTimeout(this.ffzResizeInput.bind(this),500)},ffz_destroy:function(){s._inputv===this&&(s._inputv=void 0),this.ffzResizeInput(),this._ffz_minimal_style&&(this._ffz_minimal_style.parentElement.removeChild(this._ffz_minimal_style),this._ffz_minimal_style=void 0);var e=this.$("textarea");e.attr("rows",void 0),e.off("keyup"),e.off("keydown"),e.off("keypress"),e.off("paste"),e.on("keyup",this._onKeyUp.bind(this)),e.on("keydown",this._onKeyDown.bind(this))},_ffzPaste:function(t){var i=t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData||e.clipboardData,o=i&&i.getData("text/plain");if(s.settings.input_emoji&&-1!==o.indexOf(":")){var n=[],a=o.split(":"),r=!1;n.push(a.shift());for(var l=0,c=a.length-1;c>l;l++){var d=a[l],f=r?null:s.emoji_data[s.emoji_names[d]];f?(n.push(f.raw),r=!0):(n.push((r?"":":")+d),r=!1)}if(n=n.join("")+(r?"":":")+a[a.length-1],n.length===o.length)return s.log("No emoji in paste");var a=this.get("chatTextArea"),u=a&&a.value,_=a&&a.selectionStart,m=a&&a.selectionEnd;if(!a||"number"!=typeof _||"number"!=typeof m)return s.log("Can't get input");t.stopPropagation(),t.preventDefault(),a.value=u.substr(0,_)+n+u.substr(m),h(a,_+n.length)}},ffzBuildSuggestionItem:function(e,t){if(!t)return null;var i=this,o=n.createElement("div","suggestion"),a=n.createElement("div"),r=t.width?246-t.width+"px":null;if(o.setAttribute("data-id",e),o.classList.toggle("ffz-favorite",t.favorite||!1),t.image&&(o.classList.add("has-image"),o.classList.toggle("is-emoji","emoji"===t.type),o.style.backgroundImage='url("'+n.quote_attr(t.image)+'")'),a.innerHTML=t.label,r&&(a.style.maxWidth=r),o.appendChild(a),s.settings.input_complete_emotes&&t.info){var l=n.createElement("span");l.innerHTML=t.info,o.classList.add("has-info"),r&&(l.style.maxWidth=r),o.appendChild(l)}return o.addEventListener("mouseenter",function(){if(-1===i.get("ffz_freeze_suggestions")){var t=o.parentElement.querySelectorAll(".suggestion"),s=t[Math.floor(t.length/2)];i.set("ffz_freeze_suggestions",s?parseInt(s.getAttribute("data-id")):e)}i.set("ffz_current_suggestion",e)}),o.addEventListener("mouseup",function(){i.ffzCompleteSuggestion(t)}),o.addEventListener("wheel",function(e){var t=i.get("ffz_sorted_suggestions"),s=o.parentElement.querySelector(".suggestion:first-of-type"),n=s&&parseInt(s.getAttribute("data-id"));n+=event.deltaY>0?1:-1,i.set("ffz_freeze_suggestions",-1),i.set("ffz_current_suggestion",Math.min(n+2,t.length-1))}),o},ffzUpdateSuggestions:function(){var e=this.get("ffz_suggestions_visible");if(e){if(this.get("ffz_updating"))return;this.set("ffz_updating",!0);var t=this.ffz_suggestions_el,s=this.get("ffz_current_suggestion")||0;t?t.innerHTML="":(t=this.ffz_suggestions_el=n.createElement("div","suggestions ffz-suggestions"),this.get("element").appendChild(t));var i=this.get("ffz_sorted_suggestions"),o=this.get("ffz_freeze_suggestions"),a=-1===o?s:o,r=Math.max(0,a-2),l=Math.min(i.length,r+5),c=!1;r=Math.min(r,Math.max(0,l-5)),s>=i.length&&(this.set("ffz_current_suggestion",r),s=r);for(var d=r;l>d;d++){var h=i[d],f=this.ffzBuildSuggestionItem(d,h);d===s&&f.classList.add("highlighted"),f&&(t.appendChild(f),c=!0)}if(!c){var f=n.createElement("div","suggestion disabled");f.textContent="No matches.",t.appendChild(f)}this.set("ffz_updating",!1)}else this.ffz_suggestions_el&&(this.ffz_suggestions_el.parentElement.removeChild(this.ffz_suggestions_el),this.ffz_suggestions_el=null)}.observes("ffz_suggestions_visible","ffz_sorted_suggestions","ffz_current_suggestion"),ffzHideSuggestions:function(){this.set("ffz_suggestions_visible",!1),this.set("ffz_freeze_suggestions",-1),this.set("ffz_current_suggestion",0)},ffzShowSuggestions:function(){this.set("ffz_current_suggestion",0),this.ffzFetchNameSuggestions(),this.set("ffz_freeze_suggestions",-1),this.set("ffz_suggestions_visible",!0),this.ffzSetPartialWord()},ffzSetPartialWord:function(){var e=this.get("chatTextArea");if(e&&this.get("ffz_suggestions_visible")){var t=this.get("textareaValue"),s=d(e);if(-1===s)return this.ffzHideSuggestions();var i=t.lastIndexOf(" ",s-1)+1;this.set("ffz_partial_word_start",i);var o=t.substr(i).match(/^[^ ]*/);o&&o[0]?this.set("ffz_partial_word",o[0]):"/"===t.charAt(0)&&" "!==t.charAt(1)&&i===t.indexOf(" ")+1?this.set("ffz_partial_word","@"):this.ffzHideSuggestions()}}.observes("textareaValue"),ffzFetchNameSuggestions:function(){this.get("ffz_suggestions_visible")||this.set("ffz_name_suggestions",this.get("suggestions"))}.observes("suggestions"),ffzCompleteSuggestion:function(e){if(!e){var t=this.get("ffz_sorted_suggestions"),i=this.get("ffz_current_suggestion");e=t&&t[i]}if(this.ffzHideSuggestions(),e){var o=this,n=this.get("ffz_partial_word_start"),a=this.get("textareaValue"),r=a.charAt(0),l="/"===r||"."===r,c=(s.settings.input_complete_name_at&&!l&&"user"===e.type&&"@"===this.get("ffz_partial_word").charAt(0)?"@":"")+((e.command_content&&l?e.command_content:e.content)||e.label),d=a.substr(n+this.get("ffz_partial_word").length),f=a.substr(0,n)+c+(d?"":" ");this.set("textareaValue",f+d),this.set("ffz_partial_word",""),this.set("ffz_partial_word_start",-1),this.trackSuggestionsCompleted(),Ember.run.next(function(){var e=o.get("chatTextArea");h(e,f.length),e.focus()})}},ffz_emoticons:function(){var e,t,i,n,r,l,c,d,h,f={},u=this.get("parentView.context.model"),_=u&&u.get("id"),m=u&&u.tmiSession,g=s.get_user(),p=s.getEmotes(g&&g.login,_),v=s.settings.input_complete_emotes;if(!v)return{};if(m){var b=m.getEmotes();if(b&&b.emoticon_sets)for(var y in b.emoticon_sets)if(l=b.emoticon_sets[y],r=s.settings.favorite_emotes["twitch-"+y]||[],n=!1,e=s._twitch_set_to_channel[y],l&&(e?"--global--"===e?e="Twitch Global":"--twitch-turbo--"===e||"turbo"===e||"--turbo-faces--"===e?e="Twitch Turbo":(e="Channel: "+o.get_capitalization(e),n=!0):e="Unknown Source",1!==v||n))for(var w=0;w<l.length;w++)if(c=l[w],h=c&&c.code,h=h&&(a.KNOWN_CODES[h]||h),t=s.settings.replace_bad_emotes&&a.EMOTE_REPLACEMENTS[c.id],i=t?a.EMOTE_REPLACEMENT_BASE+t:a.TWITCH_BASE+c.id+"/1.0",f[h]&&f[h][0]||(f[h]=[!0,h,!0,n,e,i,null,-1!==r.indexOf(c.id)]),s.settings.input_complete_without_prefix&&n){var z=h.substr(1).match(/[A-Z].+$/);z=z?z[0]:null,z&&!f[z]&&(f[z]=[!1,h,!0,n,e,i,null,-1!==r.indexOf(c.id)])}}for(var w=0;w<p.length;w++)if(l=s.emote_sets[p[w]],l&&(1!==v||-1===s.default_sets.indexOf(l.id))){e=(l.source||"FFZ")+" "+(l.title||"Global"),r=s.settings.favorite_emotes[l.hasOwnProperty("source_ext")?"ffz-ext-"+l.source_ext+"-"+l.source_id:"ffz-"+l.id]||[];for(d in l.emoticons)c=l.emoticons[d],c.hidden||!c.name||f[c.name]&&f[c.name][0]||(f[c.name]=[!0,c.name,!1,l.id,e,c.urls[1],c.width,-1!==r.indexOf(c.id)])}return f}.property(),_setPartialName:function(){},ffz_suggestions:function(){var e=[],t=this.get("ffz_emoticons"),i=this.get("ffz_name_suggestions");if(s.settings.input_complete_emotes){for(var n in t){var a=t[n],r=9,l=a[1]===n?a[1]:"<i>"+a[1].substr(0,a[1].length-n.length)+"</i>"+n;if(a[2])a[3]&&(r=1);else{var c=s.emote_sets[a[3]];c&&(r=1===c._type?3:-1===ffz.default_sets.indexOf(c.id)?2:6)}e.push({type:"emoticon",match:n,sort:r,content:a[1],label:l,info:a[4],image:a[5],width:a[6],favorite:a[7]||!1})}if(s.settings.parse_emoji){var d=s.settings.parse_emoji,h=s.settings.favorite_emotes.emoji||[];for(var f in s.emoji_names){var u=s.emoji_names[f],_=s.emoji_data[u];if(_&&(3===d?_.one:2===d?_.noto:_.tw)){var m=":"+f+":",g=3===s.settings.parse_emoji?_.one_src:2===s.settings.parse_emoji?_.noto_src:_.tw_src;e.push({type:"emoji",match:":"+f+":",content:_.raw,label:_.name,info:m,image:g,width:18,favorite:-1!==h.indexOf(_.raw)})}}}}for(var p={},v=s.settings.input_complete_aliases,b=0;b<i.length;b++){var y=i[b],w=y.id,z=s.aliases[w];if(p[w]&&!p[w].is_alias){var k=p[w];k.whispered|=y.whispered,y.timestamp>k.timestamp&&(k.timestamp=y.timestamp)}else if(2!==v&&e.push(p[w]={type:"user",command_content:w,label:o.get_capitalization(w),whispered:y.whispered,timestamp:y.timestamp||new Date(0),info:"User",is_alias:!1}),z&&v)if(p[z]&&p[z].is_alias){var k=p[w];k.whispered|=y.whispered,k.timestamp=Math.max(k.timestamp,y.timestamp)}else p[z]||e.push(p[z]={type:"user",command_content:w,label:z,whispered:y.whispered,timestamp:y.timestamp||new Date(0),info:"User Alias",is_alias:!0})}return e}.property("ffz_emoticons","ffz_name_suggestions"),ffz_filtered_suggestions:Ember.computed("ffz_suggestions","ffz_partial_word",function(){var e=this.get("ffz_suggestions"),t=this.get("ffz_partial_word"),i=t.substr(1),o=t.charAt(0);return e.filter(function(e){var n=e.match||e.content||e.label,a=e.type;return n?"user"===a?(n=n.toLowerCase(),"@"===o?0===n.indexOf(i.toLowerCase()):0===n.indexOf(t.toLowerCase())):"emoji"!==a&&s.settings.input_emoticons_case_sensitive?0===n.indexOf(t):(n=n.toLowerCase(),0===n.indexOf(t.toLowerCase())):!1})}),ffz_sorted_suggestions:Ember.computed("ffz_filtered_suggestions.[]",function(){var e=this.get("textareaValue"),t=Date.now(),s="/w "===e.substr(0,3);return this.get("ffz_filtered_suggestions").sort(function(e,i){if("user"===e.type){if("user"!==i.type)return-1;if(s){if(e.whisper&&!i.whisper)return-1;if(!e.whisper&&i.whisper)return 1}if(e.timestamp>i.timestamp)return-1;if(e.timestamp<i.timestamp)return 1;var o=e.label.toLowerCase(),n=i.label.toLowerCase();return n>o?-1:o>n?1:0}if("user"===i.type)return 1;var o=f(e,t,s),n=f(i,t,s);return n>o?-1:o>n?1:0})}),ffzOnInput:function(){if(!(!s._chat_style||s.settings.minimal_chat<2||r)){var e=Date.now(),t=e-(this._ffz_last_resize||0);t>500&&this.ffzResizeInput()}}.observes("textareaValue"),ffzResizeInput:function(){this._ffz_last_resize=Date.now();var e=this.get("element"),t=e&&e.querySelector("textarea");if(t&&s._chat_style&&!(s.settings.minimal_chat<2)){this._ffz_minimal_style.innerHTML="body.ffz-minimal-chat-input .ember-chat .chat-interface .textarea-contain textarea { height: auto !important; }";var i=Math.max(32,Math.min(128,t.scrollHeight));this._ffz_minimal_style.innerHTML="body.ffz-minimal-chat-input .ember-chat .chat-interface .textarea-contain textarea { height: "+i+"px !important; }",i!==this._ffz_last_height&&(n.update_css(s._chat_style,"input_height","body.ffz-minimal-chat-input .ember-chat .chat-interface { height: "+i+"px !important; }body.ffz-minimal-chat-input .ember-chat .chat-messages, body.ffz-minimal-chat-input .ember-chat .chat-interface .emoticon-selector { bottom: "+i+"px !important; }"),s._roomv&&s._roomv.get("stuckToBottom")&&s._roomv._scrollToBottom()),this._ffz_last_height=i}},hideSuggestions:Ember.on("document.mouseup",function(e){var t=e.target,s=t.classList;!this.get("ffz_suggestions_visible")||s.contains("suggestion")||s.contains("suggestions")||t===this.get("chatTextArea")||this.ffzHideSuggestions()}),_ffzKeyPress:function(t){var i=this,o=t||e.event,n=o.charCode||o.keyCode;switch(n){case l.AT_SIGN:if(!this.get("ffz_suggestions_visible")){var a=d(this.get("chatTextArea"))-1;Ember.run.next(function(){(0>a||" "===i.get("textareaValue").charAt(a))&&(i.ffzShowSuggestions(),i.trackSuggestions("@"))})}break;case l.COLON:if(s.settings.input_emoji){var r=this.get("chatTextArea"),a=d(r);a>0&&Ember.run.next(function(){var e=i.get("textareaValue"),t=e.lastIndexOf(":",a-1);if(-1!==t&&-1!==a&&":"===e.charAt(a)){var o=e.substr(t+1,a-t-1),n=s.emoji_names[o],r=s.emoji_data[n];if(r){var l=e.substr(0,t)+r.raw;i.ffzHideSuggestions(),i.set("textareaValue",l+e.substr(a+1)),Ember.run.next(function(){h(i.get("chatTextArea"),l.length)})}}})}}},_ffzKeyDown:function(t){var i=this,o=t||e.event,n=o.charCode||o.keyCode;switch(n){case c.ESC:this.get("ffz_suggestions_visible")&&(this.ffzHideSuggestions(),o.preventDefault());break;case c.BACKSPACE:!this.get("ffz_suggestions_visible")||1!==this.get("ffz_partial_word").length&&0!==d(this.get("chatTextArea"))||this.ffzHideSuggestions();break;case c.TAB:if(o.ctrlKey||o.altKey||o.metaKey)break;o.preventDefault();var a=this.get("textareaValue");if(0===a.length)break;if("/"!==a.charAt(0)){var r=a.split(" ");if(0===r[r.length-1].length)break}this.get("ffz_suggestions_visible")?this.ffzCompleteSuggestion():(this.ffzFetchNameSuggestions(),this.set("ffz_suggestions_visible",!0),this.ffzSetPartialWord(),this.trackSuggestions("Tab"));break;case c.PAGE_UP:case c.PAGE_DOWN:if(this.get("ffz_suggestions_visible")&&!(o.shiftKey||o.shiftLeft||o.ctrlKey||o.metaKey)){var l=this.get("ffz_sorted_suggestions"),f=this.get("ffz_current_suggestion")+(n===c.PAGE_UP?-5:5);0>f?f=0:f>=l.length&&(f=l.length-1),this.set("ffz_freeze_suggestions",-1),this.set("ffz_current_suggestion",f),o.preventDefault()}break;case c.UP:case c.DOWN:if(this.get("ffz_suggestions_visible")&&!(o.shiftKey||o.shiftLeft||o.ctrlKey||o.metaKey)){var l=this.get("ffz_sorted_suggestions"),f=this.get("ffz_current_suggestion")+(n===c.UP?-1:1);0>f?f=l.length-1:f>=l.length&&(f=0),
this.set("ffz_freeze_suggestions",-1),this.set("ffz_current_suggestion",f),o.preventDefault();break}if(o.shiftKey||o.shiftLeft||o.ctrlKey||o.metaKey)break;Ember.run.next(s.settings.input_mru?this.ffzCycleMRU.bind(this,n,d(this.get("chatTextArea"))):this.cycleWhisperTargets.bind(this,n));break;case c.ENTER:if(o.shiftKey||o.shiftLeft)break;this.set("ffz_mru_index",-1),this.get("ffz_suggestions_visible")?this.ffzCompleteSuggestion():(this.set("_currentWhisperTarget",-1),setTimeout(this.ffzResizeInput.bind(this),25),this.sendAction("sendMessage")),o.stopPropagation&&o.stopPropagation(),o.preventDefault();break;case c.SPACE:this.get("ffz_suggestions_visible")&&this.ffzHideSuggestions();var u=d(this.get("chatTextArea"));Ember.run.next(function(){var e=i.get("textareaValue"),t=e.indexOf(" "),o=-1!==t&&e.substr(0,t);if(t===u)if(s.settings.input_quick_reply&&"/r"===o){var n=i.get("uniqueWhisperSuggestions.0");n?(i.set("_currentWhisperTarget",0),i.set("textareaValue","/w "+n+i.get("textareaValue").substr(2)),Ember.run.next(function(){h(i.get("chatTextArea"),4+n.length)})):(i.set("textareaValue","/w "+i.get("textareaValue").substr(2)),Ember.run.next(function(){h(i.get("chatTextArea"),3),i.ffzFetchNameSuggestions(),i.set("ffz_suggestions_visible",!0),i.ffzSetPartialWord()}))}else("/w"===o||"/ignore"===o||"/unignore"===o||"/mod"===o||"/unmod"===o||"/ban"===o||"/unban"===o||"/timeout"===o||"/purge"===o)&&(i.ffzFetchNameSuggestions(),i.set("ffz_suggestions_visible",!0),i.ffzSetPartialWord())})}},ffzCycleMRU:function(e,t){var s=d(this.get("chatTextArea"));if(t===s){var i=this.get("ffz_mru_index"),o=this.get("parentView.context.model.mru_list")||[];i=e===c.UP?(i+1)%(o.length+1):(i+o.length)%(o.length+1);var n=this.get("ffz_old_mru");(void 0===n||null===n)&&(n=this.get("textareaValue"),this.set("ffz_old_mru",n));var a=o[i];void 0===a&&(this.set("ffz_old_mru",void 0),a=n),this.set("ffz_mru_index",i),this.set("textareaValue",a)}}})}},{"../constants":6,"../utils":53}],11:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");o.basic_settings.delayed_chat={type:"select",options:{"-1":"Default Delay (Room Specific; Non-Mod Only)",0:"No Delay",300:"Minor (Bot Moderation; 0.3s)",1200:"Normal (Human Moderation; 1.2s)",5e3:"Large (Spoiler Removal / Really Slow Mods; 5s)",1e4:"Extra Large (10s)",15e3:"Extremely Large (15s)",2e4:"Mods Asleep; Delay Chat (20s)",3e4:"Half a Minute (30s)",6e4:"Why??? (1m)"},category:"Chat",no_bttv:!0,name:"Delay and Filter Chat",help:"Delay the appearance of chat messages to allow time for moderation and completely hide removed messages.",get:function(){return this.settings.remove_deleted&&this.settings.remove_bot_ban_notices?this.settings.chat_delay:0},set:function(e){e=+e,this.settings.set("remove_deleted",0!==e),this.settings.set("remove_bot_ban_notices",0!==e),this.settings.set("chat_delay",e)}},o.settings_info.minimal_chat={type:"select",options:{0:"Disabled",1:"No Heading",2:"Minimalistic Input",3:"All"},value:0,category:"Chat Appearance",name:"Minimalistic Chat",help:"Hide all of the chat user interface, only showing messages and an input box.",process_value:function(e){return e===!1?0:e===!0?3:"string"==typeof e?parseInt(e)||0:e},on_update:function(e){if(document.body.classList.toggle("ffz-minimal-chat-head",1===e||3===e),document.body.classList.toggle("ffz-minimal-chat-input",e>1),this.settings.group_tabs&&this._chatv&&this._chatv._ffz_tabs){var t=this;setTimeout(function(){t._chatv&&t._chatv.$(".chat-room").css("top",t._chatv._ffz_tabs.offsetHeight+"px"),t._roomv&&t._roomv.get("stuckToBottom")&&t._roomv._scrollToBottom()},0)}(1===e||3===e)&&this._chatv&&this._chatv.get("controller.showList")&&this._chatv.set("controller.showList",!1),e>1||!this._chat_style?e>1&&this._inputv&&this._inputv.ffzResizeInput():(this._inputv&&(this._inputv._ffz_minimal_style&&(this._inputv._ffz_minimal_style.innerHTML=""),this._inputv._ffz_last_height=void 0),n.update_css(this._chat_style,"input_height",""),this._roomv&&this._roomv.get("stuckToBottom")&&this._roomv._scrollToBottom())}},o.settings_info.chat_batching={type:"select",options:{0:"No Batching",125:"Minimal (0.125s)",250:"Minor (0.25s)",500:"Normal (0.5s)",750:"Large (0.75s)",1e3:"Extreme (1s)"},value:0,category:"Chat Appearance",no_bttv:!0,name:"Chat Message Batching",help:"Display chat messages in batches to improve performance in <em>extremely</em> fast chats.",process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},on_update:function(e){this._roomv&&this._roomv.ffzUpdateStatus()}},o.settings_info.chat_delay={type:"select",options:{"-1":"Default Delay (Room Specific; Non-Mod Only)",0:"No Delay",300:"Minor (Bot Moderation; 0.3s)",1200:"Normal (Human Moderation; 1.2s)",5e3:"Large (Spoiler Removal / Really Slow Mods; 5s)",1e4:"Extra Large (10s)",15e3:"Extremely Large (15s)",2e4:"Mods Asleep; Delay Chat (20s)",3e4:"Half a Minute (30s)",6e4:"Why??? (1m)"},value:-1,category:"Chat Appearance",no_bttv:!0,name:"Artificial Chat Delay",help:"Delay the appearance of chat messages to allow for moderation before you see them.",process_value:function(e){return"string"==typeof e?parseInt(e||"0"):e},on_update:function(e){for(var t in this.rooms){var s=this.rooms[t].room;s&&Ember.propertyDidChange(s,"ffz_chat_delay")}this._roomv&&this._roomv.ffzUpdateStatus()}},o.settings_info.remove_deleted={type:"boolean",value:!1,no_bttv:!0,category:"Chat Filtering",name:"Remove Deleted Messages",help:"Remove deleted messages from chat entirely rather than leaving behind a clickable &lt;deleted message&gt;.",on_update:function(e){if(!this.has_bttv&&this.rooms&&e)for(var t in this.rooms){var s=this.rooms[t],i=s&&s.room;if(i)for(var o,n=i.get("messages"),a=n.get("length"),r=a;r--;){var l=n.get(r);l.ffz_deleted||l.deleted?(void 0===o&&(o=l.ffz_alternate),n.removeAt(r)):void 0===o?o=l.ffz_alternate:(o=!o,i.set("messages."+r+".ffz_alternate",o))}}}},o.settings_info.remove_bot_ban_notices={type:"boolean",value:!1,no_bttv:!0,category:"Chat Filtering",name:"Remove Bot Ban Notices",help:"Remove messages from bots announcing who was banned for what reason and for how long."},o.settings_info.prevent_clear={type:"boolean",value:!1,no_bttv:!0,category:"Chat Filtering",name:"Show Deleted Messages",help:"Fade deleted messages instead of replacing them, and prevent chat from being cleared.",on_update:function(e){if(!this.has_bttv&&this.rooms)for(var t in this.rooms){var s=this.rooms[t],i=s&&s.room;i&&i.get("messages").forEach(function(t,s){e&&!t.ffz_deleted&&t.deleted?i.set("messages."+s+".deleted",!1):!t.ffz_deleted||e||t.deleted||i.set("messages."+s+".deleted",!0)})}}},o.settings_info.chat_history={type:"boolean",value:!0,visible:!1,category:"Chat Appearance",name:"Chat History <span>Alpha</span>",help:"Load previous chat messages when loading a chat room so you can see what people have been talking about. <b>This currently only works in a handful of channels due to server capacity.</b>"},o.settings_info.group_tabs={type:"select",options:{0:"Disabled",1:"Rooms with Recent Activity",2:"Rooms with Recent Mentions",3:"All Rooms"},value:0,process_value:function(e){return e===!1?0:e===!0?3:"string"==typeof e?parseInt(e)||0:e},no_bttv:!0,category:"Chat Appearance",name:"Chat Room Tabs",help:"Display tabs for chat rooms with recent activity at the top of the chat window for more convenient chatting.",on_update:function(e){!this.has_bttv&&this._chatv&&(e?this._chatv._ffz_tabs?this._chatv.ffzRebuildTabs():this._chatv.ffzEnableTabs():this._chatv.ffzDisableTabs(),this._chatv.ffzUpdateMenuUnread())}},o.settings_info.pinned_rooms={value:[],visible:!1},o.settings_info.visible_rooms={value:[],visible:!1},o.prototype.refresh_chat=function(){var e,t=jQuery("ul.chat-lines");if(!this.has_bttv&&t&&t.length&&(e=t.parents(".chatReplay"),!e||!e.length)){var s=n.ember_lookup("controller:chat");if(s){var i=s.get("currentRoom");s.blurRoom(),s.focusRoom(i)}}},o.prototype.setup_chatview=function(){document.body.classList.toggle("ffz-minimal-chat-head",1===this.settings.minimal_chat||3===this.settings.minimal_chat),document.body.classList.toggle("ffz-minimal-chat-input",2===this.settings.minimal_chat||3===this.settings.minimal_chat),this.log("Hooking the Ember Chat controller.");var e=n.ember_lookup("controller:chat"),t=this;e&&(e.set("ffz_last_channel_room",e.get("currentChannelRoom.id")),e.reopen({ffzUpdateChannels:function(){t._chatv&&!t.has_bttv&&(t._chatv.ffzRebuildMenu(),t.settings.group_tabs&&t._chatv.ffzRebuildTabs())}.observes("currentChannelRoom","connectedPrivateGroupRooms"),ffzSubOwnChannelRoom:function(){try{var e=this.get("ffz_last_channel_room"),s=this.get("currentChannelRoom.id"),i=t.rooms&&t.rooms[e],o=t.rooms&&t.rooms[s];this.set("ffz_last_channel_room",s),t.update_room_important(e,this),t.update_room_important(s,this),i&&!i.important&&t.ws_unsub("room."+e),o&&o.important&&t.ws_sub("room."+s)}catch(n){t.error("Error updating Chat Room Subscriptions",n)}}.observes("currentChannelRoom"),ffzUpdateInvites:function(){t._chatv&&!t.has_bttv&&t._chatv.ffzUpdateMenuUnread()}.observes("invitedPrivateGroupRooms"),ffzChangedRoom:function(){t._inputv&&Ember.propertyDidChange(t._inputv,"ffz_emoticons")}.observes("currentRoom"),notificationsCount:function(){if(!t._chatv||t.has_bttv)return this._super();var e=this.get("invitedPrivateGroupRooms.length")||0;if(!t._chatv._ffz_tabs&&t._chatv.ffz_unread)for(var s in t._chatv.ffz_unread)t._chatv.ffz_unread[s]&&e++;return e}.property("currentRoom","currentChannelRoom","currentChannelRoom.unreadCount","invitedPrivateGroupRooms.length","connectedPrivateGroupRooms.@each.unreadCount"),_kickUserFromRoomNoLongerInList:function(){if(t._chatv&&t._chatv.ffz_unread){var e=!1;for(var s in t._chatv.ffz_unread)!t._chatv.ffz_unread[s]||t.rooms[s]&&t.rooms[s].room||(t._chatv.ffz_unread[s]=!1,e=!0);e&&t._chatv.ffzUpdateMenuUnread()}var i=this.get("currentRoom"),s=i&&i.get("id"),o=this.get("currentChannelRoom"),n=i&&_.contains(this.get("privateGroupRooms.content")||[],i);i===o||n||t._chatv&&t._chatv._ffz_host===s||t.settings.pinned_rooms&&-1!==t.settings.pinned_rooms.indexOf(s)||(this.blurRoom(),this.get("showList")||this.send("toggleMode"))}.observes("privateGroupRooms.@each"),removeCurrentChannelRoom:function(){if(t.has_bttv)return this._super();var e=this.get("currentChannelRoom"),s=e&&e.get("id"),i=t.get_user();t._chatv&&t._chatv._ffz_host===s||t.settings.pinned_rooms&&-1!==t.settings.pinned_rooms.indexOf(s)||(e===this.get("currentRoom")&&this.blurRoom(),e&&i&&i.login!==s&&e.ffzScheduleDestroy()),this.set("currentChannelRoom",void 0)}})),this.log("Hooking the Ember Chat view."),this.update_views("view:chat",this.modify_chat_view)},o.prototype.modify_chat_view=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){t._chatv=this;var e=this.get("controller.currentRoom.id"),s=this.get("element");s&&s.setAttribute("data-room",e||""),this.$(".textarea-contain").append(t.build_ui_link(this)),t.has_bttv||(t.settings.group_tabs&&this.ffzEnableTabs(),this.ffzRebuildMenu()),this.ffz_pruner=setInterval(this.ffzPruneTabs.bind(this),1e4),setTimeout(function(){t.settings.group_tabs&&t._chatv&&t._chatv._ffz_tabs&&t._chatv.$(".chat-room").css("top",t._chatv._ffz_tabs.offsetHeight+"px");var e=t._chatv&&t._chatv.get("controller");e&&e.set("showList",!1)},1e3)},ffz_destroy:function(){t._chatv===this&&(t._chatv=null),this.ffz_pruner&&(clearInterval(this.ffz_pruner),this.ffz_pruner=null),this.$(".textarea-contain .ffz-ui-toggle").remove(),t.settings.group_tabs&&this.ffzDisableTabs(),this.ffzTeardownMenu(),this.ffzUnloadHost()},ffzPruneTabs:function(){if(this._ffz_tabs){for(var e=this._ffz_tabs.querySelectorAll(".ffz-chat-tab:not(.hidden):not(.active)"),t=!1,s=0;s<e.length;s++){var i=e[s],o=i.getAttribute("data-room"),n=i.classList.contains("hidden"),a=!this.ffzTabVisible(o);n!==a&&(i.classList.toggle("hidden",a),t=!0)}t&&this.$(".chat-room").css("top",this._ffz_tabs.offsetHeight+"px")}},ffzChangeRoom:Ember.observer("controller.currentRoom",function(){t.update_ui_link(),this.ffz_unread=this.ffz_unread||{},t._mod_card&&t._mod_card.get("closeAction")();var e=this.get("controller.currentRoom"),s=e&&e.get("id"),i=this.get("element"),o=s&&this.ffz_unread[s],n=!1;if(e&&(e.resetUnreadCount(),e.ffz_last_view=Date.now()),i&&i.setAttribute("data-room",s||""),e&&e._ffz_tab){var a=e._ffz_tab.classList.contains("hidden"),r=!this.ffzTabVisible(s);a!==r&&(e._ffz_tab.classList.toggle("hidden",r),n=!0)}if(o&&s&&(this.ffz_unread[s]=!1,this.ffzUpdateMenuUnread()),this._ffz_chan_table&&jQuery(".ffz-room-row.active",this._ffz_chan_table).removeClass("active"),this._ffz_group_table&&jQuery(".ffz-room-row.active",this._ffz_group_table).removeClass("active"),this._ffz_tabs){jQuery(".ffz-chat-tab.active",this._ffz_tabs).removeClass("active");var l=e&&e.get("canInvite");this._ffz_invite&&this._ffz_invite.classList.toggle("hidden",!l),this.set("controller.showInviteUser",l&&this.get("controller.showInviteUser")),n=!0}if(e&&e._ffz_tab){e._ffz_tab.classList.remove("tab-mentioned"),e._ffz_tab.classList.add("active");var c=e._ffz_tab.querySelector("span");c&&(c.innerHTML="")}if(e&&e._ffz_row){e._ffz_row.classList.remove("row-mentioned"),e._ffz_row.classList.add("active");var c=e._ffz_row.querySelector("span");c&&(c.innerHTML="")}n&&this.$(".chat-room").css("top",this._ffz_tabs.offsetHeight+"px")}),ffzUnloadHost:function(){this._ffz_host&&(-1===t.settings.pinned_rooms.indexOf(this._ffz_host)&&(this.get("controller.currentRoom")===this._ffz_host_room&&this.get("controller").blurRoom(),this._ffz_host_room.ffzScheduleDestroy()),this._ffz_host=null,this._ffz_host_room=null)},ffzUpdateHost:function(){var e=n.ember_lookup("controller:channel"),s=n.ember_resolve("model:room"),i=s&&e&&e.get("hostModeTarget"),o=!1;if(!t.has_bttv){if(i){var a=i.get("id");this._ffz_host!==a&&(this.ffzUnloadHost(),this._ffz_host=a,this._ffz_host_room=s.findOne(a),o=!0)}else this._ffz_host&&(this.ffzUnloadHost(),o=!0);o&&(this.ffzRebuildMenu(),this.ffzRebuildTabs())}},ffzUpdateMenuUnread:function(){var e=this.get("element"),t=this.get("controller"),s=e&&e.querySelector("#ffz-group-tabs .button .notifications");Ember.propertyDidChange(t,"notificationsCount"),s&&(s.innerHTML=n.format_unread(t.get("notificationsCount")))},ffzUpdateUnread:function(e){var s=this.get("controller.currentRoom.id");if(this.ffz_unread=this.ffz_unread||{},e!==s){var i,o=!1,a=!1;i=e?[e]:Object.keys(t.rooms);for(var r=0;r<i.length;r++){var l=i[r],c=t.rooms[l]&&t.rooms[l].room,d=c&&c._ffz_row,h=c&&c._ffz_tab,f=l===s?0:c.get("unreadCount"),u=f>0,_=n.format_unread(f);if(this.ffz_unread[l]!==u&&(this.ffz_unread[l]=u,o=!0),d){var m=d.querySelector("span");m&&(m.innerHTML=_)}if(h){var g=h.classList.contains("hidden"),p=!this.ffzTabVisible(l),m=h.querySelector("span");g!==p&&(h.classList.toggle("hidden",p),a=!0),m&&(m.innerHTML=_)}}a&&this.$(".chat-room").css("top",this._ffz_tabs.offsetHeight+"px"),o&&this.ffzUpdateMenuUnread()}},ffzTeardownMenu:function(){var e=this.get("element"),s=e&&e.querySelector(".chat-rooms .tse-content"),i=s&&s.querySelector("#ffz-channel-table"),o=s&&s.querySelector("#ffz-group-table");i&&i.parentElement.removeChild(i),o&&o.parentElement.removeChild(o),this._ffz_chan_table=null,this._ffz_group_table=null,s&&s.classList.contains("ffz-room-list")&&(s.classList.remove("ffz-room-list"),jQuery(".ffz",s).removeClass("ffz"));for(var n in t.rooms)t.rooms[n]&&t.rooms[n].room&&t.rooms[n].room._ffz_row&&(t.rooms[n].room._ffz_row=null)},ffzRebuildMenu:function(){var e=this.get("element"),s=e&&e.querySelector(".chat-rooms .tse-content");if(s){if(!s.classList.contains("ffz-room-list")){s.classList.add("ffz-room-list");var i=s.querySelectorAll(".list-header"),o=i.length?i[i.length-1]:void 0;o&&(o.classList.add("ffz"),o.nextSibling&&o.nextSibling.classList&&o.nextSibling.classList.add("ffz"))}var r=this,l=this._ffz_chan_table||s.querySelector("#ffz-channel-table tbody");if(l)l.innerHTML="";else{var c=n.createElement("table","ffz");c.setAttribute("cellspacing","0"),c.id="ffz-channel-table",c.innerHTML='<thead><tr><th colspan="2">Channels</th><th class="ffz-row-switch" title="Pinning a channel makes it so you always join that channel\'s chat, no matter where you are on Twitch.">Pin</th></tr></thead><tbody></tbody>',s.insertBefore(c,s.firstChild),jQuery(".ffz-row-switch",c).tipsy({gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"se")}),l=this._ffz_chan_table=c.querySelector("tbody")}var d,h=this.get("controller.currentChannelRoom"),f=h&&h.get("id");h&&(d=this.ffzBuildRow(h,!0),d&&l.appendChild(d)),this._ffz_host_room&&(d=this.ffzBuildRow(this._ffz_host_room,!1,!0),d&&l.appendChild(d));for(var u=0;u<t.settings.pinned_rooms.length;u++){var m=t.settings.pinned_rooms[u];f!==m&&this._ffz_host!==m&&t.rooms[m]&&t.rooms[m].room&&(d=this.ffzBuildRow(t.rooms[m].room),d&&l.appendChild(d))}var g=this._ffz_group_table||s.querySelector("#ffz-group-table tbody");if(g)g.innerHTML="";else{var c=n.createElement("table","ffz");c.setAttribute("cellspacing","0"),c.id="ffz-group-table",c.innerHTML='<thead><tr><th colspan="2">Group Chats</th></tr></thead><tbody></tbody>';var p=s.querySelector("#ffz-channel-table");s.insertBefore(c,p.nextSibling),g=this._ffz_group_table=c.querySelector("tbody")}_.each(this.get("controller.connectedPrivateGroupRooms"),function(e){var t=r.ffzBuildRow(e);t&&g&&g.appendChild(t)});var v=e.querySelector(".button.create");v&&(v.title="Create a Group Room")}},ffzBuildRow:function(e,s,i){var r,l=this,c=document.createElement("tr"),d=document.createElement("td"),h=document.createElement("td"),f=document.createElement("td"),u=e.get("id"),_=e.get("isGroupRoom"),m=e===this.get("controller.currentRoom"),g=n.format_unread(m?0:e.get("unreadCount")),p=e.get("tmiRoom.displayName")||(_?e.get("tmiRoom.name"):o.get_capitalization(u,function(t){var s=e===l.get("controller.currentRoom");g=n.format_unread(s?0:e.get("unreadCount")),h.innerHTML=n.sanitize(t)+" <span>"+g+"</span>"}));return c.setAttribute("data-room",u),c.className="ffz-room-row",c.classList.toggle("current-channel",s),c.classList.toggle("host-channel",i),c.classList.toggle("group-chat",_),c.classList.toggle("active",m),s?(d.innerHTML=a.CAMERA,c.title="Current Channel",c.classList.add("html-tooltip")):i&&(d.innerHTML=a.EYE,c.title="Hosted Channel",c.classList.add("html-tooltip")),h.className="ffz-room",h.innerHTML=n.sanitize(p)+" <span>"+g+"</span>",c.appendChild(d),c.appendChild(h),f.className="ffz-row-switch",_?(r=n.createElement("a","leave-chat html-tooltip"),r.innerHTML=a.CLOSE,r.title="Leave Group",f.innerHTML="",f.appendChild(r),r.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation&&t.stopPropagation(),confirm('Are you sure you want to leave the group room "'+p+'"?')&&e.get("isGroupRoom")&&e.del()})):(f.innerHTML='<a class="switch'+(-1!==t.settings.pinned_rooms.indexOf(u)?" active":"")+'"><span></span></a>',r=f.querySelector("a.switch"),r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation();var s=-1!==t.settings.pinned_rooms.indexOf(u);s?t._leave_room(u):t._join_room(u),this.classList.toggle("active",!s)})),c.appendChild(f),c.addEventListener("click",function(){var t=l.get("controller");t.focusRoom(e),t.set("showList",!1)}),e._ffz_row=c,c},ffzEnableTabs:function(){if(!t.has_bttv&&t.settings.group_tabs&&!this._ffz_tabs){this.$(".chat-header").addClass("hidden");var e=this._ffz_tabs=document.createElement("div");e.id="ffz-group-tabs",this.$(".chat-header").after(e),this.ffzRebuildTabs()}},ffzDisableTabs:function(){if(this._ffz_tabs){this._ffz_tabs.parentElement.removeChild(this._ffz_tabs),this._ffz_tabs=null,this._ffz_invite=null;for(var e in t.rooms)t.rooms[e]&&t.rooms[e].room&&t.rooms[e].room._ffz_tab&&(t.rooms[e].room._ffz_tab=null)}this.$(".chat-room").css("top",""),this.$(".chat-header").removeClass("hidden")},ffzRebuildTabs:function(){var e=this._ffz_tabs||this.get("element").querySelector("#ffz-group-tabs");if(e&&(e.innerHTML="",!t.has_bttv&&t.settings.group_tabs)){var s=n.createElement("a","button button--icon-only"),i=this;s.title="Chat Room Management",s.innerHTML='<figure class="icon">'+a.ROOMS+'</figure><span class="notifications"></span>',jQuery(s).tipsy({gravity:"n",offset:5}),s.addEventListener("click",function(){var e=i.get("controller");e&&e.set("showList",!e.get("showList"))}),e.appendChild(s),s=n.createElement("a","button button--icon-only html-tooltip invite"),s.title="Invite a User",s.innerHTML='<figure class="icon">'+a.INVITE+"</figure>",s.addEventListener("click",function(){var e=i.get("controller");e&&e.set("showInviteUser",e.get("currentRoom.canInvite")&&!e.get("showInviteUser"))}),s.classList.toggle("hidden",!this.get("controller.currentRoom.canInvite")),i._ffz_invite=s,e.appendChild(s);var o,r=this.get("controller.currentChannelRoom"),l=r&&r.get("id");r&&(o=this.ffzBuildTab(r,!0),o&&e.appendChild(o)),this._ffz_host_room&&(o=i.ffzBuildTab(this._ffz_host_room,!1,!0),o&&e.appendChild(o));for(var c=0;c<t.settings.pinned_rooms.length;c++){var d=t.settings.pinned_rooms[c];l!==d&&this._ffz_host!==d&&t.rooms[d]&&t.rooms[d].room&&(o=i.ffzBuildTab(t.rooms[d].room,!1,!1),o&&e.appendChild(o))}_.each(this.get("controller.connectedPrivateGroupRooms"),function(t){var s=i.ffzBuildTab(t);s&&e.appendChild(s)}),this.$(".chat-room").css("top",e.offsetHeight+"px"),this.ffzUpdateMenuUnread()}},ffzBuildTab:function(e,t,s){var i,r,l=this,c=document.createElement("span"),d="",h=e.get("id"),f=e.get("isGroupRoom"),u=e===this.get("controller.currentRoom");return c.setAttribute("data-room",h),c.className="ffz-chat-tab html-tooltip",c.classList.toggle("current-channel",t),c.classList.toggle("host-channel",s),c.classList.toggle("group-chat",f),c.classList.toggle("active",u),c.classList.toggle("hidden",!this.ffzTabVisible(h)),r=n.format_unread(u?0:e.get("unreadCount")),i=e.get("tmiRoom.displayName")||(f?e.get("tmiRoom.name"):o.get_capitalization(h,function(t){var s=e===l.get("controller.currentRoom");r=n.format_unread(s?0:e.get("unreadCount")),c.innerHTML=d+n.sanitize(t)+"<span>"+r+"</span>"})),t?(d=a.CAMERA,c.title="Current Channel"):s?(d=a.EYE,c.title="Hosted Channel"):c.title=f?"Group Chat":"Pinned Channel",c.innerHTML=d+n.sanitize(i)+"<span>"+r+"</span>",c.addEventListener("click",function(){var t=l.get("controller");t.focusRoom(e),t.set("showList",!1)}),e._ffz_tab=c,c},ffzTabVisible:function(e){var s=t.rooms[e]&&t.rooms[e].room,i=s===this.get("controller.currentRoom"),o=s===this.get("controller.currentChannelRoom"),n=Date.now();return s?i||o||e===this._ffz_host||3===t.settings.group_tabs?!0:n-s.ffz_last_view<6e4||n-s.ffz_last_input<27e5?!0:1===t.settings.group_tabs&&n-(s.ffz_last_activity||0)<27e5?!0:2===t.settings.group_tabs&&n-(s.ffz_last_mention||0)<27e5?!0:!1:!1}})},o.prototype.connect_extra_chat=function(){var e=this.get_user();if(e&&e.login&&(!this.rooms[e.login]||this.rooms[e.login].room)){var t=n.ember_resolve("model:room");t&&t.findOne(e.login)}if(!this.has_bttv){for(var s=0;s<this.settings.pinned_rooms.length;s++)this._join_room(this.settings.pinned_rooms[s],!0);this._chatv&&(this.settings.group_tabs&&this._chatv.ffzRebuildTabs(),this._chatv.ffzRebuildMenu())}},o.prototype.disconnect_extra_chat=function(){var e=n.ember_lookup("controller:chat"),t=e&&e.get("currentChannelRoom.id"),s=e&&e.get("currentRoom.id"),i=this.get_user();if(e)for(var o=0;o<this.settings.pinned_rooms.length;o++){var a=this.settings.pinned_rooms[o];a===t||i&&a===i.login||this.rooms[a]&&this.rooms[a].room&&(s===a&&e.blurRoom(),this.rooms[a].room.destroy())}},o.prototype._join_room=function(e,t){var s=!1;if(-1===this.settings.pinned_rooms.indexOf(e)&&(this.settings.pinned_rooms.push(e),this.settings.set("pinned_rooms",this.settings.pinned_rooms),s=!0),!this.rooms[e]||!this.rooms[e].room){var i=n.ember_resolve("model:room");i&&i.findOne(e)}return t||this.has_bttv||!this._chatv||(this.settings.group_tabs&&this._chatv.ffzRebuildTabs(),this._chatv.ffzRebuildMenu()),s},o.prototype._leave_room=function(e,t){var s=!1;if(-1!==this.settings.pinned_rooms.indexOf(e)&&(this.settings.pinned_rooms.removeObject(e),this.settings.set("pinned_rooms",this.settings.pinned_rooms),s=!0),!this.rooms[e]||!this.rooms[e].room)return s;var i=n.ember_lookup("controller:chat"),o=this.rooms[e].room,a=this.get_user();return!i||i.get("currentChannelRoom.id")===e||this._chatv&&this._chatv._ffz_host===e?s:(i.get("currentRoom.id")===e&&i.blurRoom(),a&&a.login===e||o.destroy(),t||this.has_bttv||!this._chatv||(this.settings.group_tabs&&this._chatv.ffzRebuildTabs(),this._chatv.ffzRebuildMenu()),s)},o.chat_commands.join=function(e,t){if(this.has_bttv)return"Pinned Rooms are not available with BetterTTV installed.";if(!t||!t.length||t.length>1)return"Join Usage: /join <channel>";var s=t[0].toLowerCase();return"#"===s.charAt(0)&&(s=s.substr(1)),this._join_room(s)?"Joining "+s+". You will always connect to this channel's chat unless you later /part from it.":"You have already joined "+s+'. Please use "/part '+s+'" to leave it.'},o.chat_commands.part=function(e,t){if(this.has_bttv)return"Pinned Rooms are not available with BetterTTV installed.";if(!t||!t.length||t.length>1)return"Part Usage: /part <channel>";var s=t[0].toLowerCase();return"#"===s.charAt(0)&&(s=s.substr(1)),this._leave_room(s)?"Leaving "+s+".":this.rooms[s]?"You do not have "+s+" pinned and you cannot leave the current channel or hosted channels via /part.":"You are not in "+s+"."}},{"../constants":6,"../utils":53}],12:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants"),r=n.createElement;o.settings_info.conv_focus_on_click={type:"boolean",value:!1,no_mobile:!0,visible:!1,category:"Whispers",name:"Focus Input on Click",help:"Focus on a conversation's input box when you click it."},o.settings_info.top_conversations={type:"boolean",value:!1,no_mobile:!0,category:"Whispers",name:"Position on Top",help:"Display the whisper UI at the top of the window instead of the bottom.",on_update:function(e){document.body.classList.toggle("ffz-top-conversations",e)}},o.settings_info.hide_conversations_in_theatre={type:"boolean",value:!1,no_mobile:!0,category:"Whispers",name:"Hide Whispers in Theater Mode",help:"Hide the whisper UI when the page is in theater mode.",on_update:function(e){document.body.classList.toggle("ffz-theatre-conversations",e)}},o.settings_info.minimize_conversations={type:"boolean",value:!1,no_mobile:!0,category:"Whispers",name:"Minimize Whisper UI",help:"Slide the whisper UI mostly out of view when it's not being used and you have no unread messages.",on_update:function(e){document.body.classList.toggle("ffz-minimize-conversations",e)}},o.prototype.setup_conversations=function(){document.body.classList.toggle("ffz-top-conversations",this.settings.top_conversations),document.body.classList.toggle("ffz-minimize-conversations",this.settings.minimize_conversations),document.body.classList.toggle("ffz-theatre-conversations",this.settings.hide_conversations_in_theatre),this.update_views("component:twitch-conversations/conversation-window",this.modify_conversation_window),this.update_views("component:twitch-conversations/conversation-settings-menu",this.modify_conversation_menu),this.update_views("component:twitch-conversations/conversation-line",this.modify_conversation_line)},o.prototype.modify_conversation_menu=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){var e=this.get("thread.otherUsername"),s=this.get("element"),i=s&&s.querySelectorAll(".options-section");if(e&&e.length&&!t.has_bttv){i&&i.length&&s.appendChild(r("div","options-divider"));var n=r("div","options-section"),a=r("a","ffz-show-card","Open Moderation Card");a.addEventListener("click",function(i){s.parentElement.classList.add("hidden"),o.chat_commands.card.call(t,null,[e])}),n.appendChild(a),s.appendChild(n)}}})},o.prototype.modify_conversation_window=function(e){var t=this,s=n.ember_lookup("service:layout");n.ember_reopen_view(e,{headerBadges:Ember.computed("thread.participants","currentUsername",function(){return[]}),ffzHeaderBadges:Ember.computed("thread.participants","currentUsername",function(){var e=this.get("otherUser");return t.get_other_badges(e.get("username"),null,e.get("userType"),!1,e.get("hasTurbo"))}),ffzReplaceBadges:function(){var e=this.get("element"),s=e&&e.querySelector(".badges"),i=this.get("ffzHeaderBadges");s.innerHTML=t.render_badges(i)}.observes("ffzHeaderBadges"),ffz_init:function(){var e=this.get("element"),i=e&&e.querySelector(".conversation-header"),o=i&&i.querySelector(".conversation-header-name"),r=this.get("otherUser.color"),l=r&&t._handle_color(r),c=s&&s.get("isTheatreMode")||t.settings.dark_twitch;this.ffzReplaceBadges(),o&&r&&(o.style.color=c?l[1]:l[0],o.classList.add("has-color"),o.setAttribute("data-color",r)),jQuery(".badge",e).tipsy({gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"n")})}})},o.prototype.modify_conversation_line=function(e){var t=this,s=n.ember_lookup("service:layout");n.ember_reopen_view(e,{tokenizedMessage:function(){try{return t.tokenize_conversation_line(this.get("message"))}catch(e){return t.error("convo-line tokenizedMessage: "+e),this._super()}}.property("message","currentUsername"),click:function(e){if(e.target&&e.target.classList.contains("deleted-link"))return t._deleted_link_click.call(e.target,e);if(!t._click_emote(e.target,e))return this._super(e)},didUpdate:function(){this.ffzRender()},ffz_init:function(){this.ffzRender()},ffzRender:function(){var e=this.get("element"),i=[],o=this.get("message.from.username"),a=this.get("message.from.color"),r=a&&t._handle_color(a),l=s&&s.get("isTheatreMode")||t.settings.dark_twitch,c=t.get_user(),d=c&&c.login===o,h=t.aliases[o],f=this.get("message.from.displayName")||o&&o.capitalize()||"unknown user",u=r&&"color:"+(l?r[1]:r[0]),_=u?" has-color":"";i.push(h?'<span class="from ffz-alias html-tooltip'+_+'" style="'+u+(r?'" data-color="'+a:"")+'" title="'+n.quote_san(f)+'">'+n.sanitize(h)+"</span>":'<span class="from'+_+'" style="'+u+(r?'" data-color="'+a:"")+'">'+n.sanitize(f)+"</span>"),i.push('<span class="colon">:</span> '),this.get("isActionMessage")||(u="",_=""),i.push('<span class="message'+_+'" style="'+u+(r?'" data-color="'+a:"")+'">'),i.push(t.render_tokens(this.get("tokenizedMessage"),!0,t.settings.filter_whispered_links&&!d)),i.push("</span>"),e.innerHTML=i.join("")}})}},{"../constants":6,"../utils":53}],13:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants"),r="//static-cdn.jtvnw.net/jtv_user_pictures/xarth/404_user_150x150.png";o.settings_info.directory_creative_showcase={type:"boolean",value:!0,category:"Directory",no_mobile:!0,name:"Creative Showcase",help:"Display the showcase on the Creative directory page.",on_update:function(e){document.body.classList.toggle("ffz-creative-showcase",e)}},o.settings_info.directory_logos={type:"boolean",value:!1,category:"Directory",no_mobile:!0,name:"Channel Logos",help:"Display channel logos in the Twitch directory."},o.settings_info.directory_group_hosts={type:"boolean",value:!0,category:"Directory",no_mobile:!0,name:"Group Hosts",help:"Only show a given hosted channel once in the directory.",on_update:function(){var e=n.ember_resolve("model:host"),t=e&&e.collections[e.collectionId("following")];t&&(t.clear(),t.load())}},o.settings_info.enable_recommended_vods={type:"boolean",value:!0,category:"Directory",no_mobile:!0,experiment_warn:!0,name:"Show Twitch's  Recommended Videos",help:'Show the "Based on your Viewing History" section of the directory rather than <nobr>Most Recent Videos.</nobr>',on_update:function(e){Ember.propertyDidChange(n.ember_lookup("service:vod-coviews"),"areVodsViewable")}},o.settings_info.recommended_above_hosts={type:"boolean",value:function(){var e=n.ember_lookup("service:vod-coviews");return e&&e.get("isFollowingAboveHost")},category:"Directory",no_mobile:!0,experiment_warn:!0,name:"Show Twitch's Recommended Videos above Hosts",help:'Enable this to place the "Based on your Viewing History" section above Live Hosts.',on_update:function(e){
Ember.propertyDidChange(n.ember_lookup("service:vod-coviews"),"isFollowingAboveHost")}},o.settings_info.banned_games={visible:!1,value:[],on_update:function(){for(var e=this.settings.banned_games,t=document.querySelectorAll(".ffz-directory-preview"),s=0;s<t.length;s++){var i=t[s],o=i.getAttribute("data-game");i.classList.toggle("ffz-game-banned",-1!==e.indexOf(o&&o.toLowerCase()))}}},o.settings_info.spoiler_games={visible:!1,value:[],on_update:function(){for(var e=this.settings.spoiler_games,t=document.querySelectorAll(".ffz-directory-preview"),s=0;s<t.length;s++){var i=t[s],o=i.getAttribute("data-game");i.classList.toggle("ffz-game-spoilered",-1!==e.indexOf(o&&o.toLowerCase()))}}},o.settings_info.directory_host_menus={type:"select",options:{0:"Disabled",1:"When Multiple are Hosting",2:"Always"},value:1,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},category:"Directory",no_mobile:!0,name:"Hosted Channel Menus",help:"Display a menu to select which channel to visit when clicking a hosted channel in the directory.",on_update:function(){var e=n.ember_resolve("model:host"),t=e&&e.collections[e.collectionId("following")];t&&(t.clear(),t.load())}},o._image_cache={},o.prototype.setup_directory=function(){document.body.classList.toggle("ffz-creative-tags",this.settings.directory_creative_all_tags),document.body.classList.toggle("ffz-creative-showcase",this.settings.directory_creative_showcase);var e=this,t=n.ember_lookup("service:vod-coviews");t?(t.reopen({isFollowingAboveHost:Ember.computed("_ffz",{get:function(t){return e.settings.recommended_above_hosts},set:function(t,s){return e.settings.recommended_above_hosts}}),areVodsViewable:function(){var t=this.get("filteredVods");return e.settings.enable_recommended_vods&&t&&t.length>0}.property("filteredVods")}),Ember.propertyDidChange(t,"isFollowingAboveHost"),Ember.propertyDidChange(t,"areVodsViewable")):this.log("Unable to locate the Ember service:vod-coviews"),this.log("Hooking the Ember Directory views."),this.update_views("component:stream-preview",function(e){this.modify_directory_live(e,!1)},!0),this.update_views("component:creative-preview",function(e){this.modify_directory_live(e,!1)},!0),this.update_views("component:csgo-channel-preview",function(e){this.modify_directory_live(e,!0)},!0),this.update_views("component:host-preview",this.modify_directory_host,!0,!0),this.update_views("component:video-preview",this.modify_video_preview,!0),this.update_views("component:game-follow-button",this.modify_game_follow_button),this.log("Attempting to modify the Following collection."),this._modify_following()},o.prototype._modify_following=function(){var t=n.ember_resolve("model:host"),s=this;if(t){var i=t.collections[t.collectionId("following")];if(i){if(this.log("Found Following model."),i.reopen({ffz_streams:{},ffz_hosts_for:{},ffz_skipped:0,empty:function(){this._super(),this.set("ffz_streams",{}),this.set("ffz_hosts_for",{}),this.set("ffz_skipped",0)},request:function(t){if(!Twitch.user.isLoggedIn()||e.App.get("disableFollowingDirectory"))return RSVP.resolve({hosts:[],_total:0});var s={limit:this.limit,offset:this.get("content.length")+this.get("ffz_skipped")};return this.get("api").request("get","/api/users/:login/followed/hosting",s)},afterSuccess:function(e){for(var t=[],i=this.get("ffz_streams"),o=this.get("ffz_skipped"),n=(this.get("ffz_hosts_for"),0);n<e.hosts.length;n++){var a=e.hosts[n],r=a&&a.target&&a.target.id;a.rollbackData&&(a.rollbackData=void 0),s.settings.directory_group_hosts&&i[r]?(o++,i[r].ffz_hosts&&i[r].ffz_hosts.push({logo:a.logo,name:a.name,display_name:a.display_name})):(i[r]=a,a.ffz_hosts=[{logo:a.logo,name:a.name,display_name:a.display_name}],t.push(a))}this.set("ffz_skipped",o),this.setContent(t),this.set("gotNonEmptyResults",e.hosts&&e.hosts.length),this.set("total",e._total-o)}}),!i.get("isLoading")){for(var o=i.get("content"),a=i.get("total"),r=[],l=0;l<o.length;l++){var c=o[l];r.push({display_name:c.display_name,game:c.game,id:c.id,logo:c.logo,name:c.name,target:{_id:c.target._id,channel:{display_name:c.target.channel.display_name,id:c.target.channel.id,logo:c.target.channel.logo,name:c.target.channel.name,url:c.target.channel.url},id:c.target.id,meta_game:c.target.meta_game,preview:c.target.preview,title:c.target.title,url:c.target.url,viewers:c.target.viewers}})}i.clear(),i.afterSuccess({hosts:r,_total:a})}return}}setTimeout(this._modify_following.bind(this),250)},o.prototype.modify_game_follow_button=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){var e=this.get("element"),s=this.get("game.id").toLowerCase(),i=function(e,i){return function(o){o.preventDefault();var n=t.settings.get(e),a=n.indexOf(s);-1===a?n.push(s):n.splice(a,1),t.settings.set(e,n),i()}},o=n.createElement("button","button tooltip ffz-block-button"),a=function(){var e=-1!==t.settings.banned_games.indexOf(s);o.classList.toggle("active",e),o.innerHTML=e?"Unblock":"Block",o.title="Click to "+(e?"unblock":"block")+" this game.\n\nBlocking a game hides all the streams and videos of the game when you're not viewing it directly.",jQuery(o).trigger("mouseout").trigger("mouseover")};a(),o.addEventListener("click",i("banned_games",a)),e.appendChild(o);var r=n.createElement("button","button tooltip ffz-spoiler-button"),l=function(){var e=-1!==t.settings.spoiler_games.indexOf(s);r.classList.toggle("active",e),r.innerHTML=e?"Show Thumbnails":"Hide Thumbnails",r.title="Click to "+(e?"show":"hide")+" thumbnails for this game.\n\nHiding thumbnails for a game will help you avoid spoilers for a game that you haven't played yet.",jQuery(r).trigger("mouseout").trigger("mouseover")};l(),r.addEventListener("click",i("spoiler_games",l)),e.appendChild(r),jQuery(".tooltip",e).tipsy()}})},o.prototype.modify_directory_live=function(e,t){var s=this,i=t?"channel.":"stream.";n.ember_reopen_view(e,{ffz_init:function(){var e=this.get("element"),o=e&&e.querySelector(".meta"),l=e&&e.querySelector(".thumb"),c=l&&l.querySelector(".cap"),d=this.get(i+"channel.name"),h=this.get(i+"game");if(e.classList.add("ffz-directory-preview"),e.setAttribute("data-channel",d),e.setAttribute("data-game",h),e.classList.toggle("ffz-game-banned",-1!==s.settings.banned_games.indexOf(h&&h.toLowerCase())),e.classList.toggle("ffz-game-spoilered",-1!==s.settings.spoiler_games.indexOf(h&&h.toLowerCase())),s.settings.stream_uptime&&s.settings.stream_uptime<3&&c){var f=this._ffz_uptime=document.createElement("div");f.className="overlay_info length live",jQuery(f).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"s")}),c.appendChild(f),this._ffz_uptime_timer=setInterval(this.ffzUpdateUptime.bind(this),1e3),this.ffzUpdateUptime()}if(this._ffz_image_timer=setInterval(this.ffzRotateImage.bind(this),3e4),this.ffzRotateImage(),s.settings.directory_logos){e.classList.add("ffz-directory-logo");var u=document.createElement("a"),_=document.createElement("img");_.className="profile-photo",_.classList.toggle("is-csgo",t),_.src=this.get(i+"channel.logo")||r,_.alt=this.get(i+"channel.display_name"),u.href="/"+d,u.addEventListener("click",function(e){if(!(0!==e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)){var t=n.ember_resolve("model:deprecated-channel");if(t)return n.ember_lookup("router:main").transitionTo("channel.index",t.find({id:d}).load()),e.preventDefault(),!1}}),u.appendChild(_),o.insertBefore(u,o.firstChild)}},ffz_destroy:function(){this._ffz_uptime&&(this._ffz_uptime.parentElement.removeChild(this._ffz_uptime),this._ffz_uptime=null),this._ffz_uptime_timer&&clearInterval(this._ffz_uptime_timer),this._ffz_image_timer&&clearInterval(this._ffz_image_timer)},ffzRotateImage:function(){var e=this.get(i+"preview.medium"),t=Math.round((new Date).getTime()/15e4);o._image_cache[e]&&o._image_cache[e]!==t?e+="?_="+t:o._image_cache[e]=t,this.$(".thumb .cap img").attr("src",e)},ffzUpdateUptime:function(){var e=this.get(i+"created_at"),t=e&&n.parse_date(e),o=Date.now()-(s._ws_server_offset||0),r=t&&Math.floor((o-t.getTime())/1e3)||0;r>0?(this._ffz_uptime.innerHTML=a.CLOCK+n.time_to_string(r,!1,!1,!1,1===s.settings.stream_uptime),this._ffz_uptime.setAttribute("original-title","Stream Uptime <nobr>(since "+t.toLocaleString()+")</nobr>")):(this._ffz_uptime.setAttribute("original-title",""),this._ffz_uptime.innerHTML="")}})},o.prototype.modify_video_preview=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){var e=this.get("element"),s=this.get("video.game"),i=e&&e.querySelector(".thumb"),o=i&&i.querySelector(".boxart");if(e.classList.add("ffz-directory-preview"),e.setAttribute("data-channel",this.get("video.channel.name")),e.setAttribute("data-game",s),e.classList.toggle("ffz-game-banned",-1!==t.settings.banned_games.indexOf(s&&s.toLowerCase())),e.classList.toggle("ffz-game-spoilered",-1!==t.settings.spoiler_games.indexOf(s&&s.toLowerCase())),!o&&i&&s){var a=n.createElement("img"),r=n.ember_lookup("router:main");o=n.createElement("a","boxart"),o.href=this.get("video.gameUrl"),o.setAttribute("original-title",s),o.addEventListener("click",function(e){return 0!==e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey?void 0:(e.preventDefault(),jQuery(".tipsy").remove(),"Counter-Strike: Global Offensive"===s?r.transitionTo("csgo.channels.index"):"Creative"===s?r.transitionTo("creative.index"):r.transitionTo("game-directory.index",encodeURIComponent(s)),!1)}),a.src=this.get("video.gameBoxart"),o.appendChild(a),i.appendChild(o)}}})},o.prototype.modify_directory_host=function(e){var t=this;n.ember_reopen_view(e,{ffzVisitChannel:function(e,s){var i=n.ember_resolve("model:deprecated-channel");if(i){if(s){if(0!==s.button||s.altKey||s.ctrlKey||s.shiftKey||s.metaKey)return;s.preventDefault(),s.stopPropagation()}return t.close_popup(),n.ember_lookup("router:main").transitionTo("channel.index",i.find({id:e}).load()),!1}},ffzShowHostMenu:function(e){if(!(0!==e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)){e.preventDefault(),e.stopPropagation();var s=this.get("stream.ffz_hosts"),i=this.get("stream.target.channel.name");if(0===t.settings.directory_host_menus||!s||1===t.settings.directory_host_menus&&s.length<2)return this.ffzVisitChannel(s&&s.length<2?s[0].name:i);var o=t._popup?t.close_popup():t._last_popup,a=this;if(!o||!o.classList.contains("ffz-channel-selector")||o.getAttribute("data-channel")!==i){var l,c=document.createElement("div"),d=function(e){var t=document.createElement("a");return t.className="dropmenu_action",t.setAttribute("data-channel",e.name),t.href="/"+e.name,t.innerHTML='<img class="image" src="'+n.sanitize(e.logo||r)+'"><span class="title">'+n.sanitize(e.display_name)+"</span>",t.addEventListener("click",a.ffzVisitChannel.bind(a,e.name)),c.appendChild(t),t};c.className="ffz-channel-selector dropmenu menu-like",c.setAttribute("data-channel",i),l=document.createElement("div"),l.className="header",l.textContent="Hosted Channel",c.appendChild(l),d(this.get("stream.target.channel")),l=document.createElement("div"),l.className="header",l.textContent="Hosting Channels",c.appendChild(l);for(var h=0;h<s.length;h++)d(s[h]);var f=document.querySelector("#main_col > .tse-scroll-content > .tse-content"),u=f&&f.getBoundingClientRect(),_=e.clientX-60,m=e.clientY-60;u&&(_=Math.max(u.left,Math.min(_,u.left+u.width-302))),t.show_popup(c,[_,m],document.querySelector("#main_col > .tse-scroll-content > .tse-content"))}}},ffzRotateImage:function(){var e=this.get("stream.target.preview"),t=Math.round((new Date).getTime()/15e4);o._image_cache[e]&&o._image_cache[e]!==t?e+="?_="+t:o._image_cache[e]=t,this.$(".thumb .cap img").attr("src",e)},ffz_destroy:function(){var e=this.get("stream.target.channel");t._popup&&t._popup.classList.contains("ffz-channel-selector")&&t._popup.getAttribute("data-channel")===e&&t.close_popup(),this._ffz_image_timer&&clearInterval(this._ffz_image_timer)},ffz_init:function(){var e=this.get("element"),s=e&&e.querySelector(".meta"),i=e&&e.querySelector(".thumb"),o=i&&i.querySelector(".cap"),a=s&&s.querySelector(".title a"),l=this.get("stream.target.channel"),c=this.get("stream.target.meta_game"),d=this.get("stream.ffz_hosts");if(e.classList.add("ffz-directory-preview"),e.setAttribute("data-channel",l.name),e.setAttribute("data-game",c),e.classList.toggle("ffz-game-banned",-1!==t.settings.banned_games.indexOf(c&&c.toLowerCase())),e.classList.toggle("ffz-game-spoilered",-1!==t.settings.spoiler_games.indexOf(c&&c.toLowerCase())),this._ffz_image_timer=setInterval(this.ffzRotateImage.bind(this),3e4),this.ffzRotateImage(),t.settings.directory_logos){e.classList.add("ffz-directory-logo");var h=document.createElement("img"),f=document.createElement("a");h.className="profile-photo",h.src=this.get("stream.target.channel.logo")||r,h.alt=this.get("stream.target.channel.display_name"),f.href="/"+l.name,f.addEventListener("click",this.ffzVisitChannel.bind(this,l.name)),f.appendChild(h),s.insertBefore(f,s.firstChild)}var u=2===t.settings.directory_host_menus||d&&d.length>1;a&&(u&&(a.href="/"+l.name,a.addEventListener("click",this.ffzShowHostMenu.bind(this))),d&&d.length>1&&(a.textContent=n.number_commas(d.length)+" hosting "+n.sanitize(l.display_name),a.title=_.sortBy(d,"name").mapBy("display_name").join(", "),jQuery(a).tipsy({gravity:"s"}))),o&&u&&(o.href="/"+l.name,o.addEventListener("click",this.ffzShowHostMenu.bind(this)))}})}},{"../constants":6,"../utils":53}],14:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=(t("../constants"),function(e){var t={};if(!e||!e.length)return t;for(var s=0;s<e.length;s++){var i=e[s];if(i&&i.id){var o=t[i.id]=t[i.id]||[];o.push([i.start,i.end])}}return t});o.prototype.setup_feed_cards=function(){this.update_views("component:channel-feed/card",this.modify_feed_card),this.update_views("component:channel-feed/comment",this.modify_feed_comment),this.rerender_feed_cards()},o.prototype.rerender_feed_cards=function(e){var t=n.ember_resolve("component:channel-feed/card"),s=n.ember_resolve("component:channel-feed/comment"),i=n.ember_views();if(t)for(var o in i){var a=i[o];if(a instanceof t)try{a.ffz_init||this.modify_feed_card(a),a.ffz_init(e)}catch(r){this.error("setup component:channel-feed/card ffzInit",r)}if(s&&a instanceof s)try{a.ffz_init||this.modify_feed_comment(a),a.ffz_init(e)}catch(r){this.error("setup component:channel-feed/comment ffzInit",r)}}},o.prototype.modify_feed_card=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(e){var s=this.get("element"),i=this.get("post.body"),o=a(this.get("post.emotes")),n=this.get("post.user.login"),r=this.get("channelId")||n,l=s&&s.querySelector(".activity-body");if(i&&s&&l){if(e&&t.rooms&&t.rooms[r]){var c=t.getEmotes(n,r);if(-1===c.indexOf(e))return}var d=t.tokenize_feed_body(i,o,n,r),h=t.render_tokens(d,!0,!1);l.innerHTML="<p>"+h+"</p>"}}})},o.prototype.modify_feed_comment=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(e){var s=this.get("element"),i=this.get("comment.body"),o=a(this.get("comment.emotes")),n=this.get("comment.user.login"),r=this.get("parentView.parentView.channelId")||this.get("parentView.parentView.post.user.login")||null,l=s&&s.querySelector(".activity-body");if(i&&s&&l){if(e&&t.rooms&&t.rooms[r]){var c=t.getEmotes(n,r);if(-1===c.indexOf(e))return}var d=t.tokenize_feed_body(i,o,n,r),h=t.render_tokens(d,!0,!1);l.innerHTML="<p>"+h+"</p>"}}})}},{"../constants":6,"../utils":53}],15:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants"),r=n.createElement,l=/^\/kraken\/users\/([^\/]+)\/follows\/channels/,c=/^\/kraken\/channels\/([^\/]+)\/follows/;o.settings_info.enhance_profile_following={type:"boolean",value:!0,category:"Directory",name:"Enhanced Following Control",help:"Display additional controls on your own profile's Following tab to make management easier, as well as telling you how long everyone has been following everyone else in the profile."},o.prototype.setup_profile_following=function(){if(e.App){var t=this;this._following_cache={},this._follower_cache={};var s=function(e,s,i){t.log("Loading Follow Information for: "+e,s);for(var a=i[e]=i[e]||{},r=Date.now(),l=0;l<s.length;l++){var c=s[l],d=c&&(c.user||c.channel);d&&d.name&&(d.display_name&&(o.capitalization[d.name]=[d.display_name,r]),a[d.name]=[c.created_at?n.parse_date(c.created_at):null,c.notifications||!1])}},i=n.ember_lookup("service:api");i?i.reopen({request:function(e,i,o,n){if("get"!==e||0!==i.indexOf("/kraken/"))return this._super(e,i,o,n);var a=this;return new Promise(function(r,d){a._super(e,i,o,n).then(function(e){if(e.follows){var o=l.exec(i);o&&s(o[1],e.follows,t._following_cache),o=c.exec(i),o&&s(o[1],e.follows,t._follower_cache)}r(e)})["catch"](function(e){d(result)})})}}):this.error("Unable to locate the Ember service:api"),this.update_views("component:display-followed-item",this.modify_display_followed_item)}},o.prototype.modify_display_followed_item=function(t){var s=this;n.ember_reopen_view(t,{ffzParentModel:function(){for(var e=this.get("parentView");e;){var t=e.get("model");if(t)return t;e=e.get("parentView")}}.property("parentView"),ffz_init:function(){var t=this.get("element"),i=this.get("ffzParentModel.id"),o=-1!==document.body.getAttribute("data-current-path").indexOf(".following"),l=s.get_user(),c=l&&l.login&&l.login===i,d=o?s._following_cache:s._follower_cache,h=d[i]=d[i]||{},f=this.get("followed.id"),u=h[f];if(s.settings.enhance_profile_following){if(t.classList.add("ffz-processed"),e._d=this,!u)return!1;var _=Date.now()-(s._ws_server_offset||0),m=(u[0]?Math.floor((_-u[0].getTime())/1e3):0,r("div","overlay_info length")),g=function(){var e=Date.now()-(s._ws_server_offset||0),t=u&&u[0]?Math.floor((e-u[0].getTime())/1e3):void 0;void 0!==t?(m.innerHTML=a.CLOCK+" "+(60>t?"now":n.human_time(t,10)),m.title="Follow"+(o?"ing":"er")+" Since: <nobr>"+u[0].toLocaleString()+"</nobr>",m.style.display=""):m.style.display="none"};if(g(),jQuery(m).tipsy({html:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"s")}),t.appendChild(m),c&&o){var p=r("div","actions"),v=r("button","button ffz-no-bg follow"),b=r("button","button ffz-no-bg notifications"),y=function(){u=h[f],t.classList.toggle("followed",u),v.innerHTML=a.HEART+a.UNHEART+"<span> Follow</span>"},w=function(){u=h[f],b.classList.toggle("notifications-on",u&&u[1]),b.textContent="Notification "+(u&&u[1]?"On":"Off")};y(),w(),v.addEventListener("click",function(){var e=!!u;v.disabled=!0,b.disabled=!0,v.textContent="Updating",(e?n.api.del("users/:login/follows/channels/"+f):n.api.put("users/:login/follows/channels/"+f,{notifications:!1})).done(function(){u=h[f]=e?null:[new Date(Date.now()-(s._ws_server_offset||0)),!1]}).always(function(){y(),w(),g(),v.disabled=!1,b.disabled=!1})}),b.addEventListener("click",function(){var e=u[1];v.disabled=!0,b.disabled=!0,b.textContent="Updating",n.api.put("users/:login/follows/channels/"+f,{notifications:!e}).done(function(){u[1]=!e}).always(function(){w(),v.disabled=!1,b.disabled=!1})}),p.appendChild(v),p.appendChild(b),t.appendChild(p)}}}})}},{"../constants":6,"../utils":53}],16:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils");o.settings_info.portrait_mode={type:"select",options:{0:"Disabled",1:"Automatic (Use Window Aspect Ratio)",2:"Always On",3:"Automatic (Video Below)",4:"Always On (Video Below)"},value:0,process_value:function(e){return e===!1?0:e===!0?1:"string"==typeof e?parseInt(e)||0:e},category:"Appearance",no_mobile:!0,no_bttv:!0,name:"Portrait Mode (Chat Below Video)",help:"Display the right sidebar beneath (or above) the video player for viewing in portrait orientations.",on_update:function(e){if(!this.has_bttv){var t=n.ember_lookup("service:layout");t&&(t.set("rawPortraitMode",e),this._fix_menu_position())}}},o.settings_info.portrait_warning={value:!1,visible:!1},o.settings_info.swap_sidebars={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,no_bttv:!0,name:"Swap Sidebar Positions",help:"Swap the positions of the left and right sidebars, placing chat on the left.",on_update:function(e){this.has_bttv||(document.body.classList.toggle("ffz-sidebar-swap",e),this._fix_menu_position())}},o.settings_info.flip_dashboard={type:"boolean",value:!1,category:"Dashboard",no_mobile:!0,no_bttv:!0,name:"Swap Column Positions",help:"Swap the positions of the left and right columns of the dashboard.",on_update:function(e){this.has_bttv||document.body.classList.toggle("ffz-flip-dashboard",e)}},o.settings_info.right_column_width={type:"button",value:340,category:"Appearance",no_mobile:!0,no_bttv:!0,name:"Right Sidebar Width",help:"Set the width of the right sidebar for chat.",method:function(){var e=this,t=this.settings.right_column_width||340;n.prompt("Right Sidebar Width","Please enter a new width for the right sidebar, in pixels.</p><p><b>Minimum:</b> 250<br><b>Default:</b> 340",t,function(t){if(null!==t&&void 0!==t){var s=parseInt(t);s&&!Number.isNaN(s)&&Number.isFinite(s)||(s=340),e.settings.set("right_column_width",Math.max(250,s))}})},on_update:function(e){if(!this.has_bttv){var t=n.ember_lookup("service:layout");t&&(t.set("rightColumnWidth",e),Ember.propertyDidChange(t,"contentWidth"))}}},o.settings_info.minimal_channel_title={type:"boolean",value:!1,category:"Appearance",no_mobile:!0,no_bttv:!0,name:"Minimal Channel Title",help:"Hide the channel's name and current game when viewing a channel to maximize player size.",on_update:function(e){if(!this.has_bttv){var t=n.ember_lookup("service:layout");t&&(document.body.classList.toggle("ffz-minimal-channel-title",e),Ember.propertyDidChange(t,"windowHeight"))}}},o.prototype.setup_layout=function(){if(!this.has_bttv){document.body.classList.toggle("ffz-sidebar-swap",this.settings.swap_sidebars),document.body.classList.toggle("ffz-minimal-channel-title",this.settings.minimal_channel_title),this.log("Creating layout style element.");var e=this._layout_style=document.createElement("style");e.id="ffz-layout-css",document.head.appendChild(e);var t=n.ember_lookup("service:layout"),s=this;if(!t)return this.log("Unable to locate the Ember service:layout");this.log("Hooking the Ember service:layout"),t.reopen({rightColumnWidth:340,rawPortraitMode:0,portraitVideoBelow:!1,portraitMode:function(){var e=this.get("rawPortraitMode");if(this.set("portraitVideoBelow",3===e||4===e),0===e)return!1;if(2===e||4===e)return!0;var t=this.get("windowWidth")/(this.get("windowHeight")+120+60);return 1>t}.property("rawPortraitMode","windowHeight","windowWidth"),isTooSmallForRightColumn:function(){if(!s.has_bttv&&this.get("portraitMode")){var e=this.get("playerSize"),t=e[1];return this.get("windowHeight")<t+120+60+200}return this.get("windowWidth")<1090-this.get("rightColumnWidth")}.property("windowWidth","rightColumnWidth","playerSize","windowHeight"),contentWidth:function(){var e=this.get("isLeftColumnClosed")?50:240,t=!s.has_bttv&&this.get("portraitMode")?0:this.get("isRightColumnClosed")?0:this.get("rightColumnWidth");return this.get("windowWidth")-e-t-60}.property("windowWidth","portraitMode","isRightColumnClosed","isLeftColumnClosed","rightColumnWidth"),playerSize:function(){var e=this.get("windowHeight"),t=this.get("PLAYER_CONTROLS_HEIGHT"),i=this.get("contentWidth"),o=9*i/16+t,n=e-(s.settings.minimal_channel_title?75:120)-60,t=e-94-185,a=Math.floor(i),r=Math.floor(Math.min(o,n)),l=Math.floor(Math.min(o,t));return[a,r,l]}.property("contentWidth","windowHeight","portraitMode","PLAYER_CONTROLS_HEIGHT"),playerStyle:function(){var e=this.get("playerSize"),t=e[0],s=e[1],i=e[2];return"<style>.dynamic-player, .dynamic-player object, .dynamic-player video{width:"+t+"px !important;height:"+s+"px !important} .dynamic-target-player,.dynamic-target-player object, .dynamic-target-player video{width:"+t+"px !important;height:"+i+"px !important}</style><style>.dynamic-player .player object, .dynamic-player .player video{width:100% !important; height:100% !important}</style>"}.property("playerSize"),ffzPortraitWarning:function(){var e=this;setTimeout(function(){s.settings.portrait_mode&&!s._portrait_warning&&!s.settings.portrait_warning&&0===document.body.getAttribute("data-current-path").indexOf("user.")&&e.get("isTooSmallForRightColumn")&&(s._portrait_warning=!0,s.show_message("Twitch's Chat Sidebar has been hidden as a result of FrankerFaceZ's Portrait Mode because the window is too wide.<br><br>Please <a href=\"#\" onclick=\"ffz.settings.set('portrait_mode',0);jQuery(this).parents('.ffz-noty').remove();ffz._portrait_warning = false;return false\">disable Portrait Mode</a> or make your window narrower.<br><br><a href=\"#\" onclick=\"ffz.settings.set('portrait_warning',true);jQuery(this).parents('.ffz-noty').remove();return false\">Do not show this message again</a>"))},50)}.observes("isTooSmallForRightColumn"),ffzUpdateCss:function(){var e=this.get("windowHeight"),t=this.get("windowWidth"),i="body.ffz-small-player #player .dynamic-player {position: fixed;z-index: 9;box-shadow: 0 0 20px 0 black;";if(i+=.25*t>=.5*e?"width: 25vw !important; height: 14.0625vw !important;":"width: 50vh !important; height: 28.125vh !important;",!s.has_bttv){if(this.get("isRightColumnClosed"))i+="top: 0; right: 0}";else if(this.get("portraitMode")){var o=this.get("playerSize"),n=this.get("portraitVideoBelow"),a=o[1]+(s.settings.minimal_channel_title?75:120)+60,r=e-a,l=n?r:0,c=n?0:a,d=Math.floor(Math.max(.1*e,Math.min(e-300,9*t/16))),h=e-d,f=n?h:0,u=n?0:d;i+="top: "+l+'px;right: 0}body[data-current-path^="user."] #left_col .warp { min-height: inherit }body[data-current-path^="user."] #left_col { overflow: hidden }body[data-current-path^="user."] #left_col .warp,body[data-current-path^="user."] #left_col,body[data-current-path^="user."]:not(.ffz-sidebar-swap) #main_col{margin-right:0 !important;top:'+l+"px;height:"+a+'px}body[data-current-path^="user."].ffz-sidebar-swap #main_col{margin-left:0 !important;top:'+l+"px;height:"+a+'px}body[data-current-path^="user."] #right_col{width:100%;top:'+c+"px;height:"+r+'px}body[data-current-path^="user."] .app-main.theatre #left_col .warp,body[data-current-path^="user."] .app-main.theatre #left_col,body[data-current-path^="user."] .app-main.theatre #main_col{top:'+f+"px;height:"+d+'px}body[data-current-path^="user."] .app-main.theatre #right_col{top:'+u+"px;height:"+h+"px}"}else{var _=this.get("rightColumnWidth");i+="top: 0; right: "+_+"px}#main_col.expandRight #right_close{left: none !important}#right_col{width:"+_+"px}body:not(.ffz-sidebar-swap) #main_col:not(.expandRight){margin-right:"+_+"px}body.ffz-sidebar-swap .theatre #main_col:not(.expandRight),body.ffz-sidebar-swap #main_col:not(.expandRight){margin-left:"+_+"px}"}s._layout_style.innerHTML=i}}.observes("isRightColumnClosed","playerSize","rightColumnWidth","portraitMode","windowHeight","windowWidth"),ffzUpdatePlayerStyle:function(){Ember.propertyDidChange(t,"playerStyle")}.observes("windowHeight","windowWidth"),ffzUpdatePortraitCSS:function(){var e=this.get("portraitMode");document.body.classList.toggle("ffz-portrait",!s.has_bttv&&e)}.observes("portraitMode"),ffzFixTabs:function(){s.settings.group_tabs&&s._chatv&&s._chatv._ffz_tabs&&setTimeout(function(){var e=s._chatv&&s._chatv.$(".chat-room");e&&e.css&&e.css("top",s._chatv._ffz_tabs.offsetHeight+"px")},0)}.observes("isRightColumnClosed","rightColumnWidth","portraitMode","playerSize")}),t.set("rightColumnWidth",this.settings.right_column_width),t.set("rawPortraitMode",this.settings.portrait_mode),Ember.propertyDidChange(t,"windowWidth"),Ember.propertyDidChange(t,"windowHeight"),t.ffzUpdatePortraitCSS()}}},{"../utils":53}],17:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");o.settings_info.alias_italics={type:"boolean",value:!0,category:"Chat Appearance",no_bttv:!0,name:"Display Aliases in Italics",help:"Format the names of users that have aliases with italics to make it obvious at a glance that they have been renamed.",on_update:function(e){document.body.classList.toggle("ffz-alias-italics",e)}},o.settings_info.room_status={type:"boolean",value:!0,category:"Chat Appearance",no_bttv:!0,name:"Room Status Indicators",help:"Display the current room state (slow mode, sub mode, and r9k mode) next to the Chat button.",on_update:function(){this._roomv&&this._roomv.ffzUpdateStatus()}},o.settings_info.replace_bad_emotes={type:"boolean",value:!0,category:"Chat Appearance",warn_bttv:"Only affects Whispers when BetterTTV is enabled.",name:"Fix Low Quality Twitch Global Emoticons",help:"Replace emoticons such as DansGame and RedCoat with cleaned up versions that don't have pixels around the edges or white backgrounds for nicer display on dark chat."},o.settings_info.parse_emoticons={type:"boolean",value:!0,category:"Chat Appearance",no_bttv:!0,name:"Display Emoticons",help:"Display emoticons in chat messages rather than just text."},o.settings_info.parse_emoji={type:"select",options:{0:"No Images / Font Only",1:"Twitter Emoji Images",2:"Google Noto Images",3:"EmojiOne Images"},value:1,process_value:function(e){return e===!1?0:e===!0?1:"string"==typeof e?parseInt(e||"0"):e},category:"Chat Appearance",name:"Display Emoji",help:"Replace emoji in chat messages with nicer looking images from either Twitter or Google."},o.settings_info.scrollback_length={type:"button",value:150,category:"Chat Appearance",no_bttv:!0,name:"Scrollback Length",help:"Set the maximum number of lines to keep in chat.",method:function(){var e=this;n.prompt("Scrollback Length","Please enter a new maximum length for the chat scrollback. Please note that setting this too high may cause your computer to begin lagging as chat messages accumulate.</p><p><b>Default:</b> 150",this.settings.scrollback_length,function(t){if(null!==t&&void 0!==t){t=parseInt(t),(Number.isNaN(t)||!Number.isFinite(t))&&(t=150),t=Math.max(10,t),e.settings.set("scrollback_length",t);var s=n.ember_lookup("controller:chat"),i=s&&s.get("currentRoom.id");for(var o in e.rooms){var a=e.rooms[o];a.room&&a.room.set("messageBufferSize",t+(e._roomv&&!e._roomv.get("stuckToBottom")&&i===o?150:0))}}})}},o.settings_info.hosted_sub_notices={type:"boolean",value:!0,category:"Chat Filtering",no_bttv:!0,name:"Show Hosted Channel Subscriber Notices",help:"Display (or more specifically <i>hides</i> when disabled) notices in chat when someone subscribes to the hosted channel."},o.settings_info.filter_whispered_links={type:"boolean",value:!0,category:"Chat Filtering",warn_bttv:"Only affects Whispers when BetterTTV is enabled.",name:"Auto-Hide Potentially Dangerous Whispered Links",help:"Removes whispered links and displays a placeholder, with a warning that the link has not been approved by moderation or staff. Links remain accessible with an additional click."},o.settings_info.banned_words={type:"button",value:[],category:"Chat Filtering",warn_bttv:"Only affects Whispers when BetterTTV is enabled.",name:"Banned Words",help:"Set a list of words that will be locally removed from chat messages.",method:function(){var e=this,t=this.settings.banned_words.join(", ");n.prompt("Banned Words","Please enter a comma-separated list of words that you would like to have removed from chat messages.",t,function(t){if(null!==t&&void 0!==t){t=t.trim().split(a.SPLITTER);for(var s=[],i=0;i<t.length;i++)t[i]&&s.push(t[i]);1==s.length&&"disable"==s[0]&&(s=[]),e.settings.set("banned_words",s)}})}},o.settings_info.keywords={type:"button",value:[],category:"Chat Filtering",warn_bttv:"Only affects Whispers when BetterTTV is enabled.",name:"Highlight Keywords",help:"Set additional keywords that will be highlighted in chat.",method:function(){var e=this,t=this.settings.keywords.join(", ");n.prompt("Highlight Keywords","Please enter a comma-separated list of words that you would like to be highlighted in chat.",t,function(t){if(null!==t&&void 0!==t){t=t.trim().split(a.SPLITTER);for(var s=[],i=0;i<t.length;i++)t[i]&&s.push(t[i]);1==s.length&&"disable"==s[0]&&(s=[]),e.settings.set("keywords",s)}})}},o.settings_info.clickable_emoticons={type:"boolean",value:!1,category:"Chat Tooltips",warn_bttv:"Only affects Whispers when BetterTTV is enabled.",no_mobile:!0,name:"Emoticon Information Pages",help:"When enabled, holding shift and clicking on an emoticon will open it on the FrankerFaceZ website or Twitch Emotes."
},o.settings_info.link_info={type:"boolean",value:!0,category:"Chat Tooltips",no_bttv:!0,name:"Link Information <span>Beta</span>",help:"Check links against known bad websites, unshorten URLs, and show YouTube info."},o.settings_info.link_image_hover={type:"boolean",value:!1,category:"Chat Tooltips",no_bttv:!0,no_mobile:!0,name:"Image Preview",help:"Display image thumbnails for links to Imgur and YouTube."},o.settings_info.emote_image_hover={type:"boolean",value:!1,category:"Chat Tooltips",no_mobile:!0,name:"Emote Preview",help:"Display scaled up high-DPI emoticon images in tooltips to help see details on low-resolution monitors.",on_update:function(e){this._reset_tooltips()}},o.settings_info.image_hover_all_domains={type:"boolean",value:!1,category:"Chat Tooltips",no_bttv:!0,no_mobile:!0,name:"Image Preview - All Domains",help:"<i>Requires Image Preview.</i> Attempt to show an image preview for any URL ending in the appropriate extension. <b>Warning: This may be used to leak your IP address to malicious users.</b>"},o.settings_info.chat_rows={type:"boolean",value:!1,category:"Chat Appearance",no_bttv:!0,name:"Chat Line Backgrounds",help:"Display alternating background colors for lines in chat.",on_update:function(e){this.toggle_style("chat-background",!this.has_bttv&&e),this.toggle_style("chat-setup",!this.has_bttv&&(e||this.settings.chat_separators||this.settings.highlight_messages_with_mod_card))}},o.settings_info.chat_separators={type:"select",options:{0:"Disabled",1:"Basic Line (1px solid)",2:"3D Line (2px groove)",3:"3D Line (2px groove inset)",4:"Wide Line (2px solid)"},value:0,category:"Chat Appearance",no_bttv:!0,process_value:function(e){return e===!1?0:e===!0?1:"string"==typeof e?parseInt(e)||0:e},name:"Chat Line Separators",help:"Display thin lines between chat messages for further visual separation.",on_update:function(e){this.toggle_style("chat-setup",!this.has_bttv&&(e||this.settings.chat_rows||this.settings.highlight_messages_with_mod_card)),this.toggle_style("chat-separator",!this.has_bttv&&e),this.toggle_style("chat-separator-3d",!this.has_bttv&&2===e),this.toggle_style("chat-separator-3d-inset",!this.has_bttv&&3===e),this.toggle_style("chat-separator-wide",!this.has_bttv&&4===e)}},o.settings_info.old_sub_notices={type:"boolean",value:!1,category:"Chat Appearance",no_bttv:!0,name:"Old-Style Subscriber Notices",help:"Display the old style subscriber notices, with the message on a separate line."},o.settings_info.emote_alignment={type:"boolean",value:!1,category:"Chat Appearance",no_bttv:!0,name:"Baseline Emoticon Alignment",help:"Align emotes on the text baseline, making messages taller but ensuring emotes don't overlap.",on_update:function(e){document.body.classList.toggle("ffz-baseline-emoticons",!this.has_bttv&&e)}},o.settings_info.chat_padding={type:"boolean",value:!1,category:"Chat Appearance",no_bttv:!0,name:"Reduced Chat Line Padding",help:"Reduce the amount of padding around chat messages to fit more on-screen at once.",on_update:function(e){this.toggle_style("chat-padding",!this.has_bttv&&e)}},o.settings_info.high_contrast_chat={type:"select",options:{222:"Disabled",212:"Bold",221:"Text",211:"Text + Bold",122:"Background",121:"Background + Text",112:"Background + Bold",111:"All"},value:"222",category:"Chat Appearance",name:"High Contrast",help:"Display chat using white and black for maximum contrast. This is suitable for capturing and chroma keying chat to display on stream.",process_value:function(e){return e===!1?"222":e===!0?"111":e},on_update:function(e){this.toggle_style("chat-hc-text","1"===e[2]),this.toggle_style("chat-hc-bold","1"===e[1]),this.toggle_style("chat-hc-background","1"===e[0])}},o.settings_info.chat_font_family={type:"button",value:null,category:"Chat Appearance",no_bttv:!0,name:"Font Family",help:"Change the font used for rendering chat messages.",method:function(){var e=this,t=this.settings.chat_font_family||"";n.prompt("Chat Font Family","Please enter a font family to use rendering chat. Leave this blank to use the default.",t,function(t){null!==t&&void 0!==t&&(t||(t=null),e.settings.set("chat_font_family",t))})},on_update:function(e){if(!this.has_bttv&&this._chat_style){var t;if(e){-1!==e.indexOf(" ")&&-1===e.indexOf(",")&&-1===e.indexOf('"')&&-1===e.indexOf("'")&&(e='"'+e+'"');var s=document.createElement("span");s.style.fontFamily=e,t=".timestamp-line,.conversation-chat-line,.conversation-system-messages,.chat-history,.ember-chat .chat-messages {"+s.style.cssText+"}"}else t="";n.update_css(this._chat_style,"chat_font_family",t)}}},o.settings_info.chat_font_size={type:"button",value:12,category:"Chat Appearance",no_bttv:!0,name:"Font Size",help:"Make the chat font bigger or smaller.",method:function(){var e=this,t=this.settings.chat_font_size;n.prompt("Chat Font Size","Please enter a new size for the chat font.</p><p><b>Default:</b> 12",t,function(t){if(null!==t&&void 0!==t){var s=parseInt(t);(!s||Number.isNaN(s)||1>s)&&(s=12),e.settings.set("chat_font_size",s)}})},on_update:function(e){if(!this.has_bttv&&this._chat_style){var t;if(12!==e&&e){var s=Math.max(20,Math.round(20/12*e)),i=Math.floor((s-20)/2);t=".timestamp-line,.conversation-chat-line,.conversation-system-messages,.chat-history .chat-line,.ember-chat .chat-messages .chat-line { font-size: "+e+"px !important; line-height: "+s+"px !important; }",i&&(t+=".ember-chat .chat-messages .chat-line .mod-icons, .ember-chat .chat-messages .chat-line .badges { padding-top: "+i+"px; }")}else t="";n.update_css(this._chat_style,"chat_font_size",t),o.settings_info.chat_ts_size.on_update.call(this,this.settings.chat_ts_size)}}},o.settings_info.chat_ts_size={type:"button",value:null,category:"Chat Appearance",no_bttv:!0,name:"Timestamp Font Size",help:"Make the chat timestamp font bigger or smaller.",method:function(){var e=this,t=this.settings.chat_ts_size;t||(t=this.settings.chat_font_size),n.prompt("Chat Timestamp Font Size","Please enter a new size for the chat timestamp font. The default is to match the regular chat font size.",t,function(t){if(null!==t&&void 0!==t){var s=parseInt(t);(1>s||Number.isNaN(s)||!Number.isFinite(s))&&(s=null),e.settings.set("chat_ts_size",s)}})},on_update:function(e){if(!this.has_bttv&&this._chat_style){var t;if(null===e)t="";else{var s=Math.max(20,Math.round(20/12*e),Math.round(20/12*this.settings.chat_font_size));t=".ember-chat .chat-messages .timestamp { font-size: "+e+"px !important; line-height: "+s+"px !important; }"}n.update_css(this._chat_style,"chat_ts_font_size",t)}}},o.prototype.setup_line=function(){jQuery(document.body).on("mouseleave",".tipsy",function(){this.parentElement.removeChild(this)});try{this.aliases=JSON.parse(localStorage.ffz_aliases||"{}")}catch(e){this.log("Error Loading Aliases: "+e),this.aliases={}}var t=this._chat_style=document.createElement("style");t.id="ffz-style-chat",t.type="text/css",document.head.appendChild(t),o.settings_info.chat_font_size.on_update.call(this,this.settings.chat_font_size),o.settings_info.chat_font_family.on_update.call(this,this.settings.chat_font_family),document.body.classList.toggle("ffz-alias-italics",this.settings.alias_italics),document.body.classList.toggle("ffz-baseline-emoticons",!this.has_bttv&&this.settings.emote_alignment),this.toggle_style("chat-setup",!this.has_bttv&&(this.settings.chat_rows||this.settings.chat_separators||this.settings.highlight_messages_with_mod_card)),this.toggle_style("chat-padding",!this.has_bttv&&this.settings.chat_padding),this.toggle_style("chat-background",!this.has_bttv&&this.settings.chat_rows),this.toggle_style("chat-separator",!this.has_bttv&&this.settings.chat_separators),this.toggle_style("chat-separator-3d",!this.has_bttv&&2===this.settings.chat_separators),this.toggle_style("chat-separator-3d-inset",!this.has_bttv&&3===this.settings.chat_separators),this.toggle_style("chat-separator-wide",!this.has_bttv&&4===this.settings.chat_separators),this.toggle_style("chat-hc-text","1"===this.settings.high_contrast_chat[2]),this.toggle_style("chat-hc-bold","1"===this.settings.high_contrast_chat[1]),this.toggle_style("chat-hc-background","1"===this.settings.high_contrast_chat[0]),this._last_row={},this.log("Hooking the Ember VOD Chat Line component.");var s=n.ember_resolve("component:vod-chat-line");s?this._modify_vod_line(s):this.log("Couldn't find VOD Chat Line component."),this.log("Hooking the Ember Message Line component.");var i=n.ember_resolve("component:chat/message-line");i?this._modify_chat_subline(i):this.error("Couldn't find the Message Line component."),this.log("Hooking the Ember Whisper Line component.");var a=n.ember_resolve("component:chat/whisper-line");a?this._modify_chat_subline(a):this.error("Couldn't find the Whisper Line component.");var r=this.get_user();r&&r.name&&(o.capitalization[r.login]=[r.name,Date.now()])},o.prototype.save_aliases=function(){this.log("Saving "+Object.keys(this.aliases).length+" aliases to local storage."),localStorage.ffz_aliases=JSON.stringify(this.aliases)},o.prototype._modify_chat_line=function(e,t){var s=this,i=n.ember_lookup("service:layout"),o=n.ember_lookup("controller:settings");e.reopen({ffzTokenizedMessage:function(){try{return s.tokenize_chat_line(this.get("msgObject"))}catch(e){return s.error("chat-line tokenizedMessage: "+e),this._super()}}.property("msgObject.message","isChannelLinksDisabled","currentUserNick","msgObject.from","msgObject.tags.emotes"),lineChanged:Ember.observer("msgObject.deleted","isModeratorOrHigher","msgObject.ffz_old_messages","ffzTokenizedMessage",function(){this.$(".mod-icons").replaceWith(this.buildModIconsHTML()),this.get("msgObject.deleted")?this.$(".message").replaceWith(this.buildDeletedMessageHTML()):this.$(".deleted,.message").replaceWith(this.buildMessageHTML())}),ffzUpdateBadges:function(){this.$(".badges").html(s.render_badges(s.get_line_badges(this.get("msgObject"))))},ffzUserLevel:function(){return this.get("isStaff")?5:this.get("isAdmin")?4:this.get("isBroadcaster")?3:this.get("isGlobalMod")?2:this.get("isModerator")?1:0}.property("msgObject.labels.[]"),buildModIconsHTML:function(){var e,t=this.get("msgObject.from"),i=this.get("msgObject.room"),o=s.rooms&&s.rooms[i],a=this.get("msgObject.deleted"),r=this.get("msgObject.to"),l=r&&r.length,c=this.get("ffzUserLevel"),d=o&&o.room&&o.room.get("ffzUserLevel")||0;if(l||c>=d||0===s.settings.mod_buttons.length)return"";e='<span class="mod-icons">';for(var h=0,f=s.settings.mod_buttons.length;f>h;h++){var u,_,m=s.settings.mod_buttons[h],g=m[0],p=m[1];p===!1?e+=a?'<a class="mod-icon html-tooltip unban" title="Unban User" href="#">Unban</a>':'<a class="mod-icon html-tooltip ban" title="Ban User" href="#">Ban</a>':600===p?e+='<a class="mod-icon html-tooltip timeout" title="Timeout User (10m)" href="#">Timeout</a>':("string"==typeof p?(u=p.replace(/{user}/g,t).replace(/{id}/g,this.get("msgObject.tags.id")).replace(/ *<LINE> */,"\n"),_="Custom Command"+(-1!==u.indexOf("\n")?"s":"")+"<br>"+n.quote_san(u).replace("\n","<br>")):(u="/timeout "+t+" "+p,_="Timeout User ("+n.duration_string(p)+")"),e+='<a class="mod-icon html-tooltip'+("/timeout"===u.substr(0,9)?" is-timeout":"")+' custom" data-cmd="'+n.quote_attr(u)+'" title="'+_+'" href="#">'+g+"</a>")}return e+"</span>"},buildSenderHTML:function(){var e=this.get("msgObject.from"),t=this.get("msgObject.room"),a=s.rooms&&s.rooms[t],r=(this.get("msgObject.deleted"),this.get("msgObject.to")),l=r&&r.length,c=this.get("ffz_is_replay"),d=(this.get("ffzUserLevel"),a&&a.room&&a.room.get("ffzUserLevel")||0,this.get("msgObject.color")),h=d&&s._handle_color(d),f=i&&i.get("isTheatreMode")||(c?s.settings.dark_twitch:o&&o.get("settings.darkMode")),u=this.get("systemMsg"),_="";if(_='<div class="indicator"></div>',u&&(_+='<div class="system-msg">'+n.sanitize(u)+"</div>",this.get("ffzShouldRenderMessageBody")===!1))return _;_+='<span class="timestamp">'+this.get("timestamp")+"</span> ",_+=this.buildModIconsHTML(),_+='<span class="badges">'+s.render_badges(s.get_line_badges(this.get("msgObject")))+"</span>";var m=s.aliases[e],g=this.get("msgObject.tags.display-name")||e&&e.capitalize()||"unknown user",p=h&&"color:"+(f?h[1]:h[0])||"",v=p?" has-color"+(c?" replay-color":""):"";if(_+='<span class="from'+(m?" ffz-alias html-tooltip":"")+v+'" style="'+p+(h?'" data-color="'+d:""),_+=m?'" title="'+n.quote_san(g)+'">'+n.sanitize(m):'">'+n.sanitize(g),l){var b=s.aliases[r],y=this.get("msgObject.tags.recipient-display-name")||r&&r.capitalize()||"unknown user",w=this.get("msgObject.toColor"),z=w&&s._handle_color(w),k=w?"color:"+(f?z[1]:z[0]):"",C=k?" has-color":"";_+="</span><svg class='svg-whisper-arrow' height='10px' version='1.1' width='16px'><polyline points='6 2, 10 6, 6 10, 6 2' /></svg>",_+='<span class="to'+(b?" ffz-alias html-tooltip":"")+C+'" style="'+k+(z?'" data=color="'+w:""),_+=b?'" title="'+n.quote_san(y)+'">'+n.sanitize(b):'">'+n.sanitize(y)}return _+'</span><span class="colon">:</span> '},buildDeletedMessageHTML:function(){return'<span class="deleted"><a class="undelete" href=#">&lt;message deleted&gt;</a></span>'},buildMessageHTML:function(){var e,t=this.get("msgObject.to"),a=t&&t.length;if("action"===this.get("msgObject.style")){var r=this.get("msgObject.color"),l=r&&s._handle_color(r),c=this.get("ffz_is_replay"),d=i&&i.get("isTheatreMode")||(c?s.settings.dark_twitch:o&&o.get("settings.darkMode"));e=r?'<span class="message has-color'+(c?" replay-color":"")+'" style="color:'+(d?l[1]:l[0])+'" data-color="'+r+'">':'<span class="message">'}else e='<span class="message">';e+=s.render_tokens(this.get("ffzTokenizedMessage"),!0,a&&s.settings.filter_whispered_links&&this.get("ffzUserLevel")<4,this.get("isBitsEnabled"));var h=this.get("msgObject.ffz_old_messages");return h&&h.length&&(e+='<div class="button primary float-right ffz-old-messages">Show '+n.number_commas(h.length)+" Old</div>"),e+"</span>"},ffzRender:function(){var e=this.get("element"),t=this.buildSenderHTML();this.get("ffzShouldRenderMessageBody")!==!1&&(t+=this.get("msgObject.deleted")?this.buildDeletedMessageHTML():this.buildMessageHTML()),e.innerHTML=t},ffzShouldRenderMessageBody:function(){return!this.get("hasSystemMsg")||this.get("hasMessageBody")}.property("hasSystemMsg","hasMessageBody"),shouldRenderMessageBody:function(){return!1}.property("hasSystemMsg","hasMessageBody"),ffzWasDeleted:function(){return s.settings.prevent_clear&&this.get("msgObject.ffz_deleted")}.property("msgObject.ffz_deleted"),ffzHasOldMessages:function(){var e=this.get("msgObject.ffz_old_messages");return e&&e.length}.property("msgObject.ffz_old_messages")})},o.prototype._modify_chat_subline=function(t){var s=this;this._modify_chat_line(t),t.reopen({classNameBindings:["msgObject.style","msgObject.ffz_has_mention:ffz-mentioned","ffzWasDeleted:ffz-deleted","ffzHasOldMessages:clearfix","ffzHasOldMessages:ffz-has-deleted"],attributeBindings:["msgObject.tags.id:data-id","msgObject.room:data-room","msgObject.from:data-sender","msgObject.deleted:data-deleted"],didInsertElement:function(){this.set("msgObject._line",this),this.ffzRender()},willClearRender:function(){this.set("msgObject._line",null)},click:function(t){if(t.target){var i=t.target.classList,o=this.get("msgObject.from");if(i.contains("ffz-old-messages"))return s._show_deleted(this.get("msgObject.room"));if(i.contains("deleted-word"))jQuery(t.target).trigger("mouseout"),t.target.outerHTML=t.target.getAttribute("data-text");else{if(i.contains("deleted-link"))return s._deleted_link_click.call(t.target,t);if(i.contains("mod-icon")){if(jQuery(t.target).trigger("mouseout"),t.preventDefault(),i.contains("custom")){var n=this.get("msgObject.room"),a=n&&s.rooms[n]&&s.rooms[n].room,r=t.target.getAttribute("data-cmd");if(a){for(var l=r.split("\n"),c=0;c<l.length;c++)a.send(l[c],!0);i.contains("is-timeout")&&a.clearMessages(o,null,!0)}return}i.contains("ban")?this.sendAction("banUser",{user:o}):i.contains("unban")?this.sendAction("unbanUser",{user:o}):i.contains("timeout")&&this.sendAction("timeoutUser",{user:o})}else if(i.contains("badge"))i.contains("click_url")?e.open(t.target.getAttribute("data-url"),"_blank"):i.contains("turbo")?e.open("/products/turbo?ref=chat_badge","_blank"):i.contains("subscriber")&&this.sendAction("clickSubscriber");else{if(s._click_emote(t.target,t))return;if(t.target.classList.contains("from")){var d,h=this.get("element"),f=h&&h.getBoundingClientRect()||document.body.getBoundingClientRect();f.left>400&&(d=f.left-40),this.sendAction("showModOverlay",{left:f.left,right:d,top:f.top+f.height,real_top:f.top,sender:o})}else t.target.classList.contains("undelete")&&(t.preventDefault(),this.set("msgObject.deleted",!1))}}}}});try{t.create().destroy()}catch(i){}},o.prototype._modify_vod_line=function(t){var s=this;this._modify_chat_line(t,!0),t.reopen({ffz_is_replay:!0,classNameBindings:["msgObject.ffz_has_mention:ffz-mentioned"],attributeBindings:["msgObject.room:data-room","msgObject.from:data-sender","msgObject.deleted:data-deleted"],tokenizedMessage:function(){return[]}.property("msgObject.message"),ffzTokenizedMessage:function(){try{return s.tokenize_vod_line(this.get("msgObject"),!(this.get("enableLinkification")||this.get("isModeratorOrHigher")))}catch(e){return s.error("vod-chat-line tokenizedMessage: "+e),this._super()}}.property("msgObject.message","currentUserNick","msgObject.from","msgObject.tags.emotes"),buildHorizontalLineHTML:function(){return'<div class="horizontal-line"><span>'+this.get("msgObject.timestamp")+"</span></div>"},buildModIconsHTML:function(){return!this.get("isViewerModeratorOrHigher")||this.get("isModeratorOrHigher")?"":'<span class="mod-icons">'+(this.get("msgObject.deleted")?'<em class="mod-icon unban"></em>':'<a class="mod-icon html-tooltip delete" title="Delete Message" href="#">Delete</a>')+"</span>"},buildDeletedMesageHTML:function(){return'<span clas="deleted">&lt;message deleted&gt;</span>'},didInsertElement:function(){this.ffzRender()},ffzRender:function(){var e,t=this.get("element");this.get("msgObject.isHorizontalLine")?e=this.buildHorizontalLineHTML():(e=this.buildSenderHTML(),e+=this.get("msgObject.deleted")?this.buildDeletedMessageHTML():this.buildMessageHTML()),t.innerHTML=e},click:function(t){var s=t.target.classList;s.contains("badge")?s.contains("click_url")?e.open(t.target.getAttribute("data-url"),"_blank"):s.contains("turbo")?e.open("/products/turbo?ref=chat_badge","_blank"):s.contains("subscriber")&&this.sendAction("clickSubscriber"):s.contains("delete")&&(t.preventDefault(),this.sendAction("timeoutUser",this.get("msgObject.id")))}});try{t.create().destroy()}catch(i){}},o.capitalization={},o._cap_fetching=0,o._cap_waiting={},o.get_capitalization=function(e,t){if(!e)return e;if(e=e.toLowerCase(),"jtv"==e||"twitchnotify"==e)return e;var s=o.capitalization[e];return s&&Date.now()-s[1]<36e5?s[0]:(o._cap_waiting[e]?o._cap_waiting[e].push(t):o._cap_fetching<25&&(o._cap_fetching++,o._cap_waiting[e]=[t],o.get().ws_send("get_display_name",e,function(t,s){var i=t?s:e,n=o._cap_waiting[e];o.capitalization[e]=[i,Date.now()],o._cap_fetching--,o._cap_waiting[e]=!1;for(var a=0;a<n.length;a++)try{"function"==typeof n[a]&&n[a](i)}catch(r){}})),s?s[0]:e)},o.prototype._remove_banned=function(e){var t=this.settings.banned_words;if(!t||!t.length)return e;"string"==typeof e&&(e=[e]);for(var s=o._words_to_regex(t),i=[],n=0,a=e.length;a>n;n++){var r=e[n];"string"==typeof r&&(r={type:"text",text:r}),"text"===r.type&&s.test(r.text)?(r=r.text.replace(s,function(e,t,s){return t.length&&i.push({type:"text",text:t}),i.push({type:"deleted",length:s.length,text:s}),""}),r&&i.push({type:"text",text:r})):"emoticon"===r.type&&s.test(r.altText)?(r=r.altText.replace(s,function(e,t,s){return t.length&&i.push({type:"text",text:t}),i.push({type:"deleted",length:s.length,text:s}),""}),r&&i.push({type:"text",text:r})):i.push("link"===r.type&&s.test(r.text)?{type:"link",isDeleted:!0,isMailTo:r.isMailTo,isLong:!1,length:r.text.length,censoredLink:r.text.replace(s,"$1***"),link:r.link,text:r.text}:r)}return i},o.prototype._emoticonize=function(e,t){var s=e.get("msgObject.room"),i=e.get("msgObject.from");return this.tokenize_emotes(i,s,t)}},{"../constants":6,"../utils":53}],18:[function(t,s,i){var o,n=e.FrankerFaceZ,a=t("../utils"),r=t("../constants"),l=t("../compiled_styles"),c=/^\/t(?:imeout)? +([^ ]+)(?: +(\d+)(?: +(.+))?)?$/,d=/^\/b(?:an)? +([^ ]+)(?: +(.+))?$/,h=/\{user\}/g,f={ESC:27,R:82,P:80,B:66,T:84,U:85},u='<svg class="svg-messages" height="16px" version="1.1" viewBox="0 0 18 18" width="16px" x="0px" y="0px"><path clip-rule="evenodd" d="M1,15V3h16v12H1z M15.354,5.354l-0.707-0.707L9,10.293L3.354,4.646L2.646,5.354L6.293,9l-3.646,3.646l0.707,0.707L7,9.707l1.646,1.646h0.707L11,9.707l3.646,3.646l0.707-0.707L11.707,9L15.354,5.354z" fill-rule="evenodd"></path></svg>',m='<svg class="svg-unban" height="16px" version="1.1" viewBox="0 0 16 16" width="16px" x="0px" y="0px"><path fill-rule="evenodd" clip-rule="evenodd" fill="#888888" d="M6.5,12.75L2,8.25l2-2l2.5,2.5l5.5-5.5l2,2L6.5,12.75z"/></svg>';try{o=e.require&&e.require("web-client/helpers/chat/chat-line-helpers")}catch(g){}n.basic_settings.enhanced_moderation_cards={type:"boolean",no_bttv:!0,category:"Chat",name:"Enhanced Moderation Cards",help:"Improve moderation cards with hotkeys, additional buttons, chat history, and other information to make moderating easier.",get:function(){return this.settings.mod_card_hotkeys&&this.settings.mod_card_info&&this.settings.mod_card_history},set:function(e){this.settings.set("mod_card_hotkeys",e),this.settings.set("mod_card_info",e),this.settings.set("mod_card_history",e)}},n.basic_settings.chat_hover_pause={type:"boolean",no_bttv:!0,category:"Chat",name:"Pause Chat Scrolling on Mouse Hover",help:"Automatically prevent the chat from scrolling when moving the mouse over it to prevent moderation mistakes and link misclicks.",get:"chat_hover_pause",set:"chat_hover_pause"},n.settings_info.highlight_messages_with_mod_card={type:"boolean",value:!1,no_bttv:!0,category:"Chat Moderation",name:"Highlight Messages with Mod Card Open",help:"Highlight a user's messages in chat when their moderation card is open.",on_update:function(e){this.toggle_style("chat-setup",!this.has_bttv&&(this.settings.chat_rows||this.settings.chat_separators||e)),this._mod_card&&(e?a.update_css(this._chat_style,"mod-card-highlight",l["chat-user-bg"].replace(/{user_id}/g,this._mod_card.get("cardInfo.user.id"))):a.update_css(this._chat_style,"mod-card-highlight"))}},n.settings_info.chat_mod_icon_visibility={type:"select",options:{0:"Disabled",1:"Enabled",2:"When Ctrl is Held",3:"When "+r.META_NAME+" is Held",4:"When Alt is Held",5:"When Shift is Held"},value:function(){var e=a.ember_lookup("controller:settings");return e&&e.get("settings.showModIcons")?1:0},process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},no_bttv:!0,category:"Chat Moderation",name:"Display In-Line Mod Icons",help:"Choose when you should see in-line moderation icons in chat.",on_update:function(e){var t=a.ember_lookup("controller:settings");t&&t.set("settings.showModIcons",1===e)}},n.settings_info.chat_hover_pause={type:"select",options:{0:"Disabled",1:"On Hover",2:"When Ctrl is Held",3:"When "+r.META_NAME+" is Held",4:"When Alt is Held",5:"When Shift is Held",6:"Ctrl or Hover",7:r.META_NAME+" or Hover",8:"Alt or Hover",9:"Shift or Hover"},value:0,process_value:function(e){return e===!0?1:e===!1?0:"string"==typeof e?parseInt(e)||0:e},no_bttv:!0,category:"Chat Moderation",name:"Pause Chat Scrolling",help:"Automatically prevent the chat from scrolling when moving the mouse over it or holding Ctrl to prevent moderation mistakes and link misclicks.",on_update:function(e){if(this._roomv){this._roomv.ffzDisableFreeze();var t=this._roomv.get("element"),s=t&&t.querySelector(".chat-interface .more-messages-indicator.ffz-freeze-indicator");s&&s.parentElement.removeChild(s),e&&this._roomv.ffzEnableFreeze()}}},n.settings_info.short_commands={type:"boolean",value:!0,no_bttv:!0,category:"Chat Moderation",name:"Short Moderation Commands",help:"Use /t, /b, and /u in chat in place of /timeout, /ban, /unban for quicker moderation, and use /p for 1 second timeouts."},n.settings_info.mod_card_hotkeys={type:"boolean",value:!1,no_bttv:!0,category:"Chat Moderation",name:"Moderation Card Hotkeys",help:"With a moderation card selected, press B to ban the user, T to time them out for 10 minutes, P to time them out for 1 second, or U to unban them. ESC closes the card."},n.settings_info.mod_card_info={type:"boolean",value:!0,no_bttv:!0,category:"Chat Moderation",name:"Moderation Card Additional Information",help:"Display a channel's follower count, view count, and account age on moderation cards."},n.settings_info.timeout_notices={type:"select",options:{0:"Disabled",1:"If I'm a Moderator",2:"Always"},value:1,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},no_bttv:!0,category:"Chat Moderation",name:"Display Timeout / Ban Notices",help:"Display notices in chat when a user is timed out or banned. (You always see your own bans.)"},n.settings_info.mod_card_history={type:"boolean",value:!1,no_bttv:!0,category:"Chat Moderation",name:"Moderation Card History",help:"Display a few of the user's previously sent messages on moderation cards.",on_update:function(e){if(!e&&this.rooms)for(var t in this.rooms){var s=this.rooms[t];s&&(s.user_history=void 0)}}},n.settings_info.mod_card_reasons={type:"button",value:["One-Man Spam","Posting Bad Links","Ban Evasion","Threats / Personal Info","Hate / Harassment","Ignoring Broadcaster / Moderators"],category:"Chat Moderation",no_bttv:!0,name:"Moderation Card Ban Reasons",help:"Change the available options in the chat moderation card ban reasons list.",method:function(){var e=this,t=this.settings.mod_card_reasons.join("\n"),s=a.createElement("textarea");s.style.marginBottom="20px",a.prompt("Moderation Card Ban Reasons","Please enter a list of ban reasons to select from in chat moderation cards. One item per line.",t,function(t){if(null!==t&&void 0!==t){for(var s=t.trim().split(/\s*\n\s*/g),i=s.length;i--;)0===s[i].length&&s.splice(i,1);e.settings.set("mod_card_reasons",s)}},600,s)}},n.settings_info.mod_buttons={type:"button",value:[["",!1,!1],["",600,!1]],category:"Chat Moderation",no_bttv:!0,name:"Custom In-Line Moderation Icons",help:"Change out the different in-line moderation icons to use any command quickly.",method:function(){for(var e=this,t="",s=0;s<this.settings.mod_buttons.length;s++){var i=this.settings.mod_buttons[s],o=i[0],n=i[1],r=i[2];n===!1?n="<BAN>":"string"!=typeof n&&(n=""+n),r?o+="=":o=""," {user}"===n.substr(n.length-7)&&(n=n.substr(0,n.length-7)),t+=-1!==n.indexOf(" ")?" "+o+'"'+n+'"':" "+o+n}a.prompt("Custom In-Line Moderation Icons",'Please enter a list of commands to be made available as mod icons within chat lines. Commands are separated by spaces. To include spaces in a command, surround the command with double quotes ("). Use <code>{user}</code> to insert the user\'s name into the command, otherwise it will be appended to the end. Use <code>{id}</code> to insert the unique message ID into the command.</p><p><b>Example:</b> <code>!permit "!reg add {user}" "/timeout {user} 1 {id}"</code></p><p>To send multiple commands, separate them with <code>&lt;LINE&gt;</code>.</p><p>Numeric values will become timeout buttons for that number of seconds. The text <code>&lt;BAN&gt;</code> is a special value that will act like the normal Ban button in chat.</p><p>To assign a specific letter for use as the icon, specify it at the start of the command followed by an equals sign.</p><p><b>Example:</b> <code>A="!reg add"</code></p><p><b>Default:</b> <code>&lt;BAN&gt; 600</code>',t.substr(1),function(t){if(null!==t&&void 0!==t){var s=[],i="";for(t=t.trim();t;)if("="!==t.charAt(1))if('"'===t.charAt(0)){var o=t.indexOf('"',1);-1===o&&(o=t.length);var n=t.substr(1,o-1);n&&(s.push([i,n]),i=""),t=t.substr(o+1)}else{var r=t.indexOf(" ");if(-1===r)t&&(s.push([i,t]),i=""),t="";else{var n=t.substr(0,r);n&&(s.push([i,n]),i=""),t=t.substr(r+1)}}else i=t.charAt(0),t=t.substr(2);for(var l=[],c=0;c<s.length;c++){var d=!1,i=s[c][0],h=s[c][1];"<BAN>"===h&&(h=!1);var f=parseInt(h);if(f>0&&!Number.isNaN(f)&&(h=f),i)d=!0;else{var u;u="string"==typeof h?/\w/.exec(h):a.duration_string(h),i=u&&u.length?u[0].toUpperCase():"C"}if("string"==typeof h){for(var _=h.split(/ *<LINE> */),m=0;m<_.length;m++)-1===_[m].indexOf("{user}")&&(_[m]+=" {user}");h=_.join("<LINE>")}l.push([i,h,d])}e.settings.set("mod_buttons",l);var g=a.ember_resolve("component:chat/chat-line"),p=g?a.ember_views():[];for(var v in p){var b=p[v];b instanceof g&&b.buildModIconsHTML&&b.$(".mod-icons").replaceWith(b.buildModIconsHTML())}}},600)}},n.settings_info.mod_card_buttons={type:"button",value:[],category:"Chat Moderation",no_bttv:!0,name:"Moderation Card Additional Buttons",help:"Add additional buttons to moderation cards for running chat commands on those users.",method:function(){for(var e=this,t="",s=0;s<this.settings.mod_card_buttons.length;s++){var i=this.settings.mod_card_buttons[s];t+=-1!==i.indexOf(" ")?' "'+i+'"':" "+i}a.prompt("Moderation Card Additional Buttons",'Please enter a list of additional commands to display buttons for on moderation cards. Commands are separated by spaces. To include spaces in a command, surround the command with double quotes ("). Use <code>{user}</code> to insert the user\'s name into the command, otherwise it will be appended to the end.</p><p><b>Example:</b> !permit "!reg add {user}"',t.substr(1),function(t){if(null!==t&&void 0!==t){var s=[];for(t=t.trim();t;)if('"'===t.charAt(0)){var i=t.indexOf('"',1);-1===i&&(i=t.length);var o=t.substr(1,i-1);o&&s.push(o),t=t.substr(i+1)}else{var n=t.indexOf(" ");if(-1===n)t&&s.push(t),t="";else{var o=t.substr(0,n);o&&s.push(o),t=t.substr(n+1)}}e.settings.set("mod_card_buttons",s)}},600)}},n.settings_info.mod_card_durations={type:"button",value:[300,600,3600,43200,86400,604800],category:"Chat Moderation",no_bttv:!0,name:"Moderation Card Timeout Buttons",help:"Add additional timeout buttons to moderation cards with specific durations.",method:function(){var e=this,t=this.settings.mod_card_durations.join(", ");a.prompt("Moderation Card Timeout Buttons","Please enter a comma-separated list of durations that you would like to have timeout buttons for. Durations must be expressed in seconds.</p><p><b>Default:</b> 300, 600, 3600, 43200, 86400, 604800",t,function(t){if(null!==t&&void 0!==t){"reset"===t&&(t=n.settings_info.mod_card_durations.value.join(", ")),t=t.trim().split(/[ ,]+/);for(var s=[],i=0;i<t.length;i++){var o=parseInt(t[i]);0===o&&(o=1),!Number.isNaN(o)&&o>0&&s.push(o)}e.settings.set("mod_card_durations",s)}},600)}},n.prototype.setup_mod_card=function(){try{o=e.require&&e.require("web-client/helpers/chat/chat-line-helpers")}catch(t){}this.log("Listening to the Settings controller to catch mod icon state changes.");var s=this,i=a.ember_lookup("controller:settings");i&&i.addObserver("settings.showModIcons",function(){i.get("settings.showModIcons")&&s.settings.set("chat_mod_icon_visibility",1)}),this.log("Modifying Mousetrap stopCallback so we can catch ESC.");var n=Mousetrap.stopCallback;Mousetrap.stopCallback=function(e,t,s){return t.classList.contains("no-mousetrap")?!0:n(e,t,s)},Mousetrap.bind("up up down down left right left right b a",function(){var e=document.querySelector(".app-main")||document.querySelector(".ember-chat-container");e&&e.classList.toggle("ffz-flip")}),this.log("Hooking the Ember Moderation Card view."),this.update_views("component:chat/moderation-card",this.modify_moderation_card)},n.prototype.modify_moderation_card=function(t){var s=this;a.ember_reopen_view(t,{ffzForceRedraw:function(){this.rerender(),s.settings.mod_card_history&&this.ffzRenderHistory(),s.settings.highlight_messages_with_mod_card&&a.update_css(s._chat_style,"mod-card-highlight",l["chat-user-bg"].replace(/{user_id}/g,this.get("cardInfo.user.id")))}.observes("cardInfo.isModeratorOrHigher","cardInfo.user.id"),ffzRebuildInfo:function(){
var e=this.get("element"),t=e&&e.querySelector(".info");if(t){var i='<span class="stat html-tooltip" title="Total Views">'+r.EYE+" "+a.number_commas(this.get("cardInfo.user.views")||0)+"</span>",o=a.parse_date(this.get("cardInfo.user.created_at")||""),n=this.get("cardInfo.user.ffz_followers");if("number"==typeof n)i+='<span class="stat html-tooltip" title="Followers">'+r.HEART+" "+a.number_commas(n||0)+"</span>";else if(void 0===n){var l=this;this.set("cardInfo.user.ffz_followers",!1),a.api.get("channels/"+this.get("cardInfo.user.id")+"/follows",{limit:1}).done(function(e){l.set("cardInfo.user.ffz_followers",e._total),l.ffzRebuildInfo()}).fail(function(e){l.set("cardInfo.user.ffz_followers",void 0)})}if(o){var c=Date.now()-(s._ws_server_offset||0),d=Math.floor((c-o.getTime())/1e3);d>0&&(i+='<span class="stat html-tooltip" title="Member Since: '+a.quote_san(d>86400?o.toLocaleDateString():o.toLocaleString())+'">'+r.CLOCK+" "+a.human_time(d,10)+"</span>")}t.innerHTML=i}}.observes("cardInfo.user.views"),userName:Ember.computed("cardInfo.user.id","cardInfo.user.display_name",function(){var e=this.get("cardInfo.user.id"),t=s.aliases[e];return t||this.get("cardInfo.user.display_name")||e.capitalize()}),ffz_destroy:function(){s._mod_card===this&&(s._mod_card=void 0),a.update_css(s._chat_style,"mod-card-highlight")},ffz_init:function(){if(!s.has_bttv){s._mod_card=this;var t,i,o,n=this.get("element"),g=this.get("controller"),p=this,v=g.get("cardInfo.isModeratorOrHigher"),b=a.ember_lookup("controller:chat"),y=s.get_user(),w=b&&b.get("currentRoom.id"),z=y&&w===y.login,k=g.get("cardInfo.user.id"),C=s.aliases[k],x=function(){return i&&i.value?" "+i.value:""};if(this.ffz_room_id=w,s.settings.highlight_messages_with_mod_card&&a.update_css(s._chat_style,"mod-card-highlight",l["chat-user-bg"].replace(/{user_id}/g,k)),this.set("banAction",function(e){var t=a.ember_lookup("controller:chat").get("currentRoom");t.send("/ban "+e.user+x(),!0)}),this.set("timeoutAction",function(e){var t=a.ember_lookup("controller:chat").get("currentRoom");t.send("/timeout "+e.user+" 600 "+x(),!0)}),C){var T=n.querySelector("h3.name"),S=T&&T.querySelector("a");S&&(T=S),T&&(T.classList.add("ffz-alias"),T.title=a.sanitize(g.get("cardInfo.user.display_name")||k.capitalize()),jQuery(T).tipsy({gravity:a.tooltip_placement(r.TOOLTIP_DISTANCE,"n")}))}if(n.classList.add("ffz-moderation-card"),s.settings.mod_card_info){var E=a.createElement("div","info channel-stats"),M=n.querySelector("h3.name");M&&(n.classList.add("ffz-has-info"),M.parentElement.insertBefore(E,M.nextSibling),this.ffzRebuildInfo())}if(v&&s.settings.mod_card_buttons&&s.settings.mod_card_buttons.length){t=a.createElement("div","extra-interface interface clearfix");for(var L={},A=function(e){var t=g.get("cardInfo.user.id"),s=a.ember_lookup("controller:chat"),i=s&&s.get("currentRoom"),o=e.replace(h,t),n=x();if(n){var r=c.exec(o);r?(r[2]||(o+=" 600"),r[3]||(o+=n)):(r=d.exec(o),r&&!r[2]&&(o+=n))}i&&i.send(o,!0)},O=function(e){var t=a.createElement("button","button ffz-no-bg"),s=e.split(" ",1)[0],i=L[s]>1?e.split(" ",L[s]):[s];return/^[!~.\/]/.test(i[0])&&(i[0]=i[0].substr(1)),i=_.map(i,function(e){return e.capitalize()}).join(" "),t.innerHTML=a.sanitize(i),t.title=a.sanitize(e.replace(/{user}/g,g.get("cardInfo.user.id")||"{user}")),jQuery(t).tipsy({gravity:a.tooltip_placement(r.TOOLTIP_DISTANCE,"n")}),t.addEventListener("click",A.bind(this,e)),t},L={},I=0;I<s.settings.mod_card_buttons.length;I++)L[s.settings.mod_card_buttons[I].split(" ",1)[0]]=(L[s.settings.mod_card_buttons[I].split(" ",1)[0]]||0)+1;for(var I=0;I<s.settings.mod_card_buttons.length;I++){var R=s.settings.mod_card_buttons[I],F=R.indexOf("{user}");-1===F&&(R+=" {user}"),t.appendChild(O(R))}n.appendChild(t)}if(n.setAttribute("tabindex",1),s.settings.mod_card_hotkeys&&(n.classList.add("no-mousetrap"),o=function(t){var s=t.keyCode||t.which,o=g.get("cardInfo.user.id"),r=g.get("cardInfo.isModeratorOrHigher"),l=a.ember_lookup("controller:chat").get("currentRoom");if(r&&s==f.P)l.send("/timeout "+o+" 1"+x(),!0);else if(r&&s==f.B)l.send("/ban "+o+x(),!0);else if(r&&s==f.T)l.send("/timeout "+o+" 600"+x(),!0);else if(r&&s==f.U)l.send("/unban "+o,!0);else{if(r&&i&&s==f.R){var c=document.createEvent("MouseEvents");return c.initMouseEvent("mousedown",!0,!0,e),i.focus(),void i.dispatchEvent(c)}if(s==f.ESC&&t.target===i)return void n.focus();if(s!=f.ESC)return}p.get("closeAction")()},n.addEventListener("keyup",o)),v){n.classList.add("ffz-is-mod");var H=function(e){var t=g.get("cardInfo.user.id"),s=a.ember_lookup("controller:chat").get("currentRoom");-1===e?s.send("/unban "+t,!0):s.send("/timeout "+t+" "+e+x(),!0)},D=function(e){var t=a.createElement("button","button ffz-no-bg");return t.innerHTML=a.duration_string(e),t.title="Timeout User for "+a.number_commas(e)+" Second"+(1!=e?"s":""),s.settings.mod_card_hotkeys&&600===e?t.title="(T)"+t.title.substr(1):s.settings.mod_card_hotkeys&&1===e&&(t.title="(P)urge - "+t.title),jQuery(t).tipsy({gravity:a.tooltip_placement(r.TOOLTIP_DISTANCE,"n")}),t.addEventListener("click",H.bind(this,e)),t};if(s.settings.mod_card_durations&&s.settings.mod_card_durations.length){t=a.createElement("div","extra-interface interface clearfix"),t.appendChild(D(1));var j=a.createElement("span","right");t.appendChild(j);for(var I=0;I<s.settings.mod_card_durations.length;I++)j.appendChild(D(s.settings.mod_card_durations[I]));n.appendChild(t),this.$("button.timeout").remove()}if(s.settings.mod_card_reasons&&s.settings.mod_card_reasons.length){t=a.createElement("div","extra-interface interface clearfix"),i=a.createElement("select","ffz-ban-reasons",'<option value="">Select a Ban '+(s.settings.mod_card_hotkeys?"(R)":"R")+"eason</option>"),t.appendChild(i);for(var I=0;I<s.settings.mod_card_reasons.length;I++){var P=a.createElement("option"),N=s.settings.mod_card_reasons[I];P.value=N,P.textContent=I+1+") "+N,i.appendChild(P)}n.appendChild(t)}var B=n.querySelector("button.ban");s.settings.mod_card_hotkeys&&B.setAttribute("title","(B)an User");var U=a.createElement("button","unban button button--icon-only light");U.innerHTML='<figure class="icon">'+m+"</figure>",U.title=(s.settings.mod_card_hotkeys?"(U)":"U")+"nban User",jQuery(U).tipsy({gravity:a.tooltip_placement(r.TOOLTIP_DISTANCE,"n")}),U.addEventListener("click",H.bind(this,-1)),jQuery(B).after(U)}jQuery("button.ignore, button.ban").tipsy({gravity:a.tooltip_placement(r.TOOLTIP_DISTANCE,"n")});var q=n.querySelector("button.mod");if(q){var V=z||y&&y.is_admin||y&&y.is_staff;V||q.parentElement.removeChild(q)}var W=n.querySelector(".follow-button");W&&jQuery(W).tipsy({title:function(){return W.classList.contains("is-following")?"Unfollow":"Follow"}});var Z=n.querySelector(".interface > button.message-button");if(Z){Z.innerHTML="W",Z.classList.add("button--icon-only"),Z.classList.add("message"),Z.title="Whisper User",jQuery(Z).tipsy({gravity:a.tooltip_placement(r.TOOLTIP_DISTANCE,"n")});var G=a.createElement("button","message-button button button--icon-only message html-tooltip");G.innerHTML='<figure class="icon">'+u+"</figure>",G.title="Message User",G.addEventListener("click",function(){e.open("//www.twitch.tv/message/compose?to="+g.get("cardInfo.user.id"))}),Z.parentElement.insertBefore(G,Z.nextSibling)}var Q=a.createElement("button","alias button button--icon-only html-tooltip");if(Q.innerHTML='<figure class="icon">'+r.EDIT+"</figure>",Q.title="Set Alias",Q.addEventListener("click",function(){var e=g.get("cardInfo.user.id"),t=s.aliases[e];a.prompt("Alias for <b>"+a.sanitize(g.get("cardInfo.user.display_name")||e)+"</b>","Please enter an alias for the user. Leave it blank to remove the alias.",t,function(t){if(null!==t&&void 0!==t){t=t.trim(),t||(t=void 0),s.aliases[e]=t,s.save_aliases(),s._update_alias(e),Ember.propertyDidChange(g,"cardInfo.user.display_name");var i=n.querySelector("h3.name");i&&i.classList.toggle("ffz-alias",t)}})}),Z)Z.parentElement.insertBefore(Q,Z);else{var K=n.querySelector(".interface > .follow-button");K&&K.parentElement.insertBefore(Q,K.nextSibling)}s.settings.mod_card_history&&this.ffzRenderHistory(),this.ffzReposition(),this.$().draggable({start:function(){n.focus()}}),n.focus()}},ffzReposition:function(){var e=this.get("element"),t=e.getBoundingClientRect(),s=document.body.getBoundingClientRect(),i=this.get("cardInfo.renderBottom"),o=this.get("cardInfo.renderRight");if(o){var n=t.left+t.width-o;e.style.left=t.left-n+"px"}if(i){var n=t.bottom-i;e.style.top=t.top-n+"px"}else if(t.bottom>s.bottom){var n=t.bottom-s.bottom;t.top-n>s.top&&(e.style.top=t.top-n+"px")}}.observes("cardInfo.renderTop","cardInfo.renderLeft","cardInfo.renderRight","cardInfo.renderBottom"),ffzRenderHistory:function(){var t=this,i=a.ember_lookup("controller:chat"),o=i&&i.get("currentRoom"),n=o&&o.get("roomProperties.hide_chat_links"),r=o.tmiSession||e.TMI&&TMI._sessions&&TMI._sessions[0],l=o.get("id"),c=this.get("cardInfo.user.id"),d=o&&s.rooms&&s.rooms[l],h=d&&d.user_history&&d.user_history[c]||[],f=this.get("element"),u=f&&f.querySelector(".chat-history");if(u?(u.classList.remove("loading"),u.innerHTML=""):(u=a.createElement("ul","interface clearfix chat-history"),f.appendChild(u)),h.length<50){var _=(h.length>0?h[0].date.getTime():Date.now())-(s._ws_server_offset||0);s.ws_send("user_history",[l,c,50-h.length],function(e,i){if(e){s.parse_history(i,null,null,l,n,r);for(var o=i.length,a=u&&u.scrollTop>=u.scrollHeight-u.clientHeight,c=!0;o--;){var d=i[o];d&&(d.from_server=!0,!d.date||d.date.getTime()>=_||(c&&(c=!1,u.insertBefore(s._build_mod_card_history({date:d.date,from:"jtv",style:"admin",cachedTokens:["(Server History Above)"]}),u.firstElementChild)),u.insertBefore(s._build_mod_card_history(d,t),u.firstElementChild)))}a&&setTimeout(function(){u.scrollTop=u.scrollHeight})}})}for(var m=0;m<h.length;m++)u.appendChild(s._build_mod_card_history(h[m],t));u.scrollTop=u.scrollHeight},ffzAdjacentHistory:function(t){var i=a.ember_lookup("controller:chat"),o=this,n=this.get("cardInfo.user.id"),r=i&&i.get("currentRoom"),l=r.get("id"),c=r&&r.get("roomProperties.hide_chat_links"),d=r.tmiSession||e.TMI&&TMI._sessions&&TMI._sessions[0],h=this.get("element"),f=h&&h.querySelector(".chat-history"),u=h&&h.querySelector(".chat-history.adjacent-history"),_=t.date.getTime(),m=u&&u.scrollTop||f&&f.scrollTop||0;f&&(u?(u.classList.add("loading"),u.scrollTop=0):(f.classList.add("loading"),f.scrollTop=0),s.ws_send("adjacent_history",[l,_,2],function(e,i){var r=f.classList.contains("loading");if(u?(u.classList.remove("loading"),u.scrollTop=m):(f.classList.remove("loading"),f.scrollTop=m),e&&i&&i.length&&r){var _,g=!1,p=!1;u?(g=!0,u.innerHTML=""):(u=a.createElement("ul","interface clearfix chat-history adjacent-history"),_=a.createElement("button","button ffz-no-bg back-button"),_.innerHTML="&laquo; Back",_.addEventListener("click",function(){u.parentElement.removeChild(u),_.parentElement.removeChild(_),f.classList.remove("hidden")})),s.parse_history(i,null,null,l,c,d,function(e){e.from_server=!0;var i=t.date.getTime()-(t.from_server?0:s._ws_server_offset||0),a=!p&&Math.abs(i-e.date.getTime())<(t.from_server?50:1e3)&&t.from===e.from&&t.message===e.message;return e.original_sender=n===e.from,e.is_original=a,p=p||a,u.insertBefore(s._build_mod_card_history(e,o,!0),u.firstElementChild),!0}),g||(f.classList.add("hidden"),f.parentElement.insertBefore(u,f),f.parentElement.insertBefore(_,u)),p&&setTimeout(function(){h=u.querySelector(".original-msg"),h&&(u.scrollTop=h.offsetTop-u.offsetTop-(u.clientHeight-h.clientHeight)/2)})}})||(u?(u.classList.remove("loading"),u.scrollTop=m):(f.classList.remove("loading"),f.scrollTop=m)))}})},n.prototype._build_mod_card_history=function(e,t,s){var i=document.createElement("li"),n=[],r=this;m="",g="",o&&o.getTime&&n.push('<span class="timestamp">'+o.getTime(e.date)+"</span>");var l=this.aliases[e.from],c=e.tags&&e.tags["display-name"]||e.from&&e.from.capitalize()||"unknown user";if(s){n.push('<span class="badges">'),n.push(this.render_badges(this.get_line_badges(e,!1))),n.push("</span>");var d=e.color,h=d&&this._handle_color(d),f=a.ember_lookup("service:layout"),u=a.ember_lookup("controller:settings"),_=f&&f.get("isTheatreMode")||u&&u.get("settings.darkMode"),m=h&&"color:"+(_?h[1]:h[0]),g=m?" has-color":"";n.push(l?'<span class="from ffz-alias html-tooltip'+g+'" style="'+m+(h?'" data-color="'+d:"")+'" title="'+a.quote_san(c)+'">'+a.sanitize(l)+"</span>":'<span class="from'+g+'" style="'+m+(h?'" data-color="'+d:"")+'">'+a.sanitize(c)+"</span>"),n.push('<span class="colon">:</span> ')}"action"!==e.style&&(m="",g="");var p='<span class="message'+g+'" style="'+m+(h?'" data-color="'+d:"")+'">'+("action"!==e.style||s?"":"*"+c+" ")+this.render_tokens(e.cachedTokens,!0,!1,e.tags&&e.tags.bits)+"</span>";return n.push(e.deleted?'<span class="deleted"><a class="undelete" href="#" data-message="'+a.quote_attr(p)+'">&lt;message deleted&gt;</a></span>':p),i.className="message-line chat-line clearfix",e.style&&i.classList.add(e.style),e.original_sender&&i.classList.add("original-sender"),e.is_original&&i.classList.add("original-msg"),e.ffz_has_mention&&i.classList.add("ffz-mentioned"),this.settings.prevent_clear&&e.ffz_deleted&&i.classList.add("ffz-deleted"),i.setAttribute("data-room",e.room),i.setAttribute("data-sender",e.from),i.setAttribute("data-id",e.tags&&e.tags.id),i.setAttribute("data-deleted",e.deleted||!1),i.innerHTML=n.join(""),jQuery("a.undelete",i).click(function(e){this.parentElement.outerHTML=this.getAttribute("data-message")}),jQuery(".deleted-word",i).click(function(e){jQuery(this).trigger("mouseout"),this.outerHTML=this.getAttribute("data-text")}),jQuery("a.deleted-link",i).click(r._deleted_link_click),jQuery("img.emoticon",i).click(function(e){r._click_emote(this,e)}),t&&(t.get("cardInfo.user.id")!==e.from&&jQuery("span.from",i).click(function(s){var i=t.get("element");i&&r._roomv&&r._roomv.get("context.model.id")===e.room&&r._roomv.get("controller").send("showModOverlay",{sender:e.from,top:parseInt(i.style.top),left:parseInt(i.style.left)})}),i.querySelector(".timestamp").addEventListener("click",function(s){0===s.button&&t.ffzAdjacentHistory(e)})),i},n.prototype._update_alias=function(e){var t=this.aliases&&this.aliases[e],s=n.get_capitalization(e),i=t||s,o=this._roomv&&this._roomv.get("element"),a=o&&o.querySelectorAll('.chat-line[data-sender="'+e+'"]');if(a){for(var r=0,l=a.length;l>r;r++){var c=a[r],d=c.querySelector(".from");d&&(d.classList.toggle("ffz-alias",t),d.textContent=i,d.title=t?s:"")}this._inputv&&Ember.propertyDidChange(this._inputv,"ffz_name_suggestions")}},n.chat_commands.purge=function(e,t){if(!t||!t.length)return"Purge Usage: /p username [more usernames separated by spaces]";if(t.length>10)return"Please only purge up to 10 users at once.";for(var s=0;s<t.length;s++){var i=t[s];i&&e.room.send("/timeout "+i+" 1",!0)}},n.chat_commands.p=function(e,t){return n.chat_commands.purge.call(this,e,t)},n.chat_commands.p.enabled=function(){return this.settings.short_commands},n.chat_commands.t=function(e,t){return t&&t.length?void e.room.send("/timeout "+t.join(" "),!0):"Timeout Usage: /t username [duration]"},n.chat_commands.t.enabled=function(){return this.settings.short_commands},n.chat_commands.b=function(e,t){if(!t||!t.length)return"Ban Usage: /b username [more usernames separated by spaces]";if(t.length>10)return"Please only ban up to 10 users at once.";for(var s=0;s<t.length;s++){var i=t[s];i&&e.room.send("/ban "+i,!0)}},n.chat_commands.b.enabled=function(){return this.settings.short_commands},n.chat_commands.u=function(e,t){if(!t||!t.length)return"Unban Usage: /u username [more usernames separated by spaces]";if(t.length>10)return"Please only unban up to 10 users at once.";for(var s=0;s<t.length;s++){var i=t[s];i&&e.room.send("/unban "+i,!0)}},n.chat_commands.u.enabled=function(){return this.settings.short_commands}},{"../compiled_styles":5,"../constants":6,"../utils":53}],19:[function(t,s,i){{var o=e.FrankerFaceZ,n=t("../utils");t("../constants")}o.settings_info.player_stats={type:"boolean",value:!1,no_mobile:!0,category:"Channel Metadata",name:"Stream Latency",help:"Display your current stream latency (how far behind the broadcast you are) under the player, with a few useful statistics in a tooltip.",on_update:function(e){this._cindex&&this._cindex.ffzUpdatePlayerStats()}},o.settings_info.classic_player={type:"boolean",value:!1,no_mobile:!0,category:"Player",name:"Classic Player",help:"Alter the appearance of the player to resemble the older Twitch player with always visible controls.",on_update:function(e){n.toggle_cls("ffz-classic-player")(e);var t=n.ember_lookup("service:layout");t&&t.set("PLAYER_CONTROLS_HEIGHT",e?32:0)}},o.settings_info.player_volume_bar={type:"boolean",value:!1,no_mobile:!0,category:"Player",name:"Volume Always Expanded",help:"Keep the volume slider expanded even when not hovering over it with the mouse.",on_update:n.toggle_cls("ffz-player-volume")},o.settings_info.player_pause_hosts={type:"select",options:{0:"Disabled",1:"When Hosting Channel was Paused",2:"Always"},value:1,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},category:"Player",name:"Auto-Pause Hosted Channels",help:"Automatically pause hosted channels if you paused the channel doing the hosting, or just pause all hosts."},o.prototype.setup_player=function(){n.toggle_cls("ffz-player-volume")(this.settings.player_volume_bar),n.toggle_cls("ffz-classic-player")(this.settings.classic_player);var e=n.ember_lookup("service:layout");e&&e.set("PLAYER_CONTROLS_HEIGHT",this.settings.classic_player?32:0),this.players={},this.players_paused={},this.update_views("component:twitch-player2",this.modify_twitch_player)},o.prototype.modify_twitch_player=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){var e=this.get("channel.id");t.players[e]=this;var s=this.get("player");s&&!this.get("ffz_post_player")&&this.ffzPostPlayer()},ffz_destroy:function(){var e=this.get("channel.id");t.players[e]===this&&(t.players[e]=void 0)},insertPlayer:function(e){var s=this.get("shouldStartPaused"),i=this.get("hostChannel.id");e?this.set("shouldStartPaused",!1):(1===t.settings.player_pause_hosts&&t.players_paused[i]||2===t.settings.player_pause_hosts&&i)&&this.set("shouldStartPaused",!0),this._super(),this.set("shouldStartPaused",s)}.on("didInsertElement"),postPlayerSetup:function(){this._super();try{this.get("ffz_post_player")||this.ffzPostPlayer()}catch(e){t.error("Player2 postPlayerSetup: "+e)}},ffzRecreatePlayer:function(){{var e=this.get("player");e&&e.getTheatre()}e&&e.destroy(),this.$("#video-1").html(""),Mousetrap.unbind(["alt+x","alt+t","esc"]),this.set("player",null),Ember.run.next(this.insertPlayer.bind(this,!0))},ffzUpdatePlayerPaused:function(){var e=this.get("channel.id"),s=this.get("player.paused");t.log("Player Pause State for "+e+": "+s),t.players_paused[e]=s},ffzPostPlayer:function(){var e=this.get("player");if(e){this.set("ffz_post_player",!0),t.players_paused[this.get("channel.id")]=e.paused,e.addEventListener("pause",this.ffzUpdatePlayerPaused.bind(this)),e.addEventListener("play",this.ffzUpdatePlayerPaused.bind(this));var s=this.$(".player .js-playback-stats");s.draggable({cancel:"li",containment:"parent"});var i=this,o=this.$(".player-menu .player-menu__item--stats")[0],a=o&&o.parentElement;if(o&&!a.querySelector(".js-player-reset")){var r=n.createElement("a","player-text-link js-player-reset","Reset Player"),l=n.createElement("p","player-menu__item player-menu__item--reset",r);r.tabindex="-1",r.href="#",r.addEventListener("click",function(e){return i.ffzRecreatePlayer(),e.preventDefault(),!1}),a.insertBefore(l,o.nextSibling)}}}})}},{"../constants":6,"../utils":53}],20:[function(t,s,i){var o,n=e.FrankerFaceZ,a=/ subscribed to /,r=t("../constants"),l=t("../utils"),c=[["r9k","r9k","This room is in R9K-mode."],["emote","emoteOnly","This room is in Twitch emoticons only mode. Emoticons added by extensions are not available in this mode."],["sub","subsOnly","This room is in subscribers-only mode."],["slow","slow",function(e){return"This room is in slow mode. You may send messages every "+l.number_commas(e&&e.get("slow")||120)+" seconds."}],["ban","ffz_banned","You have been banned from talking in this room."],["delay",function(e){return e&&0!==e.get("ffz_chat_delay")},function(e){return"Artificial chat delay is enabled. Messages are displayed after "+e.get("ffz_chat_delay")/1e3+" seconds."}],["batch",function(){return 0!==this.settings.chat_batching},function(){return"You have enabled chat message batching. Messages are displayed in "+this.settings.chat_batching/1e3+" second increments."}]],d=-1!==navigator.userAgent.indexOf("Android"),h=function(e){return e.moderator_badge?'.chat-line[data-room="'+e.id+'"] .badges .moderator:not(.ffz-badge-replacement) { background-repeat: no-repeat; background-size: initial; background-position: center; background-image:url("'+e.moderator_badge+'") !important; }':""};try{o=e.require&&e.require("ember-twitch-chat/helpers/chat-line-helpers")}catch(f){}n.prototype.setup_room=function(){this.rooms={},this.log("Creating room style element.");var e=this._room_style=document.createElement("style");e.id="ffz-room-css",document.head.appendChild(e),this.log("Hooking the Ember Room controller.");var t=this,s=l.ember_lookup("controller:room");if(s){var i=s._actions.banUser,o=s._actions.timeoutUser,n=s._actions.showModOverlay;s._actions.banUser=function(e){i.call(this,e),this.get("model").clearMessages(e.user,null,!0)},s._actions.timeoutUser=function(e){o.call(this,e),this.get("model").clearMessages(e.user,null,!0)},s._actions.showModOverlay=function(e){var s=l.ember_resolve("model:deprecated-channel"),i=s&&s.find&&s.find({id:e.sender});return i?(i.get("isLoaded")||i.load(),this.set("showModerationCard",!0),void this.set("moderationCardInfo",{user:i,renderTop:e.real_top||e.top,renderLeft:e.left,renderBottom:e.bottom,renderRight:e.right,isIgnored:this.get("tmiSession").isIgnored(e.sender),isChannelOwner:this.get("login.userData.login")===e.sender,profileHref:Twitch.uri.profile(e.sender),isModeratorOrHigher:this.get("model.isModeratorOrHigher")})):(t.log("Error opening mod card. model:deprecated-channel does not exist or does not have find!"),n.call(this,e))}}this.log("Hooking the Ember Room model.");var a=l.ember_resolve("model:room");this._modify_room(a);var r=a.instances;for(var c in r)if(r.hasOwnProperty(c)){var d=r[c];this.add_room(d.id,d),this._modify_room(d),d.ffzPatchTMI()}this.log("Hooking the Ember Room view."),this.update_views("view:room",this.modify_room_view)},n.prototype.modify_room_view=function(t){var s=this;l.ember_reopen_view(t,{ffz_init:function(){s._roomv=this,this.ffz_frozen=!1,this.ffz_ctrl=!1,this._ffz_keyw=this.ffzOnKey.bind(this),document.body.addEventListener("keydown",this._ffz_keyw),document.body.addEventListener("keyup",this._ffz_keyw),this._ffz_mouse_down=this.ffzMouseDown.bind(this),d&&this._$chatMessagesScroller.bind("scroll",this._ffz_mouse_down),this._$chatMessagesScroller.unbind("mousedown"),this._$chatMessagesScroller.bind("mousedown",this._ffz_mouse_down),s.settings.chat_hover_pause&&this.ffzEnableFreeze(),s.settings.room_status&&this.ffzUpdateStatus();var e=this.get("controller");e&&(e.reopen({calcRecipientEligibility:function(t){if(e.get("model.isGroupRoom"))return e.set("isRecipientBitsIneligible",!0),e.set("isBitsHelperShown",!1),e.set("minimumBits",0),void e.set("isBitsTooltipActive",!1);var s=e.get("model.roomProperties._id"),i=function(t){e.isDestroyed||e.get("model.roomProperties._id")!==s||(e.set("model._ffz_bits_eligibility",t),e.set("isRecipientBitsIneligible",!t.eligible),e.set("isBitsHelperShown",t.eligible),e.set("minimumBits",t.minBits),t.eligible||e.set("isBitsTooltipActive",!1))};if(void 0!==s){var o=e.get("model._ffz_bits_eligibility");void 0===o?e.get("bits").loadRecipientEligibility(s).then(i):i(o)}},submitButtonText:function(){if(this.get("model.isWhisperMessage")&&this.get("model.isWhispersEnabled"))return i18n("Whisper");var e=this.get("model.slowWait"),t=this.get("model.messageToSend")||"";return"/"===t.charAt(0)&&"/me "!==t.substr(0,4)||!e||!s.settings.room_status?i18n("Chat"):l.time_to_string(e,!1,!1,!0)}.property("model.isWhisperMessage","model.isWhispersEnabled","model.slowWait")}),Ember.propertyDidChange(e,"submitButtonText"))},ffz_destroy:function(){s._roomv===this&&(s._roomv=void 0),this._ffz_chat_display&&(this._ffz_chat_display=void 0),this._ffz_keyw&&(document.body.removeEventListener("keydown",this._ffz_keyw),document.body.removeEventListener("keyup",this._ffz_keyw),this._ffz_keyw=void 0),this.ffzDisableFreeze()},ffzOnKey:function(e){this.ffz_ctrl=e.ctrlKey,this.ffz_alt=e.altKey,this.ffz_shift=e.shiftKey,this.ffz_meta=e.metaKey;var t=s.settings.chat_mod_icon_visibility;if(!this._ffz_outside&&t>1&&this.get("element").classList.toggle("show-mod-icons",2===t?this.ffz_ctrl:3===t?this.ffz_meta:4===t?this.ffz_alt:this.ffz_shift),!(this._ffz_outside||s.settings.chat_hover_pause<2)){var i=this.ffzShouldBeFrozen(),o=this.ffz_frozen!==i;o&&(i?this.ffzFreeze():this.ffzUnfreeze())}},ffzUpdateStatus:function(){var e=this.get("controller.model"),t=this.get("element"),i=t&&t.querySelector(".chat-buttons-container");if(i){var o=i.querySelector("button");if(s.has_bttv||!s.settings.room_status)return jQuery(".ffz.room-state",i).remove(),void(o&&o.classList.remove("ffz-waiting"));o&&(o.classList.toggle("ffz-waiting",e&&e.get("slowWait")||0),o.classList.toggle("ffz-banned",e&&e.get("ffz_banned")||!1));for(var n,a,d,h,f=0,u=0;u<c.length;u++)d=c[u],a="ffz-stat-"+d[0],n=i.querySelector("#"+a),visible="function"==typeof d[1]?d[1].call(s,e):e&&e.get(d[1]),"string"==typeof visible&&(visible="1"===visible),h="function"==typeof d[3]?d[3].call(s,e):void 0,n||(n=l.createElement("span","ffz room-state stat float-right",(h||d[0]).charAt(0).toUpperCase()+"<span>"+(h||d[0]).substr(1).toUpperCase()+"</span>"),n.id=a,jQuery(n).tipsy({gravity:l.tooltip_placement(r.TOOLTIP_DISTANCE,"se")}),i.appendChild(n)),h&&(n.innerHTML=(h||d[0]).charAt(0).toUpperCase()+"<span>"+(h||d[0]).substr(1).toUpperCase()+"</span>"),n.title="function"==typeof d[2]?d[2].call(s,e):d[2],n.classList.toggle("hidden",!visible),visible&&f++;jQuery(".ffz.room-state",i).toggleClass("truncated",f>3)}}.observes("controller.model"),ffzEnableFreeze:function(){var e=this.get("element"),t=e.querySelector(".chat-messages");t&&(this._ffz_messages=t,this._ffz_interval=setInterval(this.ffzPulse.bind(this),200),this._ffz_mouse_move=this.ffzMouseMove.bind(this),this._ffz_mouse_out=this.ffzMouseOut.bind(this),t.addEventListener("mousemove",this._ffz_mouse_move),t.addEventListener("touchmove",this._ffz_mouse_move),t.addEventListener("mouseout",this._ffz_mouse_out))},ffzDisableFreeze:function(){this._ffz_interval&&(clearInterval(this._ffz_interval),this._ffz_interval=void 0),this.ffzUnfreeze();var e=this._ffz_messages;e&&(this._ffz_messages=void 0,this._ffz_mouse_move&&(e.removeEventListener("mousemove",this._ffz_mouse_move),e.removeEventListener("touchmove",this._ffz_mouse_move),this._ffz_mouse_move=void 0),this._ffz_mouse_out&&(e.removeEventListener("mouseout",this._ffz_mouse_out),this._ffz_mouse_out=void 0))},ffzPulse:function(){this.ffz_frozen&&!this.ffzShouldBeFrozen()&&this.ffzUnfreeze()},ffzUnfreeze:function(e){this.ffz_frozen=!1,this._ffz_last_move=0,this.ffzUnwarnPaused(),!e&&this.get("stuckToBottom")&&this._scrollToBottom()},ffzFreeze:function(){this.ffz_frozen=!0,this.get("stuckToBottom")&&(this.set("controller.model.messageBufferSize",s.settings.scrollback_length+150),this.ffzWarnPaused())},ffzMouseDown:function(e){var t=this._$chatMessagesScroller;if(t&&t[0]&&(!this.ffz_frozen&&"mousedown"===e.type||"mousewheel"===e.type||d&&"scroll"===e.type)){var s=t[0].scrollHeight-t[0].scrollTop-t[0].offsetHeight;this._setStuckToBottom(10>=s)}},ffzMouseOut:function(e){this._ffz_outside=!0;var t=this;setTimeout(function(){t._ffz_outside&&(s.settings.chat_mod_icon_visibility>1&&t.get("element").classList.toggle("show-mod-icons",!1),t.ffzUnfreeze())},25)},ffzShouldBeFrozen:function(e){void 0===e&&(e=Date.now()-this._ffz_last_move);var t=s.settings.chat_hover_pause;return this.ffz_ctrl&&(2===t||6===t)||this.ffz_meta&&(3===t||7===t)||this.ffz_alt&&(4===t||8===t)||this.ffz_shift&&(5===t||9===t)||750>e&&(1===t||t>5)},ffzMouseMove:function(e){if(this._ffz_last_move=Date.now(),this._ffz_outside=!1,e.altKey!==this.ffz_alt||e.shiftKey!==this.ffz_shift||e.ctrlKey!==this.ffz_ctrl||e.metaKey!==this.ffz_meta||e.screenX!==this._ffz_last_screenx||e.screenY!==this._ffz_last_screeny){this.ffz_ctrl=e.ctrlKey,this.ffz_alt=e.altKey,this.ffz_shift=e.shiftKey,this.ffz_meta=e.metaKey,this._ffz_last_screenx=e.screenX,this._ffz_last_screeny=e.screenY;var t=s.settings.chat_mod_icon_visibility;!this._ffz_outside&&t>1&&this.get("element").classList.toggle("show-mod-icons",2===t?this.ffz_ctrl:3===t?this.ffz_meta:4===t?this.ffz_alt:this.ffz_shift);var i=this.ffzShouldBeFrozen(),o=this.ffz_frozen!==i;o&&(i?this.ffzFreeze():this.ffzUnfreeze())}},_scrollToBottom:_.throttle(function(){var t=this,s=this._$chatMessagesScroller;Ember.run.next(function(){(e.requestAnimationFrame||setTimeout)(function(){!t.ffz_frozen&&s&&s.length&&(s[0].scrollTop=s[0].scrollHeight,t._setStuckToBottom(!0))})})},200),_setStuckToBottom:function(e){this.set("stuckToBottom",e),this.get("controller.model")&&this.set("controller.model.messageBufferSize",s.settings.scrollback_length+(e?0:150)),e||this.ffzUnfreeze(!0)},ffzWarnPaused:function(){var e=this.get("element"),t=e&&e.querySelector(".chat-interface .more-messages-indicator.ffz-freeze-indicator");if(e){if(!t){t=document.createElement("div"),t.className="more-messages-indicator ffz-freeze-indicator";var i=s.settings.chat_hover_pause,o=2===i?"Ctrl Key":3===i?r.META_NAME+" Key":4===i?"Alt Key":5===i?"Shift Key":6===i?"Ctrl or Mouse":7===i?r.META_NAME+" or Mouse":8===i?"Alt or Mouse":9===i?"Shift or Mouse":"Mouse Movement";t.innerHTML="(Chat Paused Due to "+o+")";var n=e.querySelector(".chat-interface");if(!n)return;n.insertBefore(t,n.childNodes[0])}t.classList.remove("hidden")}},ffzUnwarnPaused:function(){var e=this.get("element"),t=e&&e.querySelector(".chat-interface .more-messages-indicator.ffz-freeze-indicator");t&&t.classList.add("hidden")}})},n.chat_commands={},n.ffz_commands={},n.prototype.room_message=function(e,t){var s=t.split("\n");if(this.has_bttv)for(var i=0;i<s.length;i++)BetterTTV.chat.handlers.onPrivmsg(e.id,{style:"admin",date:new Date,from:"jtv",message:s[i]});else for(var i=0;i<s.length;i++)e.room.addMessage({style:"ffz admin",date:new Date,from:"FFZ",message:s[i]})},n.prototype.run_command=function(e,t){var s=this.rooms[t];if(!s||!s.room)return!1;if(e){var i,o=e.split(" "),a=o.shift().substr(1).toLowerCase(),r=n.chat_commands[a];if(!r)return!1;if(r.hasOwnProperty("enabled")){var l=r.enabled;if("function"==typeof l)try{l=r.enabled.call(this,s,o)}catch(c){this.error('command "'+a+'" enabled: '+c),l=!1}if(!l)return!1}this.log("Received Command: "+a,o,!0);try{i=r.call(this,s,o)}catch(c){this.error('command "'+a+'" runner: '+c),i="There was an error running the command."}return i&&this.room_message(s,i),!0}},n.prototype.run_ffz_command=function(e,t){var s=this.rooms[t];if(s&&s.room){if(!e){var i=document.querySelector("a.ffz-ui-toggle");if(i)return i.click();e="help"}var o=e.split(" "),a=o.shift().toLowerCase();this.log("Received Command: "+a,o,!0);var r,l=n.ffz_commands[a];if(l)try{r=l.call(this,s,o)}catch(c){this.log("Error Running Command - "+a+": "+c,s),r="There was an error running the command."}else r='There is no "'+a+'" command.';r&&this.room_message(s,r)}},n.ffz_commands.help=function(e,t){if(t&&t.length){var s=n.ffz_commands[t[0].toLowerCase()];return s?s.help?s.help:'No help is available for the command "'+t[0]+'".':'There is no "'+t[0]+'" command.'}var i=[];for(var o in n.ffz_commands)n.ffz_commands.hasOwnProperty(o)&&i.push(o);return"The available commands are: "+i.join(", ")},n.ffz_commands.help.help="Usage: /ffz help [command]\nList available commands, or show help for a specific command.",
n.prototype.update_room_important=function(e,t){var s=t||l.ember_lookup("controller:chat"),i=s&&s.get("currentChannelRoom"),o=this.rooms[e];o&&(o.important=o.room&&i===o.room||i&&i.ffz_host_target===e||o.room&&o.room.get("isGroupRoom")||-1!==this.settings.pinned_rooms.indexOf(e))},n.prototype.add_room=function(e,t){if(this.rooms[e])return this.log("Tried to add existing room: "+e);this.log("Adding Room: "+e);var s=this.rooms[e]={id:e,room:t,sets:[],ext_sets:[],css:null,needs_history:!1};if(this.follow_sets&&this.follow_sets[e]){s.extra_sets=this.follow_sets[e],delete this.follow_sets[e];for(var i=0;i<s.extra_sets.length;i++){var o=s.extra_sets[i],n=this.emote_sets&&this.emote_sets[o];n?-1===n.users.indexOf(e)&&n.users.push(e):this.load_set(o,function(t,s){t&&s.users.push(e)})}}this.update_room_important(e),s.important&&(this.ws_sub("room."+e),!this.has_bttv&&this.settings.chat_history&&t&&(t.get("messages.length")||0)<10&&(this.ws_send("chat_history",[e,25],this._load_history.bind(this,e))||(s.needs_history=!0))),t.set("messageBufferSize",this.settings.scrollback_length+(this._roomv&&!this._roomv.get("stuckToBottom")&&this._roomv.get("controller.model.id")===e?150:0)),this.load_room(e);for(var a in this._apis){var r=this._apis[a];r._room_callbacks(e,s)}},n.prototype.remove_room=function(e){var t=this.rooms[e];if(t&&(this.log("Removing Room: "+e),(t.css||t.moderator_badge)&&l.update_css(this._room_style,e,null),this.ws_unsub("room."+e),delete this.rooms[e],"_"!==e.charAt(0))){var s=this.emote_sets[t.set];s&&(s.users.removeObject(e),this.global_sets.contains(t.set)||s.users.length||this.unload_set(t.set))}},n.prototype._load_history=function(e,t,s){var i=this.rooms[e];if(i&&i.room){if(!t)return this.log("Error retrieving chat history for: "+e);if(this.log("Received "+s.length+" old messages for: "+e),s.length)return this._insert_history(e,s,!0)}},n.prototype._show_deleted=function(e){var t=this.rooms[e];if(t&&t.room){var s=t.room.get("messages.0.ffz_old_messages");s&&s.length&&(t.room.set("messages.0.ffz_old_messages",void 0),this._insert_history(e,s))}},n.prototype._insert_history=function(e,t,s){var i=this.rooms[e],o=this;if(i&&i.room){var n,a,r,c=this.get_user(),d=i.room,h=d.get("messages"),f=d.get("messageBufferSize"),u=d.tmiSession||TMI._sessions&&TMI._sessions[0],_=d.get("roomProperties.hide_chat_links"),m=0,g=0;if(a=h.length?h[0]:null,a&&"jtv"===a.from&&"Welcome to the chat room!"===a.message&&(a=h.length>1?h[1]:null),a&&(r=a.date&&a.date.getTime()),this.parse_history(t,null,null,e,_,u,function(e){if(s&&(e.from_server=!0),!e.date||r&&r-(e.from_server&&!a.from_server?o._ws_server_offset||0:0)<e.date.getTime())return!0;if(o.settings.remove_deleted&&e.deleted)return!0;if(e.tags&&e.tags.target&&"@@"!==e.tags.target){var t=c&&c.login===e.tags.target;if(!t&&!d.ffzShouldDisplayNotice())return!0;e.tags["ban-reason"]&&(t||d.get("isModeratorOrHigher"))&&(e.message=e.message.substr(0,e.message.length-1)+" with reason: "+e.tags["ban-reason"],e.cachedTokens=[l.sanitize(e.message)])}if(d.shouldShowMessage(e)&&d.ffzShouldShowMessage(e)){if(!(h.length<f))return!1;if(e.ffz_old_messages){var i=f-(h.length+1);0>=i?e.ffz_old_messages=null:e.ffz_old_messages.length>i&&(e.ffz_old_messages=e.ffz_old_messages.slice(e.ffz_old_messages.length-i))}n||(n=e);var u=e.tags&&e.tags.id,_=d.ffz_ids=d.ffz_ids||{};u&&!_[u]&&(_[u]=e),h.unshiftObject(e),g+=1}return e.tags&&"@@"===e.tags.target?!1:!0}),n){var p=Date.now()-(n.from_server?this._ws_server_offset||0:0),v=p-n.date.getTime();if(v>3e5){var b={color:"#755000",date:n.date,from:"frankerfacez_admin",style:"admin",message:"(Last message is "+l.human_time(v/1e3)+" old.)",room:e,from_server:s};if(this.tokenize_chat_line(b,!1,_),d.shouldShowMessage(b))for(h.insertAt(g,b);h.length>f;){var y=h.get(0);y.tags&&y.tags.id&&d.ffz_ids&&d.ffz_ids[y.tags.id]&&delete d.ffz_ids[y.tags.id],h.removeAt(0),m++}}}}},n.prototype.load_room=function(e,t,s){var i=this;jQuery.getJSON(r.API_SERVER+"v1/room/"+e).done(function(s){if(s.sets)for(var o in s.sets)s.sets.hasOwnProperty(o)&&i._load_set_json(o,void 0,s.sets[o]);i._load_room_json(e,t,s)}).fail(function(o){return 404==o.status?"function"==typeof t&&t(!1):(s=(s||0)+1,10>s?i.load_room(e,t,s):"function"==typeof t&&t(!1))})},n.prototype._load_room_json=function(e,t,s){if(!s||!s.room)return"function"==typeof t&&t(!1);s=s.room,this.rooms[e]&&(s.room=this.rooms[e].room);for(var i in this.rooms[e])"room"!==i&&this.rooms[e].hasOwnProperty(i)&&!s.hasOwnProperty(i)&&(s[i]=this.rooms[e][i]);s.needs_history=this.rooms[e]&&this.rooms[e].needs_history||!1,this.rooms[e]=s,(s.css||s.moderator_badge)&&l.update_css(this._room_style,e,h(s)+(s.css||"")),this.emote_sets.hasOwnProperty(s.set)?-1===this.emote_sets[s.set].users.indexOf(e)&&this.emote_sets[s.set].users.push(e):this.load_set(s.set,function(t,s){-1===s.users.indexOf(e)&&s.users.push(e)}),this.update_ui_link(),s.set&&this.rerender_feed_cards(s.set),t&&t(!0,s)},n.prototype._modify_room=function(t){var s=this;t.reopen({slowWaiting:!1,slow:0,ffz_banned:!1,mru_list:[],updateWait:function(e,t,i){var o=this.get("slowWait")||0;this.set("slowWait",e),1>o&&e>0?(this._ffz_wait_timer&&clearTimeout(this._ffz_wait_timer),this._ffz_wait_timer=setTimeout(this.ffzUpdateWait.bind(this),1e3),!i&&s._roomv&&s._roomv.ffzUpdateStatus()):(o>0&&1>e||t)&&(this.set("ffz_banned",!1),!i&&s._roomv&&s._roomv.ffzUpdateStatus())},ffzUpdateWait:function(){this._ffz_wait_timer=void 0;var e=this.get("slowWait")||0;1>e||(this.set("slowWait",--e),e>0?this._ffz_wait_timer=setTimeout(this.ffzUpdateWait.bind(this),1e3):(this.set("ffz_banned",!1),s._roomv&&s._roomv.ffzUpdateStatus()))},ffzScheduleDestroy:function(){if(!this._ffz_destroy_timer){var e=this;this._ffz_destroy_timer=setTimeout(function(){e._ffz_destroy_timer=null,e.ffzCheckDestroy()},5e3)}},ffzCheckDestroy:function(){var e=l.ember_lookup("controller:chat"),t=s.get_user(),i=this.get("id");e&&e.get("currentChannelRoom")===this||t&&t.login===i||s._chatv&&s._chatv._ffz_host===i||s.settings.pinned_rooms&&-1!==s.settings.pinned_rooms.indexOf(i)||this.destroy()},ffzUpdateStatus:function(){s._roomv&&s._roomv.ffzUpdateStatus()}.observes("r9k","subsOnly","emoteOnly","slow","ffz_banned"),ffzUserLevel:function(){return this.get("isStaff")?5:this.get("isAdmin")?4:this.get("isBroadcaster")?3:this.get("isGlobalModerator")?2:this.get("isModerator")?1:0}.property("id","chatLabels.[]"),init:function(){this._super();try{s.add_room(this.id,this),this.set("ffz_chatters",{}),this.set("ffz_ids",this.get("ffz_ids")||{})}catch(e){s.error("add_room: "+e)}},willDestroy:function(){this._super();try{s.remove_room(this.id)}catch(e){s.error("remove_room: "+e)}},clearMessages:function(e,t,i){var o=this;if(e){var a=1/0,c=void 0,d=void 0,h=s.get_user(),f=h&&h.login===e;if(t&&t["ban-duration"]&&(a=parseInt(t["ban-duration"])),isNaN(a)&&(a=1/0),t&&t["ban-reason"]&&(f||o.get("isModeratorOrHigher"))&&(c=t["ban-reason"]),c){var u=r.UUID_TEST.exec(c);u&&(d=u[1],c=c.substr(0,c.length-u[0].length),c.length||(c=void 0))}for(f&&(o.set("ffz_banned",!0),"number"==typeof a&&a&&isFinite(a)&&!isNaN(a)?o.updateWait(a):a&&(o.set("slowWait",0),s._roomv&&s._roomv.ffzUpdateStatus())),o.ffzRecentlyBanned||(o.ffzRecentlyBanned=[]),o.ffzRecentlyBanned.push(e);o.ffzRecentlyBanned.length>100;)o.ffzRecentlyBanned.shift();if(d&&this.ffz_ids){var _=this.ffz_ids[d];if(_&&_.from===e){if(_.ffz_deleted=!0,s.settings.prevent_clear||(_.deleted=!0),s.settings.remove_deleted)if(_.pending)_.removed=!0;else for(var m=o.get("messages"),g=m.get("length"),p=g;p--;){var _=m.get(p);if(_.tags&&_.tags.id===d){m.removeAt(p),delete this.ffz_ids[d];break}}_._line&&(Ember.propertyDidChange(_._line,"msgObject.ffz_deleted"),Ember.propertyDidChange(_._line,"msgObject.deleted"))}else s.log(_.from!==e?"Banned Message ID #"+d+" not owned by: "+e:"Banned Message ID #"+d+" not found in chat.")}else{for(var m=o.get("messages"),g=m.get("length"),p=g,v=0;p--;){var _=m.get(p);if(_.from===e){if(s.settings.remove_deleted){_.tags&&_.tags.id&&this.ffz_ids&&this.ffz_ids[_.tags.id]&&delete this.ffz_ids[_.tags.id],m.removeAt(p),v++;continue}o.set("messages."+p+".ffz_deleted",!0),s.settings.prevent_clear||o.set("messages."+p+".deleted",!0)}}if(o.ffzPending)for(m=o.ffzPending,p=m.length;p--;){var _=m.get(p);_.from===e&&(_.ffz_deleted=!0,_.deleted=!s.settings.prevent_clear,_.removed=s.settings.remove_deleted)}}if(!i){var b,y,w=f||this.ffzShouldDisplayNotice(),z=f||this.get("isModeratorOrHigher"),k=s.rooms&&s.rooms[o.get("id")],C=new Date,x=C+1e3*a;k&&(b=k.ban_history=k.ban_history||{},y=b[e],(!y||Math.abs(C-y.date)>15e3)&&(y=null));var T=(f?"You have":n.get_capitalization(e)+" has")+" been "+(isFinite(a)?"timed out for "+l.duration_string(a,!0):"banned");if(w)if(y)d&&-1===y.msg_ids.indexOf(d)&&y.msg_ids.push(d),c&&-1===y.reasons.indexOf(c)&&y.reasons.push(c),-1===y.durations.indexOf(a)&&y.durations.push(a),y.end_time=x,y.timeouts++,y.message=T+" ("+l.number_commas(y.timeouts)+" times)"+(z&&0!==y.reasons.length?" with reason"+l.pluralize(y.reasons.length)+": "+y.reasons.join(", "):"."),y.cachedTokens=[{type:"text",text:y.message}],y._line&&Ember.propertyDidChange(y._line,"ffzTokenizedMessage");else{var _={style:"admin",date:C,ffz_ban_target:e,reasons:c?[c]:[],msg_ids:d?[d]:[],durations:[a],end_time:x,timeouts:1,message:T+(z&&c?" with reason: "+c:".")};b&&(b[e]=_),this.addMessage(_)}if(k&&s.settings.mod_card_history){var S=(k.user_history=k.user_history||{},k.user_history[e]=k.user_history[e]||[]),y=S.length>0?S[S.length-1]:null;if((!y||!y.is_delete||Math.abs(C-y.date)>15e3)&&(y=null),y)d&&-1===y.msg_ids.indexOf(d)&&y.msg_ids.push(d),c&&-1===y.reasons.indexOf(c)&&y.reasons.push(c),-1===y.durations.indexOf(a)&&y.durations.push(a),y.end_time=x,y.timeouts++,y.cachedTokens=[T+" ("+l.number_commas(y.timeouts)+" times)"+(0===y.reasons.length?".":" with reason"+l.pluralize(y.reasons.length)+": "+y.reasons.join(", "))];else for(S.push({from:"jtv",is_delete:!0,style:"admin",date:C,ffz_ban_target:e,reasons:c?[c]:[],msg_ids:d?[d]:[],durations:[a],end_time:x,timeouts:1,cachedTokens:T+(c?" with reason: "+c:".")});S.length>20;)S.shift()}}}else if(s.settings.prevent_clear)this.addTmiMessage("A moderator's attempt to clear chat was ignored.");else{var m=o.get("messages");o.set("messages",[]),o.addMessage({style:"admin",message:i18n("Chat was cleared by a moderator"),ffz_old_messages:m})}},trimMessages:function(){var e=this.get("messages"),t=e.get("length"),s=this.get("messageBufferSize");if(t>s){for(var i=t-s,o=0;i>o;o++){var n=e.get(o);n.tags&&n.tags.id&&this.ffz_ids&&this.ffz_ids[n.tags.id]&&delete this.ffz_ids[n.tags.id]}e.removeAt(0,i)}},ffz_chat_delay:function(){var e=s.settings.chat_delay;return-1!==e?e:(e=this.get("roomProperties.chat_delay_duration"),Number.isNaN(e)||!Number.isFinite(e)||this.get("isModeratorOrHigher")?0:e)}.property("roomProperties.chat_delay_duration","isModeratorOrHigher"),ffz_update_display:function(){s._roomv&&s._roomv.ffzUpdateStatus()}.observes("roomProperties.chat_delay_duration"),pushMessage:function(e){if(0!==s.settings.chat_batching||0!==this.get("ffz_chat_delay")||this.ffzPending&&this.ffzPending.length){this.ffzPending||(this.ffzPending=[]);var t=e.time=Date.now();e.pending=!0,this.ffzPending.push(e),this.ffzSchedulePendingFlush(t)}else this.ffzActualPushMessage(e)},ffzActualPushMessage:function(e){this.shouldShowMessage(e)&&this.ffzShouldShowMessage(e)&&(this.get("messages").pushObject(e),this.trimMessages(),"admin"!==e.style&&"whisper"!==e.style&&(e.ffz_has_mention&&(this.ffz_last_mention=Date.now()),this.ffz_last_activity=Date.now(),this.incrementProperty("unreadCount",1)))},ffzSchedulePendingFlush:function(e){if(!this._ffz_pending_flush&&this.ffzPending&&this.ffzPending.length){e=e||Date.now();var t=this.get("ffz_chat_delay"),i=Math.max(0!==t?50+Math.max(0,t+(this.ffzPending[0].time||0)-e):0,0!==s.settings.chat_batching?Math.max(0,s.settings.chat_batching-(e-(this._ffz_last_batch||0))):0);this._ffz_pending_flush=setTimeout(this.ffzPendingFlush.bind(this),i)}},ffzPendingFlush:function(){this._ffz_pending_flush=null;for(var e=this._ffz_last_batch=Date.now(),t=this.get("ffz_chat_delay"),s=0,i=this.ffzPending.length;i>s;s++){var o=this.ffzPending[s];if(o.removed){var n=o&&o.tags&&o.tags.id;n&&this.ffz_ids&&this.ffz_ids[n]&&delete this.ffz_ids[n]}else{if(0!==t&&t+o.time>e)break;o.pending=!1,this.ffzActualPushMessage(o)}}this.ffzPending=this.ffzPending.slice(s),this.ffzSchedulePendingFlush(e)},ffzShouldShowMessage:function(e){if(!s.settings.hosted_sub_notices&&"notification"===e.style&&a.test(e.message))return!1;if(s.settings.remove_bot_ban_notices&&this.ffzRecentlyBanned){var t="("+this.ffzRecentlyBanned.join("|")+")",i={nightbot:"^"+t,moobot:"\\("+t+"\\)",xanbot:"^"+t};if(e.from in i&&new RegExp(i[e.from]).test(e.message))return!1}return!0},ffzShouldDisplayNotice:function(){return 2===s.settings.timeout_notices||1===s.settings.timeout_notices&&this.get("isModeratorOrHigher")},addNotification:function(e){if(e){if(("timeout_success"===e.msgId||"ban_success"===e.msgId)&&this.ffzShouldDisplayNotice())return;return this._super(e)}},onMessage:function(e){this.addMessage(e)},addMessage:function(t){if(t){var i=t.tags&&"resub"===t.tags["msg-id"],o=this.get("id"),n=t.tags&&t.tags.id;if(i&&!s.settings.hosted_sub_notices&&(t.tags["room-id"]!=this.get("roomProperties._id")||a.test(t.tags["system-msg"])))return;if(i&&s.settings.old_sub_notices){if(this.addMessage({style:"notification",from:"twitchnotify",date:t.date||new Date,room:o,message:t.tags["system-msg"]}),!t.message)return;t.tags["system-msg"]=""}var r="whisper"===t.style;if(r&&l.ember_lookup("controller:application").get("isConversationsEnabled"))return;if(r||(t.room=o),this.tmiRoom&&t.from&&(t.color||(t.color=t.tags&&t.tags.color?t.tags.color:this.tmiSession.getColor(t.from.toLowerCase())),t.labels||(t.labels=this.tmiRoom.getLabels(t.from))),s.tokenize_chat_line(t,!1,this.get("roomProperties.hide_chat_links")),"twitchnotify"===t.from&&-1===t.message.indexOf("subscribed to")&&-1!==t.message.indexOf("subscribed")&&(t.tags||(t.tags={}),t.tags.badges||(t.tags.badges={}),t.tags.badges.subscriber="1",t.tags.subscriber=!0,t.labels&&-1===t.labels.indexOf("subscriber")&&t.labels.push("subscriber")),!r&&t.from&&"jtv"!==t.from&&"twitchnotify"!==t.from&&s.settings.mod_card_history){var c=s.rooms&&s.rooms[t.room];if(c){var d=(c.user_history=c.user_history||{},c.user_history[t.from]=c.user_history[t.from]||[]),h=d.length&&d[d.length-1],f={from:t.from,tags:{"display-name":t.tags&&t.tags["display-name"],bits:t.tags&&t.tags.bits},message:t.message,cachedTokens:t.cachedTokens,style:t.style,date:t.date};if(h&&h.is_delete&&t.date-h.date<=200?d.splice(d.length-1,0,f):d.push(f),d.length>20&&d.shift(),s._mod_card&&s._mod_card.ffz_room_id===t.room&&s._mod_card.get("cardInfo.user.id")===t.from){var u=s._mod_card.get("element"),_=u&&u.querySelector(".chat-history:not(.adjacent-history)"),m=_&&_.scrollTop>=_.scrollHeight-_.clientHeight;_&&(_.appendChild(s._build_mod_card_history(t,s._mod_card)),m&&setTimeout(function(){_.scrollTop=_.scrollHeight}),_.childElementCount>100&&_.removeChild(_.firstElementChild))}}}var g=s.rooms&&s.rooms[t.room],p=g&&g.ban_history;if(p&&t.from&&(p[t.from]&&new Date-p[t.from].date<=200?(t.ffz_deleted=!0,t.deleted=!s.settings.prevent_clear):p[t.from]=!1),!r&&!t.ffz_deleted){var v=s.get_user();if(v&&v.login===t.from){var b=this.get("ffz_banned");this.set("ffz_banned",!1),this.get("isSubscriber")||this.get("isModeratorOrHigher")||!this.get("slowMode")?this.updateWait(0,b):this.get("slowMode")&&this.updateWait(this.get("slow"))}}r||!this.chatters||this.chatters[t.from]||"twitchnotify"===t.from||"jtv"===t.from||this.ffzUpdateChatters(t.from)}t.color&&s._handle_color(t.color);for(var y=s._chat_filters.length;y--;)if(s._chat_filters[y](t)===!1)return;if(n){var w=this.ffz_ids=this.ffz_ids||{};w[n]=t}return e!==e.parent&&parent.postMessage&&t.from&&"jtv"!==t.from&&"twitchnotify"!==t.from&&parent.postMessage({from_ffz:!0,command:"chat_message",data:{from:t.from,room:t.room}},"*"),this._super(t)},ffzChatFilters:function(e){s._chat_filters.length},setHostMode:function(e){this.set("ffz_host_target",e&&e.hostTarget||null);var t=s.get_user();t&&s._cindex&&this.get("id")===t.login&&s._cindex.ffzUpdateHostButton();var i=l.ember_lookup("controller:chat");if(i&&i.get("currentChannelRoom")===this)return this._super(e)},send:function(e,t){try{this.ffz_last_input=Date.now();var i=e.charAt(0),o="/"===i||"."===i;if(o&&(e=e.replace(/\s+$/,"")),e&&!t){var n=this.get("mru_list"),a=n.indexOf(e);-1!==a?n.splice(a,1):n.length>20&&n.pop(),n.unshift(e)}var r=e.split(" ",1)[0].toLowerCase();if("/ffz"===r)return this.set("messageToSend",""),void s.run_ffz_command(e.substr(5),this.get("id"));if("/"===r.charAt(0)&&s.run_command(e,this.get("id")))return void this.set("messageToSend","")}catch(l){s.error("send: "+l)}return this._super(e)},ffzUpdateUnread:function(){var e=l.ember_lookup("controller:chat");e&&e.get("currentRoom")===this?this.resetUnreadCount():s._chatv&&s._chatv.ffzUpdateUnread(this.get("id"))}.observes("unreadCount"),ffzInitChatterCount:function(){if(this.tmiRoom){this._ffz_chatter_timer&&(clearTimeout(this._ffz_chatter_timer),this._ffz_chatter_timer=void 0);var e=this;this.tmiRoom.list().done(function(t){var s={};if(t=t.data.chatters,t&&t.admins)for(var i=0;i<t.admins.length;i++)s[t.admins[i]]=!0;if(t&&t.global_mods)for(var i=0;i<t.global_mods.length;i++)s[t.global_mods[i]]=!0;if(t&&t.moderators)for(var i=0;i<t.moderators.length;i++)s[t.moderators[i]]=!0;if(t&&t.staff)for(var i=0;i<t.staff.length;i++)s[t.staff[i]]=!0;if(t&&t.viewers)for(var i=0;i<t.viewers.length;i++)s[t.viewers[i]]=!0;e.set("ffz_chatters",s),e.ffzUpdateChatters()}).always(function(){e._ffz_chatter_timer=setTimeout(e.ffzInitChatterCount.bind(e),3e5)})}},ffzUpdateChatters:function(t,i){var o=this.get("ffz_chatters")||{};t&&(o[t]=!0),i&&o[i]&&delete o[i],s.settings.chatter_count&&(s._cindex&&s._cindex.ffzUpdateChatters(),e!==e.parent&&parent.postMessage&&parent.postMessage({from_ffz:!0,command:"chatter_count",data:Object.keys(this.get("ffz_chatters")||{}).length},"*"))},ffzPatchTMI:function(){var e=this.get("tmiRoom"),t=this;if(!this.get("ffz_is_patched")&&e){s.settings.chatter_count&&this.ffzInitChatterCount();var i=e._roomConn._connection;i.ffz_cap_patched||(i.ffz_cap_patched=!0,i._send("CAP REQ :twitch.tv/membership"),i.on("opened",function(){this._send("CAP REQ :twitch.tv/membership")},i)),e.on("notice",function(e){if("msg_slowmode"===e.msgId){var i=/in (\d+) seconds/.exec(e.message);i&&t.updateWait(parseInt(i[1]))}if("msg_timedout"===e.msgId){var i=/for (\d+) more seconds/.exec(e.message);i&&(t.set("ffz_banned",!0),t.updateWait(parseInt(i[1])))}if("msg_banned"===e.msgId&&(t.set("ffz_banned",!0),s._roomv&&s._roomv.ffzUpdateStatus()),"hosts_remaining"===e.msgId){var i=/(\d+) host command/.exec(e.message);i&&(t.set("ffz_hosts_left",parseInt(i[1]||0)),s._cindex&&s._cindex.ffzUpdateHostButton())}}),e._roomConn._connection.off("message",e._roomConn._onIrcMessage,e._roomConn),e._roomConn._onIrcMessage=function(e){if(e.target==this.ircChannel)switch(e.command){case"JOIN":this._session&&this._session.nickname===e.sender?this._onIrcJoin(e):s.settings.chatter_count&&t.ffzUpdateChatters(e.sender);break;case"PART":this._session&&this._session.nickname===e.sender?(this._resetActiveState(),this._connection._exitedRoomConn(),this._trigger("exited")):s.settings.chatter_count&&t.ffzUpdateChatters(null,e.sender)}},e._roomConn._connection.on("message",e._roomConn._onIrcMessage,e._roomConn),this.set("ffz_is_patched",!0)}}.observes("tmiRoom"),slowMode:function(){return this.get("slow")>0}.property("slow"),onSlowOff:function(){this.get("slowMode")||this.updateWait(0)}.observes("slowMode")})}},{"../constants":6,"../utils":53}],21:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils");o.prototype.setup_router=function(){if(this.log("Hooking the Ember router."),e.App){var t=this,s=n.ember_lookup("router:main");s&&s.reopen({ffzTransition:function(){if(t._force_refresh)return void(location.href=this.get("url"));try{document.body.setAttribute("data-current-path",App.get("currentPath"))}catch(e){t.error("ffzTransition: "+e)}}.on("didTransition")}),document.body.setAttribute("data-current-path",App.get("currentPath"))}},o.ws_commands.please_refresh=function(){this.log("Refreshing the page upon the next transition."),this._force_refresh=!0}},{"../utils":53}],22:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=(t("../constants"),"service:ember-twitch-presence@presence"),r=!1;o.settings_info.sidebar_followed_games={type:"select",options:{0:"Disabled",5:"Normal (5)",10:"Large (10)",999:"No Limit"},value:5,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},category:"Sidebar",no_mobile:!0,name:"Followed Games",help:"Display this number of followed games on the sidebar.",on_update:function(e){var t=n.ember_lookup("controller:games-following");t&&t.set("ffz_sidebar_games",e)}},o.settings_info.sidebar_hide_recommended_channels={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Hide Recommended Channels",help:"Hide the Recommended Channels section from the sidebar.",on_update:n.toggle_cls("ffz-hide-recommended-channels")},o.settings_info.sidebar_hide_promoted_games={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Hide Promoted Games",help:"Hide the Promoted Games section from the sidebar.",on_update:n.toggle_cls("ffz-hide-promoted-games")},o.settings_info.sidebar_hide_recommended_friends={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Hide Recommended Friends",help:"Hide the Recommended Friends section from the sidebar.",on_update:n.toggle_cls("ffz-hide-recommended-friends")},o.settings_info.sidebar_hide_friends_collapsed={type:"boolean",value:!1,category:"Sidebar",no_mobile:!1,name:"Hide Friends when Collapsed",help:"Hide your friends from the sidebar when it's collapsed.",on_update:n.toggle_cls("ffz-hide-friends-collapsed")},o.settings_info.sidebar_hide_more_at_twitch={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Hide More at Twitch",help:"Hide the More at Twitch section from the sidebar.",on_update:n.toggle_cls("ffz-hide-more-at-twitch")},o.settings_info.sidebar_disable_friends={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Disable Friends",help:"Hide the Friends UI entirely and set you as Invisible.",on_update:function(e){n.toggle_cls("ffz-hide-friends")(e);var t=n.ember_lookup(a);t&&(e?t.setInvisible&&t.setInvisible():r||t.setOnline&&t.setOnline())}},o.settings_info.sidebar_start_open={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Automatically Open Drawer",help:"Open the drawer at the bottom of the sidebar by default when the page is loaded."},o.settings_info.sidebar_directly_to_followed_channels={type:"boolean",value:!1,category:"Sidebar",no_mobile:!0,name:"Open Following to Channels",help:"When going to your Following directory, view the Live Channels tab by default."},o.prototype.setup_sidebar=function(){if(n.toggle_cls("ffz-hide-promoted-games")(this.settings.sidebar_hide_promoted_games),n.toggle_cls("ffz-hide-recommended-channels")(this.settings.sidebar_hide_recommended_channels),n.toggle_cls("ffz-hide-recommended-friends")(this.settings.sidebar_hide_recommended_friends),n.toggle_cls("ffz-hide-friends-collapsed")(this.settings.sidebar_hide_friends_collapsed),n.toggle_cls("ffz-hide-more-at-twitch")(this.settings.sidebar_hide_more_at_twitch),n.toggle_cls("ffz-hide-friends")(this.settings.sidebar_disable_friends),this.settings.sidebar_disable_friends)try{var t=n.ember_lookup(a);t&&(r=t.get("isInvisible")||!1,t.setInvisible&&t.setInvisible())}catch(s){e.dumberror=s,this.error("Setting Friends Visibility",s)}var i=n.ember_lookup("controller:games-following");i?(this.log("Hooking the Ember games-following controller."),i.reopen({ffz_sidebar_games:this.settings.sidebar_followed_games,sidePanelFollowing:function(){var e=this.get("liveFollowing.sortedContent"),t=this.get("ffz_sidebar_games");return 999===t?e:_.first(e,t)}.property("liveFollowing.@each","ffz_sidebar_games")}),Ember.propertyDidChange(i,"sidePanelFollowing")):this.error("Unable to load the Ember games-following controller.",null);var o=n.ember_lookup("controller:navigation");o?this.settings.sidebar_start_open&&o.set("isDrawerOpen",!0):this.error("Unable to load the Ember navigation controller.",null),this._views_to_update&&this.update_views("view:navigation",this.modify_navigation,!0)},o.prototype.setup_following_link=function(){var e=this,t=document.body.querySelector("#header_following");t&&(t.href="/directory/following"+(e.settings.sidebar_directly_to_followed_channels?"/live":""),t.addEventListener("click",function(s){t.href="/directory/following"+(e.settings.sidebar_directly_to_followed_channels?"/live":"")}))},o.prototype.modify_navigation=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){t._nav=this;var e=this.get("element"),s=e&&e.querySelector('a[data-href="following"]');s&&(s.href="/directory/following"+(t.settings.sidebar_directly_to_followed_channels?"/live":""),s.addEventListener("click",function(e){s.href="/directory/following"+(t.settings.sidebar_directly_to_followed_channels?"/live":"");var i=n.ember_lookup("router:main");if(i&&(!e||0===e.button&&!e.ctrlKey&&!e.metaKey))return i.transitionTo("directory.following."+(t.settings.sidebar_directly_to_followed_channels?"channels":"index")),e.stopImmediatePropagation(),e.preventDefault(),!1}))},ffz_destroy:function(){t._nav===this&&(t._nav=null)}})}},{"../constants":6,"../utils":53}],23:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=[["staff","Staff"],["admins","Admins"],["global_mods","Global Moderators"],["moderators","Moderators"],["viewers","Viewers"]];o.settings_info.sort_viewers={type:"boolean",value:!0,category:"Chat Appearance",name:"Sort Viewer List",help:"Make sure the viewer list is alphabetically sorted and place the Broadcaster in their own category."},o.prototype.setup_viewers=function(){this.update_views("component:chat/twitch-chat-viewers",this.modify_viewer_list)},o.prototype.modify_viewer_list=function(e){var t=this;n.ember_reopen_view(e,{lines:function(){var e=this._super();if(!t.settings.sort_viewers)return this._super();try{var e=[],s=!1,i=this.get("model.chatters")||{},r=n.ember_lookup("controller:channel"),l=this.get("model.id"),c=r&&r.get("model.id");if(c){var d=r.get("model.display_name");d&&(o.capitalization[c]=[d,Date.now()])}l!==c&&(c=null);for(var h=0;h<a.length;h++){var f=i[a[h][0]],u=a[h][1],_=!0;if(f&&f.length)for(var m=0;m<f.length;m++)f[m]!==c?(_&&(e.push({category:i18n(u)}),e.push({chatter:""}),_=!1),e.push({chatter:o.get_capitalization(f[m])})):s=!0}return s&&e.splice(0,0,{category:i18n("Broadcaster")},{chatter:""},{chatter:o.get_capitalization(c)}),e}catch(g){return t.error("ViewersController lines: "+g),this._super()}}.property("model.chatters")})}},{"../utils":53}],24:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");o.prototype.setup_vod_chat=function(){var e=this,t=n.ember_lookup("service:vod-chat-service");t?t.reopen({messageBufferSize:e.settings.scrollback_length,pushMessage:function(e){if(null===e.get("color")){var t=this.get("colorSettings"),s=e.get("from");t.get(s)||t.set(s,a.CHAT_COLORS[Math.floor(Math.random()*a.CHAT_COLORS.length)]),e.set("color",t.get(s))}this.get("messages").pushObject(e);var i=this.get("messages"),o=this.get("messages.length"),n=this.get("messageBufferSize");o>n&&i.removeAt(0,o-n)}}):e.error("Unable to locate VOD Chat Service."),this.update_views("component:vod-right-column",this.modify_vod_right_column),this.update_views("view:vod",this.modify_vod_view),this.update_views("component:vod-chat-display",this.modify_vod_chat_display)},o.prototype.modify_vod_view=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){t._vodv=this;var e=this.get("context.channel.name");if(t.settings.auto_theater){var s=t.players&&t.players[e]&&t.players[e].get("player");s&&s.setTheatre(!0)}this._ffz_scroller=this.ffzOnScroll.bind(this),jQuery(this.get("element")).parents(".tse-scroll-content").on("scroll",this._ffz_scroller)},ffz_destroy:function(){t._vodv===this&&(t._vodv=null),this._ffz_scroller&&(jQuery(this.get("element")).parents(".tse-scroll-content").off("scroll",this._ffz_scroller),this._ffz_scroller=null)},ffzOnScroll:function(e){var s=e&&e.target&&e.target.scrollTop,i=this.get("layout.playerSize.1");s||(s=jQuery(this.get("element")).parents(".tse-scroll-content").scrollTop()),document.body.classList.toggle("ffz-small-player",t.settings.small_player&&s>=i)}})},o.prototype.modify_vod_right_column=function(e){var t=this;n.ember_reopen_view(e,{ffz_init:function(){if(t.settings.dark_twitch){var e=this.get("element"),s=e&&e.querySelector(".chat-container");s&&s.classList.add("dark")}}})},o.prototype.modify_vod_chat_display=function(t){var s=this,i=n.ember_lookup("service:vod-chat-service");n.ember_reopen_view(t,{_prepareToolTips:function(){this.$(".tooltip").tipsy({live:!0,gravity:n.tooltip_placement(a.TOOLTIP_DISTANCE,"s")})},ffz_init:function(){s._vodc=this;var e=this.get("video.channel.name");e&&!s.rooms[e]&&s.load_room(e),this.ffz_frozen=!1,s.settings.chat_hover_pause&&this.ffzEnableFreeze()},ffz_destroy:function(){s._vodc===this&&(s._vodc=void 0),this.ffzDisableFreeze()},ffzEnableFreeze:function(){var e=this.get("chatMessagesScroller");e&&(this._ffz_interval=setInterval(this.ffzPulse.bind(this),200),this._ffz_mouse_move=this.ffzMouseMove.bind(this),this._ffz_mouse_out=this.ffzMouseOut.bind(this),e.on("mousemove",this._ffz_mouse_move),e.on("touchmove",this._ffz_mouse_move),e.on("mouseout",this._ffz_mouse_out))},ffzDisableFreeze:function(){this._ffz_interval&&(clearInterval(this._ffz_interval),this._ffz_interval=void 0),this.ffzUnfreeze();var e=this.get("chatMessagesScroller");e&&(this._ffz_mouse_move&&(e.off("mousemove",this._ffz_mouse_move),e.off("touchmove",this._ffz_mouse_move),this._ffz_mouse_move=void 0),this._ffz_mouse_out&&(e.off("mouseout",this._ffz_mouse_out),this._ffz_mouse_out=void 0))},ffzUnfreeze:function(e){this.ffz_frozen=!1,this._ffz_last_move=0,this.ffzUnwarnPaused(),!e&&this.get("stuckToBottom")&&this._scrollToBottom()},ffzPulse:function(){if(this.ffz_frozen){var e=Date.now()-this._ffz_last_move;e>750&&this.ffzUnfreeze()}},ffzMouseOut:function(e){this._ffz_outside=!0;var t=this;setTimeout(function(){t._ffz_outside&&t.ffzUnfreeze()},25)},ffzMouseMove:function(e){this._ffz_last_move=Date.now(),this._ffz_outside=!1,(e.screenX!==this._ffz_last_screenx||e.screenY!==this._ffz_last_screeny)&&(this._ffz_last_screenx=e.screenX,this._ffz_last_screeny=e.screenY,this.ffz_frozen||(this.ffz_frozen=!0,this.get("stuckToBottom")&&(i&&i.set("messageBufferSize",s.settings.scrollback_length+150),this.ffzWarnPaused())))},_scrollToBottom:_.throttle(function(){var t=this,s=t.get("chatMessagesScroller");s&&s.length&&Ember.run.next(function(){(e.requestAnimationFrame||setTimeout)(function(){t.ffz_frozen||(s[0].scrollTop=s[0].scrollHeight,t._setStuckToBottom(!0))})})},300),_setStuckToBottom:function(e){this.set("stuckToBottom",e),i&&i.set("messageBufferSize",s.settings.scrollback_length+(e?0:150)),e||this.ffUnfreeze(!0)},ffzWarnPaused:function(){var e=this.get("element"),t=e&&e.querySelector(".chat-interface .more-messages-indicator.ffz-freeze-indicator");if(e){if(!t){t=document.createElement("div"),t.className="more-messages-indicator ffz-freeze-indicator",t.innerHTML="(Chat Paused Due to Mouse Movement)";var s=e.querySelector(".chat-interface");if(!s)return;s.insertBefore(t,s.childNodes[0])}t.classList.remove("hidden")}},ffzUnwarnPaused:function(){var e=this.get("element"),t=e&&e.querySelector(".chat-interface .more-messages-indicator.ffz-freeze-indicator");t&&t.classList.add("hidden")}})}},{"../constants":6,"../utils":53}],25:[function(t,s,i){{var o=e.FrankerFaceZ,n=t("../utils");t("../constants")}o.prototype.setup_ember_wrapper=function(){this._views_to_update=[],
this._ember_finalized=!1},o.prototype.update_views=function(e,t,s,i){var o;if("string"==typeof e){if(o=e,e=n.ember_resolve(e),!e&&s&&("function"==typeof s?s.call(this,e,t):(e=Ember.Component.extend({}),App.__registry__.register(o,e))),!e)return this.error("Unable to locate the Ember "+o),!1}else o=e.toString();return this._ember_finalized||i?this._update_views([[o,e,t]]):this._views_to_update.push([o,e,t]),!0},o.prototype.finalize_ember_wrapper=function(){this._ember_finalized=!0;var e=this._views_to_update;this._views_to_update=null,this._update_views(e)},o.prototype._update_views=function(e){this.log("Updating Ember classes and instances.",e);for(var t=0,s=0,i=0;i<e.length;i++){e[i][2].call(this,e[i][1]),s++;try{e[i][1].create().destroy()}catch(o){this.log('There was an error creating and destroying an instance of the Ember class "'+e[i][0]+'" to clear its cache.',o)}}var a=n.ember_views();for(var r in a){var l=a[r];if(l)for(var i=0;i<e.length;i++)if(l instanceof e[i][1]){t++;try{l.ffz_modified||e[i][2].call(this,l),(l.ffz_update||l.ffz_init).call(l)}catch(o){this.error("An error occured when updating an existing Ember instance of: "+e[i][0],o)}break}}this.log("Updated "+n.number_commas(t)+" existing instances across "+s+" classes.")}},{"../constants":6,"../utils":53}],26:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./constants"),a=t("./utils"),r=function(e){return e.margins||e.css?'img[data-ffz-emote="'+e.id+'"] { '+(e.margins?"margin: "+e.margins+";":"")+(e.css||"")+" }\n":""};o.prototype.setup_emoticons=function(){this.log("Preparing emoticon system."),this.emoji_data={},this.emoji_names={},this.emote_sets={},this.global_sets=[],this.default_sets=[],this._last_emote_id=0,this.emote_usage={},this.log("Creating emoticon style element.");var e=this._emote_style=document.createElement("style");if(e.id="ffz-emoticon-css",document.head.appendChild(e),this.log("Loading global emote sets."),this.load_global_sets(),this.log("Loading emoji data."),this.load_emoji_data(),this.log("Watching Twitch emoticon parser to ensure it loads."),this._twitch_emote_check=setTimeout(this.check_twitch_emotes.bind(this),1e4),this._apis)for(var t in this._apis){var s=this._apis[t];for(var i in s.emote_sets)this.emote_sets[i]=s.emote_sets[i];for(var o=0;o<s.global_sets.length;o++){var i=s.global_sets[o];-1===this.global_sets.indexOf(i)&&this.global_sets.push(i)}for(var o=0;o<s.default_sets.length;o++){var i=s.default_sets[o];-1===this.default_sets.indexOf(i)&&this.default_sets.push(i)}}},o.prototype.add_usage=function(e,t,s){var i=this.emote_sets[t.set_id];if(i&&!i.source_ext){var o=t.id,n=this.emote_usage[o]=this.emote_usage[o]||{};n[e]=(n[e]||0)+(s||1),this._emote_report_scheduled||(this._emote_report_scheduled=setTimeout(this._report_emotes.bind(this),3e4))}},o.prototype._report_emotes=function(){this._emote_report_scheduled&&delete this._emote_report_scheduled;var e=this.emote_usage;this.emote_usage={},this.ws_send("emoticon_uses",[e],function(){},!0)},o.prototype._click_emote=function(t,s){if(this.settings.clickable_emoticons&&(!s||(s.shiftKey||s.shiftLeft)&&t&&t.classList.contains("emoticon"))){var i=t.getAttribute("data-emote");if(i)e.open("https://twitchemotes.com/emote/"+i);else{i=t.getAttribute("data-ffz-emote");var o,n=t.getAttribute("data-ffz-set"),a=n&&this.emote_sets[n];if(!a)return;if(a.hasOwnProperty("source_ext")){var r=this._apis[a.source_ext];r&&r.emote_url_generator&&(o=r.emote_url_generator(a.source_id,i))}else o="https://www.frankerfacez.com/emoticons/"+i;if(o)return e.open(o),!0}}},o.prototype.check_twitch_emotes=function(){this._twitch_emote_check&&(clearTimeout(this._twitch_emote_check),delete this._twitch_emote_check);var e;if(this.rooms)for(var t in this.rooms)if(this.rooms.hasOwnProperty(t)){e=this.rooms[t];break}if(!e||!e.room||!e.room.tmiSession)return void(this._twitch_emote_check=setTimeout(this.check_twitch_emotes.bind(this),1e4));var s=e.room.tmiSession._emotesParser,i=Object.keys(s.emoticonRegexToIds).length;if(!(i>0)){var o=s.emoticonSetIds;s.emoticonSetIds="",s.updateEmoticons(o),this._twitch_emote_check=setTimeout(this.check_twitch_emotes.bind(this),1e4)}},o.prototype.getEmotes=function(e,t){var s=this.users&&this.users[e],i=this.rooms&&this.rooms[t];return _.union(s&&s.sets||[],i&&i.set&&[i.set]||[],i&&i.extra_sets||[],i&&i.ext_sets||[],this.default_sets)},o.ws_commands.reload_set=function(e){this.emote_sets.hasOwnProperty(e)&&this.load_set(e)},o.ws_commands.load_set=function(e){this.load_set(e)},o.prototype.load_emoji_data=function(t,s){var i=this,o=e.punycode&&punycode.ucs2;jQuery.getJSON(n.SERVER+"emoji/emoji-data.json").done(function(e){var s={},r={};for(var l in e){var c=e[l];if(l=l.toLowerCase(),c.code=l,s[l]=c,c.short_name&&(r[c.short_name]=l),c.names&&c.names.length)for(var d=0,h=c.names.length;h>d;d++)r[c.names[d]]=l;c.raw=_.map(c.code.split("-"),a.codepoint_to_emoji).join(""),c.tw_src=n.SERVER+"emoji/tw/"+l+".svg",c.noto_src=n.SERVER+"emoji/noto-"+l+".svg",c.one_src=n.SERVER+"emoji/one/"+l+".svg",c.token={type:"emoticon",imgSrc:!0,length:o?o.decode(c.raw).length:c.raw.length,tw_src:c.tw_src,noto_src:c.noto_src,one_src:c.one_src,tw:c.tw,noto:c.noto,one:c.one,ffzEmoji:l,altText:c.raw}}i.emoji_data=s,i.emoji_names=r,i.log("Loaded data on "+Object.keys(s).length+" emoji."),"function"==typeof t&&t(!0,e)}).fail(function(e){return 404===e.status?"function"==typeof t&&t(!1):(s=(s||0)+1,50>s?i.load_emoji(t,s):"function"==typeof t&&t(!1))})},o.prototype.load_global_sets=function(e,t){var s=this;jQuery.getJSON(n.API_SERVER+"v1/set/global").done(function(e){s.default_sets=e.default_sets;var t=s.global_sets=[],i=e.sets||{};s.feature_friday&&s.feature_friday.set&&(-1===s.global_sets.indexOf(s.feature_friday.set)&&s.global_sets.push(s.feature_friday.set),-1===s.default_sets.indexOf(s.feature_friday.set)&&s.default_sets.push(s.feature_friday.set));for(var o in i)if(i.hasOwnProperty(o)){var n=i[o];t.push(o),s._load_set_json(o,void 0,n)}}).fail(function(i){return 404==i.status?"function"==typeof e&&e(!1):(t=t||0,t++,50>t?s.load_global_sets(e,t):"function"==typeof e&&e(!1))})},o.prototype.load_set=function(e,t,s){var i=this;jQuery.getJSON(n.API_SERVER+"v1/set/"+e).done(function(s){i._load_set_json(e,t,s&&s.set)}).fail(function(o){return 404==o.status?"function"==typeof t&&t(!1):(s=s||0,s++,10>s?i.load_set(e,t,s):"function"==typeof t&&t(!1))})},o.prototype.unload_set=function(e){var t=this.emote_sets[e];if(t){if(this.log("Unloading emoticons for set: "+e),a.update_css(this._emote_style,e,null),delete this.emote_sets[e],t.hasOwnProperty("source_ext")){var s=this._apis[t.source_ext];s&&s.emote_sets&&s.emote_sets[e]&&(s.emote_sets[e]=void 0)}this._inputv&&Ember.propertyDidChange(this._inputv,"ffz_emoticons")}},o.prototype._load_set_json=function(e,t,s){if(!s)return"function"==typeof t&&t(!1);var i=this.emote_sets[e]&&this.emote_sets[e].users||[];this.emote_sets[e]=s,s.users=i,s.count=0;var o="",n=s.emoticons;s.emoticons={};for(var l=0;l<n.length;l++){var c=n[l];c.set_id=e,c.srcSet=c.urls[1]+" 1x",c.urls[2]&&(c.srcSet+=", "+c.urls[2]+" 2x"),c.urls[4]&&(c.srcSet+=", "+c.urls[4]+" 4x"),c.regex="!"===c.name[c.name.length-1]?new RegExp("(^|\\W|\\b)("+a.escape_regex(c.name)+")(?=\\W|$)","g"):new RegExp("(^|\\W|\\b)("+a.escape_regex(c.name)+")\\b","g"),c.token={type:"emoticon",srcSet:c.srcSet,imgSrc:c.urls[1],ffzEmote:c.id,ffzEmoteSet:e,altText:c.hidden?"???":c.name},o+=r(c),s.count++,s.emoticons[c.id]=c}a.update_css(this._emote_style,e,o+(s.css||"")),this.log("Updated emoticons for set #"+e+": "+s.title,s),this._cindex&&this._cindex.ffzFixTitle(),this.update_ui_link(),this._inputv&&Ember.propertyDidChange(this._inputv,"ffz_emoticons"),this.rerender_feed_cards(e),t&&t(!0,s)}},{"./constants":6,"./utils":53}],27:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=function(e){return e.margins||e.css?'img[src="'+e.urls[1]+'"]{'+(e.margins?"margin:"+e.margins+";":"")+(e.css||"")+"}":""};o.prototype.check_badware=function(){if(!this.embed_in_dash&&e.jQuery&&e.jQuery.noty&&o.settings_info.bttv_global_emotes&&"BetterTTV"===o.settings_info.bttv_global_emotes.category){var t=localStorage.ffz_warning_bttv4ffz_clone;"true"!==t&&(localStorage.ffz_warning_bttv4ffz_clone="true",this.show_message('You appear to be using an unofficial version of BTTV4FFZ that was copied without the developer\'s permission. Please use the official version available at <a href="https://lordmau5.com/bttv4ffz/">https://lordmau5.com/bttv4ffz/</a>'))}};var r=o.API=function(e,t,s,i,n){if(this.ffz=e||o.get(),t)for(var a in this.ffz._known_apis)if(this.ffz._known_apis[a]===t){this.id=a;break}if(!this.id){for(var r=0;!this.id;){if(!this.ffz._known_apis.hasOwnProperty(r)){this.id=r;break}r++}t&&(this.ffz._known_apis[this.id]=t,localStorage.ffz_known_apis=JSON.stringify(this.ffz._known_apis))}this.ffz._apis[this.id]=this,this.emote_sets={},this.global_sets=[],this.default_sets=[],this.badges={},this.users={},this.chat_filters=[],this.on_room_callbacks=[],this.name=t||"Extension#"+this.id,this.name_key=n||this.name.replace(/[^A-Z0-9_\-]/g,"").toLowerCase(),this.icon=s||null,this.version=i||null,this.ffz.log("Registered New Extension #"+this.id+": "+this.name)};o.prototype.api=function(e,t,s){if(!this._known_apis&&(this._known_apis={},localStorage.hasOwnProperty("ffz_known_apis")))try{this._known_apis=JSON.parse(localStorage.ffz_known_apis)}catch(i){this.log("Error loading Known APIs: "+i)}return new r(this,e,t,s)},r.prototype.log=function(e,t,s,i){this.ffz.log('Ext "'+this.name+'": '+e,t,s,i)},r.prototype._load_set=function(e,t,s){if(!s)return null;var i=[];this.emote_sets[e]&&this.emote_sets[e].users&&(i=this.emote_sets[e].users);var o={source:this.name,source_ext:this.id,source_id:t,users:i,count:0,emoticons:{},_type:s._type||0,css:s.css||null,description:s.description||null,icon:s.icon||this.icon||null,id:e,title:s.title||"Global Emoticons"};this.emote_sets[e]=o,this.ffz.emote_sets&&(this.ffz.emote_sets[e]=o);for(var r="",l=s.emoticons,c=o.emoticons,d=0;d<l.length;d++){var h=l[d],f={urls:{}},u=h.id||this.name+"-"+t+"-"+d;h.name&&(f.id=u,f.set_id=e,f.name=h.name,f.width=h.width,f.height=h.height,f.hidden=h.hidden,f.owner=h.owner,f.css=h.css,f.margins=h.margins,f.srcSet=h.urls[1]+" 1x",f.urls[1]=h.urls[1],h.urls[2]&&(f.urls[2]=h.urls[2],f.srcSet+=", "+h.urls[2]+" 2x"),h.urls[3]&&(f.urls[3]=h.urls[3],f.srcSet+=", "+h.urls[3]+" 3x"),h.urls[4]&&(f.urls[4]=h.urls[4],f.srcSet+=", "+h.urls[4]+" 4x"),f.regex=h.regex?h.regex:"string"!=typeof h.name?h.name:o.require_spaces||h.require_spaces?new RegExp("(^| )("+n.escape_regex(h.name)+")(?= |$)","g"):new RegExp("(^|\\W|\\b)("+n.escape_regex(h.name)+")(?=\\W|$)","g"),f.token={type:"emoticon",srcSet:f.srcSet,imgSrc:f.urls[1],ffzEmote:u,ffzEmoteSet:e,altText:f.hidden?"???":f.name},r+=a(f),o.count++,c[u]=f)}n.update_css(this.ffz._emote_style,e,r+(o.css||"")),this.ffz._cindex&&this.ffz._cindex.ffzFixTitle();try{this.ffz.update_ui_link()}catch(_){}return o},r.prototype.load_set=function(e,t){var s=this.id+"-"+e;return t.title=t.title||"Global Emoticons",t._type=t._type||0,t=this._load_set(s,e,t),this.log("Loaded Emoticon Set #"+e+": "+t.title+" ("+t.count+" emotes)",t),t},r.prototype.unload_set=function(e){var t=this.id+"-"+e,s=this.emote_sets[t];if(s){if(this.unregister_global_set(e),n.update_css(this.ffz._emote_style,t,null),this.emote_sets[t]=void 0,this.ffz.emote_sets&&(this.ffz.emote_sets[t]=void 0),s.users){for(var i=0;i<s.users.length;i++){var o=s.users[i],a=this.ffz.rooms&&this.ffz.rooms[o];if(a){var r=a.ext_sets?a.ext_sets.indexOf(t):-1;-1!==r&&a.ext_sets.splice(r,1)}}s.users=[]}return s}},r.prototype.get_set=function(e){var t=this.id+"-"+e;return this.emote_sets[t]},r.prototype.register_global_set=function(e,t){var s=this.id+"-"+e;if(t=t?this.load_set(e,t):this.emote_sets[s],!t)throw new Error("Invalid set ID");this.ffz.emote_sets[s]||(this.ffz.emote_sets[s]=t),-1===this.global_sets.indexOf(s)&&this.global_sets.push(s),-1===this.default_sets.indexOf(s)&&this.default_sets.push(s),this.ffz.global_sets&&-1===this.ffz.global_sets.indexOf(s)&&this.ffz.global_sets.push(s),this.ffz.default_sets&&-1===this.ffz.default_sets.indexOf(s)&&this.ffz.default_sets.push(s),this.ffz._inputv&&Ember.propertyDidChange(this.ffz._inputv,"ffz_emoticons")},r.prototype.unregister_global_set=function(e){var t=this.id+"-"+e,s=this.emote_sets[t];if(s){var i=this.global_sets.indexOf(t);-1!==i&&this.global_sets.splice(i,1),i=this.default_sets.indexOf(t),-1!==i&&this.default_sets.splice(i,1),i=this.ffz.global_sets?this.ffz.global_sets.indexOf(t):-1,-1!==i&&this.ffz.global_sets.splice(i,1),i=this.ffz.default_sets?this.ffz.default_sets.indexOf(t):-1,-1!==i&&this.ffz.default_sets.splice(i,1),this.ffz._inputv&&Ember.propertyDidChange(this.ffz._inputv,"ffz_emoticons")}},r.prototype.register_room_set=function(e,t,s){var i=this.id+"-"+t,o=this.ffz.rooms&&this.ffz.rooms[e];if(!o)throw new Error("Room not loaded");if(s?(s.title=s.title||"Channel: "+(o.display_name||e),s._type=s._type||1,s=this.load_set(t,s)):s=this.emote_sets[i],!s)throw new Error("Invalid set ID");this.ffz.emote_sets[i]||(this.ffz.emote_sets[i]=s),o.ext_sets&&o.ext_sets.push(i),s.users.push(e),this.ffz._inputv&&Ember.propertyDidChange(this.ffz._inputv,"ffz_emoticons")},r.prototype.unregister_room_set=function(e,t){var s=this.id+"-"+t,i=this.emote_sets[s],o=this.ffz.rooms&&this.ffz.rooms[e];if(i&&o){var n=o.ext_sets?o.ext_sets.indexOf(s):-1;-1!==n&&o.ext_sets.splice(n,1),n=i.users.indexOf(e),-1!==n&&i.users.splice(n,1),this.ffz._inputv&&Ember.propertyDidChange(this.ffz._inputv,"ffz_emoticons")}},r.prototype.add_badge=function(e,t){var s=this.id+"-"+e,i={id:s,source_ext:this.id,source_id:e,alpha_image:t.alpha_image,color:t.color||"transparent",no_invert:t.no_invert,invert_invert:t.invert_invert,css:t.css,image:t.image,name:t.name,title:t.title,slot:t.slot,visible:t.visible,replaces:t.replaces,replaces_type:t.replaces_type};this.ffz.badges[s]=this.badges[e]=i,n.update_css(this.ffz._badge_style,s,n.badge_css(i))},r.prototype.remove_badge=function(e){var t=this.id+"-"+e;this.ffz.badges[t]=this.badges[e]=void 0,n.update_css(this.ffz._badge_style,t)},r.prototype.user_add_badge=function(e,t,s){var i=this.users[e]=this.users[e]||{},o=this.ffz.users[e]=this.ffz.users[e]||{},n=i.badges=i.badges||{},a=o.badges=o.badges||{},r=this.id+"-"+s,l={id:r};n[t]=a[t]=l},r.prototype.user_remove_badge=function(e,t){var s=this.users[e]=this.users[e]||{},i=this.ffz.users[e]=this.ffz.users[e]||{},o=s.badges=s.badges||{},n=i.badges=i.badges||{};o[t]=n[t]=null},r.prototype.user_add_set=function(e,t){var s=this.users[e]=this.users[e]||{},i=this.ffz.users[e]=this.ffz.users[e]||{},o=s.sets=s.sets||[],n=i.sets=i.sets||[],a=this.id+"-"+t;-1===o.indexOf(a)&&o.push(a),-1===n.indexOf(a)&&n.push(a);var s=this.ffz.get_user();this.ffz._inputv&&s&&s.login===e&&Ember.propertyDidChange(this.ffz._inputv,"ffz_emoticons")},r.prototype.user_remove_set=function(e,t){var s=this.users[e],i=this.ffz.users[e],o=s&&s.sets,n=i&&i.sets,a=this.id+"-"+t,r=o?o.indexOf(a):-1;-1!==r&&o.splice(r,1),r=n?n.indexOf(a):-1,-1!==r&&n.splice(r,1);var s=this.ffz.get_user();this.ffz._inputv&&s&&s.login===e&&Ember.propertyDidChange(this.ffz._inputv,"ffz_emoticons")},r.prototype.register_chat_filter=function(e){this.chat_filters.push(e),this.ffz._chat_filters.push(e)},r.prototype.unregister_chat_filter=function(e){var t=this.chat_filters.indexOf(e);-1!==t&&this.chat_filters.splice(t,1),t=this.ffz._chat_filters.indexOf(e),-1!==t&&this.ffz._chat_filters.splice(t,1)},r.prototype._room_callbacks=function(e,t,s){var i=this.register_room_set.bind(this,e);if(s)try{s(e,i)}catch(o){this.log("Error in On-Room Callback: "+o)}else for(var n=0;n<this.on_room_callbacks.length;n++){var a=this.on_room_callbacks[n];try{a(e,i)}catch(o){this.log("Error in On-Room Callback: "+o)}}},r.prototype.register_on_room_callback=function(e,t){if(this.on_room_callbacks.push(e),!t&&this.ffz.rooms)for(var s in this.ffz.rooms)this._room_callbacks(s,this.ffz.rooms[s],e)},r.prototype.unregister_on_room_callback=function(e){var t=this.on_room_callbacks.indexOf(e);-1!==t&&this.on_room_callbacks.splice(t,1)}},{"../utils":53}],28:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils"),r=Object.prototype.hasOwnProperty;o.prototype.find_bttv=function(t,s){return this.has_bttv=!1,e.BTTVLOADED?this.setup_bttv(s||0):void(s>=6e4?this.log("BetterTTV was not detected after 60 seconds."):setTimeout(this.find_bttv.bind(this,t,(s||0)+t),t))},o.prototype.setup_bttv=function(e){this.log("BetterTTV was detected after "+e+"ms. Hooking."),this.has_bttv=!0,document.body.classList.remove("ffz-dark"),this._dark_style&&(this._dark_style.parentElement.removeChild(this._dark_style),this._dark_style=void 0),this._layout_style&&(this._layout_style.parentElement.removeChild(this._layout_style),this._layout_style=void 0),this._chat_style&&(a.update_css(this._chat_style,"chat_font_size",""),a.update_css(this._chat_style,"chat_ts_font_size","")),this.is_dashboard&&(this._update_subscribers(),this._remove_dash_chart()),document.body.classList.add("ffz-bttv");var t=BetterTTV.settings.get("darkenedMode");document.body.classList.toggle("ffz-bttv-dark",t),setInterval(function(){var e=BetterTTV.settings.get("darkenedMode");e!==t&&(document.body.classList.toggle("ffz-bttv-dark",e),t=e)},500),this._chatv&&(this.settings.group_tabs&&this._chatv.ffzDisableTabs(),this._chatv.ffzTeardownMenu(),this._chatv.ffzUnloadHost()),this._roomv&&(this.settings.chat_hover_pause&&this._roomv.ffzDisableFreeze(),this.settings.room_status&&this._roomv.ffzUpdateStatus()),this.disconnect_extra_chat(),this.toggle_style("chat-setup"),this.toggle_style("chat-padding"),this.toggle_style("chat-background"),this.toggle_style("chat-separator"),this.toggle_style("chat-separator-3d"),this.toggle_style("chat-separator-3d-inset"),this.toggle_style("chat-separator-wide"),this.toggle_style("chat-colors-gray"),this.toggle_style("badges-rounded"),this.toggle_style("badges-circular"),this.toggle_style("badges-blank"),this.toggle_style("badges-circular-small"),this.toggle_style("badges-transparent"),this.toggle_style("badges-sub-notice"),this.toggle_style("badges-sub-notice-on");var s=document.body.classList;s.remove("ffz-transparent-badges"),s.remove("ffz-sidebar-swap"),s.remove("ffz-portrait"),s.remove("ffz-minimal-channel-title"),s.remove("ffz-flip-dashboard"),this.settings.following_count&&(this._schedule_following_count(),this._draw_following_count(),this._draw_following_channels());var i=this,o=BetterTTV.chat,l=o.helpers.sendMessage;o.helpers.sendMessage=function(e){var t=e.split(" ",1)[0].toLowerCase();return"/ffz"!==t?l(e):void i.run_ffz_command(e.substr(5),o.store.currentRoom)};var c,d=o.handlers.onPrivmsg;o.handlers.onPrivmsg=function(e,t){c=e;var s=d(e,t);return c=null,s};var h=o.templates.privmsg;o.templates.privmsg=function(e,t){try{return t=t||{},i.bttv_badges(e),'<div class="chat-line'+(t.highlight?" highlight":"")+(t.action?" action":"")+(t.server?" admin":"")+(t.notice?" notice":"")+'" data-sender="'+(e.sender||"").toLowerCase()+'" data-room="'+c+'">'+o.templates.timestamp(e.time)+" "+(t.isMod?o.templates.modicons():"")+" "+o.templates.badges(e.badges)+o.templates.from(e.nickname,e.color)+o.templates.message(e.sender,e.message,{emotes:e.emotes,colored:t.action&&!t.highlight?e.color:!1,bits:e.bits})+"</div>"}catch(s){return i.log("Error: ",s),h(e,t)}};var f=o.templates.whisper;o.templates.whisper=function(e){try{return i.bttv_badges(e),'<div class="chat-line whisper" data-sender="'+e.sender+'">'+o.templates.timestamp(e.time)+" "+(e.badges&&e.badges.length?o.templates.badges(e.badges):"")+o.templates.whisperName(e.sender,e.receiver,e.from,e.to,e.fromColor,e.toColor)+o.templates.message(e.sender,e.message,{emotes:e.emotes,colored:!1})+"</div>"}catch(t){return i.log("Error: ",t),f(e)}};var u,_=o.templates.message;o.templates.message=function(e,t,s){try{s=s||{};var n=s.colored||!1,a=s.force||!1,r=s.emotes,l=s.bits,c=encodeURIComponent(t);if("jtv"!==e){u=e;var d=o.templates.emoticonize(t,r);u=null;for(var h=0;h<d.length;h++)d[h]="string"==typeof d[h]?o.templates.bttvMessageTokenize(e,d[h],l):d[h][0];t=d.join(" ")}var f=!1;return BetterTTV.settings.get("hideSpam")&&o.helpers.isSpammer(e)&&!o.helpers.isModerator(e)&&!a&&(t='<span class="deleted">&lt;spam deleted&gt;</span>',f=!0),'<span class="message '+(f?"spam":"")+'" '+(n?'style="color: '+n+'" ':"")+'data-raw="'+c+'" data-bits="'+(l?encodeURIComponent(JSON.stringify(l)):"false")+'" data-emotes="'+(r?encodeURIComponent(JSON.stringify(r)):"false")+'">'+t+"</span>"}catch(m){return i.log("Error: ",m),_(e,t,r,n)}};var m=function(e){for(var t=i.settings.parse_emoji,s=[],o=e.split(n.EMOJI_REGEX),r=null;o.length;)if(r=(r||"")+o.shift(),o.length){var l=o.shift(),c=a.emoji_to_codepoint(l),d=i.emoji_data[c],h=d&&(3===t?d.one_src:2===t?d.noto_src:d.tw_src);if(h){if(r&&r.length&&s.push(r),0===t)s.push([d.raw]);else{var f=a.quote_attr(d.raw);s.push(['<img class="emoticon emoji ffz-tooltip" height="18px" data-ffz-emoji="'+c+'" src="'+a.quote_attr(h)+'" alt="'+f+'">'])}r=null}else r=(r||"")+l}return r&&r.length&&s.push(r),s},g=o.templates.emoticonize;o.templates.emoticonize=function(e,t){for(var s,o=g(e,t),n=c||BetterTTV.getChannel(),l=n&&n.toLowerCase(),d=u&&u.toLowerCase(),h=i.getEmotes(d,l),t={},f=i.get_user(),_=[],p=f&&f.login===d,v=0;v<h.length;v++){var b=i.emote_sets[h[v]];if(b&&b.emoticons)for(var y in b.emoticons)s=b.emoticons[y],r.call(t,s.name)||(t[s.name]=s)}for(var v=0,w=o.length;w>v;v++){var z=o[v];if("string"==typeof z){for(var k,C=z.split(" "),x=[],T=0,S=C.length;S>T;T++)if(k=C[T],r.call(t,k)){if(s=t[k],x.length){for(var E=m(x.join(" ")+" "),M=0;M<E.length;M++)_.push(E[M]);x=[]}_.push(['<img class="emoticon ffz-tooltip" data-ffz-set="'+s.set_id+'" data-ffz-emote="'+s.id+'" srcset="'+a.quote_attr(s.srcSet||"")+'" src="'+a.quote_attr(s.urls[1])+'" alt="'+a.quote_attr(s.name)+'">']),p&&l&&i.add_usage(l,s),x.push("")}else x.push(k);if(x.length>1||1===x.length&&""!==x[0])for(var E=m(x.join(" ")+" "),M=0;M<E.length;M++)_.push(E[M])}else _.push(z)}return _},this.update_ui_link()}},{"../constants":6,"../utils":53}],29:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils");o.prototype.find_emote_menu=function(t,s){return this.has_emote_menu=!1,e.emoteMenu&&emoteMenu.registerEmoteGetter?this.setup_emote_menu(s||0):void(s>=6e4?this.log("Emote Menu for Twitch was not detected after 60 seconds."):setTimeout(this.find_emote_menu.bind(this,t,(s||0)+t),t))},o.prototype.setup_emote_menu=function(e){this.log("Emote Menu for Twitch was detected after "+e+"ms. Registering emote enumerator."),emoteMenu.registerEmoteGetter("FrankerFaceZ",this._emote_menu_enumerator.bind(this))},o.prototype._emote_menu_enumerator=function(){for(var e=this.get_user(),t=e?e.login:null,s=n.ember_lookup("controller:chat"),i=s?s.get("currentRoom.id"):null,o=this.getEmotes(t,i),a=[],r=0;r<o.length;r++){var l=this.emote_sets[o[r]];if(l&&l.emoticons)for(var c in l.emoticons)if(l.emoticons.hasOwnProperty(c)){var d=l.emoticons[c];if(!d.hidden){var h=(l.source||"FrankerFaceZ")+" "+l.title,f=l.icon||"//cdn.frankerfacez.com/script/devicon.png";a.push({text:d.name,url:d.urls[1],hidden:!1,channel:h,badge:f})}}}return a}},{"../utils":53}],30:[function(t,s,i){var o=e.FrankerFaceZ;o.settings_info.warp_world={type:"boolean",value:!0,category:"Channel Metadata",name:"Warp World <small>(Requires Refresh)</small>",help:'Automatically load <a href="https://warp.world" target="_blank">Warp World</a> when viewing a channel that uses Warp World.'},o.ws_commands.warp_world=function(t){if(t&&this.settings.warp_world){var s=document.querySelector("script#ww_script");s||e.WarpWorld||(s=document.createElement("script"),s.id="ww_script",s.src="//cdn.warp.world/twitch_script/main.min.js?_="+Date.now(),document.head.appendChild(s))}}},{}],31:[function(t,s,i){var o=e.FrankerFaceZ=function(){o.instance=this,this._log_data=[],this._apis={},this._chat_filters=[];var t=this;e.addEventListener("error",function(e){e.error&&t.error("Uncaught JavaScript Error",e.error)}),this.initialize()};o.get=function(){return o.instance},o.msg_commands={};var n=o.version_info={major:3,minor:5,revision:271,toString:function(){return[n.major,n.minor,n.revision].join(".")+(n.extra||"")}};o.prototype.log=function(e,t,s,i){s&&(e=e+" -- "+JSON.stringify(t)),this._log_data.push(e+(!s&&i?" -- "+JSON.stringify(t):"")),void 0!==t&&console.groupCollapsed&&console.dir?(console.groupCollapsed("%cFFZ:%c "+e,"color:#755000; font-weight: bold","color:black; font-weight: normal"),"string"==typeof t||-1!==navigator.userAgent.indexOf("Firefox/")?console.log(t):console.dir(t),console.groupEnd("%cFFZ:%c "+e,"color:#755000; font-weight: bold","color:black; font-weight: normal")):console.log("%cFFZ:%c "+e,"color:#755000; font-weight: bold","color:black; font-weight: normal")},o.prototype.error=function(e,t,s,i){var o=t&&t.stack||t;if(e="Error: "+e+" ["+t+"]"+(s?" -- "+JSON.stringify(o):""),this._log_data.push(e+(!s&&i?" -- "+JSON.stringify(o):"")),void 0===o){var n=new Error;o=n.stack}void 0!==o&&console.groupCollapsed&&console.dir?(console.groupCollapsed("%cFFZ "+e,"color:red"),"string"==typeof o||-1!==navigator.userAgent.indexOf("Firefox/")?console.log(o):console.dir(o),console.groupEnd("%cFFZ "+e,"color:red")):console.log("%cFFZ "+e,"color:red")},o.prototype.paste_logs=function(){this._pastebin(this._log_data.join("\n"),function(e){return e?void console.log("FFZ: Your FrankerFaceZ log has been pasted to: "+e):console.log("FFZ Error: Unable to upload log to pastebin.")})},o.prototype._pastebin=function(e,t){jQuery.ajax({url:"https://putco.de/",type:"PUT",data:e,context:this}).success(function(e){t.call(this,e.trim()+".log")}).fail(function(e){t.call(this,null)})},o.prototype.get_user=function(t){if(!t&&this.__user)return this.__user;var s=o.utils.ember_lookup("service:login"),i=s?s.get("userData"):void 0;return!i&&e.PP&&PP.login&&(i=PP),i&&(this.__user=i),i},o.prototype._editor_of=null,o.prototype.get_user_editor_of=function(){var e=this;return new Promise(function(t,s){var i=e.get_user();return i&&i.login?void jQuery.get("/"+i.login+"/dashboard/permissions").done(function(i){try{var o=(new DOMParser).parseFromString(i,"text/html"),n=o.querySelectorAll("#editable .label");e._editor_of=_.map(n,function(e){var t=e.getAttribute("href");return t&&t.substr(t.lastIndexOf("/")+1)}),t(e._editor_of)}catch(a){e.error("Failed to parse User Editor State",a),s()}}).fail(function(t){e.error("Failed to load User Editor State",t),s()}):s()})},t("./localization"),t("./ui/menu"),t("./settings"),t("./socket"),t("./colors"),t("./emoticons"),t("./badges"),t("./tokenize"),t("./ember/wrapper"),t("./ember/router"),t("./ember/bits"),t("./ember/channel"),t("./ember/player"),t("./ember/room"),t("./ember/vod-chat"),t("./ember/layout"),t("./ember/line"),t("./ember/chatview"),t("./ember/conversations"),t("./ember/viewers"),t("./ember/moderation-card"),t("./ember/chat-input"),t("./ember/directory"),t("./ember/following"),t("./ember/feed-card"),t("./ember/sidebar"),t("./debug"),t("./ext/betterttv"),t("./ext/emote_menu"),t("./featurefriday"),t("./ui/popups"),t("./ui/styles"),t("./ui/dark"),t("./ui/tooltips"),t("./ui/notifications"),t("./ui/viewer_count"),t("./ui/sub_count"),t("./ui/dash_stats"),t("./ui/dash_feed"),t("./ui/menu_button"),t("./ui/following"),t("./ui/following-count"),t("./ui/races"),t("./ui/my_emotes"),t("./ui/about_page"),t("./commands"),t("./ext/api"),t("./ext/warpworld"),o.prototype.initialize=function(e,t){if("passport.twitch.tv"===location.hostname||/^\/user\/two_factor/.test(location.pathname))return this.log("Found authentication sub-page. Not initializing.");if(-1!==["im.twitch.tv","api.twitch.tv"].indexOf(location.hostname)||/^\/products\//.test(location.pathname))return this.log("Found banned sub-domain. Not initializing.");if("player.twitch.tv"===location.hostname)return void this.init_player(t);if(/^\/(?:$|search$|team\/|user\/|p\/|settings|m\/|messages?\/)/.test(location.pathname))return void this.init_normal(t);if(/\/[^\/]+\/dashboard/.test(location.pathname)&&!/bookmarks$/.test(location.pathname))return void this.init_dashboard(t);var s=o.utils.ember_resolve("model:room");return s?void this.init_ember(t):(e=e||10,void(t>=6e4?this.log('Twitch application not detected in "'+location.toString()+'". Aborting.'):setTimeout(this.initialize.bind(this,e,(t||0)+e),e)))},o.prototype.init_player=function(t){var s=e.performance&&performance.now?performance.now():Date.now();this.log("Found Twitch Player after "+(t||0)+" ms at: "+location),this.log("Initializing FrankerFaceZ version "+o.version_info),this.users={},this.is_dashboard=!1;try{this.embed_in_dash=e.top!==e&&/\/[^\/]+\/dashboard/.test(e.top.location.pathname)&&!/bookmarks$/.test(e.top.location.pathname)}catch(i){this.embed_in_dash=!1}this.load_settings(),this.setup_dark(),this.setup_css(),this.setup_player();var n=e.performance&&performance.now?performance.now():Date.now(),a=n-s;this.log("Initialization complete in "+a+"ms")},o.prototype.init_normal=function(t,s){var i=e.performance&&performance.now?performance.now():Date.now();this.log("Found non-Ember Twitch after "+(t||0)+" ms at: "+location),this.log("Initializing FrankerFaceZ version "+o.version_info),this.users={},this.is_dashboard=!1;try{this.embed_in_dash=e.top!==e&&/\/[^\/]+\/dashboard/.test(e.top.location.pathname)&&!/bookmarks$/.test(e.top.location.pathname)}catch(n){this.embed_in_dash=!1}this.load_settings(),this.setup_dark(),this.setup_css(),this.setup_popups(),this.setup_following_link(),s||(this.setup_time(),this.ws_create()),this.setup_colors(),this.setup_emoticons(),this.setup_badges(),this.setup_sidebar(),this.setup_notifications(),this.setup_following_count(!1),this.setup_menu(),this.setup_message_event(),this.fix_tooltips(),this.find_bttv(10);var a=e.performance&&performance.now?performance.now():Date.now(),r=a-i;this.log("Initialization complete in "+r+"ms")},o.prototype.is_dashboard=!1,o.prototype.init_dashboard=function(t){var s=e.performance&&performance.now?performance.now():Date.now();this.log("Found Twitch Dashboard after "+(t||0)+" ms at: "+location),this.log("Initializing FrankerFaceZ version "+o.version_info);var i=location.pathname.match(/\/([^\/]+)/);this.dashboard_channel=i&&i[1]||void 0,this.users={},this.is_dashboard=!0,this.embed_in_dash=!1,this.load_settings(),this.setup_dark(),this.setup_css(),this.setup_popups(),this.setup_following_link(),this.setup_time(),this.ws_create(),this.setup_colors(),this.setup_emoticons(),this.setup_badges(),this.setup_tokenization(),this.setup_notifications(),this.setup_following_count(!1),this.setup_menu(),this.setup_dash_stats(),this.setup_dash_feed(),this._update_subscribers(),this.setup_message_event(),this.fix_tooltips(),this.find_bttv(10);var n=e.performance&&performance.now?performance.now():Date.now(),a=n-s;this.log("Initialization complete in "+a+"ms")},o.prototype.init_ember=function(t){var s=e.performance&&performance.now?performance.now():Date.now();this.log("Found Twitch application after "+(t||0)+" ms at: "+location),this.log("Initializing FrankerFaceZ version "+o.version_info),this.users={},this.is_dashboard=!1;try{this.embed_in_dash=e.top!==e&&/\/[^\/]+\/dashboard/.test(e.top.location.pathname)&&!/bookmarks$/.test(e.top.location.pathname)}catch(i){this.embed_in_dash=!1}var n=o.utils.ember_lookup("controller:settings");n&&void 0===n.get("settings")&&n.reopen({settings:Ember.computed.alias("model")}),this.load_settings(),this.setup_ember_wrapper(),this.setup_dark(),this.setup_css(),this.setup_popups(),this.setup_time(),this.ws_create(),this.setup_emoticons(),this.setup_badges(),this.setup_router(),this.setup_colors(),this.setup_tokenization(),this.setup_player(),this.setup_channel(),this.setup_room(),this.setup_vod_chat(),this.setup_line(),this.setup_bits(),this.setup_layout(),this.setup_chatview(),this.setup_conversations(),this.setup_viewers(),this.setup_mod_card(),this.setup_chat_input(),this.setup_directory(),
this.setup_profile_following(),this.setup_feed_cards(),this.setup_sidebar(),this.setup_notifications(),this.setup_menu(),this.setup_my_emotes(),this.setup_following(),this.setup_following_count(!0),this.setup_races(),this.finalize_ember_wrapper(),this.fix_tooltips(),this.connect_extra_chat(),this.setup_message_event(),this.find_bttv(10),this.find_emote_menu(10),setTimeout(this.check_badware.bind(this),1e4),this.check_ff(),this.refresh_chat();var a=e.performance&&performance.now?performance.now():Date.now(),r=a-s;this.log("Initialization complete in "+r+"ms")},o.prototype.setup_message_event=function(){this.log("Listening for Window Messages."),e.addEventListener("message",this._on_window_message.bind(this),!1)},o.prototype._on_window_message=function(e){var t=e.data;if("string"==typeof t)try{t=JSON.parse(t)}catch(s){return}if(t&&t.from_ffz){var i=o.msg_commands[t.command];i?i.call(this,t.data):this.log("Invalid Message: "+t.command,t.data,!1,!0)}}},{"./badges":2,"./colors":3,"./commands":4,"./debug":7,"./ember/bits":8,"./ember/channel":9,"./ember/chat-input":10,"./ember/chatview":11,"./ember/conversations":12,"./ember/directory":13,"./ember/feed-card":14,"./ember/following":15,"./ember/layout":16,"./ember/line":17,"./ember/moderation-card":18,"./ember/player":19,"./ember/room":20,"./ember/router":21,"./ember/sidebar":22,"./ember/viewers":23,"./ember/vod-chat":24,"./ember/wrapper":25,"./emoticons":26,"./ext/api":27,"./ext/betterttv":28,"./ext/emote_menu":29,"./ext/warpworld":30,"./featurefriday":32,"./localization":33,"./settings":34,"./socket":35,"./tokenize":36,"./ui/about_page":37,"./ui/dark":38,"./ui/dash_feed":39,"./ui/dash_stats":40,"./ui/following":42,"./ui/following-count":41,"./ui/menu":43,"./ui/menu_button":44,"./ui/my_emotes":45,"./ui/notifications":46,"./ui/popups":47,"./ui/races":48,"./ui/styles":49,"./ui/sub_count":50,"./ui/tooltips":51,"./ui/viewer_count":52}],32:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./constants"),a=t("./utils");o.prototype.feature_friday=null,o.prototype.check_ff=function(e){e||this.log("Checking for Feature Friday data..."),jQuery.ajax(n.SERVER+"script/event.json?_="+(n.DEBUG?Date.now():o.version_info),{dataType:"json",context:this}).done(function(e){return this._load_ff(e)}).fail(function(t){return 404==t.status?this._load_ff(null):(e=e||0,e++,10>e?setTimeout(this.check_ff.bind(this,e),250):this._load_ff(null))})},o.ws_commands.reload_ff=function(){this.check_ff()},o.prototype._feature_friday_ui=function(e,t,s){if(this.feature_friday&&this.feature_friday.channel!==e){this._emotes_for_sets(t,s,[this.feature_friday.set],this.feature_friday.title,this.feature_friday.icon,"FrankerFaceZ");var i=a.ember_lookup("controller:channel");if(this.feature_friday.channel&&(!i||i.get("id")!==this.feature_friday.channel)){var o=this.feature_friday,n=document.createElement("div"),r=document.createElement("a");n.className="chat-menu-content",n.style.textAlign="center";var l=o.display_name+(o.live?" is live now!":"");r.className="button primary",r.classList.toggle("live",o.live),r.classList.toggle("blue",this.has_bttv&&BetterTTV.settings.get("showBlueButtons")),r.href="//www.twitch.tv/"+o.channel,r.title=l,r.target="_new",r.innerHTML="<span>"+l+"</span>",n.appendChild(r),t.appendChild(n)}}},o.prototype._load_ff=function(e){this.feature_friday&&(this.global_sets.removeObject(this.feature_friday.set),this.default_sets.removeObject(this.feature_friday.set),this.feature_friday=null,this.update_ui_link()),e&&e.set&&(this.feature_friday={set:e.set,channel:e.channel,live:!1,title:e.title||"Feature Friday",icon:e.icon,display_name:e.channel?o.get_capitalization(e.channel,this._update_ff_name.bind(this)):e.title||"Feature Friday"},this.global_sets.push(e.set),this.default_sets.push(e.set),this.load_set(e.set),this._update_ff_live())},o.prototype._update_ff_live=function(){if(this.feature_friday&&this.feature_friday.channel){var e=this;a.api.get("streams/"+this.feature_friday.channel).done(function(t){e.feature_friday.live=null!=t.stream,e.update_ui_link()}).always(function(){e.feature_friday.timer=setTimeout(e._update_ff_live.bind(e),12e4)})}},o.prototype._update_ff_name=function(e){this.feature_friday&&(this.feature_friday.display_name=e)}},{"./constants":6,"./utils":53}],33:[function(t,s,i){var o=e.FrankerFaceZ;o.prototype.tr=function(e){return e}},{}],34:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./constants"),a=t("./utils"),r=t("./FileSaver"),l=document.createElement.bind(document),c=function(e){return"ffz_setting_"+e},d=function(e,t,s){var i=this.settings.favorite_settings.indexOf(t);-1===i?(this.settings.favorite_settings.push(t),e.setAttribute("original-title","Unfavorite this Setting"),e.classList.add("active")):(this.settings.favorite_settings.splice(i,1),e.setAttribute("original-title","Favorite this Setting"),e.classList.remove("active")),jQuery(e).trigger("mouseout").trigger("mouseover"),this.settings.set("favorite_settings",this.settings.favorite_settings)},h=function(e,t,s){var i=!(s.get?"function"==typeof s.get?s.get.call(this):this.settings.get(s.get):this.settings.get(t));"function"==typeof s.set?s.set.call(this,i):this.settings.set(s.set||t,i),e.classList.toggle("active",i)},f=function(e,t,s){var i=JSON.parse(e.options[e.selectedIndex].value);"function"==typeof s.set?s.set.call(this,i):this.settings.set(s.set||t,i)};o.settings_info={advanced_settings:{value:!1,visible:!1}},o.basic_settings={},o.prototype.load_settings=function(){this.log("Loading settings."),this.settings={},this.settings.get=this._setting_get.bind(this),this.settings.set=this._setting_set.bind(this),this.settings.del=this._setting_del.bind(this),this.settings.load=this._setting_load.bind(this);var t=!1;for(var s in o.settings_info)if(o.settings_info.hasOwnProperty(s)){{var i=o.settings_info[s];i&&i.storage_key||c(s)}t=t||localStorage.hasOwnProperty(s),this._setting_load(s)||t}e.addEventListener("storage",this._setting_update.bind(this),!1)},o.prototype.reset_settings=function(){if(confirm(this.tr("Are you sure you wish to reset FrankerFaceZ?\n\nThis will force the tab to refresh."))){for(var t in o.settings_info)o.settings_info.hasOwnProperty(t)&&this.settings.del(t);this.aliases={},localStorage.ffz_aliases="{}",e.location.reload()}},o.prototype._get_settings_object=function(){var e={version:1,script_version:o.version_info+"",aliases:this.aliases,filters:this.filters,settings:{}};for(var t in o.settings_info)if(o.settings_info.hasOwnProperty(t)){var s=o.settings_info[t],i=s.storage_key||c(t);localStorage.hasOwnProperty(i)&&(e.settings[t]=this.settings[t])}return e},o.prototype.save_settings_file=function(){var e=this._get_settings_object(),t=new Blob([JSON.stringify(e,null,4)],{type:"application/json;charset=utf-8"});r.saveAs(t,"ffz-settings.json")},o.prototype.load_settings_file=function(e){if("string"==typeof e)this._load_settings_file(e);else{var t=new FileReader,s=this;t.onload=function(e){s._load_settings_file(e.target.result)},t.readAsText(e)}},o.prototype._load_settings_file=function(e,t){if("string"==typeof e)try{e=JSON.parse(e)}catch(s){return this.error("Error Loading Settings: "+s),t||alert("There was an error attempting to read the provided settings data."),[-1,-1,-1]}this.log("Loading Settings Data",e);var i=[],n=[],a=0;if(e.settings)for(var r in e.settings)if(o.settings_info.hasOwnProperty(r)){var l=o.settings_info[r],c=e.settings[r];l.process_value&&(c=l.process_value.call(this,c)),c!==this.settings.get(r)&&this.settings.set(r,c),n.push(r)}else i.push(r);if(e.aliases){for(var r in e.aliases)this.aliases[r]!==e.aliases[r]&&(this.aliases[r]=e.aliases[r],a++);a&&(localStorage.ffz_aliases=JSON.stringify(this.aliases))}return e.filters,t||setTimeout(function(){alert("Successfully loaded "+n.length+" settings and skipped "+i.length+" settings. Added "+a+" user nicknames.")}),[n.length,i.length,a]};var u=-1!==navigator.userAgent.indexOf("Android"),_=function(e,t,s,i){return function(o,r){var c=this,_={},m=[];if(i){var g=a.createElement("div","ffz-filter-container"),p=a.createElement("input","emoticon-selector__filter-input js-filter-input text text--full-width"),v=a.createElement("div","ffz-filter-children ffz-ui-sub-menu-page");p.placeholder="Search for Settings",p.type="text",v.style.maxHeight=parseInt(r.style.maxHeight)-51+"px",g.appendChild(p),r.appendChild(v),r.appendChild(g),r=v,p.addEventListener("input",function(e){var t=p.value||"",s=v.querySelectorAll(".chat-menu-content");t=t.toLowerCase();for(var i=0;i<s.length;i++){for(var o=s[i],n=o.querySelectorAll(".ffz-setting"),a=!0,r=0;r<n.length;r++){var l=n[r],c=t.length&&-1===l.getAttribute("data-filter").indexOf(t);l.classList.toggle("hidden",c),a=a&&c}var d=o.querySelector(".bttv-incompatibility"),n=d&&d.querySelectorAll("b"),h=!0;if(d){for(var r=0;r<n.length;r++){var l=n[r],c=t.length&&-1===l.getAttribute("data-filter").indexOf(t);l.classList.toggle("hidden",c),h=h&&c}d.classList.toggle("hidden",h),a=a&&h}o.classList.toggle("collapsable",!t.length),o.classList.toggle("hidden",a)}})}for(var b in e){var y=e[b],w=y.category||"Miscellaneous",z=_[w];if(y.hasOwnProperty("visible")){var k=y.visible;if("function"==typeof k&&(k=k.call(this)),!k)continue}u&&y.no_mobile||(z||(m.push(w),z=_[w]=[]),z.push([b,y]))}m.sort(function(e,t){var e=e.toLowerCase(),t=t.toLowerCase();return"debugging"===e&&(e="zzz"+e),"debugging"===t&&(t="zzz"+t),t>e?-1:e>t?1:0});for(var C=s?this[s]||!0:m[0],x=0;x<m.length;x++){var T=m[x],S=_[T],E=[],M=0,L=l("div"),A=l("div");A.className="heading",L.className="chat-menu-content",L.setAttribute("data-category",T),t&&(L.classList.add("collapsable"),L.classList.toggle("collapsed",C!==T),L.addEventListener("click",function(e){var t=this;if(t.classList.contains("collapsable")){if(t.classList.contains("collapsed"))jQuery(".chat-menu-content:not(.collapsed)",r).addClass("collapsed"),t.classList.remove("collapsed"),s&&(c[s]=t.getAttribute("data-category"));else{if(!e.target.classList.contains("heading"))return;t.classList.add("collapsed"),s&&(c[s]=!0)}setTimeout(function(){t.scrollIntoViewIfNeeded()})}})),A.innerHTML=T,L.appendChild(A),S.sort(function(e,t){var e=e[1],t=t[1],s=2,i=2,o=e.name.toLowerCase(),n=t.name.toLowerCase();return i>s?-1:s>i?1:n>o?-1:o>n?1:0});for(var O=0;O<S.length;O++){var b=S[O][0],y=S[O][1],I=l("p"),R=l("a"),F=y.get?"function"==typeof y.get?y.get.call(this):this.settings.get(y.get):this.settings.get(b);if(I.className="ffz-setting clearfix",this.has_bttv&&y.no_bttv)E.push([y.name,y.help]);else{if(i){var H=-1!==this.settings.favorite_settings.indexOf(b);R.className="pin-switch html-tooltip",R.classList.toggle("active",H),R.addEventListener("click",d.bind(this,R,b,y)),R.title=(H?"Unf":"F")+"avorite this Setting",R.innerHTML=n.STAR}if("boolean"===y.type){var D=l("a"),j=l("span");D.className="switch",D.classList.toggle("active",F),D.appendChild(l("span")),j.className="switch-label",j.innerHTML=y.name,I.appendChild(D),i&&I.appendChild(R),I.appendChild(j),D.addEventListener("click",h.bind(this,D,b,y))}else if("select"===y.type){var P=l("select"),j=l("span");j.className="option-label",j.innerHTML=y.name;var N=[];for(var B in y.options){var U=l("option"),q=y.options[B],V=0;U.value=JSON.stringify(B),F==B&&U.setAttribute("selected",!0),"object"==typeof q?(U.innerHTML=q[0],V=q[1]):U.innerHTML=q,N.push([V,U])}N.sort(function(e,t){return e[0]-t[0]});for(var W=0;W<N.length;W++)P.appendChild(N[W][1]);P.addEventListener("change",f.bind(this,P,b,y)),i&&I.appendChild(R),I.appendChild(j),I.appendChild(P)}else{if("function"!=typeof y.method)continue;I.classList.add("option");var Z=l("a");Z.innerHTML=y.name,Z.href="#",i&&I.appendChild(R),I.appendChild(Z),Z.addEventListener("click",y.method.bind(this))}if(y.help||y.experiment_warn||this.has_bttv&&y.warn_bttv){var G=document.createElement("span");G.className="help";var Q=[];y.experiment_warn&&Q.push('<b>Note:</b> This affects an active Twitch experiment. Give feedback at: <a href="mailto:feedback@twitch.tv">feedback@twitch.tv</a>'),this.has_bttv&&y.warn_bttv&&Q.push("<i>"+y.warn_bttv+"</i>"),y.help&&Q.push(y.help),G.innerHTML=Q.join("<br>"),I.appendChild(G)}I.setAttribute("data-filter",I.textContent.toLowerCase()),M++,L.appendChild(I)}}if(M){if(E.length){var I=l("p"),j=l("span"),G=l("span");I.className="bttv-incompatibility clearfix disabled",j.className="switch-label",j.innerHTML="Features Incompatible with BetterTTV",G.className="help";for(var O=0;O<E.length;O++){var K=E[O],$=K[0].toLowerCase()+(K[1]?" "+K[1].toLowerCase():"");G.innerHTML+='<b data-filter="'+a.quote_attr($)+'"'+(K[1]?' class="html-tooltip" title="'+a.quote_attr(K[1])+'"':"")+">"+K[0]+"</b>"}I.appendChild(j),I.appendChild(G),L.appendChild(I)}r.appendChild(L)}}}},m=_(o.basic_settings,!1,"_ffz_basic_settings_page"),g=_(o.settings_info,!0,"_ffz_settings_page",!0);o.settings_info.favorite_settings={value:[],hidden:!0},o.menu_pages.settings={name:"Settings",icon:n.GEAR,sort_order:99999,wide:!0,default_page:function(){return this.settings.favorite_settings.length?"favorites":this.settings.advanced_settings?"advanced":"basic"},pages:{favorites:{name:"Favorites",sort_order:1,render:function(e,t){var s=this.settings.favorite_settings,i=0;if(this.has_bttv)for(var n=0;n<s.length;n++)o.settings_info[s[n]].no_bttv||i++;else i=s.length;if(!i){var r=a.createElement("div");return r.className="emoticon-grid ffz-no-emotes center",r.innerHTML='You have no favorite settings.<br><img src="//cdn.frankerfacez.com/emoticon/26608/2"><br>To make a setting a favorite, find it on the <nobr>Advanced</nobr> tab and click the star icon to the right.',void t.appendChild(r)}for(var l={},n=0,c=s.length;c>n;n++){var d=s[n],h=o.settings_info[d];h&&(l[d]=h)}return _(l,!1,"_ffz_favorite_settings_page").call(this,e,t)}},basic:{name:"Basic",sort_order:2,render:function(e,t){return this.settings.set("advanced_settings",!1),m.call(this,e,t)}},advanced:{name:"Advanced",sort_order:3,render:function(e,t){return this.settings.set("advanced_settings",!0),g.call(this,e,t)}},backup:{name:"Backup & Restore",sort_order:4,render:function(e,t){var s=l("div"),i=l("div"),o=l("div"),n=l("div"),a=l("div"),r=l("div"),c=l("p"),d=l("a"),h=l("span"),f=l("p"),u=l("input"),_=l("a"),m=l("span"),g=l("p"),p=l("a"),v=l("span"),b=this;n.className="chat-menu-content",s.className="heading",s.innerHTML="Backup Settings",n.appendChild(s),c.className="clearfix option",d.href="#",d.innerHTML="Save to File",d.addEventListener("click",this.save_settings_file.bind(this)),h.className="help",h.innerHTML="This generates a JSON file containing all of your settings and prompts you to save it.",c.appendChild(d),c.appendChild(h),n.appendChild(c),a.className="chat-menu-content",i.className="heading",i.innerHTML="Restore Settings",a.appendChild(i),f.className="clearfix option",u.type="file",u.addEventListener("change",function(){b.load_settings_file(this.files[0])}),_.href="#",_.innerHTML="Restore from File",_.addEventListener("click",function(e){e.preventDefault(),u.click()}),m.className="help",m.innerHTML="This loads settings from a previously generated JSON file.",f.appendChild(_),f.appendChild(m),a.appendChild(f),r.className="chat-menu-content",o.className="heading",o.innerHTML=this.tr("Reset Settings"),r.appendChild(o),g.className="clearfix option",p.href="#",p.innerHTML=this.tr("Reset FrankerFaceZ"),p.addEventListener("click",this.reset_settings.bind(this)),v.className="help",v.innerHTML=this.tr("This resets all of your FFZ data. That includes chat filters, nicknames for users, and settings."),g.appendChild(p),g.appendChild(v),r.appendChild(g),t.appendChild(n),t.appendChild(a),t.appendChild(r)}}}},o.prototype._setting_update=function(t){if(t||(t=e.event),t.key&&"ffz_setting_"===t.key.substr(0,12)){var s=t.key,i=s.substr(12),n=void 0,a=o.settings_info[i];if(!a){for(i in o.settings_info)if(o.settings_info.hasOwnProperty(i)&&(a=o.settings_info[i],a.storage_key==s))break;if(a.storage_key!=s)return}this.log("Updated Setting: "+i);try{n=JSON.parse(t.newValue)}catch(r){this.log('Error loading new value for "'+i+'": '+r),n=a.value||void 0}if(a.process_value)try{n=a.process_value.call(this,n)}catch(r){return void this.log('Error processing value for setting "'+i+'": '+r)}if(this.settings[i]=n,a.on_update)try{a.on_update.call(this,n,!1)}catch(r){this.log('Error running updater for setting "'+i+'": '+r)}}},o.prototype._setting_load=function(e,t){var s=o.settings_info[e],i=s&&s.storage_key||c(e),n=t||(s&&s.hasOwnProperty("value")?s.value:void 0);if(localStorage.hasOwnProperty(i))try{n=JSON.parse(localStorage.getItem(i))}catch(a){this.log('Error loading value for "'+e+'": '+a)}return s&&s.process_value&&(n=s.process_value.call(this,n)),this.settings[e]=n,n},o.prototype._setting_get=function(e){return!this.settings.hasOwnProperty(e)&&o.settings_info[e]&&this._setting_load(e),this.settings[e]},o.prototype._setting_set=function(e,t,s){var i=o.settings_info[e],n=i.storage_key||c(e);if(i.process_value)try{t=i.process_value.call(this,t)}catch(a){return this.log('Error processing value for setting "'+e+'": '+a),!1}this.settings[e]=t;var r=JSON.stringify(t);if(localStorage.setItem(n,r),s||this.log('Changed Setting "'+e+'" to: '+r),i.on_update)try{i.on_update.call(this,t,!0)}catch(a){this.log('Error running updater for setting "'+e+'": '+a)}},o.prototype._setting_del=function(e){var t=o.settings_info[e],s=t.storage_key||c(e),i=void 0;if(localStorage.hasOwnProperty(s)&&localStorage.removeItem(s),t&&(i=this.settings[e]=t.hasOwnProperty("value")?t.value:void 0),this.settings[e]=i,t.on_update)try{t.on_update.call(this,i,!0)}catch(n){this.log('Error running updater for setting "'+e+'": '+n)}}},{"./FileSaver":1,"./constants":6,"./utils":53}],35:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./constants"),a=t("./utils"),r=function(e){for(var t,s=0,i=e.length;i--;)s+=e[i][1];for(t=Math.random()*s,i=0;i<e.length;i++)if(t-=e[i][1],0>=t)return i;return e.length-1};o.prototype._ws_open=!1,o.prototype._ws_delay=0,o.prototype._ws_host_idx=-1,o.prototype._ws_current_pool=-1,o.prototype._ws_last_ping=null,o.prototype._ws_server_offset=null,o.ws_commands={},o.ws_on_close=[],o.settings_info.socket_server_pool={type:"select",options:{0:"Disabled",1:"Production",2:"Development"},value:1,process_value:function(e){return"string"==typeof e?parseInt(e)||0:e},visible:function(){return localStorage.hasOwnProperty("ffz_socket_server_pool")&&1!==this.settings.socket_server_pool||this.settings.developer_mode||Date.now()-parseInt(localStorage.ffzLastDevMode||"0")<6048e5},category:"Debugging",name:"Socket Server Cluster",help:"Select which cluster of socket servers to connect to.",on_update:function(e){if(e!==this._ws_current_pool){try{this._ws_sock.close()}catch(t){}this._ws_open=!1,this._ws_delay=0,this._ws_host_idx=-1,this._ws_recreate_timer&&(clearTimeout(this._ws_recreate_timer),this._ws_recreate_timer=null),0!==e&&this.ws_create()}}},o.prototype.ws_sub=function(e){return this._ws_topics=this._ws_topics||{},this._ws_topics[e]?!0:this._ws_open?(this.ws_send("sub",e),this._ws_topics[e]=!0,!0):!1},o.prototype.ws_unsub=function(e){return this._ws_topics=this._ws_topics||{},this._ws_topics[e]&&this._ws_open?(this.ws_send("unsub",e),this._ws_topics[e]=!1,!0):!0},o.prototype.ws_create=function(){var t,s=this;this._ws_last_req=1,this._ws_callbacks={1:s._ws_on_hello.bind(s)},this._ws_pending=this._ws_pending||[],this._ws_topics={},this._ws_recreate_timer=null;var i=this.settings.socket_server_pool,a=n.WS_SERVER_POOLS[i];if(this._ws_current_pool=i,a){this._ws_host_idx<0&&(this._ws_host_idx=r(a));var l=a[this._ws_host_idx][0];this.log("Using Socket Server: "+l+" ["+i+":"+this._ws_host_idx+"]");try{t=this._ws_sock=new WebSocket(l)}catch(c){return this._ws_exists=!1,this.log("Error Creating WebSocket: "+c)}this._ws_exists=!0,t.onopen=function(i){s._ws_open=!0,s._ws_delay=0,s.log("Socket Connected."),s._ws_ping_time=e.performance?performance.now():Date.now(),t.send("1 hello "+JSON.stringify(["ffz_"+o.version_info,localStorage.ffzClientId]));var n=s.get_user();if(n&&s.ws_send("setuser",n.login),s.is_dashboard){var a=location.pathname.match(/\/([^\/]+)/);a&&s.ws_sub("channel."+a[1])}for(var r in s.rooms){var l=s.rooms[r];s.rooms.hasOwnProperty(r)&&l&&l.important&&(s.ws_sub("room."+r),l.needs_history&&(l.needs_history=!1,!s.has_bttv&&s.settings.chat_history&&s.ws_send("chat_history",[r,25],s._load_history.bind(s,r))))}if(s._cindex){var c=s._cindex.get("controller.model.id"),d=s._cindex.get("controller.hostModeTarget.id");c&&s.ws_sub("channel."+c),d&&s.ws_sub("channel."+d)}var h=s._ws_pending;s._ws_pending=[];for(var f=0;f<h.length;f++){var u=h[f];s.ws_send(u[0],u[1],u[2])}if(s._ws_offline_time){var _=s._ws_offline_time;delete s._ws_offline_time,s.ws_send("ready",_)}else s.ws_send("ready",0)},t.onerror=function(){s._ws_offline_time||(s._ws_offline_time=(new Date).getTime())},t.onclose=function(e){var t=s._ws_open;if(s.log("Socket closed. (Code: "+e.code+", Reason: "+e.reason+")"),!s._ws_recreate_timer){s._ws_open=!1,s._ws_offline_time||(s._ws_offline_time=(new Date).getTime());for(var i=0;i<o.ws_on_close.length;i++)try{o.ws_on_close[i].bind(s)()}catch(n){s.log("Error on Socket Close Callback: "+n)}t||(s._ws_host_idx=-1),s._ws_delay<6e4?s._ws_delay+=1e3*(Math.floor(10*Math.random())+5):s._ws_delay=1e3*(Math.floor(60*Math.random())+30),s._ws_recreate_timer=setTimeout(s.ws_create.bind(s),s._ws_delay)}},t.onmessage=function(e){var t,i,n=e.data.indexOf(" "),a=e.data.substr(n+1),r=parseInt(e.data.slice(0,n));if(n=a.indexOf(" "),-1===n&&(n=a.length),t=a.slice(0,n),a=a.substr(n+1),a&&(i=JSON.parse(a)),-1===r){var l=o.ws_commands[t];l?l.bind(s)(i):s.log("Invalid command: "+t,i,!1,!0)}else{var c="ok"===t,d="function"==typeof s._ws_callbacks[r];if(d){try{s._ws_callbacks[r](c,i)}catch(h){s.error("Callback for "+r+": "+h)}delete s._ws_callbacks[r]}else s.log("Socket Reply to "+r+" - "+(c?"SUCCESS":"FAIL"),i,!1,!0)}}}},o.prototype.ws_send=function(e,t,s,i){if(!this._ws_open){if(i){var o=this._ws_pending=this._ws_pending||[];return o.push([e,t,s]),!0}return!1}var n=++this._ws_last_req;t=void 0!==t?" "+JSON.stringify(t):"",s&&(this._ws_callbacks[n]=s);try{this._ws_sock.send(n+" "+e+t)}catch(a){return this.log("Socket Send Error: "+a),!1}return n},o.prototype._ws_on_hello=function(e,t){return e?(this._ws_on_pong(e,t[1]),localStorage.ffzClientId=t[0],void this.log("Client ID: "+localStorage.ffzClientId)):this.log("Error Saying Hello: "+t)},o.prototype.setup_time=function(){var e=Date.now(),t=this;setInterval(function(){var s=Date.now(),i=s-e-5e3;e=s,Math.abs(i)>1e3&&(t.log("WARNING! Time drift of "+i+"ms across 5 seconds. Did the local time change?"),t._ws_server_offset=null,t.ws_ping())},5e3)},o.prototype.ws_ping=function(){this._ws_ping_time||(this._ws_ping_time=e.performance?performance.now():Date.now(),this.ws_send("ping",void 0,this._ws_on_pong.bind(this))||(this._ws_ping_time=null))},o.prototype._ws_on_pong=function(t,s){var i=Date.now(),o=e.performance?performance.now():i;if(!t)return this._ws_ping_time=null,void this.log("Error Pinging Server: "+s);if(this._ws_ping_time){var n=o-this._ws_ping_time,r=this._ws_last_ping=n/2;this._ws_ping_time=null,this._ws_server_offset=i-(s+r),this.log("Server Time: "+new Date(s).toISOString()),this.log("Local Time: "+new Date(i).toISOString()),this.log("Estimated Ping: "+r+"ms"),this.log("Time Offset: "+(this._ws_server_offset<0?"-":"")+a.time_to_string(Math.abs(this._ws_server_offset)/1e3)),Math.abs(this._ws_server_offset)>3e5&&this.log("WARNING! The time offset with the server is greater than 5 minutes.")}},o.ws_commands.reconnect=function(){this.log("Socket Reconnect Command Received"),this._ws_open=!1,this._ws_sock.close();for(var e=0;e<o.ws_on_close.length;e++)try{o.ws_on_close[e].call(this)}catch(t){this.log("Error on Socket Close Callback: "+t)}this._ws_delay=1e3*Math.floor(5*Math.random()),this._ws_recreate_timer=setTimeout(this.ws_create.bind(this),this._ws_delay)},o.ws_commands.do_authorize=function(e){var t;for(var s in this.rooms)if(this.rooms.hasOwnProperty(s)){var i=this.rooms[s];if(i&&i.room&&!i.room.get("roomProperties.eventchat")&&!i.room.get("isGroupRoom")&&i.room.tmiRoom){var n=i.room.tmiRoom._getConnection();if(n.isConnected){t=n;break}}}t?t._send("PRIVMSG #frankerfacezauthorizer :AUTH "+e):setTimeout(o.ws_commands.do_authorize.bind(this,e),5e3)}},{"./constants":6,"./utils":53}],36:[function(t,s,i){var o,n,a,r,l,c=e.FrankerFaceZ,d=t("./utils"),h=t("./constants"),f=Object.prototype.hasOwnProperty,u="<hr>This link has been sent to you via a whisper rather than standard chat, and has not been checked or approved of by any moderators or staff members. Please treat this link with caution and do not visit it if you do not trust the sender.",m=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},g=/(?:https?:\/\/)?(?:[-a-zA-Z0-9@:%_\+~#=]+\.)+[a-z]{2,6}\b(?:[-a-zA-Z0-9@:%_\+.~#?&\/\/=()]*)/g,p=/(?:https?:\/\/)?clips\.twitch\.tv\/(\w+)\/(\w+)/,v=/^(?:(https?):\/\/)?(?:(.*?)@)?([^\/:]+)(?::(\d+))?(.*?)(?:\?(.*?))?(?:\#(.*?))?$/,b=/^\/(?:gallery\/)?[A-Za-z0-9]+(?:\.(?:png|jpg|jpeg|gif|gifv|bmp))?$/,y=/\.(?:png|jpg|jpeg|gif|bmp)$/i,w=[],z=function(e,t){var s=e.match(v);if(s){var i=s[3].toLowerCase(),o=s[4],n=s[5];return o&&"80"!==o&&"443"!==o?!1:"i.imgur.com"===i||"imgur.com"===i||"www.imgur.com"===i||"m.imgur.com"===i?b.test(n):t?y.test(n):-1!==w.indexOf(i)}},k=function(e,t){return'<iframe class="ffz-image-hover'+(t?" "+t:"")+'" allowtransparency="true" src="'+h.SERVER+"script/img-proxy.html#"+d.quote_attr(e)+'"></iframe>'},C=function(e,t,s){t&&(this._link_data[e]=s,this.settings.link_info&&s.unsafe&&jQuery('a.chat-link[data-url="'+e+'"]').addClass("unsafe-link"))};c.SRC_IDS={},c.src_to_id=function(e){if(c.SRC_IDS.hasOwnProperty(e))return c.SRC_IDS[e];var t=/\/emoticons\/v1\/(\d+)\/1\.0/.exec(e),s=t?parseInt(t[1]):null;return Number.isNaN(s)&&(s=null),c.SRC_IDS[e]=s,s},c._emote_mirror_swap=function(e){var t,s=parseInt(e.getAttribute("data-alt-attempts"))||0;if(!(s>3)){e.setAttribute("data-alt-attempts",s+1);var i=e.getAttribute("data-emote"),t="//"+e.src.split("//")[1];t.substr(0,h.TWITCH_BASE.length)===h.TWITCH_BASE?(e.src=h.EMOTE_MIRROR_BASE+i+".png",e.srcset=""):(e.src=h.TWITCH_BASE+i+"/1.0",e.srcset=d.build_srcset(i))}};var x=new Date(0).toLocaleTimeString().toUpperCase(),T=-1===x.lastIndexOf("PM")&&-1===x.lastIndexOf("AM");c.settings_info.twenty_four_timestamps={type:"select",options:{0:"12-Hour"+(T?"":" (Default)"),1:"12-Hour Zero-Padded",2:"24-Hour"+(T?" (Default)":""),3:"24-Hour Zero-Padded"},value:T?2:0,process_value:function(e){return e===!1?0:e===!0?2:"string"==typeof e?parseInt(e)||0:e},category:"Chat Appearance",no_bttv:!0,name:"Timestamp Format",help:"Display timestamps in chat in the 24 hour format rather than 12 hour.",on_update:function(e){var t=d.ember_resolve("component:chat/chat-line"),s=t&&o&&o.getTime?d.ember_views():{};for(var i in s){var n=s[i];n instanceof t&&n.$(".timestamp").text(n.get("timestamp"))}}},c.settings_info.timestamp_seconds={type:"boolean",value:!1,category:"Chat Appearance",no_bttv:!0,name:"Timestamp Seconds",help:"Display seconds in chat timestamps."},c.settings_info.collect_bits={type:"boolean",value:!1,category:"Chat Appearance",no_bttv:!0,name:"Bits Stacking",help:"Collect all the bits emoticons in a message into a single one at the start of the message."},c.settings_info.show_deleted_links={type:"boolean",value:!1,category:"Chat Moderation",no_bttv:!0,name:"Show Deleted Links",help:"Do not delete links based on room settings or link length."},c.prototype.setup_tokenization=function(){this._twitch_emotes={},this._twitch_emote_to_set={},this._twitch_set_to_channel={},this._link_data={},this.load_twitch_emote_data();try{o=e.require&&e.require("web-client/helpers/chat/chat-line-helpers")}catch(t){}if(!o)return this.log("Unable to get chat helper functions.");try{r=e.require&&e.require("web-client/utilities/bits/tokenize")}catch(t){this.error("Unable to get bits tokenizer.",t)}l=d.ember_lookup("service:bits-rendering-config");try{n=e.require&&e.require("web-client/helpers/twitch-conversations/conversation-line-helpers")}catch(t){this.error("Unable to get conversation helper functions.",t)}try{a=e.require&&e.require("web-client/utilities/tmi-emotes")["default"]}catch(t){this.error("Unable to get tmi-emotes helper function.",t)}this.log("Hooking Ember chat line helpers.");var s=this;o.getTime=function(e){if(void 0===e||null===e)return"?:??"+(s.settings.timestamp_seconds?":??":"");var t=e.getHours(),i=e.getMinutes(),o=e.getSeconds(),n=s.settings.twenty_four_timestamps;return 2>n&&(t>12?t-=12:0===t&&(t=12)),((1===n||3===n)&&10>t?"0":"")+t+":"+(10>i?"0":"")+i+(s.settings.timestamp_seconds?":"+(10>o?"0":"")+o:"")},o.linkifyMessage=function(e,t){var i=s.settings.show_deleted_links;return _.chain(e).map(function(e){if("text"===e.type&&(e=e.text),!_.isString(e))return e;var s=e.match(g);return s&&s.length?_.zip(e.split(g),_.map(s,function(e){var s=e.length>255,o={type:"link",length:e.length,isDeleted:!i&&(t||s),isLong:s,isMailTo:e.indexOf("@")>-1&&(-1===e.indexOf("/")||e.indexOf("@")<e.indexOf("/")),text:e,link:e};return o.isMailTo||e.match(/^(?:https?:\/\/)/)||(o.link="http://"+e),o})):[e]}).flatten().compact().value()}},c.prototype.load_twitch_emote_data=function(e){jQuery.ajax(h.SERVER+"script/twitch_emotes.json",{context:this}).done(function(e){for(var t in e){var s=e[t];if(s){this._twitch_set_to_channel[t]=s.name;for(var i=0,o=s.emotes.length;o>i;i++)this._twitch_emote_to_set[s.emotes[i]]=t}}this._twitch_set_to_channel[0]="--global--",this._twitch_set_to_channel[33]="--turbo-faces--",this._twitch_set_to_channel[42]="--turbo-faces--"}).fail(function(t){404!==t.status&&(e=(e||0)+1,10>e&&setTimeout(this.load_twitch_emote_data.bind(this,e),1e3))})},c.prototype.render_tooltip=function(e){var t=this,s=function(){if(this.classList.contains("ffz-bit")){var e,s,i=parseInt(this.getAttribute("data-amount").replace(/,/g,"")),o=JSON.parse(this.getAttribute("data-individuals")||"null"),n=l.ffz_get_tier(i),a=d.number_commas(i)+" Bit"+d.pluralize(i);if(t.settings.emote_image_hover&&(e=l.ffz_get_preview(n[1])),o&&o.length>1){a+="<br>",o.sort().reverse();for(var r=0;r<o.length&&12>r;r++)a+=t.render_token(!1,!1,!0,{type:"bits",amount:o[r]});o.length>=12&&(a+="<br>(and "+(o.length-12)+" more)")}return s=e?'<img style="height:112px" class="emoticon ffz-image-hover" src="'+e+'"?_=preview">':"",s+a}if(this.classList.contains("emoticon")){var e,s,c,f,_,m=0,g=0,p=this.getAttribute("data-ffz-emote");if(p){if("93269"==p)return"";if(c=this.getAttribute("data-ffz-set"),_=t.emote_sets[c],f=_&&_.emoticons[p]){var v=f.owner,b=_.title||"Global",y=_.source||"FFZ";return t.settings.emote_image_hover?(f.urls[4]?(g=4*f.height,m=4*f.width,e=f.urls[4]):f.urls[2]&&(g=2*f.height,m=2*f.width),m>186&&(g*=186/m),g=Math.min(186,g)):e=null,s=e?'<img style="height:'+g+'px" class="emoticon ffz-image-hover" src="'+e+'"?_=preview">':"",s+"Emoticon: "+(f.hidden?"???":f.name)+"<br>"+y+" "+b+(v?"<br>By: "+v.display_name:"")}}if(p=this.getAttribute("data-emote")){c=t._twitch_emote_to_set[p],_=c&&t._twitch_set_to_channel[c];var w="Channel";return e=t.settings.emote_image_hover&&h.TWITCH_BASE+p+"/3.0",s=e?'<img style="height:112px" class="emoticon ffz-image-hover" src="'+e+'"?_=preview">':"","--global--"===_||"80393"===p?(_="Twitch Global",w=null):("--twitch-turbo--"===_||"turbo"===_||"--turbo-faces--"===_)&&(_="Twitch Turbo",w=null),this.classList.contains("ffz-tooltip-no-credit")?s+this.alt:s+"Emoticon: "+this.alt+"<br>"+(w?w+": ":"")+_}if(p=this.getAttribute("data-ffz-emoji")){f=t.emoji_data[p];var C=f&&(3===t.settings.parse_emoji?f.one_src:2===t.settings.parse_emoji?f.noto_src:f.tw_src);return e=t.settings.emote_image_hover&&C,s=e?'<img style="height:72px" class="emoticon ffz-image-hover" src="'+e+'"?_=preview">':"",s+"Emoji: "+this.alt+"<br>Name: "+f.name+(f.short_name?"<br>Short Name :"+f.short_name+":":"")+(f.cat?"<br>Category: "+d.sanitize(h.EMOJI_CATEGORIES[f.cat]||f.cat):"")}}else{if(this.classList.contains("email-link")){
var x=this.getAttribute("data-url");return x?"E-Mail "+x.substr(7):""}if(this.classList.contains("chat-link")){var x=this.getAttribute("data-url"),T=x&&t._link_data[x],e=null,S=!0,s="",E="";if(!x)return;return T&&T!==!0?(E=T.html,e=T.image,S=void 0!==T.image_iframe?T.image_iframe:!0):e=z(x,t.settings.image_hover_all_domains)?x:null,t.settings.link_image_hover&&e&&(s=S?k(x):'<img class="emoticon ffz-image-hover" src="'+d.quote_attr(e)+'">'),this.classList.contains("deleted-link")&&(E=x),this.classList.contains("warn-link")&&(E+=u),s+E}}return t.log("Unable to Build Tooltip For: "+this.className,this),""};return e?s(e):s},c.prototype.tokenize_conversation_line=function(e,t){var s=e.get("body"),i=this.get_user(),r=e.get("from.username"),l=i&&r===i.login,d=e.get("tags.emotes"),h=[s];n&&n.checkActionMessage&&(h=n.checkActionMessage(h)),a&&(d=a(d)),o&&o.linkifyMessage&&(h=o.linkifyMessage(h)),i&&i.login&&o&&o.mentionizeMessage&&(h=o.mentionizeMessage(h,i.login,l)),o&&o.emoticonizeMessage&&d&&this.settings.parse_emoticons&&(h=o.emoticonizeMessage(h,d)),h=this._remove_banned(h),this.settings.parse_emoticons&&2!==this.settings.parse_emoticons&&(h=this.tokenize_emotes(r,void 0,h,l)),this.settings.parse_emoji&&(h=this.tokenize_emoji(h));var f=e.get("from.displayName");return f&&f.length&&(c.capitalization[r]=[f.trim(),Date.now()]),l||(h=this.tokenize_mentions(h)),h},c.prototype.tokenize_vod_line=function(e,t){var s=e.get("cachedTokens");if(s)return s;var i=e.get("message"),n=e.get("room"),a=e.get("from"),r=this.get_user(),l=r&&a===r.login,d=e.get("tags.emotes"),h=[i];o&&o.linkifyMessage&&(h=o.linkifyMessage(h,t)),r&&r.login&&o&&o.mentionizeMessage&&(h=o.mentionizeMessage(h,r.login,l)),o&&o.emoticonizeMessage&&d&&this.settings.parse_emoticons&&(h=o.emoticonizeMessage(h,d)),h=this._remove_banned(h),this.settings.parse_emoticons&&2!==this.settings.parse_emoticons&&(h=this.tokenize_emotes(a,n,h,l)),this.settings.parse_emoji&&(h=this.tokenize_emoji(h));var f=e.get("tags.display-name");if(f&&f.length&&(c.capitalization[a]=[f.trim(),Date.now()]),!l){h=this.tokenize_mentions(h);for(var u=0;u<h.length;u++){var _=h[u];if("mention"===_.type&&!_.isOwnMessage){e.set("ffz_has_mention",!0);break}}}return e.set("cachedTokens",h),h},c.prototype.tokenize_chat_line=function(t,s,i){if(t.cachedTokens)return t.cachedTokens;var n=t.message,a=t.room,l=t.from,h=this.get_user(),f=h&&l===h.login,u=t.tags||{},_=u.emotes,m=[n];if(u.bits&&r&&r.tokenizeBits&&(m=r.tokenizeBits(m)),o&&o.linkifyMessage){var g=t.labels||[],p=-1!==g.indexOf("owner")||-1!==g.indexOf("staff")||-1!==g.indexOf("admin")||-1!==g.indexOf("global_mod")||-1!==g.indexOf("mod")||"admin"===t.style;m=o.linkifyMessage(m,i&&!p)}if(h&&h.login&&o&&o.mentionizeMessage&&(m=o.mentionizeMessage(m,h.login,f)),o&&o.emoticonizeMessage&&this.settings.parse_emoticons&&(m=o.emoticonizeMessage(m,_)),m=this._remove_banned(m),u.bits&&this.settings.collect_bits){for(var v=0,b=[],y=0;y<m.length;y++)m[y]&&"bits"===m[y].type&&(m[y].hidden=!0,v+=m[y].amount||0,b.push(m[y].amount));m.splice(0,0,{type:"bits",amount:v,individuals:b,length:0})}this.settings.parse_emoticons&&2!==this.settings.parse_emoticons&&(m=this.tokenize_emotes(l,a,m,f)),this.settings.parse_emoji&&(m=this.tokenize_emoji(m));var w=u["display-name"];if(w&&w.length&&(c.capitalization[l]=[w.trim(),Date.now()]),!f){m=this.tokenize_mentions(m);for(var y=0;y<m.length;y++){var z=m[y],k="mention"===z.type;if(k&&!z.isOwnMessage){if(t.ffz_has_mention=!0,a&&!this.has_bttv&&this._chatv){var C=this.rooms[a]&&this.rooms[a].room;if(C._ffz_tab&&!C._ffz_tab.classList.contains("active")){C._ffz_tab.classList.add("tab-mentioned");var x=C._ffz_tab.classList.contains("hidden");x&&(C._ffz_tab.classList.remove("hidden"),this._chatv.$(".chat-room").css("top",this._chatv._ffz_tabs.offsetHeight+"px"))}C._ffz_row&&!C._ffz_row.classList.contains("active")&&C._ffz_row.classList.add("row-mentioned")}if(this._chatv&&this.settings.highlight_notifications&&!this.embed_in_dash&&!document.hasFocus()&&!s){var T,C=this.rooms[a]&&this.rooms[a].room;if(this.settings.group_tabs&&(-1!==this.settings.pinned_rooms.indexOf(a)||this._chatv._ffz_host)||C.get("isGroupRoom")||C===this._chatv.get("controller.currentChannelRoom")){T=C&&C.get("isGroupRoom")?C.get("tmiRoom.displayName"):c.get_capitalization(a),w=w||Twitch.display.capitalize(l),n="action"===t.style?"* "+w+" "+n:w+": "+n;"whisper"===t.style?this.show_notification(n,"Twitch Chat Whisper","ffz_whisper_notice",1e3*this.settings.notification_timeout,function(){e.focus()}):this.show_notification(n,"Twitch Chat Mention in "+T,a,1e3*this.settings.notification_timeout,function(){e.focus();var t=d.ember_lookup("controller:chat");C&&t&&t.focusRoom(C)})}}break}}}return t.cachedTokens=m,m},c.prototype.tokenize_line=function(e,t,s,i,n){if("string"==typeof s&&(s=[s]),o&&o.linkifyMessage&&(s=o.linkifyMessage(s)),o&&o.mentionizeMessage){var a=this.get_user();a&&a.login&&(s=o.mentionizeMessage(s,a.login,e===a.login))}return!i&&this.settings.parse_emoticons&&2!==this.settings.parse_emoticons&&(s=this.tokenize_emotes(e,t,s)),this.settings.parse_emoji&&!n&&(s=this.tokenize_emoji(s)),s},c.prototype.tokenize_feed_body=function(e,t,s,i){"use strict";"string"==typeof e&&(e=[{type:"text",text:e}]),o&&o.linkifyMessage&&(e=o.linkifyMessage(e)),e=this.tokenize_emoji(e),o&&o.emoticonizeMessage&&this.settings.parse_emoticons&&(e=o.emoticonizeMessage(e,t));for(var n,a=[],r=0;r<e.length;r++)if(n=e[r]){if("string"!=typeof n){if("text"!==n.type){a.push(n);continue}n=n.text}for(var l=n.split(/\n/g);l.length;)a.push({type:"text",text:l.shift()}),l.length&&a.push({type:"raw",html:"</p><p>"})}return this.settings.parse_emoticons&&2!==this.settings.parse_emoticons&&(a=this.tokenize_emotes(s,i,a)),a},c.prototype.render_token=function(e,t,s,i){if(!i)return"";if(i.hidden)return"";if("raw"===i.type)return i.html;if("emoticon"===i.type){var o,n,a,r=i.imgSrc;if(i.ffzEmote){var f=this.emote_sets&&this.emote_sets[i.ffzEmoteSet],u=f&&f.emoticons&&f.emoticons[i.ffzEmote];o=u?u.srcSet:i.srcSet,a=(u?' data-ffz-emote="'+u.id+'"':"")+(f?' data-ffz-set="'+f.id+'"':"")}else if(i.ffzEmoji){var _=this.settings.parse_emoji;if(0===_||1===_&&!i.tw||2===_&&!i.noto||3===_&&!i.one)return i.altText;r=3===_?i.one_src:2===_?i.noto_src:i.tw_src,a=' data-ffz-emoji="'+i.ffzEmoji+'" height="18px"',n=" emoji"}else{var m=c.src_to_id(r),g=this.settings.replace_bad_emotes&&h.EMOTE_REPLACEMENTS[m];a=' data-emote="'+m+'" onerror="FrankerFaceZ._emote_mirror_swap(this)"',g?(r=h.EMOTE_REPLACEMENT_BASE+g,o=""):o=d.build_srcset(m)}return'<img class="emoticon ffz-tooltip'+(n||"")+'"'+(a||"")+' src="'+d.quote_attr(r)+'"'+(o?' srcset="'+d.quote_attr(o)+'"':"")+' alt="'+d.quote_attr(i.altText)+'">'}if("tag"===i.type){var v=Twitch.uri.game("Creative")+"/"+i.tag;return'<a href="'+d.quote_attr(v)+'" data-tag="'+d.quote_attr(i.tag)+'" class="ffz-creative-tag-link">'+d.sanitize(i.text)+"</a>"}if("link"===i.type){var b=i.title||i.isLong&&"<long link>"||i.isDeleted&&"<deleted link>"||t&&"<whispered link>"||i.text;if(!e&&void 0!==e)return d.sanitize(b);var y=i.link||i.text,n="";if(i.isMailTo)n="email-link",y="mailto:"+y;else if(n="chat-link",this.settings.link_info&&(!this._link_data||!this._link_data[y])){this._link_data=this._link_data||{},this._link_data[y]=!0;var w=C.bind(this,y),z=p.exec(y);if(z){var k=d.ember_lookup("service:clips");k&&k.getClipInfo(z[1],z[2]).then(function(e){w(!0,{image:e.previewImage,image_iframe:!1,html:'<span class="ffz-clip-title">'+d.sanitize(e.title)+"</span>Channel: "+d.sanitize(e.broadcasterDisplayName)+"<br>Game: "+d.sanitize(e.game)})})}else this.ws_send("get_link",y,w)}var x=y;return i.isDeleted?(n="deleted-link "+n,y="#"):t&&(n="warn-link deleted-link "+n,y="#"),'<a class="ffz-tooltip'+(n?" "+n:"")+'" data-text="'+d.quote_attr(i.text)+'" data-url="'+d.quote_attr(x)+'" href="'+d.quote_attr(y||"#")+'" target="_blank" rel="noopener">'+d.sanitize(b)+"</a>"}if("bits"===i.type){var T=s&&l.ffz_get_tier(i.amount)||[null,null];return T[1]?'<span class="emoticon ffz-bit ffz-tooltip bit-tier-'+T[0]+'"'+(i.individuals?' data-individuals="'+d.quote_attr(JSON.stringify(i.individuals))+'"':"")+' data-amount="'+d.number_commas(i.amount)+'" alt="cheer'+i.amount+'"></span>':"cheer"+i.amount}return"deleted"===i.type?'<span class="deleted-word html-tooltip" title="'+d.quote_san(i.text)+'" data-text="'+d.sanitize(i.text)+'">&times;&times;&times;</span>':"mention"===i.type?'<span class="'+(i.isOwnMessage?"mentioning":"mentioned")+'">'+d.sanitize(i.user)+"</span>":i.deletedLink||i.text?d.sanitize(i.text):"string"!=typeof i?'<b class="html-tooltip" title="<div style=&quot;text-align:left&quot;>'+d.quote_attr(JSON.stringify(i,null,2))+'</div>">[unknown token]</b>':d.sanitize(i)},c.prototype.render_tokens=function(e,t,s,i){return _.map(e,this.render_token.bind(this,t,s,i)).join("")},c.prototype.tokenize_ctags=function(t,s){"use strict";"string"==typeof t&&(t=[t]);for(var i=e.SiteOptions&&SiteOptions.creative_banned_tags&&SiteOptions.creative_banned_tags.split(",")||[],o=[],n=0,a=t.length;a>n;n++){var r=t[n];if(r){if("string"!=typeof r){if("text"!==r.type){!s&&o.push(r);continue}r=r.text}for(var l,c,d=r.split(" "),h=[],f=0,u=d.length;u>f;f++)l=d[f],c=l.substr(1).toLowerCase(),"#"===l.charAt(0)&&-1===i.indexOf(c)?(h.length&&(!s&&o.push({type:"text",text:h.join(" ")+" "}),h=[]),o.push({type:"tag",text:l,tag:c}),h.push("")):h.push(l);!s&&(h.length>1||1===h.length&&""!==h[0])&&o.push({type:"text",text:h.join(" ")})}}return o},c.prototype.tokenize_emotes=function(e,t,s,i){"use strict";var o,n=this.getEmotes(e,t),a={},r=[];if(!(s&&s.length&&n&&n.length))return s;for(var l=0;l<n.length;l++){var c=this.emote_sets[n[l]];if(c&&c.emoticons)for(var d in c.emoticons)o=c.emoticons[d],f.call(a,o.name)||(a[o.name]=o)}"string"==typeof s&&(s=[s]);for(var l=0,h=s.length;h>l;l++){var u=s[l];if(u){if("string"!=typeof u){if("text"!==u.type){r.push(u);continue}u=u.text}for(var _,m=u.split(" "),g=[],p=0,v=m.length;v>p;p++)_=m[p],f.call(a,_)?(o=a[_],g.length&&(r.push({type:"text",text:g.join(" ")+" "}),g=[]),r.push(o.token),i&&t&&this.add_usage(t,o),g.push("")):g.push(_);(g.length>1||1===g.length&&""!==g[0])&&r.push({type:"text",text:g.join(" ")})}}return r},c.prototype.tokenize_emoji=function(e){"use strict";if(!e||!e.length||!this.emoji_data)return e;"string"==typeof e&&(e=[e]);for(var t=[],s=0,i=e.length;i>s;s++){var o=e[s];if(o){if("string"!=typeof o){if("text"!==o.type){t.push(o);continue}o=o.text}for(var n=o.split(h.EMOJI_REGEX),a=null;n.length;)if(a=(a||"")+n.shift(),n.length){var r=n.shift(),l=d.emoji_to_codepoint(r),c=this.emoji_data[l];c?(a&&a.length&&t.push(a),t.push(c.token),a=null):a=(a||"")+r}a&&a.length&&t.push(a)}}return t},c._regex_cache={},c._get_regex=function(e){return c._regex_cache[e]=c._regex_cache[e]||RegExp("\\b"+m(e)+"\\b","ig")},c._words_to_regex=function(e){var t=c._regex_cache[e];if(!t){for(var s="",i=0;i<e.length;i++)e[i]&&(s+=(s?"|":"")+m(e[i]));t=c._regex_cache[e]=new RegExp("(^|.*?"+h.SEPARATORS+")("+s+")(?=$|"+h.SEPARATORS+")","ig")}return t},c.prototype.tokenize_mentions=function(e){var t=this.settings.keywords;if(!t||!t.length)return e;"string"==typeof e&&(e=[e]);for(var s=c._words_to_regex(t),i=[],o=0;o<e.length;o++){var n=e[o];"text"===n.type&&(n=n.text),_.isString(n)&&n.match(s)?(n=n.replace(s,function(e,t,s){return i.push(t),i.push({type:"mention",length:s.length,user:s,isOwnMessage:!1}),""}),n&&i.push(n)):i.push(n)}return i},c.prototype._deleted_link_click=function(e){if(!this.classList.contains("deleted-link"))return!0;e.preventDefault();{var t=this.getAttribute("data-url"),s=this.getAttribute("data-text")||t;FrankerFaceZ.get()}this.classList.remove("deleted-link"),this.classList.remove("warn-link"),this.href=t,this.target="_blank",this.textContent=s,jQuery(this).trigger("mouseout").trigger("mouseover")},c.prototype.parse_history=function(e,t,s,i,o,n,a){var r=e.length,l=!1;for(t=t||{},s=s||{};r--;){var c=e[r],f=c.tags&&c.tags.id,u=c.ffz_deleted=t[c.from]||f&&s[f]||!1;if(u&&!this.settings.prevent_clear&&(c.deleted=!0),!c.room&&i&&(c.room=i),("string"==typeof c.date||"number"==typeof c.date)&&(c.date=d.parse_date(c.date)),c.color||(c.color=c.tags&&c.tags.color?c.tags.color:n&&c.from?n.getColor(c.from):"#755000"),!c.labels||!c.labels.length){var _=c.labels=[];if(c.room&&c.room===c.from)_.push("owner");else if(c.tags){var m=c.tags["user-type"];("mod"===m||"staff"===m||"admin"===m||"global_mod"===m)&&_.push(m)}c.tags&&(c.tags.turbo&&_.push("turbo"),c.tags.subscriber&&_.push("subscriber"))}if(c.style||("jtv"===c.from?c.style="admin":"twitchnotify"===c.from&&(c.style="notification")),c.tags&&"string"==typeof c.tags.emotes&&(c.tags.emotes=d.uncompressEmotes(c.tags.emotes)),c.tags&&"string"==typeof c.tags.badges&&(c.tags.badges=d.uncompressBadges(c.tags.badges)),c.cachedTokens&&c.cachedTokens.length||this.tokenize_chat_line(c,!0,o),c.tags&&"@@"===c.tags.target)l=!0;else if(c.tags&&c.tags.target){var g=c.tags&&c.tags["ban-reason"],p=g&&h.UUID_TEST.exec(g);p?(s[p[1]]=!0,g=g.substr(0,g.length-p[0].length),c.tags["ban-reason"]=g?g:void 0):t[c.tags.target]=!0}if(a&&!a(c))break}return[e,t,l]}},{"./constants":6,"./utils":53}],37:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils"),r=a.createElement,l={cluster:null,manifest_cluster:null,user_ip:null},c=function(e,t,s){return function(i,o){var n=r("div","chat-menu-content center");n.innerHTML="<h1>FrankerFaceZ</h1>"+(e?'<div class="ffz-about-subheading">'+e+"</div>":""),jQuery.ajax(t,{cache:!1,context:this}).done(function(e){o.appendChild(n),o.innerHTML+=e,jQuery("#ffz-old-news-button",o).on("click",function(){jQuery(this).remove(),jQuery("#ffz-old-news",o).css("display","block")}),"function"==typeof s&&s(i,o)}).fail(function(e){var t=r("div","chat-menu-content menu-side-padding");t.textContent="There was an error loading this page from the server.",o.appendChild(n),o.appendChild(t)})}},d=(c("news",n.SERVER+"script/news.html"),function(e,t){var s=l.hasOwnProperty(e)?l[e]:e;if(s)return line=r("li",null,s+"<span></span>"),line.setAttribute("data-property",e),t.appendChild(line),line}),h=function(t){if(document.querySelector('.ffz-ui-sub-menu-page[data-page="debugging"]')){setTimeout(h.bind(this,t),1e3);var s=e.performance&&performance.memory;if(s)for(var i=["jsHeapSizeLimit","totalJSHeapSize","usedJSHeapSize"],o=0;o<i.length;o++){var n=i[o],r=s[n],l=t.querySelector('li[data-property="'+n+'"]');l||(l=d(n,t)),l&&(l.querySelector("span").textContent=a.format_size(r)+" ("+r+")")}}},f=function(e,t){if(document.querySelector('.ffz-ui-sub-menu-page[data-page="debugging"]')&&e.getVideoInfo){setTimeout(f.bind(this,e,t),1e3);var s;try{s=e.getVideoInfo()}catch(i){}if(s){try{s.backend=e.getBackend(),s.version=e.getVersion()}catch(i){}for(var o=Object.keys(s).sort(),n=0;n<o.length;n++){var a=o[n],r=s[a],l=t.querySelector('li[data-property="'+a+'"]');l||(l=d(a,t)),l&&(l.querySelector("span").textContent=r)}}}};o.menu_pages.about={name:"About",icon:n.HEART,sort_order:1e5,pages:{about:{name:"About",render:function(e,t,s,i){var n=this.rooms[e.get("context.currentRoom.id")],a=!1,l=this;if(n&&n.set){var c=this.emote_sets[n.set];c&&c.count>0&&(a=!0)}var d=r("div"),h="";h+="<h1>FrankerFaceZ</h1>",h+='<div class="ffz-about-subheading">new ways to woof</div>',d.className="chat-menu-content center",d.innerHTML=h,t.appendChild(d);var f=0,u=d.querySelector("h1");u&&u.addEventListener("click",function(){if(u.style.cursor="pointer",f++,f>=3){f=0;var e=document.querySelector(".app-main")||document.querySelector(".ember-chat-container");e&&e.classList.toggle("ffz-flip")}setTimeout(function(){f=0,u.style.cursor=""},2e3)});var _=r("div"),m=r("a"),g=(r("a"),r("a")),p="To use custom emoticons in "+(a?"this channel":"tons of channels")+", get FrankerFaceZ from https://www.frankerfacez.com";m.className="button primary",m.innerHTML="Advertise in Chat",m.addEventListener("click",this._add_emote.bind(this,e,p)),_.appendChild(m),g.className="button ffz-donate",g.href="https://www.frankerfacez.com/donate",g.target="_new",g.innerHTML="Donate",_.appendChild(g),_.className="chat-menu-content center",t.appendChild(_);var v=r("div");h='<table class="ffz-about-table">',h+='<tr><th colspan="4">Developers</th></tr>',h+='<tr><td>Dan Salvato</td><td><a class="twitch" href="//www.twitch.tv/dansalvato" title="Twitch" target="_new">&nbsp;</a></td><td><a class="twitter" href="https://twitter.com/dansalvato" title="Twitter" target="_new">&nbsp;</a></td><td><a class="youtube" href="https://www.youtube.com/user/dansalvato1" title="YouTube" target="_new">&nbsp;</a></td></tr>',h+='<tr><td>Stendec</td><td><a class="twitch" href="//www.twitch.tv/sirstendec" title="Twitch" target="_new">&nbsp;</a></td><td><a class="twitter" href="https://twitter.com/SirStendec" title="Twitter" target="_new">&nbsp;</a></td><td><a class="youtube" href="https://www.youtube.com/channel/UCnxuvmK1DCPCXSJ-mXIh4KQ" title="YouTube" target="_new">&nbsp;</a></td></tr>',h+='<tr class="debug"><td><a href="#" id="ffz-changelog">Version '+o.version_info+'</a></td><td colspan="3"><a href="#" id="ffz-debug-logs">Logs</a></td></tr>',v.className="chat-menu-content center",v.innerHTML=h,v.querySelector("#ffz-changelog").addEventListener("click",l._ui_change_subpage.bind(l,e,s,i,t,"changelog"));var b=!1;v.querySelector("#ffz-debug-logs").addEventListener("click",function(){b||(b=!0,l._pastebin(l._log_data.join("\n"),function(e){b=!1,e?prompt("Your FrankerFaceZ logs have been uploaded to the URL:",e):alert("There was an error uploading the FrankerFaceZ logs.")}))}),t.appendChild(v)}},changelog:{name:"Changes",wide:!0,render:c("change log",n.SERVER+"script/changelog.html")},credits:{name:"Credit",wide:!0,render:c("credits",n.SERVER+"script/credits.html")},debugging:{name:"Debug",wide:!0,render:function(t,s){var i,n,l=r("div"),c=r("div"),d=r("ul"),u=[["Client ID",localStorage.ffzClientId||"<i>not set</i>"],["Socket Server",this._ws_sock&&this._ws_sock.url||"<i>disconnected</i>"],["Server Ping",this._ws_last_ping||"<i>unknown</i>"],["Time Offset",this._ws_sock&&this._ws_server_offset&&(this._ws_server_offset<0?"-":"")+a.time_to_string(Math.abs(this._ws_server_offset)/1e3)||"<i>unknown</i>"]],_=r("div"),m=r("ul"),g=[["Deploy Flavor",SiteOptions.deploy_flavor]],p=r("div"),v=r("ul"),b=e.performance&&performance.memory,y=r("div"),w=r("ul"),z=r("div"),k=r("ul"),C=r("div"),x=r("ul"),T=[["Ember",Ember.VERSION],["Ember Data",e.DS&&DS.VERSION||"<i>unknown</i>"],["GIT Version",EmberENV.GIT_VERSION],null,["FrankerFaceZ",o.version_info.toString()]],S=r("div"),E=r("pre");for(var M in this.players)if(i=this.players[M]&&this.players[M].player)break;if(i)try{n=i.getVideoInfo()}catch(L){}l.className="chat-menu-content center",l.innerHTML='<h1>FrankerFaceZ</h1><div class="ffz-about-subheading">woofs for nerds</div>',c.className=p.className=y.className=_.className=z.className=C.className=S.className="list-header",d.className=w.className=m.className=v.className=k.className=x.className="chat-menu-content menu-side-padding version-list",c.innerHTML="Client Status";for(var A=0;A<u.length;A++){var O=u[A],I=r("li");I.innerHTML=null===O?"<br>":O[0]+"<span>"+O[1]+"</span>",d.appendChild(I)}_.innerHTML="Twitch Configuration";var R=this.get_user();if(R&&R.login){g.push(["Current User",R.login+" ["+R.id+"]"]);var F=[];R.is_staff&&F.push("staff"),R.is_admin&&F.push("admin"),R.is_partner&&F.push("partner"),R.is_broadcaster&&F.push("broadcaster"),R.has_turbo&&F.push("turbo"),g.push(["User State",F.join(", ")||"<i>none</i>"])}else g.push(["Current User","<i>not logged in</i>"]);if(e.Twitch&&Twitch.geo&&Twitch.geo._result){var O=Twitch.geo._result;O.geo&&g.push(["Region",O.geo+(O.eu?" [EU]":"")]),O.received_language&&g.push(["Received Language",O.received_language])}for(var A=0;A<g.length;A++){var O=g[A],I=r("li");I.innerHTML=null===O?"<br>":O[0]+"<span>"+O[1]+"</span>",m.appendChild(I)}var H=a.ember_lookup("service:experiments");if(H){p.innerHTML="Twitch Experiments";for(var D in H.values)if(H.values.hasOwnProperty(D)){var j=H.values[D],I=r("li");I.innerHTML=D+"<span>"+a.sanitize(j)+"</span>",v.appendChild(I)}}if(C.innerHTML="Versions",this.has_bttv&&T.push(["BetterTTV",BetterTTV.info.version+"r"+BetterTTV.info.release]),Object.keys(this._apis).length){T.push(null);for(var D in this._apis){var P=this._apis[D];T.push(["<b>Ext #"+P.id+".</b> "+P.name,P.version||"<i>unknown</i>"])}}for(var A=0;A<T.length;A++){var O=T[A],I=r("li");I.innerHTML=null===O?"<br>":O[0]+"<span>"+O[1]+"</span>",x.appendChild(I)}S.className="list-header",S.innerHTML="Logs",E.className="chat-menu-content menu-side-padding",E.textContent=this._log_data.join("\n"),s.appendChild(l),s.appendChild(C),s.appendChild(x),s.appendChild(c),s.appendChild(d),s.appendChild(_),s.appendChild(m),H&&(s.appendChild(p),s.appendChild(v)),b&&(y.innerHTML="Memory Statistics",setTimeout(h.bind(this,w),0),s.appendChild(y),s.appendChild(w)),n&&(z.innerHTML="Player Statistics",setTimeout(f.bind(this,i,k),0),s.appendChild(z),s.appendChild(k)),s.appendChild(S),s.appendChild(E)}}}}},{"../constants":6,"../utils":53}],38:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils");o.basic_settings.dark_twitch={type:"boolean",no_bttv:!0,category:"General",name:"Dark Twitch",help:"Apply a dark background to channels and other related pages for easier viewing.",get:function(){return this.settings.dark_twitch},set:function(e){this.settings.set("dark_twitch",e),this.settings.set("dark_no_blue",e)}},o.basic_settings.separated_chat={type:"boolean",no_bttv:!0,category:"Chat",name:"Separated Lines",help:"Use alternating rows and thin lines to visually separate chat messages for easier reading.",get:function(){return this.settings.chat_rows&&"0"!==this.settings.chat_separators},set:function(e){this.settings.set("chat_rows",e),this.settings.set("chat_separators",e?"2":"0")}},o.basic_settings.minimalistic_chat={type:"boolean",category:"Chat",name:"Minimalistic UI",help:"Hide all of chat except messages and the input box and reduce chat margins.",get:function(){return 3===this.settings.minimal_chat&&this.settings.chat_padding},set:function(e){this.settings.set("minimal_chat",e?3:0),this.settings.set("chat_padding",e)}},o.basic_settings.high_contrast={type:"boolean",category:"Chat",no_bttv:!0,name:"High Contrast",help:"Display chat using white and black for maximum contrast. This is suitable for capturing and chroma keying chat to display on stream.",get:function(){return"222"!==this.settings.high_contrast_chat},set:function(e){this.settings.set("high_contrast_chat",e?"111":"222")}},o.basic_settings.keywords={type:"button",category:"Chat",no_bttv:!0,name:"Highlight Keywords",help:"Set additional keywords that will be highlighted in chat.",method:function(){o.settings_info.keywords.method.call(this)}},o.basic_settings.banned_words={type:"button",category:"Chat",no_bttv:!0,name:"Banned Keywords",help:"Set a list of words that will be removed from chat messages, locally.",method:function(){o.settings_info.banned_words.method.call(this)}},o.settings_info.twitch_chat_dark={type:"boolean",value:!1,visible:!1},o.settings_info.dark_twitch={type:"boolean",value:!1,no_bttv:!0,category:"Appearance",name:"Dark Twitch",help:"Apply a dark background to channels and other related pages for easier viewing.",on_update:function(e){var t=document.querySelector("input.ffz-setting-dark-twitch");if(t&&(t.checked=e),!this.has_bttv){document.body.classList.toggle("ffz-dark",e);var s=a.ember_lookup("controller:settings"),i=s&&s.get("settings");e?(this._load_dark_css(),i&&this.settings.set("twitch_chat_dark",i.get("darkMode")),i&&i.set("darkMode",!0)):i&&i.set("darkMode",this.settings.twitch_chat_dark),jQuery(".chatReplay").toggleClass("dark",e||!1)}}},o.settings_info.dark_no_blue={type:"boolean",value:!1,category:"Appearance",name:"Gray Chat (no blue)",help:"Make the dark theme for chat and a few other places on Twitch a bit darker and not at all blue.",on_update:function(e){document.body.classList.toggle("ffz-no-blue",e)}},o.settings_info.hide_recent_past_broadcast={type:"boolean",value:!1,no_mobile:!0,category:"Channel Metadata",name:'Hide "Watch Last Broadcast"',help:'Hide the "Watch Last Broadcast" banner at the top of offline Twitch channels.',on_update:function(e){document.body.classList.toggle("ffz-hide-recent-past-broadcast",e)}},o.prototype.setup_dark=function(){if(document.body.classList.toggle("ffz-hide-recent-past-broadcast",this.settings.hide_recent_past_broadcast),document.body.classList.toggle("ffz-no-blue",this.settings.dark_no_blue),!this.has_bttv&&(document.body.classList.toggle("ffz-dark",this.settings.dark_twitch),this.settings.dark_twitch)){var e=a.ember_lookup("controller:settings");if(e)try{e.set("settings.darkMode",!0)}catch(t){this.error("Unable to set the darkMode setting because it isn't named what we expect. WTF?")}else this.error("Unable to load the Ember settings controller.");this._load_dark_css()}},o.prototype._load_dark_css=function(){if(!this._dark_style){this.log("Injecting FrankerFaceZ Dark Twitch CSS.");var e=this._dark_style=document.createElement("link");e.id="ffz-dark-css",e.setAttribute("rel","stylesheet"),e.setAttribute("href",n.SERVER+"script/dark"+(n.DEBUG?"":".min")+".css?_="+(n.DEBUG?Date.now():o.version_info)),document.head.appendChild(e)}}},{"../constants":6,"../utils":53}],39:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=n.createElement;o.settings_info.dashboard_feed={type:"boolean",value:!0,no_mobile:!0,category:"Dashboard",name:"Channel Feed <small>(Requires Refresh)</small>",help:"Add a way to post to your channel feed directly to the dashboard!"},o.prototype.setup_dash_feed=function(){var e=this,t=this.get_user(),s=this.is_dashboard?location.pathname.match(/\/([^\/]+)/):void 0,i=this.is_dashboard&&s&&s[1];this.settings.dashboard_feed&&t&&i&&i===t.login&&n.api.get("feed/"+i+"/posts",{limit:1},{version:3}).done(function(t){e.build_dash_feed()})},o.prototype._remove_dash_feed=function(){var e=document.querySelector("#ffz-feed-tabs"),t=e&&e.parentElement,s=document.querySelector("div.dash-broadcast-contain");e&&t&&(s&&e.contains(s)&&(e.removeChild(s),t.insertBefore(s,e)),t.removeChild(e))},o.prototype.build_dash_feed=function(){var e=this,t=this.get_user(),s=a("div"),i=a("ul","tabs"),o=a("li","tab",'<a id="ffz-nav-status">Broadcast Status</a>'),r=a("li","tab",'<a id="ffz-nav-feed">Channel Feed</a>'),l=document.querySelector("div.dash-broadcast-contain"),c=a("div","dash-broadcast-contain dash-ffz-feed-contain hidden"),d=a("textarea","ffz-feed-entry"),h=a("span","char-count","0");if(align_btn=a("div","ffz-feed-button clearfix"),chk_share=a("span",null,'<input type="checkbox"> Share to Twitter'),checkbox=chk_share.querySelector("input"),btn_submit=a("button","button primary","<span>Post</span>"),column=l&&l.parentElement,placeholder="Post an update to your channel...",l&&column&&t){if(c.appendChild(d),c.appendChild(align_btn),t.twitter_connected)align_btn.appendChild(chk_share);else{var f=a("span",null,"<i>(Twitter Not Connected)</i>");f.title="Click to Refresh",f.style.cursor="pointer",f.addEventListener("click",function(){t=e.get_user(),t.twitter_connected&&(jQuery(f).trigger("mouseout"),align_btn.removeChild(f),align_btn.insertBefore(chk_share,align_btn.firstChild))}),jQuery(f).tipsy(),align_btn.appendChild(f)}h.title="Roughly the first 115 characters of a post will appear in a Tweet.",jQuery(h).tipsy(),align_btn.appendChild(btn_submit),align_btn.appendChild(h),d.id="vod_status",d.placeholder=placeholder;var u=function(){var e=t.twitter_connected&&checkbox&&checkbox.checked||!1,s=d.value.length;h.innerHTML=e?n.number_commas(115-s)+"<span>+</span>":n.number_commas(s),h.classList.toggle("over-limit",e&&0>115-s||!1),0===s&&(d.placeholder=placeholder)};checkbox.addEventListener("change",u),d.addEventListener("input",u),btn_submit.addEventListener("click",function(){var s=e.is_dashboard?location.pathname.match(/\/([^\/]+)/):void 0,i=e.is_dashboard&&s&&s[1];if(i&&!this.disabled){var o=t.twitter_connected&&checkbox&&checkbox.checked||!1,a=d.value;d.disabled=!0,btn_submit.disabled=!0,n.api.post("feed/"+i+"/posts?share="+JSON.stringify(o),{content:a,share:o}).done(function(t){d.disabled=!1,btn_submit.disabled=!1,d.value="";var s=t.tweet?" The update was tweeted out.":o?" There was a problem tweeting the update.":"";d.placeholder="The update was posted successfully."+s+" Post another update to your channel...",e.log("Channel Feed Posting Succeeded",t)}).fail(function(t){d.disabled=!1,btn_submit.disabled=!1,t=t?t.data||t.responseJSON||void 0:void 0,e.log("Channel Feed Posting Failed",t),alert("An error occured posting to your channel feed:\n\n"+(t&&t.message||"Unknown Error"))})}});var _=function(e){var t=this.getAttribute("data-nav");jQuery(".selected",i).removeClass("selected"),this.classList.add("selected"),jQuery(".active-tab",s).removeClass("active-tab").addClass("hidden"),jQuery('div[data-tab="'+t+'"]',s).addClass("active-tab").removeClass("hidden")};s.id="ffz-feed-tabs",o.setAttribute("data-nav","status"),r.setAttribute("data-nav","feed"),o.addEventListener("click",_),r.addEventListener("click",_),l.setAttribute("data-tab","status"),c.setAttribute("data-tab","feed"),column.removeChild(l),i.appendChild(o),i.appendChild(r),s.appendChild(i),s.appendChild(l),s.appendChild(c),column.insertBefore(s,column.firstChild),_.call(o)}}},{"../utils":53}],40:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=function(e){var t=jQuery("#channel_viewer_count");"Hidden"===t.text()||t.text(e)};o.settings_info.dashboard_graph={type:"boolean",value:!0,no_mobile:!0,no_bttv:!0,category:"Dashboard",name:"Statistics Graph <small>(Requires Refresh)</small>",help:"Display a graph of your viewers, followers, and chat activity over time."},o.msg_commands.chat_message=function(e){this.dashboard_channel&&e.room===this.dashboard_channel&&(this._stat_chat_lines++,-1===this._stat_chatters.indexOf(e.from)&&this._stat_chatters.push(e.from))},o.prototype.setup_dash_stats=function(){this._stat_chat_lines=0,this._stat_chatters=[],this._stat_last_game=null,this._stat_last_status=null,this._update_dash_stats_timer=setTimeout(this.update_dash_stats.bind(this),0);var t=this,s=document.querySelector("#stats");if(!this.has_bttv&&s&&e.Highcharts&&this.settings.dashboard_graph){t.log("Adding dashboard statistics chart.");var i=document.createElement("div");i.id="chart_container",i.className="ffz-stat-chart",s.parentElement.insertBefore(i,s.nextSibling),Highcharts.setOptions({global:{useUTC:!1}});var o={};localStorage.ffz_dash_chart_visibility&&(o=JSON.parse(localStorage.ffz_dash_chart_visibility));{var a=this.settings.twenty_four_timestamps?"%H:%M":"%l:%M";this._dash_chart=new Highcharts.Chart({chart:{type:"line",zoomType:"x",animation:!1,renderTo:i,height:200},title:{text:null},credits:{enabled:!1},exporting:{enabled:!1},legend:{backgroundColor:"#fff"},xAxis:{type:"datetime",tickPixelInterval:150,dateTimeLabelFormats:{millisecond:a,second:a,minute:a}},tooltip:{formatter:function(){this.point&&(this.points=[this.point]);var e=[],s=this.points[0].key||this.points[0].x;s&&("number"==typeof s&&(s=Highcharts.dateFormat(t.settings.twenty_four_timestamps?"%H:%M":"%l:%M %P",s)),e.push('<span style="font-size:10px">'+s+"</span>"));for(var i=0;i<this.points.length;i++){var o=this.points[i],a=o.series,r=a.tooltipOptions,l=o.text||o.y;r&&r.enabled&&void 0!==l&&null!==l&&("number"==typeof l&&(l=n.number_commas(l)),e.push('<span style="color:'+a.color+'">'+a.name+"</span>: <b>"+l+"</b>"))}return e.join("<br>")},crosshairs:!0,shared:!0},yAxis:[{title:{text:null},min:0},{title:{text:null},min:0},{title:{text:null},min:0,opposite:!0},{title:{text:null},min:0,opposite:!0}],series:[{type:"flags",name:"Status",showInLegend:!1,shape:"squarepin",data:[],zIndex:5},{name:"Viewers",data:[],zIndex:4,visible:o.hasOwnProperty("viewers")?o.viewers:!0},{name:"Followers",data:[],yAxis:1,zIndex:3,visible:o.hasOwnProperty("followers")?o.followers:!0},{name:"Subscribers",
data:[],zIndex:3,showInLegend:!1,visible:o.hasOwnProperty("subscribers")?o.subscribers:!0},{name:"Chat Lines",type:"area",data:[],yAxis:2,visible:o.hasOwnProperty("chat_lines")?o.chat_lines:!1,zIndex:1},{name:"Chatters",data:[],yAxis:3,visible:o.hasOwnProperty("chatters")?o.chatters:!1,zIndex:2}]})}}},o.prototype._dash_chart_chatters=function(e){var t=n.last_minute(),s=this._dash_chart.series[4],i=s.data.length,o=i>0&&s.data[i-1],a=!1;return!e&&!this._stat_chat_lines&&i>0&&0===o.y?(s.addPoint({x:t,y:null},!1),this._dash_chart.series[5].addPoint({x:t,y:null},!1),a=!0):(e||this._stat_chat_lines||i>0&&o&&null!==o.y)&&(0!==this._stat_chat_lines&&o&&null===o.y&&(s.addPoint({x:t-6e4,y:0},!1),this._dash_chart.series[5].addPoint({x:t-6e4,y:0},!1)),s.addPoint({x:t,y:this._stat_chat_lines||0},!1),this._dash_chart.series[5].addPoint({x:t,y:this._stat_chatters.length||0},!1),a=!0),this._stat_chat_lines=0,this._stat_chatters=[],a},o.prototype._remove_dash_chart=function(){this._dash_chart&&(this.log("Removing dashboard statistics chart."),this._dash_chart.destroy(),this._dash_chart=null,jQuery("#chart_container.ffz-stat-chart").remove())},o.prototype.update_dash_stats=function(){var e=this,t=this.dashboard_channel;if(this.has_bttv||!t)return this._remove_dash_chart();if(this._update_dash_stats_timer=setTimeout(this.update_dash_stats.bind(this),6e4),e._dash_chart){var s=e._dash_chart.series;localStorage.ffz_dash_chart_visibility=JSON.stringify({viewers:s[1].visble,followers:s[2].visible,subscribers:s[3].visible,chat_lines:s[4].visible,chatters:s[5].visible})}n.api.get("streams/"+t,{},{version:3}).done(function(t){var s=null,i=null,o=null,r=null;if(t&&t.stream){!e.has_bttv&&a(n.number_commas(t.stream.viewers)),s=t.stream.viewers;var l=t.stream.channel;l&&(i=l.hasOwnProperty("followers")?l.followers||0:null,o=l.game||"Not Playing",r=l.status||"Untitled Broadcast",l.views&&jQuery("#views_count span").text(n.number_commas(l.views)),i&&jQuery("#followers_count span").text(n.number_commas(i)))}else!e.has_bttv&&a("Offline");if(e._dash_chart){var c,d=n.last_minute();(e._stat_last_game!==o||e._stat_last_status!==r)&&(e._dash_chart.series[0].addPoint({x:d,title:o,text:r},!1),e._stat_last_game=o,e._stat_last_status=r),c=n.maybe_chart(e._dash_chart.series[1],{x:d,y:s},!1),c=e._dash_chart_chatters(c)||c,n.maybe_chart(e._dash_chart.series[2],{x:d,y:i},!1,c),e._dash_chart.redraw()}}).fail(function(){e._dash_chart&&(e._dash_chart_chatters(),e._dash_chart.redraw())})}},{"../utils":53}],41:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants"),r=['.warp__item a[data-href="following"]',"#header_actions #header_following"],l=function(e,t){return!e.settings.following_count||"header_following"!==t.id&&"following"!==t.getAttribute("data-href")&&"following"!==t.parentElement.getAttribute("data-name")?"":"ffz-wide-tip"};o.settings_info.following_count={type:"boolean",value:!0,no_mobile:!0,category:"Sidebar",name:"Following Data",help:"Display the number of live channels you're following on the sidebar, and list the channels in a tooltip.",on_update:function(e){this._schedule_following_count();var t=n.ember_resolve("model:deprecated-stream"),s=t&&t.find("live");if(s){var i=s.get("total")||0;this._draw_following_count(i),this._draw_following_channels(s.get("content"),i)}else this._update_following_count(),this._draw_following_channels()}},o.prototype.setup_following_count=function(e){if(this.settings.following_count&&this._schedule_following_count(),this._install_following_tooltips(),setTimeout(this._install_following_tooltips.bind(this),2e3),this.is_dashboard||!e)return this._following_get_me();this.log("Connecting to Live Streams model.");var t=n.ember_resolve("model:deprecated-stream");if(!t)return this.log("Unable to find Stream model.");var s=t.find("live"),i=this;if(!s)return this.log("Unable to find Live Streams collection.");s.addObserver("total",function(){i._draw_following_count(this.get("total"))}),s.addObserver("content.length",function(){i._draw_following_channels(this.get("content"),this.get("total"))}),s.load();var o=function(){var e=s.get("total"),t=s.get("content");"number"==typeof e&&(i._draw_following_count(e),t&&t.length&&i._draw_following_channels(t,e))};o(),setTimeout(o,2e3)},o.prototype._following_get_me=function(t){if(!e.Twitch)return setTimeout(this._following_get_me.bind(this,t),Math.floor(2e3*Math.random())+500);var s=this;n.api.get("/api/me").done(function(e){s.log("Fetched User Data -- "+(e.name||e.login)),s.__user=e,s._update_following_count()}).fail(function(){return t=(t||0)+1,5>t?setTimeout(s._following_get_me.bind(s,t),Math.floor(2e3*Math.random())+500):void s.log("Failed to get proper user object.")})},o.prototype._schedule_following_count=function(){return this.settings.following_count?void(this._following_count_timer||(this._following_count_timer=setTimeout(this._update_following_count.bind(this),55e3+1e4*Math.random()))):void(this._following_count_timer&&(clearTimeout(this._following_count_timer),this._following_count_timer=void 0))},o.prototype._update_following_count=function(){if(!this.settings.following_count)return void(this._following_count_timer&&(clearTimeout(this._following_count_timer),this._following_count_timer=void 0));this._following_count_timer=setTimeout(this._update_following_count.bind(this),55e3+1e4*Math.random());var e=n.ember_resolve("model:deprecated-stream"),t=e&&e.find("live"),s=(document.body.getAttribute("data-current-path")||"",this);if(!this.is_dashboard&&t)t.load();else{var i=this.get_user();n.api.get("streams/followed",{limit:20,offset:0},{version:3},i&&i.chat_oauth_token).done(function(e){s._draw_following_count(e._total),s._draw_following_channels(e.streams,e._total)}).fail(function(){s._draw_following_count(),s._draw_following_channels()})}},o.prototype._build_following_tooltip=function(e){if("header_following"!==e.id&&"following"!==e.getAttribute("data-href")&&"following"!==e.parentElement.getAttribute("data-name"))return e.getAttribute("original-title");if(!this.settings.following_count)return"Following";var t=(this.has_bttv?'<span class="stat playing">FrankerFaceZ</span>':"")+"Following",s=e.getBoundingClientRect(),i=document.body.clientHeight-(s.bottom+50),o=Math.max(Math.floor(i/40)-1,2),r=this._tooltip_streams,l=this._tooltip_total||r&&r.length||0,c=0,d=0;if(r&&r.length){for(var h=0,f=r.length;f>h;h++){var u=r[h];if(u&&u.channel)if(u.game&&-1!==this.settings.banned_games.indexOf(u.game.toLowerCase()))d++;else{if(c+=1,c>o){t+="<hr><span>And "+n.number_commas(l-o)+" more"+(d?" ("+d+" hidden)":"")+"...</span>",d=0;break}var m=this.settings.stream_uptime&&u.created_at&&n.parse_date(u.created_at),g=Date.now()-(this._ws_server_offset||0),p=m&&60*Math.floor((g-m.getTime())/6e4)||0,v="Creative"===u.channel.game&&this.tokenize_ctags(u.channel.status,!0);t+=(1===c?"<hr>":"")+(p>0?'<span class="stat">'+a.CLOCK+" "+n.duration_string(p)+"</span>":"")+'<span class="stat">'+a.LIVE+" "+n.number_commas(u.viewers)+"</span><b>"+n.sanitize(u.channel.display_name||u.channel.name)+'</b><br><span class="playing">'+("Creative"===u.channel.game?"Being Creative":u.channel.game?"Playing "+n.sanitize(u.channel.game):"Not Playing")+(v?" | "+_.pluck(v,"text").join(" "):"")+"</span>"}}d&&(t+="<hr><span>("+d+" hidden)")}else c++,t+="<hr>No one you're following is online.";return setTimeout(function(){var e=document.querySelector(".tipsy");if(e){var t=e.getBoundingClientRect(),s=parseInt(e.style.left||"0"),i=t.left+e.scrollWidth;t.left<5?e.style.left=s-t.left+5+"px":i>document.body.clientWidth-5&&(e.style.left=s-(5+i-document.body.clientWidth)+"px")}}),t},o.prototype._install_following_tooltips=function(){for(var e=this,t={html:!0,className:function(){return l(e,this)},title:function(){return e._build_following_tooltip(this)},gravity:n.tooltip_placement(2*a.TOOLTIP_DISTANCE,"w")},s=0;s<r.length;s++){var i=jQuery(r[s]);if(i&&i.length){var o=i.data("tipsy");o&&o.options?o.options=_.extend(o.options,t):i.tipsy(t)}}},o.prototype._draw_following_channels=function(e,t){this._tooltip_streams=e,this._tooltip_total=t},o.prototype._draw_following_count=function(e){e=e?n.format_unread(e):"";for(var t=0;t<r.length;t++){var s=document.querySelector(r[t]),i=s&&s.querySelector(".ffz-follow-count");s&&(!this.has_bttv&&this.settings.following_count?(i||(i=n.createElement("span","ffz-follow-count"),s.appendChild(i)),i.innerHTML=e):i&&s.removeChild(i))}}},{"../constants":6,"../utils":53}],42:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=/^[A-Za-z0-9_]+$/,r=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/([A-Za-z0-9_]+)/i;o.prototype.setup_following=function(){this.log("Initializing following support."),this.follow_data={},this.follow_sets={}},o.settings_info.follow_buttons={type:"boolean",value:!0,no_mobile:!0,category:"Channel Metadata",name:"Relevant Follow Buttons",help:"Display additional Follow buttons for channels relevant to the stream, such as people participating in co-operative gameplay.",on_update:function(e){this.rebuild_following_ui()}},o.ffz_commands.following=function(e,t){t=t.join(" ").trim().toLowerCase().split(/[ ,]+/);for(var s=this,i=[],o=0,n=t.length;n>o;o++){var a=t[o],l=a.match(r);l&&(a=l[1]),""!==a&&-1===i.indexOf(a)&&i.push(a)}return this.ws_send("update_follow_buttons",[e.id,i],function(t,i){return t?void(i?s.room_message(e,"The following buttons have been updated."):s.room_message(e,"The following buttons have been disabled.")):(s.log("Not a Success: "+JSON.stringify(i)),void s.room_message(e,i))})?void 0:"There was an error communicating with the server."},o.ws_on_close.push(function(){var e=n.ember_lookup("controller:channel"),t=e&&e.get("content.id"),s=e&&e.get("hostModeTarget.id"),i=!1;if(this.follow_sets={},e){for(var o in this.follow_data)if(delete this.follow_data[o],(o===t||o===s)&&(i=!0),this.rooms&&this.rooms[o]&&this.rooms[o].extra_sets){var a=this.rooms[o].extra_sets;delete this.rooms[o].extra_sets;for(var r=0;r<a.length;r++){var l=this.emote_sets[a[r]];l&&(l.users.removeObject(o),this.global_sets.contains(a[r])||l.users.length||this.unload_set(a[r]))}}i&&this.rebuild_following_ui()}}),o.ws_commands.follow_buttons=function(e){var t=n.ember_lookup("controller:channel"),s=t&&t.get("content.id"),i=t&&t.get("hostModeTarget.id"),o=!1;this.follow_data=this.follow_data||{};for(var a in e)this.follow_data[a]=e[a],(a===s||a===i)&&(o=!0);o&&this.rebuild_following_ui()},o.ws_commands.follow_sets=function(e){{var t=n.ember_lookup("controller:channel");t&&t.get("content.id"),t&&t.get("hostModeTarget.id")}this.follow_sets=this.follow_sets||{};for(var s in e)if(this.rooms&&this.rooms.hasOwnProperty(s)){for(var i=this.rooms[s].extra_sets||[],o=this.rooms[s].extra_sets=e[s],a=0;a<i.length;a++){var r=i[a];if(-1===o.indexOf(r)){var l=this.emote_sets&&this.emote_sets[r];l&&(l.users.removeObject(s),this.global_sets.contains(r)||l.users.length||this.unload_set(r))}}for(var a=0;a<o.length;a++){var r=o[a],l=this.emote_sets&&this.emote_sets[r];l?-1===l.users.indexOf(s)&&l.users.push(s):setTimeout(this.load_set.bind(this,r,function(e,t){e&&t.users.push(s)}),2500*Math.random())}}else this.follow_sets[s]=e[s]},o.prototype.rebuild_following_ui=function(){var e=n.ember_lookup("controller:channel"),t=e&&e.get("content.id"),s=e&&e.get("hostModeTarget.id");if(this._cindex){if(t){var i=this.follow_data&&this.follow_data[t],o=this._cindex.get("element"),a=o&&o.querySelector(".stats-and-actions .channel-actions"),r=a&&a.querySelector("#ffz-ui-following");if(a&&this.settings.follow_buttons&&i&&i.length){if(r)r.innerHTML="";else{r=document.createElement("span"),r.id="ffz-ui-following";var l=null;try{var c=a.querySelector(".subscribe-button");c?l=c.parentElement.nextSibling:(c=a.querySelector(".notification-controls"),c&&(l=c.nextSibling))}catch(d){}l?a.insertBefore(r,l):a.appendChild(r)}for(var h=[t],f=0;f<i.length&&10>f;f++){var u=i[f];-1===h.indexOf(u)&&(this._build_following_button(r,u),h.push(u))}}else r&&r.parentElement.removeChild(r)}if(s){var i=this.follow_data&&this.follow_data[s],o=this._cindex.get("element"),a=o&&o.querySelector("#hostmode .channel-actions"),r=a&&a.querySelector("#ffz-ui-following");if(a&&this.settings.follow_buttons&&i&&i.length){if(r)r.innerHTML="";else{r=document.createElement("span"),r.id="ffz-ui-following";var l=null;try{var c=a.querySelector(".subscribe-button");c?l=c.parentElement.nextSibling:(c=a.querySelector(".notification-controls"),c&&(l=c.nextSibling))}catch(d){}l?a.insertBefore(r,l):a.appendChild(r)}for(var h=[s],f=0;f<i.length&&10>f;f++){var u=i[f];-1===h.indexOf(u)&&(this._build_following_button(r,u),h.push(u))}}else r&&r.parentElement.removeChild(r)}}},o.prototype._build_following_button=function(t,s){if(!a.test(s))return this.log("Ignoring Invalid Channel: "+n.sanitize(s));var i,r=this,l=n.createElement("button","follow-button button"),c=n.createElement("a","toggle-notification-menu js-toggle-notification-menu"),d=n.createElement("div","notification-controls v2 hidden",c),h=!1,f=!1,u=function(){l.classList.toggle("is-following",h),l.classList.toggle("button--status",h),l.title=(h?"Unf":"F")+"ollow "+n.sanitize(i),l.innerHTML=(h?"":"Follow ")+n.sanitize(i),d.classList.toggle("hidden",!h)},_=function(){var e=r.get_user();return e&&e.login?void n.api.get("users/"+e.login+"/follows/channels/"+s).done(function(e){h=!0,f=e.notifications,l.classList.add("is-initialized"),u()}).fail(function(e){h=!1,f=!1,l.classList.add("is-initialized"),u()}):(h=!1,notification=!1,l.classList.add("is-initialized"),u())},m=function(e){e!==!1&&(e=!0);var t=r.get_user();return t&&t.login?(f=e,n.api.put("users/:login/follows/channels/"+s,{notifications:f}).fail(_)):null},g=function(e){i=e||s,u()};c.href="#",l.addEventListener("click",function(e){var t=r.get_user();return t&&t.login?(h=!h,u(),r.ws_send("track_follow",[s,h]),h?m():n.api.del("users/:login/follows/channels/"+s).done(_),!1):Ember.$.login({mpSourceAction:"follow-button",follow:s})}),l.addEventListener("mousedown",function(t){1===t.button&&(t.preventDefault(),e.open(Twitch.uri.profile(s)))}),c.addEventListener("click",function(){var e=r._build_following_popup(d,s,f);return e&&e.addEventListener("click",function(){var t=!f;return e.classList.toggle("active",t),m(t),!1}),!1}),i=o.get_capitalization(s,g),u(),setTimeout(_,5e3*Math.random()),t.appendChild(l),t.appendChild(d)},o.prototype._build_following_popup=function(e,t,s){{var i=this.close_popup(),a="";e.offsetLeft+e.offsetWidth}return i&&"ffz-following-popup"==i.id&&i.getAttribute("data-channel")===t?null:(i=this._popup=n.createElement("div","dropmenu notify-menu js-notify"),i.id="ffz-following-popup",i.setAttribute("data-channel",t),this._popup_allow_parent=!0,this._popup_parent=e,a='<div class="header">You are following '+o.get_capitalization(t)+"</div>",a+='<p class="clearfix">',a+='<a class="switch'+(s?" active":"")+'"><span></span></a>',a+='<span class="switch-label">Notify me when the broadcaster goes live</span>',a+="</p>",i.innerHTML=a,e.insertBefore(i,e.firstChild),i.querySelector("a.switch"))}},{"../utils":53}],43:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils"),r=n.IS_OSX,l=[],c=function(e){var t=document.body.classList.contains("ffz-sidebar-swap")&&!document.body.classList.contains("ffz-portrait"),s=e.children[0].getBoundingClientRect(),i=parseInt(e.style.left||"0"),o=s.left+s.width,n=!!e.style.left;t?s.left<20?(e.style.left="",n=!1):o>document.body.clientWidth&&(e.style.left=i-(o-document.body.clientWidth)+"px"):s.left<0?e.style.left=i-s.left+"px":o>document.body.clientWidth-20&&(e.style.left="",n=!1),e.classList.toggle("ui-moved",n)};o.prototype.setup_menu=function(){document.body.classList.toggle("ffz-menu-replace",this.settings.replace_twitch_menu),this.log("Hooking the Ember Chat Settings view.");var e=a.ember_resolve("view:settings"),t=a.ember_lookup("service:layout"),s=this;if(e){e.reopen({didInsertElement:function(){this._super();try{this.ffzInit()}catch(e){s.error("ChatSettings didInsertElement: "+e)}},willClearRender:function(){try{this.ffzTeardown()}catch(e){s.error("ChatSettings willClearRender: "+e)}this._super()},ffzInit:function(){var e=this,i=this.get("element"),o=i&&i.querySelector(".dropmenu");if(o){var n,a,r,l=document.createElement("div"),c=document.createElement("div");l.className="list-header",l.innerHTML="FrankerFaceZ",c.className="chat-menu-content",n=document.createElement("p"),n.className="no-bttv",a=document.createElement("input"),a.type="checkbox",a.className="ember-checkbox ffz-setting-dark-twitch",a.checked=s.settings.dark_twitch,n.appendChild(a),n.appendChild(document.createTextNode("Dark Twitch")),c.appendChild(n),a.addEventListener("change",function(e){s.settings.set("dark_twitch",this.checked)}),n=document.createElement("p"),a=document.createElement("input"),a.type="checkbox",a.className="ember-checkbox ffz-setting-hosted-channels",a.checked=s.settings.hosted_channels,n.appendChild(a),n.appendChild(document.createTextNode("Channel Hosting")),c.appendChild(n),a.addEventListener("change",function(e){s.settings.set("hosted_channels",this.checked)}),n=document.createElement("p"),r=document.createElement("a"),r.href="#",r.innerHTML="More Settings",n.appendChild(r),c.appendChild(n),r.addEventListener("click",function(t){return e.set("controller.settings.hidden",!0),s._last_page="settings",s.build_ui_popup(s._chatv),t.stopPropagation(),!1}),o.appendChild(l),o.appendChild(c);var d=i.querySelector(".chat-settings");t&&d&&(d.style.maxHeight=t.get("windowHeight")-90+"px")}},ffzTeardown:function(){}}),t&&t.addObserver("windowHeight",function(){var e=document.querySelector(".ember-chat .chat-settings");e&&(e.style.maxHeight=t.get("windowHeight")-90+"px")});try{e.create().destroy()}catch(i){}var o=a.ember_views();for(var n in o)if(o.hasOwnProperty(n)){var r=o[n];if(r instanceof e){this.log("Manually updating existing Chat Settings view.",r);try{r.ffzInit()}catch(i){this.error("setup: ChatSettings ffzInit: "+i)}}}}},o.menu_pages={},o.prototype._fix_menu_position=function(){var e=document.querySelector("#ffz-chat-menu");e&&c(e)},o.prototype.build_ui_popup=function(e){var t=this._popup?this.close_popup():this._last_popup;if(!t||"ffz-chat-menu"!==t.id){var s=document.createElement("div"),i=document.createElement("div"),r=document.createElement("ul");s.className="emoticon-selector chat-menu ffz-ui-popup",s.id="ffz-chat-menu",i.className="emoticon-selector-box dropmenu",s.appendChild(i);var l=document.createElement("div");l.className="ffz-ui-menu-page",i.appendChild(l),r.className="menu clearfix",i.appendChild(r);var d=document.createElement("li");d.className="title",d.innerHTML='<span class="title">Franker'+(n.DEBUG?"Dev":"Face")+"Z</span>";var h=document.createElement("span"),f=this;h.className="ffz-handle ffz-close-button",d.insertBefore(h,d.firstChild);var u=!1;h.addEventListener("mousedown",function(){var e=f._popup;u=e&&"ffz-chat-menu"===e.id&&e.style.left}),h.addEventListener("click",function(){var e=f._popup;u&&e&&f.close_popup()}),r.appendChild(d),jQuery(s).draggable({handle:r,cancel:"li.item",axis:"x",stop:function(e){c(this)}}),s.style.position="";var _=[];for(var m in o.menu_pages)if(o.menu_pages.hasOwnProperty(m)){var g=o.menu_pages[m];try{if(!g||g.hasOwnProperty("visible")&&(!g.visible||"function"==typeof g.visible&&!g.visible.call(this,e)))continue}catch(p){this.error("menu_pages "+m+" visible: "+p);continue}_.push([g.sort_order||0,m,g])}_.sort(function(e,t){if(e[0]<t[0])return 1;if(e[0]>t[0])return-1;var s=e[1].toLowerCase(),i=t[1].toLowerCase();return i>s?1:s>i?-1:0});for(var v=0;v<_.length;v++){var m=_[v][1],g=_[v][2],b=document.createElement("li"),y=document.createElement("a");b.className="item"+(g.sub_menu||g.pages?" has-sub-menu":""),b.id="ffz-menu-page-"+m,y.title=g.name,y.innerHTML=g.icon,jQuery(y).tipsy({gravity:a.tooltip_placement(n.TOOLTIP_DISTANCE,"n")}),y.addEventListener("click",this._ui_change_page.bind(this,e,i,r,l,m)),b.appendChild(y),r.appendChild(b)}var g=(this._last_page||"channel").split("_",1)[0];this._ui_change_page(e,i,r,l,g),l.style.maxHeight=Math.max(200,e.$().height()-172)+"px",e.$(".chat-interface").append(s),this._popup=s,this._popup_allow_parent=!0}},o.prototype._ui_change_subpage=function(e,t,s,i,n){var a=this._last_page,r=this._last_subpage=this._last_subpage||{};r[a]=n,i.innerHTML="",i.setAttribute("data-page",n);var l=o.menu_pages[a],c=l.pages[n];c.render.call(this,e,i,t,s),jQuery("li.active",s).removeClass("active"),jQuery("#ffz-menu-page-"+a+"-subpage-"+n,s).addClass("active");var d=!1,h=document.querySelector(".app-main")||document.querySelector(".ember-chat-container");c.hasOwnProperty("wide")?d=c.wide||"function"==typeof c.wide&&c.wide.call(this):l.hasOwnProperty("wide")&&(d=l.wide||"function"==typeof l.wide&&l.wide.call(this)),t.style.maxWidth=d?(h.offsetWidth<640?h.offsetWidth-40:600)+"px":"";var f=this;setTimeout(function(){f._fix_menu_position()})},o.prototype._ui_change_page=function(e,t,s,i,n){this._last_page=n,i.innerHTML="",i.setAttribute("data-page",n);var a=o.menu_pages[n];if(a.pages){var r=document.createElement("ul"),l=document.createElement("div"),c=parseInt(i.style.maxHeight||"0");c||(c=Math.max(200,e.$().height()-172)),c&&!Number.isNaN(c)&&(c-=37,l.style.maxHeight=c+"px"),r.className="menu sub-menu clearfix",l.className="ffz-ui-sub-menu-page";var d=[];for(var h in a.pages){var f=a.pages[h];try{if(!f||f.hasOwnProperty("visible")&&(!f.visible||"function"==typeof f.visible&&!f.visible.call(this,e)))continue}catch(u){this.error("menu_pages "+n+" subpage "+h+" visible: "+u);continue}d.push([f.sort_order||0,h,f])}d.sort(function(e,t){if(e[0]<t[0])return-1;if(e[0]>t[0])return 1;var s=e[1].toLowerCase(),i=t[1].toLowerCase();return i>s?-1:s>i?1:0});for(var _=0;_<d.length;_++){var h=d[_][1],f=d[_][2],m=document.createElement("li"),g=document.createElement("a");m.className="item",m.id="ffz-menu-page-"+n+"-subpage-"+h,g.innerHTML=f.name,g.addEventListener("click",this._ui_change_subpage.bind(this,e,t,r,l,h)),m.appendChild(g),r.appendChild(m)}var p=this._last_subpage=this._last_subpage||{},v=p[n]=p[n]||a.default_page||d[0][1];return"function"==typeof v&&(v=v.call(this)),this._ui_change_subpage(e,t,r,l,v),jQuery("li.active",s).removeClass("active"),jQuery("#ffz-menu-page-"+n,s).addClass("active"),i.appendChild(l),void i.appendChild(r)}a.render.call(this,e,i,t,s),jQuery("li.active",s).removeClass("active"),jQuery("#ffz-menu-page-"+n,s).addClass("active");var b=a.wide||"function"==typeof a.wide&&a.wide.call(this),y=document.querySelector(".app-main")||document.querySelector(".ember-chat-container");t.style.maxWidth=b?(y.offsetWidth<640?y.offsetWidth-40:600)+"px":"";var w=this;setTimeout(function(){w._fix_menu_position()})},o.menu_pages.channel={render:function(t,s){var i=t.get("controller.currentRoom.id"),r=this.rooms[i],c=!1,d=this;if(this.settings.replace_twitch_menu){var h=r.room.get("product");if(h&&!h.get("error")){c=!0;var f=a.ember_resolve("model:ticket"),u=f&&f.find("user",{channel:i}),m=u?u.get("content"):!1,g=u?u.get("isLoaded"):!1,p=r.room.get("badgeSet.subscriber.image"),v=document.createElement("div"),b=document.createElement("div"),y=0;m=m&&m.length>0,!u||m||g||(u.addObserver("isLoaded",function(){setTimeout(function(){"channel"===s.getAttribute("data-page")&&(s.innerHTML="",o.menu_pages.channel.render.bind(d)(t,s))},0)}),u.load()),v.className="emoticon-grid top-set",b.className="heading",p&&(b.style.backgroundImage='url("'+p+'")',-1!==p.indexOf(".svg")&&(b.style.backgroundSize="18px")),b.innerHTML='<span class="right">Twitch</span>Subscriber Emoticons',v.appendChild(b);for(var w=[],z=h.get("emoticons")||[],k=0;k<z.length;k++){var C=z[k];if("active"===C.state){var x=document.createElement("span"),T=m||!C.subscriber_only,S='image-set(url("'+n.TWITCH_BASE+C.id+'/1.0") 1x, url("'+n.TWITCH_BASE+C.id+'/2.0") 2x), url("'+n.TWITCH_BASE+C.id+'/3.0") 4x)';if(x.className="emoticon ffz-tooltip ffz-tooltip-no-credit"+(T?"":" locked"),-1===w.indexOf(C.emoticon_set)&&w.push(C.emoticon_set),C.emoticon_set){var E=this.settings.favorite_emotes["twitch-"+C.emoticon_set];x.classList.add("ffz-can-favorite"),x.classList.toggle("ffz-favorite",E&&-1!==E.indexOf(C.id)||!1)}x.setAttribute("data-emote",C.id),x.alt=C.regex,x.style.backgroundImage='url("'+n.TWITCH_BASE+C.id+'/1.0")',x.style.backgroundImage="-webkit-"+S,x.style.backgroundImage="-moz-"+S,x.style.backgroundImage="-ms-"+S,x.style.backgroundImage=S,x.style.width=10+C.width+"px",x.style.height=10+C.height+"px",x.addEventListener("click",function(s,i,o,n,a){if((a.shiftKey||a.shiftLeft)&&d.settings.clickable_emoticons)e.open("https://twitchemotes.com/emote/"+i);else{if(!s)return;this._add_emote(t,o,"twitch-"+n,i,a)}a.preventDefault()}.bind(this,T,C.id,C.regex,C.emoticon_set)),v.appendChild(x),y++}}if(-1===l.indexOf(h.get("id"))&&w.length&&(l.push(h.get("id")),this.log("Sets for "+h.get("id")+" ["+h.get("ticketProductId")+"]: "+JSON.stringify(w)),this.ws_send("report_twitch_set",[h.get("id"),h.get("ticketProductId"),w])),y>0&&s.appendChild(v),y>0&&!m){var M=document.createElement("div"),L=document.createElement("div"),A=document.createElement("span"),O=document.createElement("a");M.className="subscribe-message",L.className="non-subscriber-message",M.appendChild(L),A.className="unlock-text",A.innerHTML="Subscribe to unlock Emoticons",L.appendChild(A),O.className="action js-sub-button subscribe-button button button--purchase",O.href=h.get("product_url"),O.innerHTML='<span class="subscribe-text">Subscribe</span><span class="subscribe-price button__num-block">'+h.get("price")+"</span>",L.appendChild(O),s.appendChild(M)}else if(y>0){var I=u.get("content");if(I=I.length>0?I[I.length-1]:void 0,I&&I.purchase_profile&&!I.purchase_profile.will_renew){var R=a.parse_date(I.access_end||"");M=document.createElement("div"),L=document.createElement("div"),A=document.createElement("span"),now=Date.now()-(this._ws_server_offset||0),end_time=R?Math.floor((R.getTime()-now)/1e3):null,M.className="subscribe-message",L.className="non-subscriber-message",M.appendChild(L),A.className="unlock-text",A.innerHTML="Subscription expires in "+a.time_to_string(end_time,!0,!0),L.appendChild(A),s.appendChild(M)}}}}var F=_.union(r&&r.extra_sets||[],r&&r.ext_sets||[],[]);this._emotes_for_sets(s,t,r&&r.set&&[r.set]||[],this.feature_friday||c||F.length?"Channel Emoticons":null,r&&r.moderator_badge||"//cdn.frankerfacez.com/script/devicon.png","FrankerFaceZ",!c&&F.length);for(var k=0;k<F.length;k++){var H=this.emote_sets[F[k]],D=H?(H.hasOwnProperty("source_ext")?"":"Featured ")+H.title:"Featured Channel";this._emotes_for_sets(s,t,[F[k]],D,H.icon||"//cdn.frankerfacez.com/script/devicon.png",H.source||"FrankerFaceZ")}this._feature_friday_ui(i,s,t)},name:"Channel",icon:n.ZREKNARF},o.prototype._emotes_for_sets=function(t,s,i,o,n,a,r){var l=document.createElement("div"),c=0,d=this;if(l.className="emoticon-grid",r&&l.classList.add("top-set"),null!=o){var h=document.createElement("div");if(h.className="heading",a){var f=document.createElement("span");f.className="right",f.appendChild(document.createTextNode(a)),h.appendChild(f)}h.appendChild(document.createTextNode(o)),n&&(h.style.backgroundImage='url("'+n+'")',-1!==n.indexOf(".svg")&&(h.style.backgroundSize="18px")),l.appendChild(h)}for(var u=[],_=0;_<i.length;_++){var m=this.emote_sets[i[_]];if(m&&m.emoticons)for(var g in m.emoticons)m.emoticons.hasOwnProperty(g)&&!m.emoticons[g].hidden&&u.push(m.emoticons[g])}u.sort(function(e,t){var s=e.name.toLowerCase(),i=t.name.toLowerCase();return i>s?-1:s>i?1:0});for(var _=0;_<u.length;_++){var p=u[_],v=null;(p.urls[2]||p.urls[4])&&(v='url("'+p.urls[1]+'") 1x',p.urls[2]&&(v+=', url("'+p.urls[2]+'") 2x'),p.urls[4]&&(v+=', url("'+p.urls[4]+'") 4x')),c++;var f=document.createElement("span");if(f.className="emoticon ffz-tooltip",f.setAttribute("data-ffz-emote",p.id),f.setAttribute("data-ffz-set",m.id),f.style.backgroundImage='url("'+p.urls[1]+'")',v){var b="image-set("+v+")";f.style.backgroundImage="-webkit-"+b,f.style.backgroundImage="-moz-"+b,f.style.backgroundImage="-ms-"+b,f.style.backgroundImage=b}f.style.width=10+p.width+"px",f.style.height=10+p.height+"px",f.addEventListener("click",function(t,i,o){if(o.preventDefault(),(o.shiftKey||o.shiftLeft)&&d.settings.clickable_emoticons){var n;if(m.hasOwnProperty("source_ext")){var a=d._apis[m.source_ext];a&&a.emote_url_generator&&(n=a.emote_url_generator(m.source_id,t))}else n="https://www.frankerfacez.com/emoticon/"+t;n&&e.open(n)}else this._add_emote(s,i)}.bind(this,p.id,p.name)),l.appendChild(f)}c||(l.innerHTML+="This channel has no emoticons.",l.className="emoticon-grid ffz-no-emotes center"),t.appendChild(l)},o.prototype._add_emote=function(e,t,s,i,o){if(o&&(!r&&o.ctrlKey||r&&o.metaKey)){var n=o.target;if(!n.classList.contains("locked")&&n.classList.contains("ffz-can-favorite")&&s&&i){var a=this.settings.favorite_emotes[s]=this.settings.favorite_emotes[s]||[],l=-1!==a.indexOf(i);l?a.removeObject(i):a.push(i),this.settings.set("favorite_emotes",this.settings.favorite_emotes,!0),n.classList.contains("ffz-is-favorite")&&l?(jQuery(n).trigger("mouseout"),n.parentElement.removeChild(n)):n.classList.toggle("ffz-favorite",!l)}}else{var c,d,h;this.has_bttv?(c=e.get("element").querySelector("textarea"),d=c.value):(h=e.get("controller.currentRoom"),d=h.get("messageToSend")||""),d+=(d&&" "!==d.substr(-1)?" ":"")+(t.name||t),c?c.value=d:h.set("messageToSend",d)}}},{"../constants":6,"../utils":53}],44:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils");o.prototype.build_ui_link=function(e){var t=document.createElement("a");return t.className="ffz-ui-toggle",t.innerHTML=n.CHAT_BUTTON,t.addEventListener("click",this.build_ui_popup.bind(this,e)),this.update_ui_link(t),t},o.prototype.update_ui_link=function(e){var t=a.ember_lookup("controller:chat");if(e=e||document.querySelector("a.ffz-ui-toggle"),e&&t){var s=t.get("currentRoom.id"),i=this.rooms[s],o=!1,n=this.has_bttv?BetterTTV.settings.get("showBlueButtons"):!1,r=this.feature_friday&&this.feature_friday.live;if(i&&i.set){var l=this.emote_sets[i.set];l&&l.count>0&&(o=!0)}e.classList.toggle("no-emotes",!o),e.classList.toggle("live",r),e.classList.toggle("blue",n)}}},{"../constants":6,"../utils":53}],45:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils");o.basic_settings.replace_twitch_menu={type:"boolean",category:"Chat",name:"Unified Emoticons Menu",help:"Completely replace the default Twitch emoticon menu and display global emoticons in the My Emoticons menu.",get:function(){return this.settings.replace_twitch_menu&&this.settings.global_emotes_in_menu&&this.settings.emoji_in_menu},set:function(e){this.settings.set("replace_twitch_menu",e),this.settings.set("global_emotes_in_menu",e),this.settings.set("emoji_in_menu",e)}},o.settings_info.replace_twitch_menu={type:"boolean",value:!1,category:"Chat Input",name:"Replace Twitch Emoticon Menu",help:"Completely replace the default Twitch emoticon menu.",on_update:function(e){document.body.classList.toggle("ffz-menu-replace",e)}},o.settings_info.global_emotes_in_menu={type:"boolean",value:!1,category:"Chat Input",name:"Display Global Emotes in My Emotes",help:"Display the global Twitch emotes in the My Emoticons menu."},o.settings_info.emoji_in_menu={type:"boolean",value:!0,category:"Chat Input",name:"Display Emoji in My Emotes",help:"Display the supported emoji images in the My Emoticons menu."},o.settings_info.emote_menu_collapsed={storage_key:"ffz_setting_my_emoticons_collapsed_sections",value:[],visible:!1},o.settings_info.favorite_emotes={value:{},visible:!1},o.prototype.setup_my_emotes=function(){this._twitch_badges={},this._twitch_badges["--global--"]="//cdn.frankerfacez.com/script/twitch_logo.png",this._twitch_badges["--turbo-faces--"]=this._twitch_badges.turbo="//cdn.frankerfacez.com/script/turbo_badge.png"},o.menu_pages.myemotes={name:"My Emoticons",icon:n.EMOTE,has_sets:function(e){var t=this.get_user(),s=e&&e.get("controller.currentRoom.tmiSession"),i=t&&this.users[t.login]&&this.users[t.login].sets||[],o=(s&&s.getEmotes()||{
emoticon_sets:{}}).emoticon_sets,n=o&&Object.keys(o);return n&&!this.settings.global_emotes_in_menu&&-1!==n.indexOf("0")&&n.removeObject("0"),i.length||n&&n.length},visible:function(e){return this.settings.emoji_in_menu||o.menu_pages.myemotes.has_sets.call(this,e)},default_page:function(){for(var e in this.settings.favorite_emotes)if(this.settings.favorite_emotes[e]&&this.settings.favorite_emotes[e].length)return"favorites";return"all"},pages:{favorites:{name:"Favorites",sort_order:1,render:function(e,t){o.menu_pages.myemotes.render_lists.call(this,e,t,!0);var s=document.createElement("div");s.className="emoticon-grid ffz-no-emotes center",s.innerHTML='You have no favorite emoticons.<br> <img src="//cdn.frankerfacez.com/emoticon/26608/2"><br>To make an emote a favorite, find it on the <nobr>All Emoticons</nobr> tab and <nobr>'+(n.IS_OSX?"⌘":"Ctrl")+"-Click</nobr> it.",t.appendChild(s)}},all:{name:"All Emoticons",sort_order:2,visible:function(e){return o.menu_pages.myemotes.has_sets.call(this,e)},render:function(e,t){o.menu_pages.myemotes.render_lists.call(this,e,t,!1)}},emoji:{name:"Emoji",sort_order:3,visible:function(){return this.settings.emoji_in_menu},render:function(e,t){var s=[];for(var i in n.EMOJI_CATEGORIES){var a=o.menu_pages.myemotes.draw_emoji.call(this,e,i,!1);a&&s.push([i,a])}s.sort(function(e,t){var s=e[0],i=t[0];return i>s?-1:s>i?1:0}),s.length&&s[0][1].classList.add("top-set");for(var r=0;r<s.length;r++)t.appendChild(s[r][1])}}},render_lists:function(e,t,s){var i=e.get("controller.currentRoom.tmiSession"),n=(i&&i.getEmotes()||{emoticon_sets:{}}).emoticon_sets,a=this.get_user(),r=this.getEmotes(a&&a.login,null),l=[];for(var c in n)if(n.hasOwnProperty(c)&&(this.settings.global_emotes_in_menu||"0"!==c)){var d=this.settings.favorite_emotes["twitch-"+c];if(!s||d&&d.length){var h=n[c];if(h.length){var f=o.menu_pages.myemotes.draw_twitch_set.call(this,e,c,h,s);f&&l.push([this._twitch_set_to_channel[c],f])}}}if(s&&this.settings.emoji_in_menu){var d=this.settings.favorite_emotes.emoji;if(d&&d.length){var f=o.menu_pages.myemotes.draw_emoji.call(this,e,null,s);f&&l.push(["emoji",f])}}for(var u=0;u<r.length;u++){var c=r[u],h=this.emote_sets[c],_=h.hasOwnProperty("source_ext")?"ffz-ext-"+h.source_ext+"-"+h.source_id:"ffz-"+h.id,d=this.settings.favorite_emotes[_];if((!s||d&&d.length)&&h&&h.count&&(this.settings.global_emotes_in_menu||-1===this.default_sets.indexOf(c))){var f=o.menu_pages.myemotes.draw_ffz_set.call(this,e,h,s);f&&l.push([h.title.toLowerCase(),f])}}if(!l.length)return!1;if(l.sort(function(e,t){var s=e[0],i=t[0];return"turbo"===s||"--turbo-faces--"===s?s="zza|"+s:"global"===s||s&&"global emoticons"===s.substr(0,16)||"--global--"===s?s="zzy|"+s:"emoji"===s.substr(0,5)&&(s="zzz|"+s),"turbo"===i||"--turbo-faces--"===i?i="zza|"+i:"global"===i||i&&"global emoticons"===i.substr(0,16)||"--global--"===i?i="zzy|"+i:"emoji"===i.substr(0,5)&&(i="zzz|"+i),i>s?-1:s>i?1:0}),s){var m=document.createElement("div");m.className="emoticon-grid favorites-grid";for(var u=0;u<l.length;u++)m.appendChild(l[u][1]);t.appendChild(m)}else if(l.length){l[0][1].classList.add("top-set");for(var u=0;u<l.length;u++)t.appendChild(l[u][1])}return!0},toggle_section:function(e,t){var s=e.parentElement,i=s.getAttribute("data-set"),o=this.settings.emote_menu_collapsed,n=-1===o.indexOf(i);n?o.push(i):o.removeObject(i),this.settings.set("emote_menu_collapsed",o,!0),s.classList.toggle("collapsed",!n),n?s.appendChild(t):s.removeChild(t)},draw_emoji:function(e,t,s){var i=document.createElement("div"),r=document.createElement("div"),l="emoji"+(t?"-"+t:""),c=s?document.createDocumentFragment():document.createElement("div"),d=!s&&-1===this.settings.emote_menu_collapsed.indexOf(l),h=this,f=this.settings.parse_emoji||1,u=this.settings.favorite_emotes.emoji||[],_=0;r.className="emoticon-grid",r.setAttribute("data-set",l),s||(i.className="heading",i.innerHTML='<span class="right">Unicode</span>'+(t?a.sanitize(n.EMOJI_CATEGORIES[t]):"Emoji"),i.style.backgroundImage='url("'+n.SERVER+"emoji/"+(3===f?"one/":2===f?"noto-":"tw/")+(n.EMOJI_LOGOS[t]||"1f4af")+'.svg")',i.style.backgroundSize="18px",r.classList.add("collapsable"),r.appendChild(i),r.classList.toggle("collapsed",d),i.addEventListener("click",function(){o.menu_pages.myemotes.toggle_section.bind(h)(this,c)}));var m=[];for(var g in this.emoji_data)m.push(this.emoji_data[g]);m.sort(function(e,t){var s=(e.name||"").toLowerCase(),i=(t.name||"").toLowerCase();return i>s?-1:s>i?1:e.raw<t.raw?-1:e.raw>t.raw?1:0});for(var p=0;p<m.length;p++){var v=m[p],b=document.createElement("span");if(!(t&&t!==v.cat||1===f&&!v.tw||2===f&&!v.noto||3===f&&!v.one)){{var y=-1!==u.indexOf(v.raw),w=3===f?v.one_src:2===f?v.noto_src:v.tw_src;this.settings.emote_image_hover?'<img class="emoticon ffz-image-hover" src="'+w+'">':""}(!s||y)&&(b.className="emoticon emoji ffz-tooltip ffz-can-favorite",b.classList.toggle("ffz-favorite",y),b.classList.toggle("ffz-is-favorite",s),b.setAttribute("data-ffz-emoji",v.code),b.alt=v.raw,b.addEventListener("click",this._add_emote.bind(this,e,v.raw,"emoji",v.raw)),b.style.backgroundImage='url("'+w+'")',b.style.backgroundSize="18px",_++,c.appendChild(b))}}return _?s?c:(d||r.appendChild(c),r):void 0},draw_twitch_set:function(t,s,i,r){var l,c=document.createElement("div"),d=document.createElement("div"),h=r?document.createDocumentFragment():document.createElement("div"),f=!r&&-1===this.settings.emote_menu_collapsed.indexOf("twitch-"+s),u=this,_=this._twitch_set_to_channel[s],m=this.settings.favorite_emotes["twitch-"+s]||[],g=0;if(d.className="emoticon-grid",d.setAttribute("data-set","twitch-"+s),!r){if(l="twitch_unknown"===_?"Unknown Channel":"--global--"===_?"Global Emoticons":"turbo"===_||"--turbo-faces--"===_?"Twitch Turbo":o.get_capitalization(_,function(e){c.innerHTML='<span class="right">Twitch</span>'+a.sanitize(e)}),c.className="heading",c.innerHTML='<span class="right">Twitch</span>'+a.sanitize(l),this._twitch_badges[_])c.style.backgroundImage='url("'+this._twitch_badges[_]+'")';else{var u=this;a.api.get("chat/"+_+"/badges",null,{version:3}).done(function(e){e.subscriber&&e.subscriber.image&&(u._twitch_badges[_]=e.subscriber.image,localStorage.ffzTwitchBadges=JSON.stringify(u._twitch_badges),c.style.backgroundImage='url("'+e.subscriber.image+'")')})}d.classList.add("collapsable"),d.appendChild(c),d.classList.toggle("collapsed",f),c.addEventListener("click",function(){o.menu_pages.myemotes.toggle_section.bind(u)(this,h)})}i.sort(function(e,t){var s=e.code.toLowerCase(),i=t.code.toLowerCase();return i>s?-1:s>i?1:e.id<t.id?-1:e.id>t.id?1:0});for(var p=0;p<i.length;p++){var v=i[p],b=n.KNOWN_CODES[v.code]||v.code,y=-1!==m.indexOf(v.id);if(!r||y){var w=document.createElement("span"),z='image-set(url("'+n.TWITCH_BASE+v.id+'/1.0") 1x, url("'+n.TWITCH_BASE+v.id+'/2.0") 2x)';w.className="emoticon ffz-tooltip ffz-can-favorite",w.setAttribute("data-emote",v.id),w.alt=b,w.classList.toggle("ffz-favorite",y),w.classList.toggle("ffz-is-favorite",r),w.classList.toggle("ffz-tooltip-no-credit",!r),this.settings.replace_bad_emotes&&n.EMOTE_REPLACEMENTS[v.id]?w.style.backgroundImage='url("'+n.EMOTE_REPLACEMENT_BASE+n.EMOTE_REPLACEMENTS[v.id]+'")':(w.style.backgroundImage='url("'+n.TWITCH_BASE+v.id+'/1.0")',w.style.backgroundImage="-webkit-"+z,w.style.backgroundImage="-moz-"+z,w.style.backgroundImage="-ms-"+z,w.style.backgroundImage=z),w.addEventListener("click",function(i,o,n){n.preventDefault(),(n.shiftKey||n.shiftLeft)&&u.settings.clickable_emoticons?e.open("https://twitchemotes.com/emote/"+i):this._add_emote(t,o,"twitch-"+s,i,n)}.bind(this,v.id,b)),g++,h.appendChild(w)}}return g?r?h:(f||d.appendChild(h),d):void 0},draw_ffz_set:function(t,s,i){var n=document.createElement("div"),r=document.createElement("div"),l=i?document.createDocumentFragment():document.createElement("div"),c=this,d=[],h=s.hasOwnProperty("source_ext")?"ffz-ext-"+s.source_ext+"-"+s.source_id:"ffz-"+s.id,f=this.settings.favorite_emotes[h]||[],u=0,_=s.icon||s.hasOwnProperty("source_ext")&&"//cdn.frankerfacez.com/emoji/tw-1f4ac.svg"||"//cdn.frankerfacez.com/script/devicon.png",m=!i&&-1===this.settings.emote_menu_collapsed.indexOf(h);r.className="emoticon-grid",r.setAttribute("data-set",h),i||(r.classList.add("collapsable"),n.className="heading",n.innerHTML='<span class="right">'+(a.sanitize(s.source)||"FrankerFaceZ")+"</span>"+s.title,n.style.backgroundImage='url("'+_+'")',-1!==_.indexOf(".svg")&&(n.style.backgroundSize="18px"),r.appendChild(n),r.classList.toggle("collapsed",m),n.addEventListener("click",function(){o.menu_pages.myemotes.toggle_section.bind(c)(this,l)}));for(var g in s.emoticons)s.emoticons.hasOwnProperty(g)&&!s.emoticons[g].hidden&&d.push(s.emoticons[g]);d.sort(function(e,t){var s=e.name.toLowerCase(),i=t.name.toLowerCase();return i>s?-1:s>i?1:e.id<t.id?-1:e.id>t.id?1:0});for(var p=0;p<d.length;p++){var v=d[p],b=-1!==f.indexOf(v.id);if(!i||b){var y=document.createElement("span"),w='image-set(url("'+v.urls[1]+'") 1x';v.urls[2]&&(w+=', url("'+v.urls[2]+'") 2x'),v.urls[4]&&(w+=', url("'+v.urls[4]+'") 4x'),w+=")",y.className="emoticon ffz-tooltip ffz-can-favorite",y.classList.toggle("ffz-favorite",b),y.classList.toggle("ffz-is-favorite",i),y.setAttribute("data-ffz-emote",v.id),y.setAttribute("data-ffz-set",s.id),y.style.backgroundImage='url("'+v.urls[1]+'")',y.style.backgroundImage="-webkit-"+w,y.style.backgroundImage="-moz-"+w,y.style.backgroundImage="-ms-"+w,y.style.backgroundImage=w,v.height&&(y.style.height=10+v.height+"px"),v.width&&(y.style.width=10+v.width+"px"),y.addEventListener("click",function(i,o,n){if(n.preventDefault(),(n.shiftKey||n.shiftLeft)&&c.settings.clickable_emoticons){var a;if(s.hasOwnProperty("source_ext")){var r=c._apis[s.source_ext];r&&r.emote_url_generator&&(a=r.emote_url_generator(s.source_id,i))}else a="https://www.frankerfacez.com/emoticons/"+i;a&&e.open(a)}else this._add_emote(t,o,h,i,n)}.bind(this,v.id,v.name)),u++,l.appendChild(y)}}return u?i?l:(m||r.appendChild(l),r):void 0}}},{"../constants":6,"../utils":53}],46:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");o.prototype.setup_notifications=function(){this.log("Adding event handler for window focus."),e.addEventListener("focus",this.clear_notifications.bind(this))},o.settings_info.server_messages={type:"boolean",value:!0,category:"Appearance",name:"Server Notifications",help:"Display global FrankerFaceZ notifications."},o.settings_info.highlight_notifications={type:"boolean",value:!1,category:"Chat Filtering",no_bttv:!0,no_mobile:!0,name:"Highlight Notifications",help:"Display notifications when a highlighted word appears in chat in an unfocused tab. This is automatically disabled on the dashboard.",on_update:function(e,t){if(e&&t){if("denied"===Notification.permission)return this.log("Notifications have been denied by the user."),void this.settings.set("highlight_notifications",!1);if("granted"!==Notification.permission){var s=this;Notification.requestPermission(function(e){"denied"===e&&(s.log("Notifications have been denied by the user."),s.settings.set("highlight_notifications",!1))})}}}},o.settings_info.notification_timeout={type:"button",value:60,category:"Chat Filtering",no_bttv:!0,no_mobile:!0,name:"Notification Timeout",help:"Specify how long notifications should be displayed before automatically closing.",method:function(){var e=this;n.prompt("Notification Timeout","Please enter the time you'd like notifications to be displayed before automatically closing, in seconds.</p><p><b>Default:</b> 60",this.settings.notification_timeout,function(t){null!==t&&void 0!==t&&(t=parseInt(t),(Number.isNaN(t)||!Number.isFinite(t)||1>t)&&(t=60),e.settings.set("notification_timeout",t))})}},o.ws_commands.message=function(e){this.settings.server_messages&&this.show_message(e)},o._notifications={},o._last_notification=0,o.prototype.clear_notifications=function(){for(var e in o._notifications){var t=o._notifications[e];if(t)try{t.close()}catch(s){}}o._notifications={},o._last_notification=0},o.prototype.show_notification=function(e,t,s,i,n,a){var r=Notification.permission;if("denied "===r)return!1;if("granted"===r){t=t||"FrankerFaceZ",i=i||1e3*this.settings.notification_timeout;var l={lang:"en-US",dir:"ltr",body:e,tag:s||"FrankerFaceZ",icon:"//cdn.frankerfacez.com/icon32.png"},c=this,d=new Notification(t,l),h=o._last_notification++;return o._notifications[h]=d,d.addEventListener("click",function(){delete o._notifications[h],n&&n.bind(c)()}),d.addEventListener("close",function(){delete o._notifications[h],a&&a.bind(c)()}),void("number"==typeof i&&d.addEventListener("show",function(){setTimeout(function(){delete o._notifications[h],d.close()},i)}))}var c=this;Notification.requestPermission(function(i){c.show_notification(e,t,s)})},o.prototype.show_message=function(t){return e.jQuery&&e.jQuery.noty&&jQuery.noty.themes.ffzTheme?void e.noty({text:t,template:'<div class="noty_message"><span class="noty_text"></span><div class="noty_close">'+a.CLOSE+"</div></div>",theme:"ffzTheme",layout:"bottomCenter",closeWith:["button"]}).show():void setTimeout(this.show_message.bind(this,t),50)}},{"../constants":6,"../utils":53}],47:[function(t,s,i){{var o=e.FrankerFaceZ;t("../constants")}o.prototype.setup_popups=function(){this.log("Installing mouse-up event to auto-close pop-ups.");var e=this;jQuery(document).mouseup(function(t){if(!t.button||0===t.button){var s=document.getElementById("ffz-modal-container");if(!s||s!==t.target&&!s.contains(t.target)){var i=e._popup,o=e._popup_parent;if(i||(e._last_popup=void 0),!(!i||i===t.target||i.contains(t.target)||"ffz-chat-menu"===i.id&&i.style&&i.style.left)){if(e._popup_allow_parent){var o=e._popup_parent||i.parentElement;if(o&&(o===t.target||o.contains(t.target)))return}e.close_popup()}}}})},o.prototype.close_popup=function(){var e=this._popup;if(this._last_popup=e,e){if(e.parentElement.removeChild(e),this._popup_kill)try{this._popup_kill()}catch(t){this.error("_popup_kill: "+t)}return this._popup=void 0,this._popup_parent=void 0,this._popup_kill=void 0,this._popup_allow_parent=void 0,e}},o.prototype.show_popup=function(e,t,s,i,o,n){this._popup&&this.close_popup(),this._popup=e,this._popup_allow_parent=o||!1,this._popup_kill=i,s=s||document.querySelector(".app-main")||document.body;var a=s.getBoundingClientRect();e.style.display="block",e.style.position="absolute",e.style.left=t[0]-a.left+"px",e.style.top=t[1]-a.top+"px",s.appendChild(e)}},{"../constants":6}],48:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils");o.prototype.setup_races=function(){this.log("Initializing race support."),this.srl_races={}},o.settings_info.srl_races={type:"boolean",value:!0,no_mobile:!0,category:"Channel Metadata",name:"SRL Race Information",help:'Display information about <a href="http://www.speedrunslive.com/" target="_new">SpeedRunsLive</a> races under channels.',on_update:function(e){this.rebuild_race_ui()}},o.ws_on_close.push(function(){var e=n.ember_lookup("controller:channel"),t=e&&e.get("content.id"),s=e&&e.get("hostModeTarget.id"),i=!1;if(e){for(var o in this.srl_races)delete this.srl_races[o],(o===t||o===s)&&(i=!0);i&&this.rebuild_race_ui()}}),o.ws_commands.srl_race=function(e){var t=n.ember_lookup("controller:channel"),s=t&&t.get("content.id"),i=t&&t.get("hostModeTarget.id"),o=!1;this.srl_races=this.srl_races||{};for(var a=0;a<e[0].length;a++){var r=e[0][a];this.srl_races[r]=e[1],(r===s||r===i)&&(o=!0)}if(e[1]){var l=e[1],c=l.twitch_entrants={};for(var d in l.entrants)l.entrants.hasOwnProperty(d)&&(l.entrants[d].channel&&(c[l.entrants[d].channel]=d),l.entrants[d].name=d)}o&&this.rebuild_race_ui()},o.prototype.rebuild_race_ui=function(){var e=n.ember_lookup("controller:channel"),t=e&&e.get("content.id"),s=e&&e.get("hostModeTarget.id");if(this._cindex){if(t){var i=this.srl_races&&this.srl_races[t],o=this._cindex.get("element"),a=o&&o.querySelector(".stats-and-actions .channel-actions"),r=a&&a.querySelector("#ffz-ui-race");if(a&&this.settings.srl_races&&i){if(!r){r=n.createElement("span","balloon-wrapper inline"),r.id="ffz-ui-race",r.setAttribute("data-channel",t);var l=document.createElement("span");l.className="button button--text button--dropmenu",l.title="SpeedRunsLive Race",l.innerHTML='<span class="logo"></span>',l.addEventListener("click",this._build_race_popup.bind(this,r,t)),r.appendChild(l),a.appendChild(r)}this._update_race(r,!0)}else r&&r.parentElement.removeChild(r)}if(s){var i=this.srl_races&&this.srl_races[s],o=this._cindex.get("element"),a=o&&o.querySelector("#hostmode .channel-actions"),r=a&&a.querySelector("#ffz-ui-race");if(a&&this.settings.srl_races&&i){if(!r){r=n.createElement("span","balloon-wrapper inline"),r.id="ffz-ui-race",r.setAttribute("data-channel",s);var l=document.createElement("span");l.className="button button--text button--dropmenu",l.title="SpeedRunsLive Race",l.innerHTML='<span class="logo"></span>',l.addEventListener("click",this._build_race_popup.bind(this,r,s)),r.appendChild(l),a.appendChild(r)}this._update_race(r,!0)}else r&&r.parentElement.removeChild(r)}}},o.prototype._race_kill=function(){this._race_timer&&(clearTimeout(this._race_timer),delete this._race_timer),delete this._race_game,delete this._race_goal},o.prototype._build_race_popup=function(e,t){var s=this.close_popup();if((!s||"ffz-race-popup"!==s.id||s.getAttribute("data-channel")!==t)&&e){var i=e.querySelector(".button"),a=(i.offsetLeft+i.offsetWidth,this.srl_races[t]),s=n.createElement("div","share balloon balloon--md balloon--up balloon--dropmenu"),r="";s.id="ffz-race-popup",s.setAttribute("data-channel",t),this._popup_kill=this._race_kill.bind(this),this._popup_allow_parent=!0,this._popup=s;var l="http://kadgar.net/live",c=!1;for(var d in a.entrants){var h=a.entrants[d].state;a.entrants.hasOwnProperty(d)&&a.entrants[d].channel&&("racing"==h||"entered"==h)&&(l+="/"+a.entrants[d].channel,c=!0)}var f=document.querySelector(".app-main.theatre")?document.body.clientHeight-300:e.parentElement.parentElement.offsetTop-175,u=n.ember_lookup("controller:channel"),_=u&&u.get("content.id")===t?u.get("content.display_name"):o.get_capitalization(t),m=encodeURIComponent("I'm watching "+_+" race "+a.goal+" in "+a.game+" on SpeedRunsLive!");r='<div class="heading"><div></div><span class="html-tooltip"></span></div>',r+='<div class="table" style="max-height:'+f+'px"><table><thead><tr><th>#</th><th>Entrant</th><th>&nbsp;</th><th>Time</th></tr></thead>',r+="<tbody></tbody></table></div>",r+='<iframe class="twitter_share_button" style="width:130px; height:25px" src="https://platform.twitter.com/widgets/tweet_button.html?text='+m+"%20Watch%20at&via=Twitch&url=http://www.twitch.tv/"+t+'"></iframe>',r+='<p class="right"><a target="_new" href="http://www.speedrunslive.com/race/?id='+a.id+'">SRL</a>',c&&(r+=' &nbsp; <a target="_new" href="'+l+'">Multitwitch</a>'),r+="</p>",s.innerHTML=r,e.appendChild(s),this._update_race(e,!0)}},o.prototype._update_race=function(e,t){if(this._race_timer&&t&&(clearTimeout(this._race_timer),delete this._race_timer),e){var s=e.getAttribute("data-channel"),i=this.srl_races[s];if(!i)return e.parentElement.removeChild(e),void(this._popup&&"ffz-race-popup"===this._popup.id&&this._popup.getAttribute("data-channel")===s&&this.close_popup());var o=i.twitch_entrants[s],a=i.entrants[o],r=e.querySelector("#ffz-race-popup"),l=(Date.now()-(this._ws_server_offset||0))/1e3,c=Math.floor(l-i.time);if(e.querySelector(".logo").innerHTML=n.placement(a),r){var d=r.querySelector("tbody"),h=r.querySelector(".heading > span"),f=r.querySelector(".heading div");jQuery(".html-tooltip",d).trigger("mouseout"),d.innerHTML="";var u=[],_=!0;for(var m in i.entrants)i.entrants.hasOwnProperty(m)&&("racing"==i.entrants[m].state&&(_=!1),u.push(i.entrants[m]));u.sort(function(e,t){var s=e.place||9999,i=t.place||9999,o=e.time||c,n=t.time||c;return("forfeit"==e.state||"dq"==e.state)&&(s=1e4),("forfeit"==t.state||"dq"==t.state)&&(i=1e4),i>s?-1:s>i?1:e.name<t.name?-1:e.name>t.name?1:n>o?-1:o>n?1:void 0});for(var g=0;g<u.length;g++){var m=u[g],p='<a target="_new" href="http://www.speedrunslive.com/profiles/#!/'+n.sanitize(m.name)+'">'+m.display_name+"</a>",v=m.channel?'<a target="_new" class="twitch" href="//www.twitch.tv/'+n.sanitize(m.channel)+'"></a>':"",b=m.hitbox?'<a target="_new" class="hitbox" href="http://www.hitbox.tv/'+n.sanitize(m.hitbox)+'"></a>':"",y=c?n.time_to_string(m.time||c):"",w=n.place_string(m.place),z=m.comment?n.quote_san(m.comment):"";d.innerHTML+="<tr"+(z?' title="'+z+'"':"")+' class="'+m.state+(z?" html-tooltip":"")+'"><td>'+w+"</td><td>"+p+"</td><td>"+v+b+'</td><td class="time">'+("forfeit"==m.state?"Forfeit":y)+"</td></tr>"}if(this._race_game!=i.game||this._race_goal!=i.goal){this._race_game=i.game,this._race_goal=i.goal;var k=n.quote_san(i.game),C=n.unquote_attr(i.goal),x=r.getAttribute("data-old-goal");C!==x&&(r.setAttribute("data-old-goal",C),C=C?this.render_tokens(this.tokenize_line("jtv",null,C,!0)):"",f.innerHTML='<h2 class="html-tooltip" title="'+k+'">'+k+'</h2><span class="goal"><b>Goal: </b>'+C+"</span>")}i.time!=h.getAttribute("data-time")&&(h.setAttribute("data-time",i.time),h.setAttribute("original-title",i.time?"Started at: <nobr>"+n.sanitize(n.parse_date(1e3*i.time).toLocaleString())+"</nobr>":"")),c?_?h.innerHTML="Done":(h.innerHTML=n.time_to_string(c),this._race_timer=setTimeout(this._update_race.bind(this,e),1e3)):h.innerHTML="Entry Open"}}}},{"../utils":53}],49:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");styles=t("../compiled_styles"),o.prototype.setup_css=function(){document.body.classList.toggle("ffz-flip-dashboard",this.settings.flip_dashboard),this.log("Injecting main FrankerFaceZ CSS.");var t=this._main_style=document.createElement("link");t.id="ffz-main-css",t.setAttribute("rel","stylesheet"),t.setAttribute("href",a.SERVER+"script/style"+(a.DEBUG?"":".min")+".css?_="+(a.DEBUG?Date.now():o.version_info)),document.head.appendChild(t),this.log("Readying toggleable styles."),this._toggle_style_state={},t=this._toggle_style=document.createElement("style"),t.type="text/css",t.id="ffz-toggle-css",document.head.appendChild(t),e.jQuery&&jQuery.noty&&(jQuery.noty.themes.ffzTheme={name:"ffzTheme",style:function(){this.$bar.removeClass().addClass("noty_bar").addClass("ffz-noty").addClass(this.options.type)},callback:{onShow:function(){},onClose:function(){}}})},o.prototype.toggle_style=function(e,t){var s=this._toggle_style_state[e];t&&s||!t&&!s||(this._toggle_style_state[e]=t,n.update_css(this._toggle_style,e,t?styles[e]||null:null))}},{"../compiled_styles":5,"../constants":6,"../utils":53}],50:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils");o.prototype._update_subscribers=function(){this._update_subscribers_timer&&(clearTimeout(this._update_subscribers_timer),delete this._update_subscribers_timer),this._update_subscribers_timer=setTimeout(this._update_subscribers.bind(this),6e4);var e=this.get_user(),t=this,s=this.is_dashboard?location.pathname.match(/\/([^\/]+)/):void 0,i=this.is_dashboard&&s&&s[1];if(this.has_bttv||!i||i!==e.login){var o=document.querySelector("#ffz-sub-display");return void(o&&o.parentElement.removeChild(o))}jQuery.getJSON("/"+i+"/dashboard/revenue/summary_data").done(function(e){var s,o=e&&e.data&&e.data.total_subscriptions;if("string"==typeof o&&(o=parseInt(o.replace(/[,\.]/g,""))),"number"!=typeof o||0===o||o===0/0||o===1/0){s=document.querySelector("#ffz-sub-display"),s&&s.parentElement.removeChild(s);var r=t._failed_sub_checks=(t._failed_sub_checks||0)+1;return void(t._update_subscribers_timer&&r>=5&&(t.log("Subscriber count failed 5 times. Giving up."),clearTimeout(t._update_subscribers_timer),delete t._update_subscribers_timer))}if(t._dash_chart&&(t._dash_chart.series[3].options.showInLegend||(t._dash_chart.series[3].options.showInLegend=!0,t._dash_chart.legend.renderLegend()),t._dash_chart.series[3].addPoint({x:a.last_minute(),y:o})),s=document.querySelector("#ffz-sub-display span"),!s){var l=document.querySelector(t.is_dashboard?"#stats":"#channel .stats-and-actions .channel-stats");if(!l)return;var c=document.createElement("span");c.className="ffz stat",c.id="ffz-sub-display",c.title="Subscribers",c.innerHTML=n.STAR+" ",s=document.createElement("span"),c.appendChild(s),a.api.get("chat/"+i+"/badges",null,{version:3}).done(function(e){e.subscriber&&e.subscriber.image&&(c.innerHTML="",c.appendChild(s),c.style.backgroundImage='url("'+e.subscriber.image+'")',c.style.backgroundRepeat="no-repeat",c.style.paddingLeft="23px",c.style.backgroundPosition="0 50%")}),l.appendChild(c),jQuery(c).tipsy({gravity:t.is_dashboard?"s":a.tooltip_placement(n.TOOLTIP_DISTANCE,"n")})}s.innerHTML=a.number_commas(o)}).fail(function(){var e=document.querySelector("#ffz-sub-display");e&&e.parentElement.removeChild(e)})}},{"../constants":6,"../utils":53}],51:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../utils"),a=t("../constants");o.prototype.fix_tooltips=function(){jQuery(".html-tooltip").tipsy({live:!0,html:!0,gravity:n.tooltip_placement(2*a.TOOLTIP_DISTANCE,"n")}),jQuery(".ffz-tooltip").tipsy({live:!0,html:!0,title:this.render_tooltip(),gravity:n.tooltip_placement(2*a.TOOLTIP_DISTANCE,"n")});var t=n.ember_resolve("component:tipsy-tooltip");if(t&&(this.log("Modifying Tipsy-Tooltip component to use gravity."),t.reopen({didInsertElement:function(){var e=this.get("gravity");e&&"string"!=typeof e||(e=n.tooltip_placement(a.TOOLTIP_DISTANCE,e||"s")),this.$().tipsy({gravity:e})}})),e.jQuery&&jQuery.fn&&jQuery.fn.tipsy&&(jQuery.fn.tipsy.revalidate=function(){jQuery(".tipsy").each(function(){var e=jQuery.data(this,"tipsy-pointee");!(e&&e[0]&&document.contains(e[0])||!jQuery(this).remove())})}),this.log("Fixing already existing tooltips."),e.jQuery&&jQuery.cache)for(var s in jQuery.cache){var i=jQuery.cache[s];i&&i.data&&i.data.tipsy&&i.data.tipsy.options&&"function"!=typeof i.data.tipsy.options.gravity&&(i.data.tipsy.options.gravity=n.tooltip_placement(a.TOOLTIP_DISTANCE,i.data.tipsy.options.gravity||"s"))}}},{"../constants":6,"../utils":53}],52:[function(t,s,i){var o=e.FrankerFaceZ,n=t("../constants"),a=t("../utils");o.ws_commands.chatters=function(e){{var t=e[0],s=e[1],i=a.ember_lookup("controller:channel"),o=this.is_dashboard?location.pathname.match(/\/([^\/]+)/):void 0;this.is_dashboard?o&&o[1]:i&&i.get&&i.get("id")}if(!this.is_dashboard){var n=this.rooms&&this.rooms[t];return void(n&&(n.ffz_chatters=s,this._cindex&&this._cindex.ffzUpdateChatters()))}this._dash_chatters=s},o.ws_commands.viewers=function(e){var t=e[0],s=e[1],i=a.ember_lookup("controller:channel"),o=this.is_dashboard?location.pathname.match(/\/([^\/]+)/):void 0,r=this.is_dashboard?o&&o[1]:i&&i.get&&i.get("id");if(!this.is_dashboard){var l=this.rooms&&this.rooms[t];return void(l&&(l.ffz_viewers=s,this._cindex&&this._cindex.ffzUpdateChatters()))}if(this._dash_viewers=s,this.settings.chatter_count&&r===t){var c=document.querySelector("#ffz-ffzchatter-display"),d=n.ZREKNARF+" "+a.number_commas(s)+("number"==typeof this._dash_chatters?" ("+a.number_commas(this._dash_chatters)+")":"");if(c)c.innerHTML=d;else{var h=document.querySelector("#stats");if(!h)return;c=document.createElement("span"),c.id="ffz-ffzchatter-display",c.className="ffz stat",c.title="Viewers (In Chat) with FrankerFaceZ",c.innerHTML=d,h.appendChild(c),jQuery(c).tipsy({gravity:this.is_dashboard?"s":a.tooltip_placement(n.TOOLTIP_DISTANCE,"n")})}}}},{"../constants":6,"../utils":53}],53:[function(t,s,i){var o=e.FrankerFaceZ,n=t("./constants"),a=function(e,t,s){var i=document.createElement(e);return t&&(i.className=t),s&&(s.nodeType?i.appendChild(s):i.innerHTML=s),i},r=a("span"),l=function(e){return r.textContent=e,r.innerHTML},c=function(e){return e.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&gt;/g,">").replace(/&lt;/g,"<")},d=RegExp.escape||function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},h=/"/g,f=/'/g,u=/&/g,_=/</g,m=/>/g,g={},p=function(e){return e.replace(u,"&amp;").replace(h,"&quot;").replace(f,"&apos;").replace(_,"&lt;").replace(m,"&gt;")},v=function(e){return l(e).replace(h,"&quot;").replace(f,"&apos;")},b=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],y=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},w=function(e,t,s){return s=s||"s",t=t||"",1===e?t:s},z=function(e){return 1==e?"1st":2==e?"2nd":3==e?"3rd":null==e?"---":e+"th"},k=/^(\d{4}|\+\d{6})(?:-?(\d{2})(?:-?(\d{2})(?:T(\d{2})(?::?(\d{2})(?::?(\d{2})(?:(?:\.|,)(\d{1,}))?)?)?(Z|([\-+])(\d{2})(?::?(\d{2}))?)?)?)?)?$/,C=function(e){if("number"==typeof e)return new Date(e);var t=e.match(k);if(!t)return null;t[7]=t[7]&&t[7].length?t[7].substr(0,3):0;var s=Date.UTC(t[1],t[2]-1,t[3],t[4],t[5],t[6],t[7]);if(t[9]){var i=6e4*("-"==t[9]?1:-1)*(60*t[10]+1*t[11]);s+=i}return new Date(s)},x={b:"broadcaster",s:"staff",a:"admin",g:"global_mod",m:"moderator",u:"subscriber",t:"turbo"},T=function(e){if(e===!0)return{};for(var t={},s=e.split(","),i=s.length,o=0;i>o;o++){var n=s[o].split("/");if(2!==n.length)return{};t[x[n[0]]||n[0].substr(1)]=n[1]}return t},S=function(e){for(var t={},s=e.split("/"),i=s.length;i--;){var o=s[i].split(":");if(3!==o.length)return{};for(var n=o[0],a=parseInt(o[1]),r=o[2].split(","),l=t[n]=t[n]||[],c=0,d=r.length;d>c;c++){for(var h=parseInt(r[c]),f=h+a,u=0,_=l.length;_>u&&!(h<l[u][0]);u++);l.splice(u,0,[h,f])}}return t},E=/\uFE0F/g,M=String.fromCharCode(8205),L={},A=function(e,t){if(L[e]&&L[e][t])return L[e][t];for(var s=-1===e.indexOf(M)?e.replace(E,""):e,i=[],o=0,n=0,a=0;a<s.length;)o=s.charCodeAt(a++),n?(i.push((65536+(n-55296<<10)+(o-56320)).toString(16)),n=0):o>=55296&&56319>=o?n=o:i.push(o.toString(16));var r=L[e]=i.join("-");return r},O=function(e){var t="string"==typeof e?parseInt(e,16):e;return 65536>t?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))},I={},R=function(e){if(I[e])return I[e];var t=I[e]=n.TWITCH_BASE+e+"/1.0 1x, "+n.TWITCH_BASE+e+"/2.0 2x";return t},F=function(e,t,s,i,o){i=i||{};var a=i.headers=i.headers||{};return a["Client-ID"]=n.CLIENT_ID,o&&(a.Authorization="OAuth "+o),Twitch.api[e].call(this,t,s,i)},H=function(e,t,s){var i=a("div","twitch_subwindow_container"),o=a("div","twitch_subwindow ffz-subwindow"),r=a("div","card"),l=a("div","modal-close-button",n.CLOSE),c=function(){i.parentElement.removeChild(i)};i.id="ffz-modal-container",o.style.width="100%",o.style.maxWidth=(s||420)+"px",l.addEventListener("click",function(){c(),t&&t(!1)}),i.appendChild(o),o.appendChild(r),o.appendChild(l),r.appendChild(e);var d=document.querySelector("app-main");return d?d.parentElement.insertBefore(i,d.nextSibling):document.body.appendChild(i),c},D=function(t){if(e.App)try{if(App.__deprecatedInstance__&&App.__deprecatedInstance__.registry&&App.__deprecatedInstance__.registry.lookup)return App.__deprecatedInstance__.registry.lookup(t);if(App.__container__&&App.__container__.lookup)return App.__container__.lookup(t)}catch(s){return FrankerFaceZ.get().error("There was an error looking up an Ember instance: "+t,s),null}};s.exports=o.utils={ember_views:function(){return D("-view-registry:main")||{}},ember_lookup:D,ember_resolve:function(t){return e.App?App.__deprecatedInstance__&&App.__deprecatedInstance__.registry&&App.__deprecatedInstance__.registry.resolve?App.__deprecatedInstance__.registry.resolve(t):App.__container__&&App.__container__.resolve?App.__container__.resolve(t):void 0:void 0},ember_reopen_view:function(e,t){return"string"==typeof e&&(e=ember_resolve(e)),t.ffz_modified=!0,t.ffz_init&&!t.didInsertElement&&(t.didInsertElement=function(){this._super();try{this.ffz_init()}catch(e){o.get().error("An error occured running ffz_init on "+this.toString(),e)}}),t.ffz_destroy&&!t.willClearRender&&(t.willClearRender=function(){try{this.ffz_destroy()}catch(e){o.get().error("An error occured running ffz_destroy on "+this.toString(),e)}this._super()}),e.reopen(t);

},build_srcset:R,api:{del:function(e,t,s,i){return F("del",e,t,s,i)},get:function(e,t,s,i){return F("get",e,t,s,i)},post:function(e,t,s,i){return F("post",e,t,s,i)},put:function(e,t,s,i){return F("put",e,t,s,i)}},show_modal:H,confirm:function(e,t,s){var i=a("div","text-content"),o=e?a("div","content-header","<h4>"+e+"</h4>"):null,n=a("div","item"),r=a("div","buttons",'<a class="js-subwindow-close button"><span>Cancel</span></a><button class="button primary" type="submit"><span>OK</span></button>'),l=r.querySelector(".js-subwindow-close"),c=r.querySelector(".button.primary");o&&i.appendChild(o),t&&(t.nodeType?n.appendChild(t):n.innerHTML="<p>"+t+"</p>",i.appendChild(n)),i.appendChild(r);var d,h=function(e){d(),s&&s(e)};d=H(i,h),c.addEventListener("click",function(e){return e.preventDefault(),h(!0),!1}),l.addEventListener("click",function(e){return e.preventDefault(),h(!1),!1})},prompt:function(e,t,s,i,o,n){var r,l,c=a("div","text-content"),d=a("div","content-header","<h4>"+e+"</h4>"),h=a("form");n||(n=a("input"),n.type="text"),h.innerHTML='<div class="item">'+(t?"<p>"+t+"</p>":"")+'<div class="input-placeholder"></div><div class="buttons"><a class="js-subwindow-close button"><span>Cancel</span></a><button class="button primary" type="submit"><span>OK</span></button></div>';var f=h.querySelector(".input-placeholder"),u=f.parentElement;u.insertBefore(n,f),u.removeChild(f),c.appendChild(d),c.appendChild(h),r=h.querySelector(".js-subwindow-close"),l=h.querySelector(".button.primary"),void 0!==s&&(n.value=s);var _,m=function(e){_(),i&&i(e?n.value:null)};_=H(c,m,o);try{n.focus()}catch(g){}h.addEventListener("submit",function(e){return e.preventDefault(),m(!0),!1}),l.addEventListener("click",function(e){return e.preventDefault(),m(!0),!1}),r.addEventListener("click",function(e){return e.preventDefault(),m(!1),!1})},last_minute:function(){var e=new Date;return e.getSeconds()>=30&&e.setMinutes(e.getMinutes()+1),e.setSeconds(0),e.setMilliseconds(0),e.getTime()},maybe_chart:function(e,t,s,i){var o=e.data.length;return i||null!==t.y||o>0&&null!==e.data[o-1].y?(e.addPoint(t,s),!0):!1},update_css:function(e,t,s){var i=e.innerHTML,o="/*BEGIN "+t+"*/",n="/*END "+t+"*/",a=i.indexOf(o),r=i.indexOf(n),l=-1!==a&&-1!==r&&r>a;(l||s)&&(l&&(i=i.substr(0,a)+i.substr(r+n.length)),s&&(i+=o+s+n),e.innerHTML=i)},tooltip_placement:function(t,s){return function(){var i=s;"function"==typeof i&&(i=i.call(this));var o={};-1!==i.indexOf("n")?o.ns="n":-1!==i.indexOf("s")&&(o.ns="s"),-1!==i.indexOf("e")?o.ew="e":-1!==i.indexOf("w")&&(o.ew="w");var n=$(this),a=n.width()/2,r=n.height()/2,l=$(document).scrollTop()+r+2*t,c=$(document).scrollLeft()+a+t;return n.offset().top<l&&(o.ns="n"),n.offset().left<c&&(o.ew="w"),$(e).width()+$(document).scrollLeft()-(n.offset().left+a)<t&&(o.ew="e"),$(e).height()+$(document).scrollTop()-(n.offset().top+r)<2*t&&(o.ns="s"),(o.ns?o.ns:"")+(o.ew?o.ew:"")}},uncompressBadges:T,uncompressEmotes:S,emoji_to_codepoint:A,codepoint_to_emoji:O,parse_date:C,number_commas:y,place_string:z,placement:function(e){return"forfeit"==e.state?"Forfeit":"dq"==e.state?"DQed":e.place?z(e.place):""},sanitize:l,unquote_attr:c,quote_attr:p,quote_san:v,date_string:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},pluralize:w,human_number:function(e){return b[e]||y(e)},human_time:function(e,t){t=t||1,e=Math.floor(e);var s=Math.floor(e*t/31536e3)/t;if(s>=1)return s+" year"+w(s);var i=Math.floor((e%=31536e3)/86400);if(i>=1)return i+" day"+w(i);var o=Math.floor((e%=86400)/3600);if(o>=1)return o+" hour"+w(o);var n=Math.floor((e%=3600)/60);if(n>=1)return n+" minute"+w(n);var a=e%60;return a>=1?a+" second"+w(a):"less than a second"},time_to_string:function(e,t,s,i,o){var n=e%60,a=Math.floor(e/60),r=Math.floor(a/60),l=null;if(a%=60,t){if(l=Math.floor(r/24),r%=24,s&&l>0)return l+" days";l=l>0?l+" days, ":""}return(l||"")+(!i||l||r?(l&&10>r?"0":"")+r+":":"")+(10>a?"0":"")+a+(o?"":":"+(10>n?"0":"")+n)},duration_string:function(e,t){if(!t&&1===e)return"Purge";if(g[e])return g[e];var s,i,o,n,a;s=Math.floor(e/604800),a=e%604800,i=Math.floor(a/86400),a%=86400,o=Math.floor(a/3600),a%=3600,n=Math.floor(a/60),a%=60;var r=g[e]=(s?s+"w":"")+(i||s&&(o||n||a)?i+"d":"")+(o||(s||i)&&(n||a)?o+"h":"")+(n||(s||i||o)&&a?n+"m":"")+(a?a+"s":"");return r},format_unread:function(e){return 1>e?"":e>=99?"99+":""+e},format_size:function(e){if(Math.abs(e)<1024)return e+" b";var t=["Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],s=-1;do e/=1024,++s;while(Math.abs(e)>=1024&&s<t.length-1);return e.toFixed(1)+" "+t[s]},escape_regex:d,createElement:a,toggle_cls:function(e){return function(t){document.body.classList.toggle(e,t)}},badge_css:function(e,t){t=t||"ffz-badge-"+e.id;var s=".badges ."+t+" { background-color: "+e.color+'; background-image: url("'+e.image+'"); '+(e.css||"")+"}";return e.alpha_image&&(s+=".badges .badge.alpha."+t+",.ffz-transparent-badges .badges ."+t+' { background-image: url("'+e.alpha_image+'"); }'),s}}},{"./constants":6}]},{},[31]),e.ffz=new FrankerFaceZ}(window);